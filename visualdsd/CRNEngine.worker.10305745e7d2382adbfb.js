!function(f){var t={};function e(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return f[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=f,e.c=t,e.d=function(f,t,n){e.o(f,t)||Object.defineProperty(f,t,{enumerable:!0,get:n})},e.r=function(f){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},e.t=function(f,t){if(1&t&&(f=e(f)),8&t)return f;if(4&t&&"object"==typeof f&&f&&f.__esModule)return f;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:f}),2&t&&"string"!=typeof f)for(var r in f)e.d(n,r,function(t){return f[t]}.bind(null,r));return n},e.n=function(f){var t=f&&f.__esModule?function(){return f.default}:function(){return f};return e.d(t,"a",t),t},e.o=function(f,t){return Object.prototype.hasOwnProperty.call(f,t)},e.p="",e(e.s=7)}([function(f,t){var e,n,r=f.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(f){if(e===setTimeout)return setTimeout(f,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(f,0);try{return e(f,0)}catch(t){try{return e.call(null,f,0)}catch(t){return e.call(this,f,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(f){e=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(f){n=o}}();var u,s=[],c=!1,l=-1;function d(){c&&u&&(c=!1,u.length?s=u.concat(s):l=-1,s.length&&p())}function p(){if(!c){var f=a(d);c=!0;for(var t=s.length;t;){for(u=s,s=[];++l<t;)u&&u[l].run();l=-1,t=s.length}u=null,c=!1,function(f){if(n===clearTimeout)return clearTimeout(f);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(f);try{n(f)}catch(t){try{return n.call(null,f)}catch(t){return n.call(this,f)}}}(f)}}function m(f,t){this.fun=f,this.array=t}function _(){}r.nextTick=function(f){var t=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];s.push(new m(f,t)),1!==s.length||c||a(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=_,r.addListener=_,r.once=_,r.off=_,r.removeListener=_,r.removeAllListeners=_,r.emit=_,r.prependListener=_,r.prependOnceListener=_,r.listeners=function(f){return[]},r.binding=function(f){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(f){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(f,t,e){(function(t){f.exports=function(f){var n,r=void 0!==(f=f||{})?f:{},i={};for(n in r)r.hasOwnProperty(n)&&(i[n]=r[n]);r.arguments=[],r.thisProgram="./this.program",r.quit=function(f,t){throw t},r.preRun=[],r.postRun=[];var o,a,u=!1,s=!1,c=!1,l=!1;if(r.ENVIRONMENT)if("WEB"===r.ENVIRONMENT)u=!0;else if("WORKER"===r.ENVIRONMENT)s=!0;else if("NODE"===r.ENVIRONMENT)c=!0;else{if("SHELL"!==r.ENVIRONMENT)throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");l=!0}else u="object"==typeof window,s="function"==typeof importScripts,c="object"==typeof t&&!u&&!s,l=!u&&!c&&!s;if(c)r.read=function(f,t){var n;return o||(o=e(4)),a||(a=e(5)),f=a.normalize(f),n=o.readFileSync(f),t?n:n.toString()},r.readBinary=function(f){var t=r.read(f,!0);return t.buffer||(t=new Uint8Array(t)),b(t.buffer),t},t.argv.length>1&&(r.thisProgram=t.argv[1].replace(/\\/g,"/")),r.arguments=t.argv.slice(2),t.on("uncaughtException",(function(f){if(!(f instanceof ie))throw f})),t.on("unhandledRejection",(function(f,e){t.exit(1)})),r.inspect=function(){return"[Emscripten Module object]"};else if(l)"undefined"!=typeof read&&(r.read=function(f){return read(f)}),r.readBinary=function(f){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(f)):(b("object"==typeof(t=read(f,"binary"))),t)},"undefined"!=typeof scriptArgs?r.arguments=scriptArgs:void 0!==arguments&&(r.arguments=arguments),"function"==typeof quit&&(r.quit=function(f,t){quit(f)});else{if(!u&&!s)throw new Error("not compiled for this environment");r.read=function(f){var t=new XMLHttpRequest;return t.open("GET",f,!1),t.send(null),t.responseText},s&&(r.readBinary=function(f){var t=new XMLHttpRequest;return t.open("GET",f,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),r.readAsync=function(f,t,e){var n=new XMLHttpRequest;n.open("GET",f,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):e()},n.onerror=e,n.send(null)},r.setWindowTitle=function(f){document.title=f}}for(n in r.print="undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null,r.printErr="undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||r.print,r.print=r.print,r.printErr=r.printErr,i)i.hasOwnProperty(n)&&(r[n]=i[n]);i=void 0;var d=16;function p(f){b(!j);var t=x;return x=x+f+15&-16,t}function m(f,t){return t||(t=d),f=Math.ceil(f/t)*t}var _=1,C=new Array(5);function g(f,t){for(var e=0;e<5;e++)if(!C[e])return C[e]=f,_+e;throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."}function $(f){C[f-_]=null}var D=1024,B=0;function b(f,t){f||ue("Assertion failed: "+t)}function E(f){var t=r["_"+f];return b(t,"Cannot call unknown function "+f+", make sure it is exported"),t}var h={stackSave:function(){re()},stackRestore:function(){ne()},arrayToC:function(f){var t=ee(f.length);return gf(f,t),t},stringToC:function(f){var t=0;if(null!=f&&0!==f){var e=1+(f.length<<2);M(f,t=ee(e),e)}return t}},G={string:h.stringToC,array:h.arrayToC};function v(f,t,e,n,r){var i=E(f),o=[],a=0;if(n)for(var u=0;u<n.length;u++){var s=G[e[u]];s?(0===a&&(a=re()),o[u]=s(n[u])):o[u]=n[u]}var c=i.apply(null,o);return"string"===t?c=y(c):"boolean"===t&&(c=Boolean(c)),0!==a&&ne(a),c}function F(f,t,e){e=e||[];var n=E(f),r=e.every((function(f){return"number"===f}));return"string"!==t&&r?n:function(){return v(f,t,e,arguments)}}function y(f,t){if(0===t||!f)return"";for(var e,n=0,r=0;n|=e=H[f+r>>0],(0!=e||t)&&(r++,!t||r!=t););t||(t=r);var i="";if(n<128){for(var o;t>0;)o=String.fromCharCode.apply(String,H.subarray(f,f+Math.min(t,1024))),i=i?i+o:o,f+=1024,t-=1024;return i}return N(f)}var I="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(f,t){for(var e=t;f[e];)++e;if(e-t>16&&f.subarray&&I)return I.decode(f.subarray(t,e));for(var n,r,i,o,a,u="";;){if(!(n=f[t++]))return u;if(128&n)if(r=63&f[t++],192!=(224&n))if(i=63&f[t++],224==(240&n)?n=(15&n)<<12|r<<6|i:(o=63&f[t++],240==(248&n)?n=(7&n)<<18|r<<12|i<<6|o:(a=63&f[t++],n=248==(252&n)?(3&n)<<24|r<<18|i<<12|o<<6|a:(1&n)<<30|r<<24|i<<18|o<<12|a<<6|63&f[t++])),n<65536)u+=String.fromCharCode(n);else{var s=n-65536;u+=String.fromCharCode(55296|s>>10,56320|1023&s)}else u+=String.fromCharCode((31&n)<<6|r);else u+=String.fromCharCode(n)}}function N(f){return w(H,f)}function A(f,t,e,n){if(!(n>0))return 0;for(var r=e,i=e+n-1,o=0;o<f.length;++o){var a=f.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&f.charCodeAt(++o)),a<=127){if(e>=i)break;t[e++]=a}else if(a<=2047){if(e+1>=i)break;t[e++]=192|a>>6,t[e++]=128|63&a}else if(a<=65535){if(e+2>=i)break;t[e++]=224|a>>12,t[e++]=128|a>>6&63,t[e++]=128|63&a}else if(a<=2097151){if(e+3>=i)break;t[e++]=240|a>>18,t[e++]=128|a>>12&63,t[e++]=128|a>>6&63,t[e++]=128|63&a}else if(a<=67108863){if(e+4>=i)break;t[e++]=248|a>>24,t[e++]=128|a>>18&63,t[e++]=128|a>>12&63,t[e++]=128|a>>6&63,t[e++]=128|63&a}else{if(e+5>=i)break;t[e++]=252|a>>30,t[e++]=128|a>>24&63,t[e++]=128|a>>18&63,t[e++]=128|a>>12&63,t[e++]=128|a>>6&63,t[e++]=128|63&a}}return t[e]=0,e-r}function M(f,t,e){return A(f,H,t,e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var S,L,H,U,R,O,x,j,J,T,k,P,K,W=65536,q=16777216;function V(f,t){return f%t>0&&(f+=t-f%t),f}function z(f){r.buffer=S=f}function Q(){r.HEAP8=L=new Int8Array(S),r.HEAP16=U=new Int16Array(S),r.HEAP32=R=new Int32Array(S),r.HEAPU8=H=new Uint8Array(S),r.HEAPU16=new Uint16Array(S),r.HEAPU32=new Uint32Array(S),r.HEAPF32=new Float32Array(S),r.HEAPF64=new Float64Array(S)}function Z(){ue("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+ff+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function Y(){Z()}O=x=J=T=k=P=K=0,j=!1;var X=r.TOTAL_STACK||5242880,ff=r.TOTAL_MEMORY||16777216;function tf(){return ff}if(ff<X&&r.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+ff+"! (TOTAL_STACK="+X+")"),r.buffer?S=r.buffer:("object"==typeof WebAssembly&&"function"==typeof WebAssembly.Memory?(r.wasmMemory=new WebAssembly.Memory({initial:ff/W,maximum:ff/W}),S=r.wasmMemory.buffer):S=new ArrayBuffer(ff),r.buffer=S),Q(),R[0]=1668509029,U[1]=25459,115!==H[2]||99!==H[3])throw"Runtime error: expected the system to be little-endian!";function ef(f){for(;f.length>0;){var t=f.shift();if("function"!=typeof t){var e=t.func;"number"==typeof e?void 0===t.arg?r.dynCall_v(e):r.dynCall_vi(e,t.arg):e(void 0===t.arg?null:t.arg)}else t()}}var nf=[],rf=[],of=[],af=[],uf=[],sf=!1;function cf(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)_f(r.preRun.shift());ef(nf)}function lf(){sf||(sf=!0,ef(rf))}function df(){ef(of)}function pf(){ef(af),!0}function mf(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)Cf(r.postRun.shift());ef(uf)}function _f(f){nf.unshift(f)}function Cf(f){uf.unshift(f)}function gf(f,t){L.set(f,t)}var $f=Math.abs,Df=(Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.atan2,Math.exp,Math.log,Math.sqrt,Math.ceil,Math.floor,Math.pow,Math.imul,Math.fround,Math.round,Math.min,Math.max,Math.clz32,Math.trunc,0),Bf=null,bf=null;function Ef(f){Df++,r.monitorRunDependencies&&r.monitorRunDependencies(Df)}function hf(f){if(Df--,r.monitorRunDependencies&&r.monitorRunDependencies(Df),0==Df&&(null!==Bf&&(clearInterval(Bf),Bf=null),bf)){var t=bf;bf=null,t()}}r.preloadedImages={},r.preloadedAudios={};var Gf="data:application/octet-stream;base64,";function vf(f){return String.prototype.startsWith?f.startsWith(Gf):0===f.indexOf(Gf)}function Ff(){var f="SundialsSolver.wast",t="SundialsSolver.wasm",e="SundialsSolver.temp.asm.js";"function"==typeof r.locateFile&&(vf(f)||(f=r.locateFile(f)),vf(t)||(t=r.locateFile(t)),vf(e)||(e=r.locateFile(e)));var n={global:null,env:null,asm2wasm:{"f64-rem":function(f,t){return f%t},debugger:function(){}},parent:r},i=null;function o(){try{if(r.wasmBinary)return new Uint8Array(r.wasmBinary);if(r.readBinary)return r.readBinary(t);throw"on the web, we need the wasm binary to be preloaded and set on Module['wasmBinary']. emcc.py will do that for you when generating HTML (but not JS)"}catch(f){ue(f)}}function a(f,e,a){if("object"!=typeof WebAssembly)return r.printErr("no native wasm support detected"),!1;if(!(r.wasmMemory instanceof WebAssembly.Memory))return r.printErr("no native wasm Memory in use"),!1;function c(f,t){(i=f.exports).memory&&function(f){var t=r.buffer;f.byteLength<t.byteLength&&r.printErr("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here");var e=new Int8Array(t);new Int8Array(f).set(e),z(f),Q()}(i.memory),r.asm=i,r.usingWasm=!0,hf()}if(e.memory=r.wasmMemory,n.global={NaN:NaN,Infinity:1/0},n["global.Math"]=Math,n.env=e,Ef(),r.instantiateWasm)try{return r.instantiateWasm(n,c)}catch(f){return r.printErr("Module.instantiateWasm callback failed with error: "+f),!1}function l(f){c(f.instance,f.module)}function d(f){(r.wasmBinary||!u&&!s||"function"!=typeof fetch?new Promise((function(f,t){f(o())})):fetch(t,{credentials:"same-origin"}).then((function(f){if(!f.ok)throw"failed to load wasm binary file at '"+t+"'";return f.arrayBuffer()})).catch((function(){return o()}))).then((function(f){return WebAssembly.instantiate(f,n)})).then(f).catch((function(f){r.printErr("failed to asynchronously prepare wasm: "+f),ue(f)}))}return r.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||vf(t)||"function"!=typeof fetch?d(l):WebAssembly.instantiateStreaming(fetch(t,{credentials:"same-origin"}),n).then(l).catch((function(f){r.printErr("wasm streaming compile failed: "+f),r.printErr("falling back to ArrayBuffer instantiation"),d(l)})),{}}r.asmPreload=r.asm;var c=r.reallocBuffer;r.reallocBuffer=function(f){return"asmjs"===l?c(f):function(f){f=V(f,r.usingWasm?W:q);var t=r.buffer.byteLength;if(r.usingWasm)try{return-1!==r.wasmMemory.grow((f-t)/65536)?r.buffer=r.wasmMemory.buffer:null}catch(f){return null}}(f)};var l="";r.asm=function(f,t,e){if(!(t=t).table){var n=r.wasmTableSize;void 0===n&&(n=1024);var i=r.wasmMaxTableSize;"object"==typeof WebAssembly&&"function"==typeof WebAssembly.Table?t.table=void 0!==i?new WebAssembly.Table({initial:n,maximum:i,element:"anyfunc"}):new WebAssembly.Table({initial:n,element:"anyfunc"}):t.table=new Array(n),r.wasmTable=t.table}var o;return t.memoryBase||(t.memoryBase=r.STATIC_BASE),t.tableBase||(t.tableBase=0),b(o=a(0,t),"no binaryen method succeeded."),o}}Ff(),x=(O=D)+9728,rf.push();var yf=9728;r.STATIC_BASE=O,r.STATIC_BUMP=yf;var If=x;function wf(f){return fe(f)}function Nf(){return!!Nf.uncaught_exception}x+=16;var Af={last:0,caught:[],infos:{},deAdjust:function(f){if(!f||Af.infos[f])return f;for(var t in Af.infos){var e=+t;if(Af.infos[e].adjusted===f)return e}return f},addRef:function(f){f&&Af.infos[f].refcount++},decRef:function(f){if(f){var t=Af.infos[f];b(t.refcount>0),t.refcount--,0!==t.refcount||t.rethrown||(t.destructor&&r.dynCall_vi(t.destructor,f),delete Af.infos[f],___cxa_free_exception(f))}},clearRef:function(f){f&&(Af.infos[f].refcount=0)}};function Mf(f){var t=Af.infos[f];return t&&!t.caught&&(t.caught=!0,Nf.uncaught_exception--),t&&(t.rethrown=!1),Af.caught.push(f),Af.addRef(Af.deAdjust(f)),f}function Sf(f){throw Af.last||(Af.last=f),f+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function Lf(){var f=Af.last;if(!f)return 0|(te(0),0);var t=Af.infos[f],e=t.type;if(!e)return 0|(te(0),f);var n=Array.prototype.slice.call(arguments);r.___cxa_is_pointer_type(e);Lf.buffer||(Lf.buffer=fe(4)),R[Lf.buffer>>2]=f,f=Lf.buffer;for(var i=0;i<n.length;i++)if(n[i]&&r.___cxa_can_catch(n[i],e,f))return f=R[f>>2],t.adjusted=f,0|(te(n[i]),f);return f=R[f>>2],0|(te(e),f)}function Hf(f,t,e){throw Af.infos[f]={ptr:f,adjusted:f,type:t,destructor:e,refcount:0,caught:!1,rethrown:!1},Af.last=f,"uncaught_exception"in Nf?Nf.uncaught_exception++:Nf.uncaught_exception=1,f+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function Uf(){}var Rf={varargs:0,get:function(f){return Rf.varargs+=4,R[Rf.varargs-4>>2]},getStr:function(){return y(Rf.get())},get64:function(){var f=Rf.get(),t=Rf.get();return b(f>=0?0===t:-1===t),f},getZero:function(){b(0===Rf.get())}};function Of(f,t){Rf.varargs=t;try{var e=Rf.getStreamFromFD(),n=(Rf.get(),Rf.get()),r=Rf.get(),i=Rf.get(),o=n;return FS.llseek(e,o,i),R[r>>2]=e.position,e.getdents&&0===o&&0===i&&(e.getdents=null),0}catch(f){return"undefined"!=typeof FS&&f instanceof FS.ErrnoError||ue(f),-f.errno}}function xf(){var f=r._fflush;f&&f(0);var t=jf.printChar;if(t){var e=jf.buffers;e[1].length&&t(1,10),e[2].length&&t(2,10)}}function jf(f,t){Rf.varargs=t;try{var e=Rf.get(),n=Rf.get(),i=Rf.get(),o=0;jf.buffers||(jf.buffers=[null,[],[]],jf.printChar=function(f,t){var e=jf.buffers[f];b(e),0===t||10===t?((1===f?r.print:r.printErr)(w(e,0)),e.length=0):e.push(t)});for(var a=0;a<i;a++){for(var u=R[n+8*a>>2],s=R[n+(8*a+4)>>2],c=0;c<s;c++)jf.printChar(e,H[u+c]);o+=s}return o}catch(f){return"undefined"!=typeof FS&&f instanceof FS.ErrnoError||ue(f),-f.errno}}function Jf(f,t){Rf.varargs=t;try{return 0}catch(f){return"undefined"!=typeof FS&&f instanceof FS.ErrnoError||ue(f),-f.errno}}function Tf(f,t){Rf.varargs=t;try{var e=Rf.getStreamFromFD();return FS.close(e),0}catch(f){return"undefined"!=typeof FS&&f instanceof FS.ErrnoError||ue(f),-f.errno}}function kf(){r.abort()}var Pf=$f;function Kf(f,t,e){return H.set(H.subarray(t,t+e),f),f}var Wf={};function qf(f){return Wf[f]||0}var Vf=1,zf={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function Qf(f,t){return 0==f?zf.EINVAL:(R[f>>2]=Vf,Wf[Vf]=0,Vf++,0)}function Zf(f,t){Zf.seen||(Zf.seen={}),f in Zf.seen||(r.dynCall_v(t),Zf.seen[f]=1)}function Yf(f,t){return f in Wf?(Wf[f]=t,0):zf.EINVAL}function Xf(f){return r.___errno_location&&(R[r.___errno_location()>>2]=f),f}K=p(4),J=T=m(x),P=m(k=J+X),R[K>>2]=P,j=!0;function ft(f,t,e,n){try{return r.dynCall_ddii(f,t,e,n)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function tt(f,t,e,n){return C[f](t,e,n)}function et(f,t){try{return r.dynCall_di(f,t)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function nt(f,t){return C[f](t)}function rt(f,t,e){try{return r.dynCall_dii(f,t,e)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function it(f,t,e){return C[f](t,e)}function ot(f,t,e,n){try{return r.dynCall_diii(f,t,e,n)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function at(f,t,e,n){return C[f](t,e,n)}function ut(f,t,e){try{return r.dynCall_idi(f,t,e)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function st(f,t,e){return C[f](t,e)}function ct(f,t,e,n){try{return r.dynCall_idii(f,t,e,n)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function lt(f,t,e,n){return C[f](t,e,n)}function dt(f,t,e,n,i){try{return r.dynCall_idiii(f,t,e,n,i)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function pt(f,t,e,n,r){return C[f](t,e,n,r)}function mt(f,t,e,n,i,o,a,u,s){try{return r.dynCall_idiiiiiii(f,t,e,n,i,o,a,u,s)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function _t(f,t,e,n,r,i,o,a,u){return C[f](t,e,n,r,i,o,a,u)}function Ct(f,t){try{return r.dynCall_ii(f,t)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function gt(f,t){return C[f](t)}function $t(f,t,e){try{return r.dynCall_iii(f,t,e)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function Dt(f,t,e){return C[f](t,e)}function Bt(f,t,e,n){try{return r.dynCall_iiii(f,t,e,n)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function bt(f,t,e,n){return C[f](t,e,n)}function Et(f,t,e,n,i,o){try{return r.dynCall_iiiiid(f,t,e,n,i,o)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function ht(f,t,e,n,r,i){return C[f](t,e,n,r,i)}function Gt(f,t,e,n,i,o){try{return r.dynCall_iiiiii(f,t,e,n,i,o)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function vt(f,t,e,n,r,i){return C[f](t,e,n,r,i)}function Ft(f,t,e,n,i,o,a,u,s){try{return r.dynCall_iiiiiiiii(f,t,e,n,i,o,a,u,s)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function yt(f,t,e,n,r,i,o,a,u){return C[f](t,e,n,r,i,o,a,u)}function It(f){try{r.dynCall_v(f)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function wt(f){C[f]()}function Nt(f,t,e){try{r.dynCall_vdi(f,t,e)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function At(f,t,e){C[f](t,e)}function Mt(f,t,e,n,i,o){try{r.dynCall_vdidii(f,t,e,n,i,o)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function St(f,t,e,n,r,i){C[f](t,e,n,r,i)}function Lt(f,t,e,n){try{r.dynCall_vdii(f,t,e,n)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function Ht(f,t,e,n){C[f](t,e,n)}function Ut(f,t,e,n,i){try{r.dynCall_vdiii(f,t,e,n,i)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function Rt(f,t,e,n,r){C[f](t,e,n,r)}function Ot(f,t){try{r.dynCall_vi(f,t)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function xt(f,t){C[f](t)}function jt(f,t,e,n){try{r.dynCall_vidi(f,t,e,n)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function Jt(f,t,e,n){C[f](t,e,n)}function Tt(f,t,e){try{r.dynCall_vii(f,t,e)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function kt(f,t,e){C[f](t,e)}function Pt(f,t,e,n){try{r.dynCall_viii(f,t,e,n)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function Kt(f,t,e,n){C[f](t,e,n)}function Wt(f,t,e,n,i){try{r.dynCall_viiii(f,t,e,n,i)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function qt(f,t,e,n,r){C[f](t,e,n,r)}function Vt(f,t,e,n,i,o){try{r.dynCall_viiiii(f,t,e,n,i,o)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function zt(f,t,e,n,r,i){C[f](t,e,n,r,i)}function Qt(f,t,e,n,i,o,a){try{r.dynCall_viiiiii(f,t,e,n,i,o,a)}catch(f){if("number"!=typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}}function Zt(f,t,e,n,r,i,o){C[f](t,e,n,r,i,o)}r.wasmTableSize=312,r.wasmMaxTableSize=312,r.asmGlobalArg={},r.asmLibraryArg={abort:ue,assert:b,enlargeMemory:Y,getTotalMemory:tf,abortOnCannotGrowMemory:Z,invoke_ddii:ft,jsCall_ddii:tt,invoke_di:et,jsCall_di:nt,invoke_dii:rt,jsCall_dii:it,invoke_diii:ot,jsCall_diii:at,invoke_idi:ut,jsCall_idi:st,invoke_idii:ct,jsCall_idii:lt,invoke_idiii:dt,jsCall_idiii:pt,invoke_idiiiiiii:mt,jsCall_idiiiiiii:_t,invoke_ii:Ct,jsCall_ii:gt,invoke_iii:$t,jsCall_iii:Dt,invoke_iiii:Bt,jsCall_iiii:bt,invoke_iiiiid:Et,jsCall_iiiiid:ht,invoke_iiiiii:Gt,jsCall_iiiiii:vt,invoke_iiiiiiiii:Ft,jsCall_iiiiiiiii:yt,invoke_v:It,jsCall_v:wt,invoke_vdi:Nt,jsCall_vdi:At,invoke_vdidii:Mt,jsCall_vdidii:St,invoke_vdii:Lt,jsCall_vdii:Ht,invoke_vdiii:Ut,jsCall_vdiii:Rt,invoke_vi:Ot,jsCall_vi:xt,invoke_vidi:jt,jsCall_vidi:Jt,invoke_vii:Tt,jsCall_vii:kt,invoke_viii:Pt,jsCall_viii:Kt,invoke_viiii:Wt,jsCall_viiii:qt,invoke_viiiii:Vt,jsCall_viiiii:zt,invoke_viiiiii:Qt,jsCall_viiiiii:Zt,__ZSt18uncaught_exceptionv:Nf,___cxa_allocate_exception:wf,___cxa_begin_catch:Mf,___cxa_find_matching_catch:Lf,___cxa_throw:Hf,___gxx_personality_v0:Uf,___resumeException:Sf,___setErrNo:Xf,___syscall140:Of,___syscall146:jf,___syscall54:Jf,___syscall6:Tf,_abort:kf,_emscripten_memcpy_big:Kf,_llvm_fabs_f64:Pf,_pthread_getspecific:qf,_pthread_key_create:Qf,_pthread_once:Zf,_pthread_setspecific:Yf,flush_NO_FILESYSTEM:xf,DYNAMICTOP_PTR:K,tempDoublePtr:If,ABORT:B,STACKTOP:T,STACK_MAX:k};var Yt=r.asm(r.asmGlobalArg,r.asmLibraryArg,S);r.asm=Yt;r.___cxa_can_catch=function(){return r.asm.___cxa_can_catch.apply(null,arguments)},r.___cxa_is_pointer_type=function(){return r.asm.___cxa_is_pointer_type.apply(null,arguments)},r.___errno_location=function(){return r.asm.___errno_location.apply(null,arguments)},r._fnSundialsCMESolver=function(){return r.asm._fnSundialsCMESolver.apply(null,arguments)},r._fnSundialsSolver=function(){return r.asm._fnSundialsSolver.apply(null,arguments)},r._free=function(){return r.asm._free.apply(null,arguments)},r._llvm_bswap_i32=function(){return r.asm._llvm_bswap_i32.apply(null,arguments)};var Xt,fe=r._malloc=function(){return r.asm._malloc.apply(null,arguments)},te=(r._memcpy=function(){return r.asm._memcpy.apply(null,arguments)},r._memset=function(){return r.asm._memset.apply(null,arguments)},r._sbrk=function(){return r.asm._sbrk.apply(null,arguments)},r.establishStackSpace=function(){return r.asm.establishStackSpace.apply(null,arguments)},r.getTempRet0=function(){return r.asm.getTempRet0.apply(null,arguments)},r.runPostSets=function(){return r.asm.runPostSets.apply(null,arguments)},r.setTempRet0=function(){return r.asm.setTempRet0.apply(null,arguments)}),ee=(r.setThrew=function(){return r.asm.setThrew.apply(null,arguments)},r.stackAlloc=function(){return r.asm.stackAlloc.apply(null,arguments)}),ne=r.stackRestore=function(){return r.asm.stackRestore.apply(null,arguments)},re=r.stackSave=function(){return r.asm.stackSave.apply(null,arguments)};r.dynCall_ddii=function(){return r.asm.dynCall_ddii.apply(null,arguments)},r.dynCall_di=function(){return r.asm.dynCall_di.apply(null,arguments)},r.dynCall_dii=function(){return r.asm.dynCall_dii.apply(null,arguments)},r.dynCall_diii=function(){return r.asm.dynCall_diii.apply(null,arguments)},r.dynCall_idi=function(){return r.asm.dynCall_idi.apply(null,arguments)},r.dynCall_idii=function(){return r.asm.dynCall_idii.apply(null,arguments)},r.dynCall_idiii=function(){return r.asm.dynCall_idiii.apply(null,arguments)},r.dynCall_idiiiiiii=function(){return r.asm.dynCall_idiiiiiii.apply(null,arguments)},r.dynCall_ii=function(){return r.asm.dynCall_ii.apply(null,arguments)},r.dynCall_iii=function(){return r.asm.dynCall_iii.apply(null,arguments)},r.dynCall_iiii=function(){return r.asm.dynCall_iiii.apply(null,arguments)},r.dynCall_iiiiid=function(){return r.asm.dynCall_iiiiid.apply(null,arguments)},r.dynCall_iiiiii=function(){return r.asm.dynCall_iiiiii.apply(null,arguments)},r.dynCall_iiiiiiiii=function(){return r.asm.dynCall_iiiiiiiii.apply(null,arguments)},r.dynCall_v=function(){return r.asm.dynCall_v.apply(null,arguments)},r.dynCall_vdi=function(){return r.asm.dynCall_vdi.apply(null,arguments)},r.dynCall_vdidii=function(){return r.asm.dynCall_vdidii.apply(null,arguments)},r.dynCall_vdii=function(){return r.asm.dynCall_vdii.apply(null,arguments)},r.dynCall_vdiii=function(){return r.asm.dynCall_vdiii.apply(null,arguments)},r.dynCall_vi=function(){return r.asm.dynCall_vi.apply(null,arguments)},r.dynCall_vidi=function(){return r.asm.dynCall_vidi.apply(null,arguments)},r.dynCall_vii=function(){return r.asm.dynCall_vii.apply(null,arguments)},r.dynCall_viii=function(){return r.asm.dynCall_viii.apply(null,arguments)},r.dynCall_viiii=function(){return r.asm.dynCall_viiii.apply(null,arguments)},r.dynCall_viiiii=function(){return r.asm.dynCall_viiiii.apply(null,arguments)},r.dynCall_viiiiii=function(){return r.asm.dynCall_viiiiii.apply(null,arguments)};function ie(f){this.name="ExitStatus",this.message="Program terminated with exit("+f+")",this.status=f}function oe(f){function t(){r.calledRun||(r.calledRun=!0,B||(lf(),df(),r.onRuntimeInitialized&&r.onRuntimeInitialized(),mf()))}f=f||r.arguments,Df>0||(cf(),Df>0||r.calledRun||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),t()}),1)):t()))}function ae(f,e){e&&r.noExitRuntime&&0===f||(r.noExitRuntime||(B=!0,f,T=Xt,pf(),r.onExit&&r.onExit(f)),c&&t.exit(f),r.quit(f,new ie(f)))}function ue(f){throw r.onAbort&&r.onAbort(f),void 0!==f?(r.print(f),r.printErr(f),f=JSON.stringify(f)):f="",B=!0,1,"abort("+f+"). Build with -s ASSERTIONS=1 for more info."}if(r.asm=Yt,r.ccall=v,r.cwrap=F,r.addFunction=g,r.removeFunction=$,r.then=function(f){if(r.calledRun)f(r);else{var t=r.onRuntimeInitialized;r.onRuntimeInitialized=function(){t&&t(),f(r)}}return r},ie.prototype=new Error,ie.prototype.constructor=ie,bf=function f(){r.calledRun||oe(),r.calledRun||(bf=f)},r.run=oe,r.exit=ae,r.abort=ue,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return r.noExitRuntime=!0,oe(),f}}).call(this,e(0))},function(f,t,e){f.exports=e.p+"c3cea96d61e0c717c244775efc64ee00.wasm"},function(f,t){f.exports='"use strict";\r\n// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT License.\r\n//PhantomJS which is used in build agent test environment does not have console. Placing a stub here, so the scripts calling console won\'t crash\r\nif (typeof console === "undefined")\r\n    console = {\r\n        assert: function (test, message) {\r\n            var optionalParams = [];\r\n            for (var _i = 2; _i < arguments.length; _i++) {\r\n                optionalParams[_i - 2] = arguments[_i];\r\n            }\r\n            throw "Assertion not supported";\r\n        },\r\n        clear: function () { },\r\n        count: function (countTitle) { },\r\n        debug: function (message) {\r\n            var optionalParams = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                optionalParams[_i - 1] = arguments[_i];\r\n            }\r\n        },\r\n        dir: function (value) {\r\n            var optionalParams = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                optionalParams[_i - 1] = arguments[_i];\r\n            }\r\n        },\r\n        dirxml: function (value) { },\r\n        error: function (message) {\r\n            var optionalParams = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                optionalParams[_i - 1] = arguments[_i];\r\n            }\r\n        },\r\n        group: function (groupTitle) { },\r\n        groupCollapsed: function (groupTitle) { },\r\n        groupEnd: function () { },\r\n        info: function (message) {\r\n            var optionalParams = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                optionalParams[_i - 1] = arguments[_i];\r\n            }\r\n        },\r\n        log: function (message) {\r\n            var optionalParams = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                optionalParams[_i - 1] = arguments[_i];\r\n            }\r\n        },\r\n        msIsIndependentlyComposed: function (element) { return false; },\r\n        profile: function (reportName) { },\r\n        profileEnd: function () { },\r\n        select: function (element) { },\r\n        time: function (timerName) { },\r\n        timeEnd: function (timerName) { },\r\n        trace: function () { },\r\n        warn: function (message) {\r\n            var optionalParams = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                optionalParams[_i - 1] = arguments[_i];\r\n            }\r\n        },\r\n    };\r\n//# sourceMappingURL=WebWorkerSafeChecks.js.map'},function(f,t){},function(f,t,e){(function(f){function e(f,t){for(var e=0,n=f.length-1;n>=0;n--){var r=f[n];"."===r?f.splice(n,1):".."===r?(f.splice(n,1),e++):e&&(f.splice(n,1),e--)}if(t)for(;e--;e)f.unshift("..");return f}function n(f,t){if(f.filter)return f.filter(t);for(var e=[],n=0;n<f.length;n++)t(f[n],n,f)&&e.push(f[n]);return e}t.resolve=function(){for(var t="",r=!1,i=arguments.length-1;i>=-1&&!r;i--){var o=i>=0?arguments[i]:f.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,r="/"===o.charAt(0))}return(r?"/":"")+(t=e(n(t.split("/"),(function(f){return!!f})),!r).join("/"))||"."},t.normalize=function(f){var i=t.isAbsolute(f),o="/"===r(f,-1);return(f=e(n(f.split("/"),(function(f){return!!f})),!i).join("/"))||i||(f="."),f&&o&&(f+="/"),(i?"/":"")+f},t.isAbsolute=function(f){return"/"===f.charAt(0)},t.join=function(){var f=Array.prototype.slice.call(arguments,0);return t.normalize(n(f,(function(f,t){if("string"!=typeof f)throw new TypeError("Arguments to path.join must be strings");return f})).join("/"))},t.relative=function(f,e){function n(f){for(var t=0;t<f.length&&""===f[t];t++);for(var e=f.length-1;e>=0&&""===f[e];e--);return t>e?[]:f.slice(t,e-t+1)}f=t.resolve(f).substr(1),e=t.resolve(e).substr(1);for(var r=n(f.split("/")),i=n(e.split("/")),o=Math.min(r.length,i.length),a=o,u=0;u<o;u++)if(r[u]!==i[u]){a=u;break}var s=[];for(u=a;u<r.length;u++)s.push("..");return(s=s.concat(i.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(f){if("string"!=typeof f&&(f+=""),0===f.length)return".";for(var t=f.charCodeAt(0),e=47===t,n=-1,r=!0,i=f.length-1;i>=1;--i)if(47===(t=f.charCodeAt(i))){if(!r){n=i;break}}else r=!1;return-1===n?e?"/":".":e&&1===n?"/":f.slice(0,n)},t.basename=function(f,t){var e=function(f){"string"!=typeof f&&(f+="");var t,e=0,n=-1,r=!0;for(t=f.length-1;t>=0;--t)if(47===f.charCodeAt(t)){if(!r){e=t+1;break}}else-1===n&&(r=!1,n=t+1);return-1===n?"":f.slice(e,n)}(f);return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},t.extname=function(f){"string"!=typeof f&&(f+="");for(var t=-1,e=0,n=-1,r=!0,i=0,o=f.length-1;o>=0;--o){var a=f.charCodeAt(o);if(47!==a)-1===n&&(r=!1,n=o+1),46===a?-1===t?t=o:1!==i&&(i=1):-1!==t&&(i=-1);else if(!r){e=o+1;break}}return-1===t||-1===n||0===i||1===i&&t===n-1&&t===e+1?"":f.slice(t,n)};var r="b"==="ab".substr(-1)?function(f,t,e){return f.substr(t,e)}:function(f,t,e){return t<0&&(t=f.length+t),f.substr(t,e)}}).call(this,e(0))},function(f,t){f.exports='function ignore(){}function id(n){return n}function fst(n){return n[0]}function snd(n){return n[1]}function trd(n){return n[2]}IntelliFactory={Runtime:{Ctor:function(n,t){return n.prototype=t.prototype,n},Class:function(n,t,i){var u=n,f,r,e;if(t){u=new t;for(f in n)u[f]=n[f]}if(r=function(n){if(n)for(var t in n)this[t]=n[t]},r.prototype=u,i)for(e in i)r[e]=i[e];return r},Clone:function(n){var t={};for(var i in n)t[i]=n[i];return t},NewObject:function(n){for(var i={},t=0;t<n.length;t++)i[n[t][0]]=n[t][1];return i},DeleteEmptyFields:function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],n[r]===void 0&&delete n[r];return n},GetOptional:function(n){return n===void 0?null:{$:1,$0:n}},SetOptional:function(n,t,i){i?n[t]=i.$0:delete n[t]},SetOrDelete:function(n,t,i){i===void 0?delete n[t]:n[t]=i},Apply:function(n,t,i){return n.apply(t,i)},Bind:function(n){return function(){return n.apply(this,arguments)}},CreateFuncWithArgs:function(n){return function(){return n(Array.prototype.slice.call(arguments))}},CreateFuncWithOnlyThis:function(n){return function(){return n(this)}},CreateFuncWithThis:function(n){return function(){return n(this).apply(null,arguments)}},CreateFuncWithThisArgs:function(n){return function(){return n(this)(Array.prototype.slice.call(arguments))}},CreateFuncWithRest:function(n,t){return function(){return t(Array.prototype.slice.call(arguments,0,n).concat([Array.prototype.slice.call(arguments,n)]))}},CreateFuncWithArgsRest:function(n,t){return function(){return t([Array.prototype.slice.call(arguments,0,n),Array.prototype.slice.call(arguments,n)])}},BindDelegate:function(n,t){var i=n.bind(t);return i.$Func=n,i.$Target=t,i},CreateDelegate:function(n){if(n.length==0)return null;if(n.length==1)return n[0];var t=function(){for(var i,t=0;t<n.length;t++)i=n[t].apply(null,arguments);return i};return t.$Invokes=n,t},CombineDelegates:function(n){for(var t,i=[],r=0;r<n.length;r++)t=n[r],t&&("$Invokes"in t?i=i.concat(t.$Invokes):i.push(t));return IntelliFactory.Runtime.CreateDelegate(i)},DelegateEqual:function(n,t){var f,e,i,r,u;if(n===t)return!0;if(n==null||t==null||(f=n.$Invokes||[n],e=t.$Invokes||[t],f.length!=e.length))return!1;for(i=0;i<f.length;i++)if(r=f[i],u=e[i],!(r===u||"$Func"in r&&"$Func"in u&&r.$Func===u.$Func&&r.$Target==u.$Target))return!1;return!0},ThisFunc:function(n){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),n.apply(null,t)}},ThisFuncOut:function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(t.shift(),t)}},ParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat([i.slice(n)]))}},ParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat(i[n]))}},ThisParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(null,i.slice(0,n+1).concat([i.slice(n+1)]))}},ThisParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(i.shift(),i.slice(0,n).concat(i[n]))}},Curried:function(n,t,i){return i=i||[],function(r){var u=i.concat([r===void 0?null:r]);return t==1?n.apply(null,u):t==2?function(t){return n.apply(null,u.concat([t===void 0?null:t]))}:IntelliFactory.Runtime.Curried(n,t-1,u)}},Curried2:function(n){return function(t){return function(i){return n(t,i)}}},Curried3:function(n){return function(t){return function(i){return function(r){return n(t,i,r)}}}},UnionByType:function(n,t,i){for(var u,f=typeof t,r=0;r<n.length;r++)if(u=n[r],typeof u=="number"){if(Array.isArray(t)&&(u==0||t.length==u))return{$:r,$0:t}}else if(u==f)return{$:r,$0:t};if(!i)throw new Error("Type not expected for creating Choice value.");},ScriptBasePath:"./",ScriptPath:function(n,t){return this.ScriptBasePath+(this.ScriptSkipAssemblyDir?"":n+"/")+t},OnLoad:function(n){"load"in this||(this.load=[]);this.load.push(n)},Start:function(){function n(n){for(var t=0;t<n.length;t++)n[t]()}"load"in this&&(n(this.load),this.load=[])}}};IntelliFactory.Runtime.OnLoad(function(){self.WebSharper&&WebSharper.Activator&&WebSharper.Activator.Activate&&WebSharper.Activator.Activate()});Date.now||(Date.now=function(){return(new Date).getTime()});Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Object.setPrototypeOf||(Object.setPrototypeOf=function(n,t){return n.__proto__=t,n});console||(console={count:ignore,dir:ignore,error:ignore,group:ignore,groupEnd:ignore,info:ignore,log:ignore,profile:ignore,profileEnd:ignore,time:ignore,timeEnd:ignore,trace:ignore,warn:ignore});\r\n(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c0,c1,c2,c3,c4,c5,c6,c7,c8,c9,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,_do,dp,dq,dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dS,dT,dU,dV,dW,dX,dY,dZ,d0,d1,d2,d3,d4,d5,d6,d7,d8,d9,d_,d$,ea,eb,ec,ed,ee,ef,eg,eh,ei,ej,ek,el,em,en,eo,ep,eq,er,es,et,eu,ev,ew,ex,ey,ez,eA,eB,eC,eD,eE,eF,eG,eH,eI,eJ,eK,eL,eM,eN,eO,eP,eQ,eR,eS,eT,eU,eV,eW,eX,eY,eZ,e0,e1,e2,e3,e4,e5,e6,e7,e8,e9,e_,e$,fa,fb,fc,fd,fe,ff,fg,fh,fi,fj,fk,fl,fm,fn,fo,fp,fq,fr,fs,ft,fu,fv,fw,fx,fy,fz,fA;a=self;b=a.Microsoft=a.Microsoft||{};c=b.Research=b.Research||{};d=c.CRNEngine=c.CRNEngine||{};e=d.JSAPI=d.JSAPI||{};f=e.export_def=e.export_def||{};g=e.sim_run=e.sim_run||{};h=e.probabilityMap=e.probabilityMap||{};i=e.transition=e.transition||{};j=e.state=e.state||{};k=e.state_space=e.state_space||{};l=e.inference_evaluated_values=e.inference_evaluated_values||{};m=e.inference_burnin=e.inference_burnin||{};n=e.inference_sampling=e.inference_sampling||{};o=e.inference_result=e.inference_result||{};p=e.InferenceParameterRange=e.InferenceParameterRange||{};q=e.InferenceParameter=e.InferenceParameter||{};r=e.InferenceParameters=e.InferenceParameters||{};s=e.column_array=e.column_array||{};t=e.table_array=e.table_array||{};u=d.JSONAPI=d.JSONAPI||{};v=a.WebSharper=a.WebSharper||{};w=v.Obj=v.Obj||{};x=v.Collections=v.Collections||{};y=x.FSharpMap=x.FSharpMap||{};z=d.Gui=d.Gui||{};A=v.List=v.List||{};B=A.T=A.T||{};C=d.Instance=d.Instance||{};D=a.Parser=a.Parser||{};E=d.InferenceSiteGraph=d.InferenceSiteGraph||{};F=v.Operators=v.Operators||{};G=a.Error;H=D.Exception=D.Exception||{};I=D.error=D.error||{};J=E.IGraph=E.IGraph||{};K=x.Map=x.Map||{};L=d.Model=d.Model||{};M=d.Crn=d.Crn||{};N=d.GuiIG=d.GuiIG||{};O=d.Crn_settings=d.Crn_settings||{};P=d.Simulation_settings=d.Simulation_settings||{};Q=d.Functional2=d.Functional2||{};R=d.Expression=d.Expression||{};S=d.Svg=d.Svg||{};T=d.Populations=d.Populations||{};U=v.Arrays=v.Arrays||{};V=d.Initial=d.Initial||{};W=d.Population=d.Population||{};X=d.OdeOslo=d.OdeOslo||{};Y=d.Ssa=d.Ssa||{};Z=d.Table=d.Table||{};_0=d.OdeSundials=d.OdeSundials||{};_1=d.Simulator=d.Simulator||{};_2=v.Utils=v.Utils||{};_3=d.Calculus=d.Calculus||{};_4=d.Lna=d.Lna||{};_5=d.Pde=d.Pde||{};_6=d.Spatial_settings=d.Spatial_settings||{};_7=d.Stochastic_settings=d.Stochastic_settings||{};_8=d.Attributes=d.Attributes||{};_9=d.Dictionary=d.Dictionary||{};_=d.Ctmc=d.Ctmc||{};$=x.List=x.List||{};ba=d.Transition=d.Transition||{};bb=d.Stringmap=d.Stringmap||{};bc=v.Seq=v.Seq||{};bd=x.Dictionary=x.Dictionary||{};be=d.Species=d.Species||{};bf=d.Simulation=d.Simulation||{};bg=d.Cme=d.Cme||{};bh=d.Probabilities=d.Probabilities||{};bi=d.Jit=d.Jit||{};bj=d.GuiModel=d.GuiModel||{};bk=v.Unchecked=v.Unchecked||{};bl=d.Sbml=d.Sbml||{};bm=c.Filzbach=c.Filzbach||{};bn=bm.Parameters=bm.Parameters||{};bo=bn.EvaluatedValues=bn.EvaluatedValues||{};bp=bm.DataStructures=bm.DataStructures||{};bq=bp.AssociativeArray=bp.AssociativeArray||{};br=bn.ParameterRange=bn.ParameterRange||{};bs=bn.AcceptanceStatistics=bn.AcceptanceStatistics||{};bt=d.Result=d.Result||{};bu=d.Inference=d.Inference||{};bv=bu.mcmc_intermediate_result=bu.mcmc_intermediate_result||{};bw=bm.Filzbach=bm.Filzbach||{};bx=bw.Sampling=bw.Sampling||{};by=bw.Burnin=bw.Burnin||{};bz=d.Plotting=d.Plotting||{};bA=bu.mcmc_result=bu.mcmc_result||{};bB=d.Html=d.Html||{};bC=bn.Parameter=bn.Parameter||{};bD=d.Moment_closure_settings=d.Moment_closure_settings||{};bE=d.Column=d.Column||{};bF=d.Parameters=d.Parameters||{};bG=d.Task=d.Task||{};bH=E.Location=E.Location||{};bI=E.PriorKind=E.PriorKind||{};bJ=d.GuiIGTargetParameter=d.GuiIGTargetParameter||{};bK=d.GuiIGEdge=d.GuiIGEdge||{};bL=a.CRNEngineJS_JsonDecoder=a.CRNEngineJS_JsonDecoder||{};bM=a.CRNEngineJS_JsonEncoder=a.CRNEngineJS_JsonEncoder||{};bN=a.CRNEngineJS_GeneratedPrintf=a.CRNEngineJS_GeneratedPrintf||{};bO=d.Deterministic_settings=d.Deterministic_settings||{};bP=d.Interval=d.Interval||{};bQ=d.Truncated=d.Truncated||{};bR=d.LogNormal=d.LogNormal||{};bS=d.Normal=d.Normal||{};bT=d.Uniform=d.Uniform||{};bU=d.Distribution=d.Distribution||{};bV=d.Variation=d.Variation||{};bW=d.Prior=d.Prior||{};bX=d.Parameter=d.Parameter||{};bY=d.Noise_model=d.Noise_model||{};bZ=d.Noise_parameter=d.Noise_parameter||{};b0=d.Inference_settings=d.Inference_settings||{};b1=bD.t=bD.t||{};b2=d.Synthesis_settings=d.Synthesis_settings||{};b3=d.Dataset=d.Dataset||{};b4=d.Concentration=d.Concentration||{};b5=d.Time=d.Time||{};b6=d.Space=d.Space||{};b7=d.Units=d.Units||{};b8=d.Assignment=d.Assignment||{};b9=d.Sweep=d.Sweep||{};b_=d.Plot_settings=d.Plot_settings||{};b$=d.Mset=d.Mset||{};ca=b$.entry=b$.entry||{};cb=d.Rate=d.Rate||{};cc=d.Reaction=d.Reaction||{};cd=d.Spatial_initial=d.Spatial_initial||{};ce=cd.core=cd.core||{};cf=cd.point=cd.point||{};cg=cd.rectangle=cd.rectangle||{};ch=cd.t=cd.t||{};ci=v.ClientSideJson=v.ClientSideJson||{};cj=ci.Provider=ci.Provider||{};ck=bn.ParameterType=bn.ParameterType||{};cl=bn.TruncatedNormal=bn.TruncatedNormal||{};cm=bn.LogNormal=bn.LogNormal||{};cn=bn.Normal=bn.Normal||{};co=d.Key=d.Key||{};cp=R.bexp=R.bexp||{};cq=R.modulo=R.modulo||{};cr=R.minus=R.minus||{};cs=R.power=R.power||{};ct=R.divide=R.divide||{};cu=d.Kinetics=d.Kinetics||{};cv=d.Row=d.Row||{};cw=d.Point=d.Point||{};cx=x.BalancedTree=x.BalancedTree||{};cy=cx.Tree=cx.Tree||{};cz=x.Pair=x.Pair||{};cA=a.StartupCode$CRNEngineJS$InferenceSiteGraph=a.StartupCode$CRNEngineJS$InferenceSiteGraph||{};cB=v.JavaScript=v.JavaScript||{};cC=cB.Pervasives=cB.Pervasives||{};cD=S.point=S.point||{};cE=S.box=S.box||{};cF=S.group=S.group||{};cG=a.Object;cH=d.VectorFSModule=d.VectorFSModule||{};cI=d.Oslo_integrator=d.Oslo_integrator||{};cJ=cI.t=cI.t||{};cK=a.Oslo=a.Oslo||{};cL=cK.VectorModule=cK.VectorModule||{};cM=d.VectorFS=d.VectorFS||{};cN=d.Lambda=d.Lambda||{};cO=cK.MatrixModule=cK.MatrixModule||{};cP=d.Ode=d.Ode||{};cQ=d.Rng=d.Rng||{};cR=cQ.Random=cQ.Random||{};cS=d.Hashtable=d.Hashtable||{};cT=d.Event=d.Event||{};cU=d.reaction_info=d.reaction_info||{};cV=d.Errors=d.Errors||{};cW=cV.EngineException=cV.EngineException||{};cX=cV.SimulatorErrorException=cV.SimulatorErrorException||{};cY=d.Inlined=d.Inlined||{};cZ=bi.JitSpecies=bi.JitSpecies||{};c0=bi.JitReaction=bi.JitReaction||{};c1=cK.Matrix=cK.Matrix||{};c2=v.Slice=v.Slice||{};c3=c.ReactionDiffusion=c.ReactionDiffusion||{};c4=c3.Solver1d=c3.Solver1d||{};c5=c4.point=c4.point||{};c6=c3.Lib=c3.Lib||{};c7=c6.settings=c6.settings||{};c8=c3.Solver2d=c3.Solver2d||{};c9=c8.point=c8.point||{};c_=d.Statistics=d.Statistics||{};c$=_9.t=_9.t||{};da=v.Enumerator=v.Enumerator||{};db=d.Lib=d.Lib||{};dc=da.T=da.T||{};dd=x.DictionaryUtil=x.DictionaryUtil||{};de=cK.SparseMatrix=cK.SparseMatrix||{};df=de.SparseMatrix=de.SparseMatrix||{};dg=x.Set=x.Set||{};dh=x.FSharpSet=x.FSharpSet||{};di=d.Environment=d.Environment||{};dj=cB.JS=cB.JS||{};dk=v.Strings=v.Strings||{};dl=d.Stringbuilder=d.Stringbuilder||{};dm=bp.NamesMap=bp.NamesMap||{};dn=bm.Lib=bm.Lib||{};_do=dn.NormalGenerator=dn.NormalGenerator||{};dp=bu.partial=bu.partial||{};dq=bu.full=bu.full||{};dr=d.ParameterSummary=d.ParameterSummary||{};ds=bu.McmcSummary=bu.McmcSummary||{};dt=bB.Results=bB.Results||{};du=bB.Comparison=bB.Comparison||{};dv=bz.html_content=bz.html_content||{};dw=a.FSharpIDD=a.FSharpIDD||{};dx=dw.HTML=dw.HTML||{};dy=bu.Summary=bu.Summary||{};dz=d.Operators=d.Operators||{};dA=a.StartupCode$CRNEngineJS$functional=a.StartupCode$CRNEngineJS$functional||{};dB=S.anchor=S.anchor||{};dC=cI.Stepper=cI.Stepper||{};dD=cK.GearBDF=cK.GearBDF||{};dE=dD.state=dD.state||{};dF=dD.options=dD.options||{};dG=cK.RK547M=cK.RK547M||{};dH=dG.state=dG.state||{};dI=dG.options=dG.options||{};dJ=d.OsloAbstract=d.OsloAbstract||{};dK=dn.LCGRng=dn.LCGRng||{};dL=d.SundialsAbstract=d.SundialsAbstract||{};dM=c3.Solver=c3.Solver||{};dN=a.StartupCode$CRNEngineJS$stringmap=a.StartupCode$CRNEngineJS$stringmap||{};dO=a.StartupCode$ParserCombinatorsJS$ParserCombinators=a.StartupCode$ParserCombinatorsJS$ParserCombinators||{};dP=x.ValueCollection=x.ValueCollection||{};dQ=x.MapUtil=x.MapUtil||{};dR=a.proxies=a.proxies||{};dS=dR.StringBuilder=dR.StringBuilder||{};dT=a.StartupCode$CRNEngineJS$sbml=a.StartupCode$CRNEngineJS$sbml||{};dU=bl.model=bl.model||{};dV=bl.unitKind=bl.unitKind||{};dW=bl.nOp=bl.nOp||{};dX=bl.bOp=bl.bOp||{};dY=dn.NormalGeneratorState=dn.NormalGeneratorState||{};dZ=v.Char=v.Char||{};d0=a.StartupCode$CRNEngineJS$plotting=a.StartupCode$CRNEngineJS$plotting||{};d1=bm.FilzbachMultiple=bm.FilzbachMultiple||{};d2=bn.Ids=bn.Ids||{};d3=bm.FilzbachAnalysis=bm.FilzbachAnalysis||{};d4=bw.RunOptions=bw.RunOptions||{};d5=dw.DOM=dw.DOM||{};d6=dw.HtmlConverters=dw.HtmlConverters||{};d7=dw.Subplots=dw.Subplots||{};d8=dw.Chart=dw.Chart||{};d9=dw.Colour=dw.Colour||{};d_=d8.Chart=d8.Chart||{};d$=d8.LegendVisibility=d8.LegendVisibility||{};ea=dw.Plots=dw.Plots||{};eb=ea.Heatmap=ea.Heatmap||{};ec=v.Arrays2D=v.Arrays2D||{};ed=ea.Markers=ea.Markers||{};ee=ed.Shape=ed.Shape||{};ef=ea.Polyline=ea.Polyline||{};eg=ea.Histogram=ea.Histogram||{};eh=d.Index=d.Index||{};ei=d.Adapter=d.Adapter||{};ej=d.Keywords=d.Keywords||{};ek=d.Sweeps=d.Sweeps||{};el=S.path=S.path||{};em=S.label=S.label||{};en=a.StartupCode$CRNEngineJS$svg=a.StartupCode$CRNEngineJS$svg||{};eo=dD.jacobian=dD.jacobian||{};ep=dG.corrStruct=dG.corrStruct||{};eq=v.ArgumentException=v.ArgumentException||{};er=cK.SparseVector=cK.SparseVector||{};es=er.SparseVector=er.SparseVector||{};et=D.ParserBuilder=D.ParserBuilder||{};eu=a.StartupCode$CRNEngineJS$mset=a.StartupCode$CRNEngineJS$mset||{};ev=bl.unitDefinition=bl.unitDefinition||{};ew=bl.compartment=bl.compartment||{};ex=bl.species=bl.species||{};ey=bl.parameter=bl.parameter||{};ez=bl.initialAssignment=bl.initialAssignment||{};eA=bl.reaction=bl.reaction||{};eB=bl.sbmlUnit=bl.sbmlUnit||{};eC=bl.speciesReference=bl.speciesReference||{};eD=bl.kineticLaw=bl.kineticLaw||{};eE=bl.uOp=bl.uOp||{};eF=d3.ParameterSummary=d3.ParameterSummary||{};eG=d3.summaryType=d3.summaryType||{};eH=d3.qsummaryType=d3.qsummaryType||{};eI=d3.InformationCriteria=d3.InformationCriteria||{};eJ=d5.Div=d5.Div||{};eK=d5.Attribute=d5.Attribute||{};eL=dw.Placement=dw.Placement||{};eM=d7.Subplots=d7.Subplots||{};eN=a.StartupCode$FSharpIDD_WS$Chart=a.StartupCode$FSharpIDD_WS$Chart||{};eO=a.StartupCode$FSharpIDD_WS$Colour=a.StartupCode$FSharpIDD_WS$Colour||{};eP=d8.LabelledAxisRecord=d8.LabelledAxisRecord||{};eQ=eb.Plot=eb.Plot||{};eR=eb.Palette=eb.Palette||{};eS=ed.Plot=ed.Plot||{};eT=d9.Colour=d9.Colour||{};eU=ef.Plot=ef.Plot||{};eV=ef.LineCap=ef.LineCap||{};eW=ef.LineJoin=ef.LineJoin||{};eX=eg.Plot=eg.Plot||{};eY=d.Instruction=d.Instruction||{};eZ=a.StartupCode$CRNEngineJS$Keywords=a.StartupCode$CRNEngineJS$Keywords||{};e0=d.Directive=d.Directive||{};e1=x.HashSet=x.HashSet||{};e2=S.path_command=S.path_command||{};e3=a.StartupCode$CRNEngineJS$spatial_initial=a.StartupCode$CRNEngineJS$spatial_initial||{};e4=bl.NotId=bl.NotId||{};e5=a.StartupCode$CRNEngineJS$lib=a.StartupCode$CRNEngineJS$lib||{};e6=bp.NamedObject=bp.NamedObject||{};e7=bp.BayesTable=bp.BayesTable||{};e8=d5.Node=d5.Node||{};e9=d9.RgbColour=d9.RgbColour||{};e_=ea.Bars=ea.Bars||{};e$=e_.Plot=e_.Plot||{};fa=v.FormatException=v.FormatException||{};fb=v.OverflowException=v.OverflowException||{};fc=a.StartupCode$CRNEngineJS$moment_closure_settings=a.StartupCode$CRNEngineJS$moment_closure_settings||{};fd=a.StartupCode$CRNEngineJS$environment=a.StartupCode$CRNEngineJS$environment||{};fe=dD.iteration=dD.iteration||{};ff=cK.Gauss=cK.Gauss||{};fg=bw.AcceptanceResult=bw.AcceptanceResult||{};fh=d7.Slot=d7.Slot||{};fi=dw.HistogramBuilder=dw.HistogramBuilder||{};fj=fi.Histogram=fi.Histogram||{};fk=e_.Shadow=e_.Shadow||{};fl=v.IndexOutOfRangeException=v.IndexOutOfRangeException||{};fm=a.StartupCode$CRNEngineJS$expression=a.StartupCode$CRNEngineJS$expression||{};fn=a.StartupCode$Filzbach_FSharp_JS$Lib=a.StartupCode$Filzbach_FSharp_JS$Lib||{};fo=ff.SolveCoreUtility=ff.SolveCoreUtility||{};fp=d7.BareChart=d7.BareChart||{};fq=x.HashSetUtil=x.HashSetUtil||{};fr=v.MatchFailureException=v.MatchFailureException||{};fs=v.ArgumentOutOfRangeException=v.ArgumentOutOfRangeException||{};ft=a.IntelliFactory;fu=ft&&ft.Runtime;fv=a.Math;fw=a.WS_EM_GLUE;fx=a.console;fy=a.Date;fz=a.Float64Array;fA=a.String;e.valueTypeCaseString=function(fB){return fB=="MeanStdev"?"MeanStdev":fB=="MeanStdevProbabilities"?"MeanStdevProbabilities":fB=="Spatial1D"?"Spatial1D":fB=="Spatial2D"?"Spatial2D":fB=="MeanStdevTable"?"MeanStdevTable":"Float";};e.parse_code=function(fB){var fC,fE,fF;function fD(fG){return L.New(fG.top.initialise(),A.map(function(fH){return fH.initialise();},fG.systems));}fE=D.from_string_first_error_with_msg(E.parse(),fB);if(fE.$==1){fF=fE.$0;throw new H.New(fF.text,[fF]);}else fC=fE.$0;return J.New(fC.task,K.Map(function(fG,fH){return fD(fH);},fC.nodes),fC.edges,fC.expanded);};e.prepare_Model=function(fB,fC){return E.expandAndLift(fB.to_ig()).nodes.get_Item(fC).merge_shared_settings();};e.prepare_CRN_for_sim=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK;fE=e.prepare_Model(fB,fC);fF=(fG=fD.model,fG===""?fE.top:(fH=bc.tryFind(function(fL){return fL.name===fG;},fE.systems),fH==null?fE.top:fH.$0));return M.New(fF.name,fF.settings.update_simulation(fD.settings.map((fI=(fJ=(fK=fF.settings.rates,function(fL){return M.species_to_rates(fK,fL);}),function(fL){return R.map(fJ,fL);}),function(fL){return fI(Q.from_string_plot(fL));}))),fF.reactions,fF.initials,fF.attributes).substitute(fD.environment);};e.pop_to_svg=function(fB,fC){try{return S.to_string(M.get_default_svg_style(),M.initials_to_svg(M.New(fB.name,fB.settings,fB.reactions,A.ofArray(U.map(function(fD){return V.create$1({$:1,$0:fD.value},fD.species,null);},fC.index_to_species)),fB.attributes)));}catch(fD){return fD.message;}};e.get_instances=function(fB,fC){var fD;function fE(fF){return A.map(function(fG){return C.create$5(fG.model,fG.sweep,fG.assignment,fG.environment,fG.settings.map(Q.to_string_plot),fG.name);},fF.get_instances());}fD=e.prepare_Model(fB,fC);return fD.systems.$==0?fE(fD.top):A.collect(fE,fD.systems);};e.make_instance_name=function(fB){return fB.name!==""?fB.name:fB.sweep===""?fB.model:fB.model+"."+fB.sweep;};e.simulateFloat=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ;function fK(fL){fF(f.New("image/svg+xml","finals","Finals",{$:1,$0:fC},fI===""?null:{$:1,$0:fI},{$:1,$0:[e.pop_to_svg(fH,fL)]},null));}fH=e.prepare_CRN_for_sim(fB,fC,fD);fI=e.make_instance_name(fD);fJ=fH.settings.simulator;fJ=="Oslo"?fH.to_oslo().simulate_callback(fG,fE,fK):fJ=="SSA"?fH.to_ssa().simulate_callback(fG,fE,fK,{$:1,$0:fu.Curried3(function(fL,fM,fN){return null;})}):fJ=="Sundials"?A.iter(fE,Z.to_rows(fH.to_sundials().simulate())):(function(fL){return function(fM){return fL("The "+_2.toSafe(fM)+" simulator cannot be used here");};}(F.FailWith))(_1.get_to_string(fH.settings.simulator));};e.simulateMeanStdev=function(fB,fC,fD,fE,fF,fG){var fH,fI;fH=e.prepare_CRN_for_sim(fB,fC,fD);fI=fH.settings.simulator;fI=="LNA"?fH.to_lna().simulate_callback(fG,fE):fI=="CME"?fH.simulate_cme_callback(fG,a.ignore,fE):fI=="MC"?F.FailWith("MC simulator cannot be invoked this way"):F.FailWith("simulator does not return mean+stdev");};e.simulateSpatial1D=function(fB,fC,fD,fE,fF,fG){var fH;fH=e.prepare_CRN_for_sim(fB,fC,fD);fH.settings.simulator=="PDE"?fH.settings.spatial.dimensions===1?_5.simulate_1d_callback(fG,fE,fH.to_pde1d()):F.FailWith("wrong number of dimensions"):F.FailWith("simulator does not return 1d spatial");};e.simulateSpatial2D=function(fB,fC,fD,fE,fF,fG){var fH;fH=e.prepare_CRN_for_sim(fB,fC,fD);fH.settings.simulator=="PDE"?fH.settings.spatial.dimensions===2?_5.simulate_2d_callback(fG,fE,fH.to_pde2d()):F.FailWith("wrong number of dimensions"):F.FailWith("simulator does not return 2d spatial");};e.simulateMeanStdevTable=function(fB,fC,fD,fE,fF,fG){var fH;fH=e.prepare_CRN_for_sim(fB,fC,fD);fH.settings.stochastic.trajectories>1?fH.to_ssa().simulate_trajectories_callback(fG,fE):F.FailWith("simulator does not return mean+stdev table");};e.convert_state_space=function(fB,fC){var fD,fE,fF,fG;function fH(fJ){var fK;fK=fC(fJ);fF.push(fK);return fK.name;}function fI(fJ,fK){var fL;fL=fK[1];return function(fM){return j.New(fM.species,U.ofList(A.map(function(fN){return i.New(_9.find(fD,fN.target),R.to_string(a.id,fN.propensity));},fL)));};}fD=_9.empty();fE=U.ofSeq(_9.toSeq(fB.ctmc.graph));fF=[];return k.New((fG=U.mapi(function(fJ,fK){var fL;fL=fK[0];_9.add(fD,fL,fJ);return j.New(bb.of_list(A.ofSeq(bc.map(function(fM){return[fH(U.get(fB.to_species,fM.K)),fM.V];},fL))),[]);},fE),(((fu.Curried3(U.mapi2))(function(fJ,fK,fL){return(fI(fJ,fK))(fL);}))(fE))(fG)),_9.find(fD,fB.ctmc.initial_state),fF.slice());};e.simulateMeanStdevProbabilities=function(fB,fC,fD,fE,fF,fG,fH){var fI,fJ,fK,fL;function fM(fO){return bb.find(fO.name,fI.attributes);}function fN(fO){fE(e.convert_state_space(fO,fM));}fI=e.prepare_CRN_for_sim(fB,fC,fD);fJ=(fK=fI.settings.simulator,fK=="CME"?fI.simulate_cme_callback(fH,fN,fF):fK=="CMESundials"?(fI.simulate_cmesundials_callback(fH,fN,fF))[0]:F.FailWith("simulator does not return mean+stdev and probabilities"));fL=new bd.New$5();U.iter(function(fO){fL.Add(fO.species.name,fO.species);},fJ.simulator.populations.index_to_species);return fJ.probabilities;};e.getProbabilityMap=function(fB,fC,fD){var fE,fF;fE=bh.get_bounds(fB,fC);fF=fE[2];return h.New(bg.get_times(fB),A.init(fE[1]-fF+1,function(fG){return fG+fF;}),bh.probability_map({$:1,$0:fD},fB,fC));};e.simulateFloatJIT=function(fB,fC,fD,fE,fF,fG,fH){var fI,fJ,fK,fL,fM,fN;bi.simulate_callback(fH,fD,fE,fC.jit,fC.calculus);fM=fB.top.to_crn();fN=bi.to_crn(fC.jit,fM);fJ="";try{fJ=S.to_string(M.get_default_svg_style(),M.initials_to_svg(fN));}catch(fO){fJ=fO.message;}fF(f.New("image/svg+xml","finals","Finals",{$:1,$0:fB.top.name},null,{$:1,$0:[fJ]},null));fK="";try{fK=S.to_string(M.get_default_svg_style(),M.reactions_to_svg(fN));}catch(fP){fK=fP.message;}fF(f.New("image/svg+xml","reactions","Reactions",{$:1,$0:fB.top.name},null,{$:1,$0:[fK]},null));fL="";try{fL=fN.to_string();}catch(fQ){fL=fQ.message;}fF(f.New("text/plain","code","Code",{$:1,$0:fB.top.name},null,{$:1,$0:[fL]},null));fG(N.New(null,K.OfArray(U.ofSeq(A.ofArray([["",bj.New(z.from_crn(M.New(fN.name,fN.settings,fN.reactions,fM.initials,fN.attributes).saturate_initials()),B.Empty)]]))),new y.New([]),false));};e.simulator_to_value_type=function(fB){var fC,fD,fE;fD=fB.simulator;switch(fD=="CME"?1:fD=="CMESundials"?1:fD=="Oslo"?2:fD=="SSA"?3:fD=="Sundials"?4:fD=="PDE"?5:fD=="MC"?6:0){case 0:return"MeanStdev";case 1:return"MeanStdevProbabilities";case 2:return"Float";case 3:return fB.stochastic.trajectories>1?"MeanStdevTable":"Float";case 4:return"Float";case 5:fE=fB.spatial.dimensions;return fE===1?"Spatial1D":fE===2?"Spatial2D":F.FailWith("unsupported number of dimensions");case 6:return"MeanStdev";}};e.user_get_sim_runs=function(fB,fC){var fD,fE,fF;fD=E.expandAndLift(fB.to_ig()).nodes.get_Item(fC);fE=(fF=fD.systems,fF.$==1?fF.$0.settings:fD.top.settings);A.iter(function(fG){if(!bk.Equals(fG.settings.simulator,fE.simulator))F.FailWith("Systems with different simulators are not supported");},fD.systems);return g.New(e.simulator_to_value_type(fE),e.get_instances(fB,fC));};e.user_parse_code=function(fB){return N.from_ig(e.parse_code(fB));};e.model_to_single_export=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL;fK=fB.nodes.get_Item(fC).saturate_initials();if(fD==="code"){fE="";try{if(fC==="")fE=J.New(fB.task,K.OfArray(U.ofSeq(A.ofArray([["",fK]]))),new y.New([]),false).to_string();else fE=fK.string();}catch(fM){fE=fM.message;}return f.New("text/plain",fD,"Code",{$:1,$0:fC},null,{$:1,$0:[fE]},null);}else if(fD==="sbml"){fF="";try{fF=bl.to_xml(fK.to_sbml());}catch(fN){fF=fN.message;}return f.New("text/plain",fD,"SBML",{$:1,$0:fC},null,{$:1,$0:[fF]},null);}else if(fD==="initials"){fG="";try{fG=S.to_string(M.get_default_svg_style(),L.initials_to_svg(fK));}catch(fO){fG=fO.message;}return f.New("image/svg+xml",fD,"Initials",{$:1,$0:fC},null,{$:1,$0:[fG]},null);}else if(fD==="finals")return f.New("image/svg+xml",fD,"Finals",{$:1,$0:fC},null,{$:1,$0:["Finals not available for single export"]},null);else if(fD==="reactions"){fH=[];try{fH=U.ofList(A.map((fL=M.get_default_svg_style(),function(fP){return S.to_string(fL,fP);}),L.reactions_to_svgs(fK)));}catch(fP){fH=[fP.message];}fI="";try{fI=S.to_string(M.get_default_svg_style(),L.reactions_to_svg(fK));}catch(fQ){fI=fQ.message;}return f.New("image/svg+xml",fD,"Reactions",{$:1,$0:fC},null,{$:1,$0:fH},{$:1,$0:fI});}else if(fD==="matlab"){fJ="";try{fJ=fK.to_matlab();}catch(fR){fJ=fR.message;}return f.New("text/plain",fD,"Matlab",{$:1,$0:fC},null,{$:1,$0:[fJ]},null);}else return f.New("text/plain",fD,fD,{$:1,$0:fC},null,{$:1,$0:["Unknown export ID "+fD]},null);};e.model_to_export=function(fB,fC,fD){var fE,fF,fG;fG=fC.nodes.get_Item(fD).saturate_initials();try{fE=fB?null:{$:1,$0:S.to_string(M.get_default_svg_style(),L.initials_to_svg(fG))};}catch(fH){fE={$:1,$0:fH.message};}try{fF=fB?{$:1,$0:S.to_string(M.get_default_svg_style(),L.initials_to_svg(fG))}:{$:1,$0:""};}catch(fI){fF={$:1,$0:fI.message};}return[f.New("text/plain","code","Code",{$:1,$0:fD},null,null,null),f.New("text/plain","sbml","SBML",{$:1,$0:fD},null,null,null),f.New("image/svg+xml","initials","Initials",{$:1,$0:fD},null,fE==null?null:{$:1,$0:[fE.$0]},null),f.New("image/svg+xml","finals","Finals",{$:1,$0:fD},null,fF==null?null:{$:1,$0:[fF.$0]},null),f.New("image/svg+xml","reactions","Reactions",{$:1,$0:fD},null,null,null),f.New("text/plain","matlab","Matlab",{$:1,$0:fD},null,null,null)];};e.user_get_exports=function(fB,fC,fD){return e.model_to_export(fB,fC.to_ig(),fD);};e.user_get_export=function(fB,fC,fD){return e.model_to_single_export(fB.to_ig(),fC,fD);};e.convert_evaluated_values=function(fB){var fC,fD;return l.New((fC=fB.values,(fD=new bd.New$5(),(U.iter(function(fE){fD.Add(fE,fC.Item(fE));},fC.get_Names()),fD))),fB.logLikelihood);};e.convert_inference_result=function(fB,fC,fD){var fE,fF,fG;function fH(fI){var fJ;fJ=new bd.New$5();U.iter(function(fK){fJ.Add(fK,fI.Item(fK));},fI.get_Names());return fJ;}return o.New(fB,fC.iteration,fD,(fE=fC.state,fE.$==1?(fF=fE.$0,{$:1,$0:n.New(fH(fF.space),e.convert_evaluated_values(fF.state),fF.thinningSkippedCount,A.map(e.convert_evaluated_values,fF.chain),e.convert_evaluated_values(fF.mle),fF.priors,fF.indexes)}):(fG=fE.$0,{$:0,$0:m.New(fH(fG.space),e.convert_evaluated_values(fG.state),fG.stats,e.convert_evaluated_values(fG.mle),fG.priors,fG.indexes)})),fD?{$:1,$0:fC.mlesims}:null,fC.summary);};e.combine_dynchar_exports=function(fB){var fC,fD;return fB.$==1&&(fB.$1.$==0&&(fC=fB.$0[1],true))?f.New("text/html","dynamicCharacterization","Dynamic Characterization",null,null,{$:1,$0:[bz.structured_tabbed_embedded("top_tabs",fC)]},{$:1,$0:bz.structured_tabbed("","top_tabs",fC)}):(fD=A.ofSeq(A.mapi(function(fE,fF){return[fF[0],bz.structured_tabbed_embedded((function(fG){return function(fH){return fG("group"+a.String(fH));};}(a.id))(fE),fF[1])];},fB)),f.New("text/html","dynamicCharacterization","Dynamic Characterization",null,null,{$:1,$0:[bz.make_embedded(bz.arbitrary_tabbed_content("top_tabs",fD))]},{$:1,$0:bz.arbitrary_tabbed("Dynamic Characterisation",fD)}));};e.user_infer_gui=function(fB,fC,fD,fE,fF){var fG,fH;fG=E.expandAndLift(fB.to_ig());fH=[];E.inferWith(function(fI){var fJ,fK,fL,fM,fN;function fO(fP,fQ,fR){return fP!=null&&fP.$==1?{$:1,$0:e.convert_inference_result(fI.top.name,fP.$0,fR)}:null;}fJ=null;fK=fI.infer_seq(function(fP){fJ={$:1,$0:fP};});fL=A.map(function(fP){var fQ;return q.New(fP.name,p.New((fQ=fP.range.pType,fQ.$==1?"Log":fQ.$==2?"Fixed":"Real"),fP.range.lb,fP.range.ub),fP.initValue);},fK[1]);fM=bc.choose(function(fP){return fO(fP[0],fP[1],fP[2]);},fK[0]);fD(r.New(fI.top.name,fL));bc.iter(fE,fM);fJ==null?void 0:(fN=fJ.$0,fN.posterior.$!==0?fH.push([fI.top.name,bB.results_to_html_content(bB.mcmc_to_results(fI.top.settings,fI,fN))]):void 0);return fJ.$0.to_summary();},fG);fC(e.combine_dynchar_exports(A.ofSeq(fH)));};e.user_state_space=function(fB){var fC;fC=(bc.head(K.ToSeq(fB.nodes)))[1].top.to_crn();return e.convert_state_space(fC.to_ctmc(),function(fD){return bb.find(fD.name,fC.attributes);});};e.user_state_space_jit=function(fB){var fC;fC=bi.to_ctmc(fB.jit,fB.calculus);return e.convert_state_space(fC[0],fC[1]);};e.expression_to_string=function(fB){return R.to_string(a.id,fB);};e.mcplot_to_string=function(fB){return bD.to_string_monomial(fB);};e.test_crn_deterministic=function(fB){var fC;fC=D.from_string(M.get_parse(),fB).to_oslo().simulate();return t.New(U.ofList(fC.times),U.ofList(A.map(function(fD){return s.New(fD.name,U.ofList(fD.values));},fC.columns)));};e.test_crn_sundials=function(fB){var fC;fC=D.from_string(M.get_parse(),fB).to_sundials().simulate();return t.New(U.ofList(fC.times),U.ofList(A.map(function(fD){return s.New(fD.name,U.ofList(fD.values));},fC.columns)));};e.prepare_for_cme=function(fB){var fC;fC=D.from_string(M.get_parse(),fB);return[fC.to_cme(fC.to_ctmc()),bF.to_env(fC.settings.parameters),M.to_inlined_rates(fC.settings)];};e.test_crn_cme_sundials=function(fB){var fC,fD;fC=e.prepare_for_cme(fB);fD=(fC[0].simulate_sundials(fC[1],fC[2]))[1];return t.New(U.ofList(fD.times),U.ofList(A.map(function(fE){return s.New(fE.name,U.ofList(fE.values));},fD.columns)));};f.New=function(fB,fC,fD,fE,fF,fG,fH){return{content_type:fB,id:fC,display_name:fD,node_id:fE,instance:fF,content:fG,save_content:fH};};g.New=function(fB,fC){return{value_type:fB,instances:fC};};h.New=function(fB,fC,fD){return{times:fB,values:fC,probabilities:fD};};i.New=function(fB,fC){return{target:fB,propensity:fC};};j.New=function(fB,fC){return{species:fB,transitions:fC};};k.New=function(fB,fC,fD){return{states:fB,start_index:fC,attributes:fD};};l.New=function(fB,fC){return{values:fB,lglk:fC};};m.New=function(fB,fC,fD,fE,fF,fG){return{space:fB,state:fC,stats:fD,mle:fE,priors:fF,indexes:fG};};n.New=function(fB,fC,fD,fE,fF,fG,fH){return{space:fB,state:fC,thinningSkippedCount:fD,chain:fE,mle:fF,priors:fG,indexes:fH};};o.New=function(fB,fC,fD,fE,fF,fG){return{nodeId:fB,iteration:fC,lkincreased:fD,state:fE,mlesims:fF,summary:fG};};p.New=function(fB,fC,fD){return{pType:fB,lb:fC,ub:fD};};q.New=function(fB,fC,fD){return{name:fB,range:fC,initValue:fD};};r.New=function(fB,fC){return{nodeId:fB,parameters:fC};};s.New=function(fB,fC){return{name:fB,values:fC};};t.New=function(fB,fC){return{times:fB,columns:fC};};u.decodeIG=function(fB){return(bL.j$60())(fB);};u.encodeIG=function(fB){return(bM.j$13())(fB);};u.decodeModel=function(fB){return(bL.j$17())(fB);};u.encodeModel=function(fB){return(bM.j$16())(fB);};u.user_parse_code=function(fB){return(bM.j$13())(e.user_parse_code(fB));};u.user_get_exports=function(fB,fC,fD){var fE;fE=e.user_get_exports(fB,u.decodeIG(fC),fD);return((cj.EncodeArray(bM.j))())(fE);};u.user_get_export=function(fB,fC,fD){return(bM.j())(e.user_get_export(u.decodeIG(fB),fC,fD));};u.user_infer_gui=function(fB,fC,fD,fE,fF){e.user_infer_gui(u.decodeIG(fB),function(fG){fC((bM.j())(fG));},function(fG){fD((bM.j$105())(fG));},function(fG){fE((bM.j$82())(fG));},fF);};u.user_state_space=function(fB){return(bM.j$8())(e.user_state_space(u.decodeIG(fB)));};u.user_state_space_jit=function(fB){return(bM.j$8())(e.user_state_space_jit(fB));};u.user_get_sim_runs=function(fB,fC){return(bM.j$79())(e.user_get_sim_runs(u.decodeIG(fB),fC));};u.simulateFloat=function(fB,fC,fD,fE,fF,fG){e.simulateFloat(u.decodeIG(fB),fC,(bL.j$13())(fD),function(fH){fE((bM.j$78())(fH));},function(fH){fF((bM.j())(fH));},fG);};u.simulateFloatJIT=function(fB,fC,fD,fE,fF,fG,fH){e.simulateFloatJIT(u.decodeModel(fB),fC,function(fI){fD((bM.j$78())(fI));},function(fI){fE((bM.j$77())(fI));},function(fI){fF((bM.j())(fI));},function(fI){fG((bM.j$13())(fI));},fH);};u.simulateMeanStdev=function(fB,fC,fD,fE,fF,fG){e.simulateMeanStdev(u.decodeIG(fB),fC,(bL.j$13())(fD),function(fH){fE((bM.j$12())(fH));},function(fH){fF((bM.j())(fH));},fG);};u.simulateMeanStdevProbabilities=function(fB,fC,fD,fE,fF,fG,fH){return(bM.j$7())(e.simulateMeanStdevProbabilities(u.decodeIG(fB),fC,(bL.j$13())(fD),function(fI){fE((bM.j$8())(fI));},function(fI){fF((bM.j$12())(fI));},function(fI){fG((bM.j())(fI));},fH));};u.getProbabilityMap=function(fB,fC,fD){return(bM.j$6())(e.getProbabilityMap((bL.j$16())(fB),fC,fD));};u.simulateSpatial1D=function(fB,fC,fD,fE,fF,fG){e.simulateSpatial1D(u.decodeIG(fB),fC,(bL.j$13())(fD),function(fH){fE((bM.j$5())(fH));},function(fH){fF((bM.j())(fH));},fG);};u.simulateSpatial2D=function(fB,fC,fD,fE,fF,fG){e.simulateSpatial2D(u.decodeIG(fB),fC,(bL.j$13())(fD),function(fH){fE((bM.j$4())(fH));},function(fH){fF((bM.j())(fH));},fG);};u.simulateMeanStdevTable=function(fB,fC,fD,fE,fF,fG){e.simulateMeanStdevTable(u.decodeIG(fB),fC,(bL.j$13())(fD),function(fH){fE((bM.j$1())(fH));},function(fH){fF((bM.j())(fH));},fG);};u.expression_to_string=function(fB){return e.expression_to_string((bL.j$7())(fB));};u.mcplot_to_string=function(fB){return e.mcplot_to_string((bL.j())(fB));};w=v.Obj=fu.Class({Equals:function(fB){return this===fB;},GetHashCode:function(){return -1;}},null,w);w.New=fu.Ctor(function(){},w);y=x.FSharpMap=fu.Class({get_Item:function(fB){var fC;fC=this.TryFind(fB);return fC==null?F.FailWith("The given key was not present in the dictionary."):fC.$0;},TryFind:function(fB){var fC;fC=cx.TryFind(cz.New(fB,void 0),this.tree);return fC==null?null:{$:1,$0:fC.$0.Value};},ContainsKey:function(fB){return cx.Contains(cz.New(fB,void 0),this.tree);},get_Count:function(){var fB;fB=this.tree;return fB==null?0:fB.Count;},get_Tree:function(){return this.tree;},Add:function(fB,fC){return new y.New$1(cx.Add(cz.New(fB,fC),this.tree));},get_IsEmpty:function(){return this.tree==null;},GetEnumerator$1:function(){return da.Get(bc.map(function(fB){return{K:fB.Key,V:fB.Value};},cx.Enumerate(false,this.tree)));},Equals:function(fB){return this.get_Count()===fB.get_Count()&&bc.forall2(bk.Equals,this,fB);},Remove:function(fB){return new y.New$1(cx.Remove(cz.New(fB,void 0),this.tree));},GetHashCode:function(){return bk.Hash(U.ofSeq(this));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();},CompareTo0:function(fB){return bc.compareWith(bk.Compare,this,fB);}},w,y);y.New=fu.Ctor(function(fB){y.New$1.call(this,dQ.fromSeq(fB));},y);y.New$1=fu.Ctor(function(fB){w.New.call(this);this.tree=fB;},y);z=d.Gui=fu.Class({to_crn:function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fN){return R.from_string(D.name(),fN);}function fM(fN){return R.from_string(D.name(),fN);}fB=(fC=be.get_from_string(),function(fN){return cc.map(fC,fL,Q.from_string,fN);});fD=(fE=be.get_from_string(),function(fN){return V.from_gui(fE,fM,fN);});fF=this.settings.map_plots(Q.from_string,Q.from_string_plot);return M.New(this.name,fF.map((fG=(fH=fF.rates,function(fN){return M.species_to_rates(fH,fN);}),function(fN){return R.map(fG,fN);})),A.map((fI=(fJ=(fK=fF.rates,function(fN){return M.species_to_rates(fK,fN);}),function(fN){return R.map(fJ,fN);}),function(fN){return cc.map(a.id,a.id,fI,fN);}),A.map(fB,this.reactions)),A.map(fD,this.initials),this.attributes);}},null,z);z.from_crn=function(fB){var fC,fD;return z.New(fB.name,fB.settings.map_plots(Q.to_string,Q.to_string_plot),A.map((fC=function(fE){return R.to_string(a.id,fE);},function(fE){return cc.map(be.to_string,fC,Q.to_string,fE);}),fB.reactions),A.map((fD=function(fE){return R.to_string(a.id,fE);},function(fE){return V.to_gui(be.to_string,fD,fE);}),fB.initials),fB.attributes);};z.New=function(fB,fC,fD,fE,fF){return new z({name:fB,settings:fC,reactions:fD,initials:fE,attributes:fF});};B=A.T=fu.Class({get_Length:function(){return A.length(this);},get_Item:function(fB){return bc.nth(fB,this);},GetSlice:function(fB,fC){var fD;return fB!=null&&fB.$==1?fC!=null&&fC.$==1?(fD=fB.$0,A.ofSeq(bc.take(fC.$0-fD+1,A.skip(fD,this)))):A.skip(fB.$0,this):fC!=null&&fC.$==1?A.ofSeq(bc.take(fC.$0+1,this)):this;},GetEnumerator:function(){return new dc.New(this,null,function(fB){var fC;fC=fB.s;return fC.$==0?false:(fB.c=fC.$0,fB.s=fC.$1,true);},void 0);},GetEnumerator0:function(){return da.Get(this);}},null,B);B.Empty=new B({$:0});C=d.Instance=fu.Class({update_environment:function(fB){return C.New(this.model,this.sweep,this.assignment,new y.New(bc.concat([K.ToSeq(this.environment),K.ToSeq(fB)])),this.settings,this.name);}},null,C);C.create$5=function(fB,fC,fD,fE,fF,fG){return C.New(fB,fC,fD,fE,fF,fG);};C.same_sweep=function(fB,fC){return fB.model===fC.model&&fB.sweep===fC.sweep;};C.New=function(fB,fC,fD,fE,fF,fG){return new C({model:fB,sweep:fC,assignment:fD,environment:fE,settings:fF,name:fG});};D.from_string_first_error_with_msg=function(fB,fC){var fD,fG,fH,fI,fJ,fK,fL,fM,fN;function fE(fO){var fP;fP=D.run(D.manySatisfy(function(fQ){return fQ!==" "&&fQ!=="\\n"&&fQ!=="\\r";}),fO);return fP.$==1?"input":(function(fQ){return function(fR){return fQ("\'"+_2.toSafe(fR)+"\'");};}(a.id))(fP.$0);}function fF(fO,fP,fQ,fR){return{$:1,$0:I.New(fP,fQ,(function(fS){return function(fT){return fS("Unexpected "+_2.toSafe(fT)+".");};}(a.id))(fO)+(fR!==""?"\\nExpecting: "+fR:""))};}fG=D.do_run(fB,fC);switch(fG.$==1?fG.$1[0]===""?(fD=fG.$0,0):(fD=[fG.$1[1][1],fG.$1[1][0],fG.$1[0]],1):fG.$==2?(fD=[fG.$1[1],fG.$0,fG.$1[0]],2):fG.$==3?(fD=[fG.$1[1],fG.$0,fG.$1[0]],2):fG.$1[0]===""?(fD=fG.$0,0):(fD=[fG.$1[1][1],fG.$1[1][0],fG.$1[0]],1)){case 0:return{$:0,$0:fD};case 1:fH=fD[0];fI=fD[1];fJ=fD[2];return fJ===""?fF("end of input",fI+1,fH,""):fF(fE(fJ),fI+1,fH,"");case 2:fK=fD[0];fL=fD[1];fM=fD[2];fN=U.get(dk.SplitStrings(fC,["\\n","\\r\\n"],0),fM).substring(fK);return fN===""?fF("end of input",fM+1,fK,fL):fF(fE(fN),fM+1,fK,fL);}};D.from_string=function(fB,fC){var fD,fE,fF,fG,fH;fE=D.do_run(fB,fC);switch(fE.$==1?fE.$1[0]===""?(fD=fE.$0,0):(fD=[fE.$1[1][1],fE.$1[1][0],fE.$0,fE.$1[0]],1):fE.$==2?(fD=[fE.$1[1],fE.$0,fE.$1[0]],2):fE.$==3?(fD=[fE.$1[1],fE.$0,fE.$1[0]],2):fE.$1[0]===""?(fD=fE.$0,0):(fD=[fE.$1[1][1],fE.$1[1][0],fE.$0,fE.$1[0]],1)){case 0:return fD;case 1:fF=fD[0];fG=fD[1];throw new H.New((((fu.Curried3(function(fI,fJ,fK){return fI("Unexpected end of input at row "+a.String(fJ)+" column "+a.String(fK));}))(a.id))(fG))(fF),[I.New(fG+1,fF,(function(fI){return function(fJ){return fI("unexpected end of input at column "+a.String(fJ));};}(a.id))(fF))]);case 2:fH=fD[1];throw new H.New(fH,[I.New(fD[2]+1,fD[0],fH)]);}};D.run=function(fB,fC){var fD,fE,fF,fG,fH;fD=D.do_run(fB,fC);return fD.$==1?{$:0,$0:fD.$0,$1:fD.$1[0],$2:fD.$1[1]}:fD.$==2?(fE=fD.$1,(fF=fD.$0,{$:1,$0:D.errMsg(fF,fE[0],fE[1]),$1:fF,$2:fC})):fD.$==3?(fG=fD.$1,(fH=fD.$0,{$:1,$0:D.errMsg(fH,fG[0],fG[1]),$1:fH,$2:fC})):{$:0,$0:fD.$0,$1:fD.$1[0],$2:fD.$1[1]};};D.manySatisfy=function(fB){return function(fC){var fD,fE,fF,fG,fH,fI;function fJ(fK){return!fK;}fD=fC[0];fE=fC[1];fF=U.tryFindIndex(function(fK){return fJ(fB(fK));},dk.ToCharArray(fD));return fF!=null&&fF.$==1?(fG=fF.$0,(fH=dk.Substring(fD,0,fG),(fI=fD.substring(fG),fH.length>0?{$:1,$0:fH,$1:[fI,D.move(fH,fE)]}:{$:0,$0:fH,$1:[fI,D.move(fH,fE)]}))):{$:0,$0:fD,$1:["",D.add_cols(fD.length,fE)]};};};D.do_run=function(fB,fC){return(D.op_DotGreaterGreater(D.op_GreaterGreaterDot(D.spaces(),fB),D.spaces()))([fC,D.start_pos()]);};D.name=function(){dO.$cctor();return dO.name;};D.spaces=function(){dO.$cctor();return dO.spaces;};D.errMsg=function(fB,fC,fD){return((((fu.Curried(function(fE,fF,fG,fH){return fE("Expecting "+_2.toSafe(fF)+" at row "+a.String(fG)+" column "+a.String(fH));},4))(a.id))(fB))(fC+1))(fD+1);};D.move=function(fB,fC){var fD,fE;fD=dk.SplitStrings(fB,D.lineSeparators(),0);fE=U.length(fD)-1;return[fC[0]+fE,fE===0?fC[1]+U.get(fD,fE).length:U.get(fD,fE).length];};D.add_cols=function(fB,fC){return[fC[0],fC[1]+fB];};D.op_DotGreaterGreater=function(fB,fC){return D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(fB,fC),function(fD){return fD[0];});};D.op_GreaterGreaterDot=function(fB,fC){return D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(fB,fC),function(fD){return fD[1];});};D.start_pos=function(){dO.$cctor();return dO.start_pos;};D.op_GreaterGreaterEquals=function(fB,fC){return function(fD){var fE,fF;fE=fB(fD);return fE.$==1?(fF=(fC(fE.$0))(fE.$1),fF.$==1?{$:1,$0:fF.$0,$1:fF.$1}:fF.$==2?{$:3,$0:fF.$0,$1:fF.$1}:fF.$==3?{$:3,$0:fF.$0,$1:fF.$1}:{$:1,$0:fF.$0,$1:fF.$1}):fE.$==2?{$:2,$0:fE.$0,$1:fE.$1}:fE.$==3?{$:3,$0:fE.$0,$1:fE.$1}:(fC(fE.$0))(fE.$1);};};D.choice=function(fB){return bc.isEmpty(fB)?D.failParser("Malformed grammar, choice is empty."):bc.fold(D.op_LessBarGreater,bc.head(fB),bc.skip(1,fB));};D.pchar=function(fB){return function(fC){var fD,fE;fD=fC[0];fE=fC[1];return fD.length>0&&fD[0]===fB?{$:1,$0:fD[0],$1:[fD.substring(1),D.add_cols(1,fE)]}:D.mk_failEmpty(fE,fB);};};D.preturn=function(fB){return function(fC){return{$:0,$0:fB,$1:fC};};};D.kw=function(fB){return D.op_DotGreaterGreater(function(fC){return D.pstringkw(fB,fC[0],fC[1]);},D.spaces());};D.opt=function(fB){return function(fC){var fD;fD=fB(fC);return fD.$==0?{$:0,$0:{$:1,$0:fD.$0},$1:fD.$1}:fD.$==2?{$:0,$0:null,$1:fC}:fD.$==3?{$:3,$0:fD.$0,$1:fD.$1}:{$:1,$0:{$:1,$0:fD.$0},$1:fD.$1};};};D.pTry=function(fB){return function(fC){var fD;fD=fB(fC);return fD.$==3?{$:2,$0:fD.$0,$1:fD.$1}:fD;};};D.record=function(fB,fC){var fD;function fE(fG,fH){return D.op_GreaterGreaterDot(D.kw(fG),D.op_GreaterGreaterDot(D.kw("="),fH));}function fF(fG,fH){return fH(fG);}return D.op_BarGreaterGreater(D.op_GreaterGreaterGreaterGreater(D.kw("{"),D.sepEndByAmb((fD=D.choice(A.map(function(fG){return fE(fG[0],fG[1]);},fC)),function(fG){return fD([fG[0],fG[1]]);}),D.kw("}"),D.skw(";"))),function(fG){return bc.fold(fF,fB,fG);});};D.op_BarGreaterGreater=function(fB,fC){return D.op_GreaterGreaterEquals(fB,function(fD){return D.preturn(fC(fD));});};D.pint32=function(){dO.$cctor();return dO.pint32;};D.op_DotGreaterGreaterDot=function(fB,fC){return D.op_GreaterGreaterEquals(fB,function(fD){return D.op_GreaterGreaterEquals(fC,function(fE){return D.preturn([fD,fE]);});});};D.name_kw=function(fB){return D.pTry(D.op_GreaterGreaterEquals(D.name(),function(fC){return A.contains(fC,fB)?D.failParser("Keyword found"):D.preturn(fC);}));};D.lineSeparators=function(){dO.$cctor();return dO.lineSeparators;};D.failParser=function(fB){return function(fC){return{$:2,$0:fB,$1:fC[1]};};};D.op_LessBarGreater=function(fB,fC){return function(fD){var fE,fF;fE=fB(fD);return fE.$==2?(fF=fC(fD),fF.$==2?{$:2,$0:fE.$0+" or "+fF.$0,$1:fF.$1}:fF):fE;};};D.mk_failEmpty=function(fB,fC){function fD(fE,fF){return{$:2,$0:fE,$1:fF};}return D.mk_error(function(fE){return fD(fE[0],fE[1]);},fB[0],fB[1],fC);};D.pstringkw=function(fB,fC,fD){var fE,fF;return dk.StartsWith(fC,fB)?fC.length===fB.length?{$:1,$0:fB,$1:[fC.substring(fB.length),D.add_cols(fB.length,fD)]}:(fE=fB[fB.length-1],D.isDigit(fE)||D.isLetter(fE)||fE==="_"?(fF=fC[fB.length],D.isDigit(fF)||D.isLetter(fF)||fF==="_"?D.mk_failEmpty(fD,(function(fG){return function(fH){return fG("\'"+_2.toSafe(fH)+"\'");};}(a.id))(fB)):{$:1,$0:fB,$1:[fC.substring(fB.length),D.add_cols(fB.length,fD)]}):{$:1,$0:fB,$1:[fC.substring(fB.length),D.add_cols(fB.length,fD)]}):D.mk_failEmpty(fD,(function(fG){return function(fH){return fG("\'"+_2.toSafe(fH)+"\'");};}(a.id))(fB));};D.op_GreaterGreaterGreaterGreater=function(fB,fC){return D.op_GreaterGreaterEquals(fB,function(){return fC;});};D.sepEndByAmb=function(fB,fC,fD){return D.op_LessBarGreater(D.op_GreaterGreaterGreaterGreater(fC,D.preturn(B.Empty)),D.sepEndBy1Amb(fB,fC,fD));};D.skw=function(fB){return D.op_GreaterGreaterDot(D.spaces(),D.kw(fB));};D.many1=function(fB){return D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(fB,D.many(fB)),function(fC){return new B({$:1,$0:fC[0],$1:fC[1]});});};D.add_rows=function(fB,fC){return[fC[0]+fB,fC[1]];};D.op_LessQmarkGreater=function(fB,fC){return function(fD){var fE;fE=fB(fD);return fE.$==2?{$:2,$0:fC,$1:fE.$1}:fE.$==3?{$:3,$0:fC,$1:fE.$1}:fE;};};D.isDigit=function(fB){return dZ.IsDigit(fB);};D.many1Satisfy=function(fB){return function(fC){var fD,fE;fD=fC[0];fE=fC[1];return fD.length>0&&fB(fD[0])?(D.manySatisfy(fB))([fD,fE]):D.mk_failEmpty(fE,"a string satisying a predicate");};};D.newline=function(){dO.$cctor();return dO.newline;};D.skipString=function(fB){return D.op_BarGreaterGreater(D.pstring(fB),a.ignore);};D.pstring=function(fB){return function(fC){var fD,fE;fD=fC[0];fE=fC[1];return dk.StartsWith(fD,fB)?{$:1,$0:fB,$1:[fD.substring(fB.length),D.add_cols(fB.length,fE)]}:D.mk_failEmpty(fE,(function(fF){return function(fG){return fF("\'"+_2.toSafe(fG)+"\'");};}(a.id))(fB));};};D.sign=function(){dO.$cctor();return dO.sign;};D.digits1=function(){dO.$cctor();return dO.digits1;};D.guarded=function(fB,fC){return function(fD){var fE,fF,fG,fH;fE=fD[0];fF=fC([fE,fD[1]]);return fF.$==1?(fG=fF.$1,D.do_guarded(fE,fG[0],fG[1],fB,function(fI,fJ){return{$:1,$0:fI,$1:fJ};})):fF.$==2?{$:2,$0:fF.$0,$1:fF.$1}:fF.$==3?{$:3,$0:fF.$0,$1:fF.$1}:(fH=fF.$1,D.do_guarded(fE,fH[0],fH[1],fB,function(fI,fJ){return{$:0,$0:fI,$1:fJ};}));};};D.opt_sign=function(){dO.$cctor();return dO.opt_sign;};D.isLetter=function(fB){return dZ.IsLetter(fB);};D.linebreak=function(){dO.$cctor();return dO.linebreak;};D.skipChar=function(fB,fC,fD){var fE,fF;return fC.length>0&&fB(fC[0])?(fE=U.contains((fF=fC[0],a.String(fF)),D.lineSeparators())?[fD[0]+1,0]:D.add_cols(1,fD),{$:1,$0:null,$1:[fC.substring(1),fE]}):D.mk_failEmpty(fD,"a char satisying predicate");};D.isWhiteSpace=function(fB){return dZ.IsWhiteSpace(fB);};D.keyword=function(){dO.$cctor();return dO.keyword;};D.eof=function(){dO.$cctor();return dO.eof;};D.CommentSingle=function(){dO.$cctor();return dO.CommentSingle;};D.manyUntil=function(fB,fC,fD,fE){var fF,fG;fF=[fD,fE];fG=fC(fF);return fG.$==1?{$:1,$0:B.Empty,$1:fG.$1}:fG.$==2?(D.op_GreaterGreaterEquals(fB,function(fH){return D.op_GreaterGreaterEquals(function(fI){return D.manyUntil(fB,fC,fI[0],fI[1]);},function(fI){return D.preturn(new B({$:1,$0:fH,$1:fI}));});}))(fF):fG.$==3?{$:3,$0:fG.$0,$1:fG.$1}:{$:0,$0:B.Empty,$1:fG.$1};};D.anyChar_INTERNAL=function(){dO.$cctor();return dO.anyChar_INTERNAL;};D.many=function(fB){return function(fC){var fD,fE,fF;fD=fB(fC);return fD.$==1?(fE=fD.$0,(D.op_GreaterGreaterEquals(D.many(fB),function(fG){var fH;fH=new B({$:1,$0:fE,$1:fG});return function(fI){return D.preturnConsumed(fH,fI[0],fI[1]);};}))(fD.$1)):fD.$==2?{$:0,$0:B.Empty,$1:fC}:fD.$==3?{$:3,$0:fD.$0,$1:fD.$1}:(fF=fD.$0,(D.op_GreaterGreaterEquals(D.many(fB),function(fG){return D.preturn(new B({$:1,$0:fF,$1:fG}));}))(fD.$1));};};D.commentLine=function(){dO.$cctor();return dO.commentLine;};D.commentMultiline=function(){return D.op_BarGreaterGreater(D.op_GreaterGreaterDot((D.keyword())(D.CommentStart()),D.commentMultilineShield(1)),a.ignore);};D.whiteSpace=function(){dO.$cctor();return dO.whiteSpace;};D.op_GreaterGreaterPercent=function(fB,fC){return D.op_BarGreaterGreater(fB,function(){return fC;});};D.mk_error=function(fB,fC,fD,fE){return fB([fE,[fC,fD]]);};D.sepEndBy1Amb=function(fB,fC,fD){return D.op_GreaterGreaterEquals(D.op_DotGreaterGreater(fB,D.spaces()),function(fE){var fF,fG;return D.op_GreaterGreaterEquals((fF=D.op_DotGreaterGreater(D.op_GreaterGreaterGreaterGreater(fD,fB),D.spaces()),(fG=D.op_BarGreaterGreater(D.op_LessBarGreater(fC,D.pTry(D.op_GreaterGreaterGreaterGreater(fD,fC))),a.ignore),function(fH){return D.manyUntil(fF,fG,fH[0],fH[1]);})),function(fH){return D.preturn(new B({$:1,$0:fE,$1:fH}));});});};D.list_of=function(fB){return D.op_GreaterGreaterGreaterGreater(D.kw("["),D.sepEndByAmb(fB,D.kw("]"),D.kw(";")));};D.sqBrackets=function(fB){return(D.bracket("[","]"))(fB);};D.chainl1Try=function(fB,fC){return D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(fB,D.many(D.pTry(D.op_DotGreaterGreaterDot(fC,fB)))),function(fD){return bc.fold(function(fE,fF){return(fF[0](fE))(fF[1]);},fD[0],fD[1]);});};D.do_guarded=function(fB,fC,fD,fE,fF){var fG;fG=fB.length-fC.length;return fF(fE(dk.Substring(fB,0,fG)),[fB.substring(fG),fD]);};D.preturnConsumed=function(fB,fC,fD){return{$:1,$0:fB,$1:[fC,fD]};};D.CommentStart=function(){dO.$cctor();return dO.CommentStart;};D.commentMultilineShield=function(fB){function fC(fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM;while(true){fH=fE[0];fI=fE[1];fJ=fI[1];fK=fI[0];fL=[fK,fJ];if(fD===0)return{$:0,$0:null,$1:[fH,[fK,fJ]]};else if(fH==="")return{$:3,$0:"missing \\"*)\\" to close an open comment",$1:[fK,fJ]};else{fM=(fF=D.CommentStart().length,fG=D.CommentEnd().length,dk.StartsWith(fH,D.CommentStart())?[fD+1,[fH.substring(fF),D.add_cols(fF,fL)]]:dk.StartsWith(fH,D.CommentEnd())?[fD-1,[fH.substring(fG),D.add_cols(fG,fL)]]:dk.StartsWith(fH,"\\r\\n")?[fD,[fH.substring(2),[fK+1,0]]]:dk.StartsWith(fH,"\\r")||dk.StartsWith(fH,"\\n")?[fD,[fH.substring(1),[fK+1,0]]]:[fD,[fH.substring(1),D.add_cols(1,fL)]]);fD=fM[0];fE=fM[1];}}}return function(fD){return fC(fB,fD);};};D.sepBy=function(fB,fC){return D.op_BarGreaterGreater(D.opt(D.sepBy1(fB,fC)),function(fD){return fD!=null&&fD.$==1?fD.$0:B.Empty;});};D.braces=function(fB){return(D.bracket("{","}"))(fB);};D.paren=function(fB){return(D.bracket("(",")"))(fB);};D.pfix=function(fB,fC){var fD;fD=D.choice([D.op_GreaterGreaterEquals(fB(fC),function(fE){return D.pfix(fB,fE);}),D.preturn(fC)]);return function(fE){return fD([fE[0],fE[1]]);};};D.pbool=function(){dO.$cctor();return dO.pbool;};D.pfloat=function(){dO.$cctor();return dO.pfloat;};D.bracket=function(fB,fC){var fD,fE;fD=D.kw(fB);fE=D.op_GreaterGreaterDot(D.spaces(),D.kw(fC));return function(fF){return D.between(fD,fE,fF);};};D.CommentEnd=function(){dO.$cctor();return dO.CommentEnd;};D.sepBy1=function(fB,fC){return D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(fB,D.many(D.op_GreaterGreaterDot(fC,fB))),function(fD){return new B({$:1,$0:fD[0],$1:fD[1]});});};D.lookAhead=function(fB){return function(fC){var fD,fE;fD=fC[0];fE=fC[1];return dk.StartsWith(fD,fB)?{$:0,$0:null,$1:[fD,fE]}:{$:2,$0:fB,$1:fE};};};D.op_GreaterGreaterPlus=function(fB,fC){return D.op_BarGreaterGreater(D.op_PlusGreaterGreaterPlus(fB,fC),function(fD){return fD[1];});};D.op_PlusGreaterGreaterPlus=function(fB,fC){return D.op_DotGreaterGreaterDot(fB,D.op_GreaterGreaterDot(D.spaces(),fC));};D.op_PlusGreaterGreater=function(fB,fC){return D.op_BarGreaterGreater(D.op_PlusGreaterGreaterPlus(fB,fC),function(fD){return fD[0];});};D.angleBrackets=function(fB){return(D.bracket("<",">"))(fB);};D.plookAheadWith=function(fB){return function(fC){var fD,fE,fF;fD=fC[1];fE=[fC[0],fD];fF=fB(fE);return fF.$==1?{$:0,$0:fF.$0,$1:fE}:fF.$==2?{$:2,$0:fF.$0,$1:fD}:fF.$==3?{$:2,$0:fF.$0,$1:fD}:{$:0,$0:fF.$0,$1:fE};};};D.between=function(fB,fC,fD){return D.op_DotGreaterGreater(D.op_GreaterGreaterDot(fB,fD),fC);};D.pcolour=function(){dO.$cctor();return dO.pcolour;};D.tuple_of=function(fB){return D.op_LessBarGreater(D.paren(D.sepBy2(fB,D.skw(","))),D.op_BarGreaterGreater(fB,function(fC){return A.ofArray([fC]);}));};D.satisfy=function(fB){return function(fC){var fD,fE,fF,fG;fD=fC[0];fE=fC[1];fF=bc.tryHead(fD);return fF==null?{$:2,$0:fD,$1:fE}:(fG=fF.$0,fB(fG)?{$:1,$0:fG,$1:[dk.Substring(fD,1,fD.length-1),(D.add_row())(fE)]}:{$:2,$0:fD,$1:fE});};};D.manyChars=function(fB){return D.op_BarGreaterGreater(D.op_BarGreaterGreater(D.many(fB),function(fC){return A.map(a.id,fC);}),function(fC){return dk.concat("",fC);});};D.sepBy2=function(fB,fC){return D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(fB,D.many1(D.op_GreaterGreaterDot(fC,fB))),function(fD){return new B({$:1,$0:fD[0],$1:fD[1]});});};D.add_row=function(){dO.$cctor();return dO.add_row;};E.parse=function(){cA.$cctor();return cA.parse;};E.expandAndLift=function(fB){var fC,fD,fE,fF;function fG(fI,fJ){var fK;fK=fJ.expandAndLift();return[[fI,fK[0]],[fJ.top.name,fK[1]]];}function fH(fI,fJ,fK){var fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3;function f4(f6){return F.FailWith(((((((fu.Curried(function(f7,f8,f9,f_,f$,ga){return f7(_2.toSafe(f8)+" in edge "+_2.toSafe(f9)+"."+_2.toSafe(f_)+"->"+_2.toSafe(f$)+"."+_2.toSafe(ga));},6))(a.id))(f6))(fO))(fP))(fQ))(fR));}function f5(f6,f7){return[f6,f7,fN];}fL=fK[0];fM=fK[1];fN=fK[2];return fI.$==1?fJ.$==0?F.FailWith(((((fu.Curried(function(f6,f7,f8,f9){return f6("Unsupported edge "+_2.toSafe(f7)+"."+_2.toSafe(f8)+"->"+_2.toSafe(f9)+"; only node->node and system->system edges are supported.");},4))(a.id))(fI.$0[0]))(fI.$0[1]))(fJ.$0)):(fO=fI.$0[0],(fP=fI.$0[1],(fQ=fJ.$0[0],(fR=fJ.$0[1],(fS=(fT=fE.TryFind(fO),fT==null?f4((function(f6){return function(f7){return f6("Source node "+_2.toSafe(f7)+" not found");};}(a.id))(fO)):fT.$0),(fU=(fV=fE.TryFind(fQ),fV==null?f4((function(f6){return function(f7){return f6("Target node "+_2.toSafe(f7)+" not found");};}(a.id))(fQ)):fV.$0),(fW=(fX=fS.TryFind(fP),fX==null?f4((function(f6){return function(f7){return f6("Source system "+_2.toSafe(f7)+" not found");};}(a.id))(fP)):fX.$0),(fY=(fZ=fU.TryFind(fR),fZ==null?f4((function(f6){return function(f7){return f6("Target system "+_2.toSafe(f7)+" not found");};}(a.id))(fR)):fZ.$0),(f0=(f1=fW.TryFind(fL),f1==null?f4((function(f6){return function(f7){return f6("Source parameter "+_2.toSafe(f7)+" not found");};}(a.id))(fL)):f1.$0),(f2=(f3=fY.TryFind(fM),f3==null?f4((function(f6){return function(f7){return f6("Target parameter "+_2.toSafe(f7)+" not found");};}(a.id))(fM)):f3.$0),(f0.get_Length()!==f2.get_Length()?f4((((fu.Curried3(function(f6,f7,f8){return f6("Mismatched multiples count ("+a.String(f7)+" source, "+a.String(f8)+" target)");}))(a.id))(f0.get_Length()))(f2.get_Length())):void 0,A.map(function(f6){return f5(f6[0],f6[1]);},A.zip(f0,f2))))))))))))):fJ.$==1?F.FailWith(((((fu.Curried(function(f6,f7,f8,f9){return f6("Unsupported edge "+_2.toSafe(f7)+"->"+_2.toSafe(f8)+"."+_2.toSafe(f9)+"; only node->node and system->system edges are supported.");},4))(a.id))(fI.$0))(fJ.$0[0]))(fJ.$0[1])):A.ofArray([[fL,fM,fN]]);}fC=(fD=A.unzip(A.map(function(fI){return fG(fI[0],fI[1]);},A.ofSeq(K.ToSeq(fB.nodes)))),[K.OfArray(U.ofSeq(fD[0])),K.OfArray(U.ofSeq(fD[1]))]);fE=fC[1];fF=E.collectEdges(function(fI,fJ){return function(fK){return fH(fI,fJ,fK);};},J.New(fB.task,fC[0],fB.edges,fB.expanded));return J.New(fF.task,fF.nodes,fF.edges,true);};E.inferWith=function(fB,fC){var fD,fE,fF;fD=E.getNextCandidates(fC);return fD.$==0?B.Empty:(fE=A.map(function(fG){return[fG,fB(fC.nodes.get_Item(fG))];},fD),(fF=bc.fold(function(fG,fH){return E.updateGraph(fG,fH[0],fH[1]);},fC,fE),A.append(A.zip(fD,fE),E.inferWith(fB,fF))));};E.collectEdges=function(fB,fC){return J.New(fC.task,fC.nodes,K.Map(function(fD,fE){function fF(fG,fH){return[fG,A.collect(fB(fD,fG),fH)];}return A.map(function(fG){return fF(fG[0],fG[1]);},fE);},fC.edges),fC.expanded);};E.getNextCandidates=function(fB){var fC;return fB.nodes.get_IsEmpty()?B.Empty:(fC=E.getRoots(fB),fC.get_IsEmpty()?F.FailWith("Inference graph is not acyclic."):A.ofSeq(fC));};E.updateGraph=function(fB,fC,fD){var fE,fF,fG;fE=fB.nodes.get_Item(fC);fF=bc.fold(function(fH,fI){var fJ,fK;fJ=fI[1];fK=fH.nodes.get_Item(E.toNodeID(fJ));return J.New(fH.task,fH.nodes.Add(fK.top.name,E.applyEdgeToNode(fI[0],fJ,fI[2],fK)),fH.edges,fH.expanded);},fB,A.collect(function(fH){function fI(fJ,fK){function fL(fM,fN,fO){var fP;fP=K.TryFind(fM,fD.parameters);return fP==null?(function(fQ){return function(fR){return fQ("Error: cannot find parameter "+_2.toSafe(fR)+" in results");};}(F.FailWith))(fM):[fN,[fP.$0,fO]];}return[fH,fJ,K.OfArray(U.ofSeq(A.map(function(fM){return fL(fM[0],fM[1],fM[2]);},fK)))];}return fB.edges.ContainsKey(fH)?A.map(function(fJ){return fI(fJ[0],fJ[1]);},fB.edges.get_Item(fH)):B.Empty;},new B({$:1,$0:new bH({$:0,$0:fC}),$1:A.map(function(fH){return new bH({$:1,$0:[fC,fH.name]});},fE.systems)})));fG=new B({$:1,$0:new bH({$:0,$0:fC}),$1:A.map(function(fH){return new bH({$:1,$0:[fC,fH.name]});},fF.nodes.get_Item(fC).systems)});return J.New(fF.task,fF.nodes.Remove(fC),bc.fold(function(fH,fI){return fH.Remove(fI);},fF.edges,fG),fF.expanded);};E.pid=function(){cA.$cctor();return cA.pid;};E.parseTask=function(){cA.$cctor();return cA.parseTask;};E.pinferenceGraph=function(fB,fC,fD){return D.op_BarGreaterGreater(D.op_GreaterGreaterDot(D.spaces(),D.many1(E.pline(fC,fD))),function(fE){var fF;function fG(fH,fI){return function(fJ){return fJ.$==1?[fH,new B({$:1,$0:fJ.$0,$1:fI})]:[new B({$:1,$0:fJ.$0,$1:fH}),fI];};}fF=bc.fold(function(fH,fI){return(function(fJ){return fG(fJ[0],fJ[1]);}(fH))(fI);},[B.Empty,B.Empty],fE);return J.New(fB,K.OfArray(U.ofSeq(A.map(function(fH){return[fH.top.name,fH];},fF[0]))),K.Map(function(fH,fI){function fJ(fK,fL,fM){return[fM,fL];}return A.map(function(fK){return fJ(fK[0],fK[1],fK[2]);},fI);},K.OfArray(U.ofSeq(A.groupBy(function(fH){return a.id(fH[0],fH[1],fH[2]);},fF[1])))),false);});};E.getRoots=function(fB){var fC,fD,fE,fF;function fG(fI){return fI[1];}function fH(fI){return fI[0];}fC=new dh.New$1(cx.OfSeq(bc.map(function(fI){return fI[0];},K.ToSeq(fB.nodes))));fD=new dh.New$1(cx.OfSeq(bc.collect((fE=(fF=function(fI){return E.toNodeID(fH(fI));},function(fI){return A.map(fF,fI);}),function(fI){return fE(fG(fI));}),K.ToSeq(fB.edges))));return dg.Filter(function(fI){return!fD.Contains(fI);},fC);};E.toNodeID=function(fB){return fB.$==1?fB.$0[0]:fB.$0;};E.applyEdgeToNode=function(fB,fC,fD,fE){var fF;function fG(fI){var fJ,fK;return fD.ContainsKey(fI.name)?(fJ=fD.get_Item(fI.name),(fK=fJ[0],bX.New(fI.name,fK.mle,E.toPrior(fJ[1],fI.prior,fK,E.printLoc(fB),E.printLoc(fC))))):fI;}function fH(fI){var fJ;return fI.update_settings((fJ=fI.settings,O.New(fJ.simulation,fJ.simulations,fJ.stochastic,fJ.deterministic,fJ.spatial,fJ.inference,fJ.moment_closure,fJ.synthesis,fJ.data,fJ.units,fJ.simulator,fF(fI.settings.parameters),fJ.sweeps,fJ.rates,fJ.plot,fJ.quiet)));}fF=function(fI){return A.map(fG,fI);};return L.New(fH(fE.top),A.map(fH,fE.systems));};E.pline=function(fB,fC){var fD;fD=D.choice([D.op_GreaterGreaterEquals(D.op_DotGreaterGreaterDot(D.op_DotGreaterGreaterDot(D.op_DotGreaterGreater(D.op_GreaterGreaterDot(D.kw("edge"),E.plocation()),D.kw("->")),D.list_of(E.pparameter())),E.plocation()),function(fE){var fF;fF=fE[0];return D.preturn({$:1,$0:[fF[0],fF[1],fE[1]]});}),D.op_GreaterGreaterEquals(D.op_GreaterGreaterDot(D.kw("node"),E.pid()),function(fE){var fF;return D.op_BarGreaterGreater(D.record(L.New((fF=fB.top,M.New(fE,fF.settings,fF.reactions,fF.initials,fF.attributes)),fB.systems),A.ofArray([["systems",D.op_BarGreaterGreater(D.list_of(D.name()),function(fG){return function(fH){return L.New(fH.top,A.map(function(fI){return fC.ContainsKey(fI)?fC.get_Item(fI):F.FailWith("Undefined system "+fI+" in node "+fE);},fG));};})],["inference",D.op_BarGreaterGreater(b0.parse_defaults(fB.top.settings.inference),function(fG){return function(fH){var fI,fJ;return L.New((fI=fH.top,M.New(fI.name,(fJ=fH.top.settings,O.New(fJ.simulation,fJ.simulations,fJ.stochastic,fJ.deterministic,fJ.spatial,fG,fJ.moment_closure,fJ.synthesis,fJ.data,fJ.units,fJ.simulator,fJ.parameters,fJ.sweeps,fJ.rates,fJ.plot,fJ.quiet)),fI.reactions,fI.initials,fI.attributes)),fH.systems);};})]])),function(fG){return{$:0,$0:fG};});})]);return function(fE){return fD([fE[0],fE[1]]);};};E.toPrior=function(fB,fC,fD,fE,fF){var fG,fH,fI,fJ,fK,fL;return fB=="Normal"?(fG=fD.toNormalDist(),fC==null?F.FailWith(((((fu.Curried(function(fM,fN,fO,fP){return fM("Cannot propagate parameter "+_2.toSafe(fN)+"\'s fixed prior in "+_2.toSafe(fO)+" to normal prior in "+_2.toSafe(fP));},4))(a.id))(fD.name))(fE))(fF)):(fH=fC.$0,{$:1,$0:bW.New(fH.interval,fG,fH.variation)})):fB=="LogNormal"?(fI=fD.toLogNormalDist(),fC==null?F.FailWith(((((fu.Curried(function(fM,fN,fO,fP){return fM("Cannot propagate parameter "+_2.toSafe(fN)+"\'s fixed prior in "+_2.toSafe(fO)+" to lognormal prior in "+_2.toSafe(fP));},4))(a.id))(fD.name))(fE))(fF)):(fJ=fC.$0,{$:1,$0:bW.New(fJ.interval,fI,fJ.variation)})):fB=="TruncatedNormal"?(fK=fD.toTruncatedNormalDist(),fC==null?F.FailWith(((((fu.Curried(function(fM,fN,fO,fP){return fM("Cannot propagate parameter "+_2.toSafe(fN)+"\'s fixed prior in "+_2.toSafe(fO)+" to truncated normal prior in "+_2.toSafe(fP));},4))(a.id))(fD.name))(fE))(fF)):(fL=fC.$0,{$:1,$0:bW.New(fL.interval,fK,fL.variation)})):null;};E.printLoc=function(fB){return fB.$==1?fB.$0[0]+"."+fB.$0[1]:fB.$0;};E.plocation=function(){cA.$cctor();return cA.plocation;};E.pparameter=function(){cA.$cctor();return cA.pparameter;};F.FailWith=function(fB){throw new G(fB);};F.toInt=function(fB){var fC;fC=F.toUInt(fB);return fC>=2147483648?fC-4294967296:fC;};F.range=function(fB,fC){var fD;fD=1+fC-fB;return fD<=0?[]:bc.init(fD,function(fE){return fE+fB;});};F.toUInt=function(fB){return(fB<0?fv.ceil(fB):fv.floor(fB))>>>0;};F.KeyValue=function(fB){return[fB.K,fB.V];};F.step=function(fB,fC,fD){var fE;fE=F.Sign(fC);return bc.takeWhile(function(fF){return fE*(fD-fF)>=0;},bc.initInfinite(function(fF){return fB+fF*fC;}));};F.Sign=function(fB){return fB===0?0:fB<0?-1:1;};H=D.Exception=fu.Class({},G,H);H.New=fu.Ctor(function(fB,fC){this.message=fB;cG.setPrototypeOf(this,H.prototype);this.errors=fC;},H);I.New=function(fB,fC,fD){return{row:fB,column:fC,text:fD};};J=E.IGraph=fu.Class({to_string:function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fN,fO){return fO;}function fM(fN,fO){return"system "+fN+" =\\n{"+fO.to_string()+"\\n}";}this.expanded?F.FailWith("Cannot convert an Inference Graph to string after it has been expanded."):void 0;fB=(fC=this.task,fC!=null&&fC.$==1?fC.$0.to_string()+"\\n":"");return this.nodes.get_Count()===0?fB:(fD=bc.map(function(fN){return fL(fN[0],fN[1]);},K.ToSeq(this.nodes)),(fE=bc.map(function(fN){return A.map(function(fO){return[fO.name,fO];},fN.systems);},fD),(fF=db.string_of_list(a.id,"\\n",A.map(function(fN){return fM(fN[0],fN[1]);},A.ofSeq(K.ToSeq(K.OfArray(U.ofSeq(bc.isEmpty(fE)?B.Empty:bc.fold(function(fN,fO){return A.append(fO,fN);},B.Empty,fE))))))),(fG=bc.isEmpty(fD)?"":(fH=A.head(A.ofSeq(fD)).top,M.New(fH.name,(fI=fH.settings,O.New(fI.simulation,fI.simulations,fI.stochastic,fI.deterministic,fI.spatial,b0.get_defaults(),fI.moment_closure,fI.synthesis,fI.data,fI.units,fI.simulator,fI.parameters,fI.sweeps,fI.rates,fI.plot,fI.quiet)),fH.reactions,fH.initials,fH.attributes).to_string()),(fJ=db.string_of_list(function(fN){return J.node_to_igraph_string(fN[0],fN[1]);},"\\n",A.ofSeq(K.ToSeq(this.nodes))),(fK=db.string_of_list(function(fN){return J.edge_to_igraph_string(fN[0],fN[1]);},"\\n",A.ofSeq(K.ToSeq(this.edges))),fB+fG+"\\n"+fF+"\\n"+(this.nodes.get_Count()===1?(bc.head(K.ToSeq(this.nodes)))[1].systems.$==0?"":fJ:fJ+"\\n"+fK)))))));}},null,J);J.node_to_igraph_string=function(fB,fC){return"node "+fB+"{"+"systems = ["+db.string_of_list(function(fD){return fD.name;},"; ",fC.systems)+"]; "+"inference = "+(b0.get_to_string())(fC.top.settings.inference)+"}";};J.edge_to_igraph_string=function(fB,fC){var fD;function fE(fF,fG){function fH(fI,fJ,fK){return fI+" = "+bI.get_to_string(fK);}return"["+db.string_of_list(function(fI){return fH(fI[0],fI[1],fI[2]);},"; ",fG)+"] "+fF.get_to_string();}fD="edge "+fB.get_to_string()+" -> ";return db.string_of_list(function(fF){return fD+fE.apply(null,fF);},"\\n",fC);};J.New=function(fB,fC,fD,fE){return new J({task:fB,nodes:fC,edges:fD,expanded:fE});};K.Map=function(fB,fC){return new y.New$1(cx.OfSeq(bc.map(function(fD){return cz.New(fD.Key,fB(fD.Key,fD.Value));},cx.Enumerate(false,fC.get_Tree()))));};K.ToSeq=function(fB){return bc.map(function(fC){return[fC.Key,fC.Value];},cx.Enumerate(false,fB.get_Tree()));};K.TryFind=function(fB,fC){return fC.TryFind(fB);};K.FoldBack=function(fB,fC,fD){return bc.fold(function(fE,fF){return fB(fF.Key,fF.Value,fE);},fD,cx.Enumerate(true,fC.get_Tree()));};K.OfArray=function(fB){return new y.New$1(cx.OfSeq(bc.map(function(fC){return cz.New(fC[0],fC[1]);},fB)));};K.Fold=function(fB,fC,fD){return bc.fold(function(fE,fF){return fB(fE,fF.Key,fF.Value);},fC,cx.Enumerate(false,fD.get_Tree()));};K.Iterate=function(fB,fC){bc.iter(function(fD){fB(fD.K,fD.V);},fC);};K.Filter=function(fB,fC){var fD;return new y.New$1((fD=U.ofSeq(bc.filter(function(fE){return fB(fE.Key,fE.Value);},cx.Enumerate(false,fC.get_Tree()))),cx.Build(fD,0,fD.length-1)));};L=d.Model=fu.Class({merge_shared_settings:function(){var fB;fB=this;return L.New(this.top,A.map(function(fC){var fD;return M.New(fC.name,(fD=fC.settings,O.New(fD.simulation,fD.simulations,fD.stochastic,fD.deterministic,fD.spatial,fD.inference,fD.moment_closure,fD.synthesis,fD.data,fD.units,fD.simulator,A.append(fB.top.settings.parameters,fC.settings.parameters),fD.sweeps,fD.rates,fD.plot,fD.quiet)),fC.reactions,fC.initials,fC.attributes);},this.systems));},saturate_initials:function(){return L.New(this.top.saturate_initials(),A.map(function(fB){return fB.saturate_initials();},this.systems));},string:function(){var fB;fB=A.map(function(fC){return(((fu.Curried3(function(fD,fE,fF){return fD("system "+_2.toSafe(fE)+" = { \\n"+_2.toSafe(fF)+"\\n}");}))(a.id))(fC.name))(fC.to_string());},this.systems);return dk.concat("\\n\\n",new B({$:1,$0:this.top.to_string(),$1:fB}));},to_sbml:function(){return this.systems.$==0?this.top.to_sbml():F.FailWith("SBML export not implemented for multi-system models.");},to_matlab:function(){return this.systems.$==0?this.top.to_matlab():F.FailWith("Matlab export not implemented for multi-system models.");},infer_seq:function(fB){var fC,fD;fC=this.to_list_infer();fD=cP.list_to_inference(fC[0],fC[1]);return[bc.scan(function(fE,fF){var fG;fG=fF[1];return[{$:1,$0:fF[0]},fG,fE[0]==null||fG>fE[1]];},[null,-a.Infinity,false],bc.map(function(fE){var fF;return[fE,(fF=fE.state,fF.$==1?fF.$0.mle.logLikelihood:fF.$0.mle.logLikelihood)];},bu.run_mcmc_seq(fD,fB))),fD.$==1?fD.$0.parameters:fD.$0.parameters];},expandAndLift:function(){var fB,fC;fB=this;fC=A.unzip(A.map(function(fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;function fQ(fV){return fD.name+"."+fV;}function fR(fV){return A.exists(function(fW){return fW.name===fV;},fD.settings.parameters)?fQ(fV):fV;}function fS(fV){return R.map(fR,fV);}function fT(fV){var fW;return fV.$==0?{$:0,$0:fR(fV.$0)}:fV.$==1?(fW=fV.$0,{$:1,$0:fD.settings.rates.ContainsKey(fW)?fQ(fW):fW}):fV;}function fU(fV,fW){return[fQ(fV),fM(fW)];}fE=(fF=bF.expand_multiples(A.ofArray([fD.settings.simulation.sweeps.$==0?fD.settings.sweeps:A.filter(function(fV){return A.contains(fV.name,fD.settings.simulation.sweeps);},A.append(fD.settings.sweeps,fB.top.settings.sweeps))]),fD.settings.parameters),[A.head(fF[0]),fF[1],fF[2]]);fG=fE[1];fH=fE[2];fI=A.map(function(fV){return bX.New(fQ(fV.name),fV.value,fV.prior);},fG);fJ=K.Map(function(fV,fW){return A.map(fQ,fW);},fH);fK=A.map(function(fV){return b9.New(fV.name,A.map(function(fW){var fX,fY;function fZ(f0){return A.exists(function(f1){return f1.name===f0;},fG)?fQ(f0):f0;}fX=A.map((fY=function(f0){return R.map(fZ,f0);},function(f0){return A.map(fY,f0);}),fW.values);return b8.New(A.map(function(f0){return fH.ContainsKey(f0)?fQ(f0):f0;},fW.variables),fX);},fV.assignments));},fE[0]);fL=A.map(function(fV){return V.mapValues(fS,fV);},fD.initials);fM=function(fV){return R.map(fT,fV);};fN=A.map(function(fV){return cc.map(a.id,fS,fM,fV);},fD.reactions);return[M.New(fD.name,(fO=fD.settings,O.New((fP=fD.settings.simulation,P.New(fP.name,fP.initial,fP["final"],fP.points,A.map(fM,fD.settings.simulation.plots),fP.plotcolours,fP.seed,fP.kinetics,fP.times,fP.prune,fP.multicore,fP.data,fP.sweeps)),fO.simulations,fO.stochastic,fO.deterministic,fO.spatial,fO.inference,fO.moment_closure,fO.synthesis,fO.data,fO.units,fO.simulator,fI,fK,K.FoldBack(function(fV,fW,fX){return fX.Add(fV,fW);},K.OfArray(U.ofSeq(A.map(function(fV){return fU(fV[0],fV[1]);},A.ofSeq(K.ToSeq(fD.settings.rates))))),fB.top.settings.rates),fO.plot,fO.quiet)),fN,fL,fD.attributes),[fD.name,fJ]];},this.systems));return[L.New(this.top,A.map(function(fD){return fD.disambiguate_species_to_rates();},fC[0])).trim_rates(),K.OfArray(U.ofSeq(fC[1]))];},to_list_infer:function(){var fB,fC;fB=L.New(this.top,A.filter(function(fD){return!(fD.settings.data.$==0);},this.systems)).trim_rates();return[(fC=fB.top.settings,O.New(fC.simulation,fC.simulations,fC.stochastic,fC.deterministic,fC.spatial,fC.inference,fC.moment_closure,fC.synthesis,fC.data,fC.units,fC.simulator,fB.used_parameters(),fC.sweeps,fC.rates,fC.plot,fC.quiet)),A.filter(function(fD){return!(fD.settings.data.$==0);},A.map(function(fD){return fD.saturate_initials().to_ode();},new B({$:1,$0:fB.top,$1:fB.systems})))];},trim_rates:function(){var fB,fC,fD;return this.systems.$==0?L.New((fB=this.top,M.New(fB.name,(fC=this.top.settings,O.New(fC.simulation,fC.simulations,fC.stochastic,fC.deterministic,fC.spatial,fC.inference,fC.moment_closure,fC.synthesis,fC.data,fC.units,fC.simulator,fC.parameters,fC.sweeps,this.top.all_used_rates(),fC.plot,fC.quiet)),fB.reactions,fB.initials,fB.attributes)),this.systems):L.New(this.top.update_settings((fD=this.top.settings,O.New(fD.simulation,fD.simulations,fD.stochastic,fD.deterministic,fD.spatial,fD.inference,fD.moment_closure,fD.synthesis,fD.data,fD.units,fD.simulator,fD.parameters,fD.sweeps,new y.New([]),fD.plot,fD.quiet))),A.map(function(fE){var fF;return fE.update_settings((fF=fE.settings,O.New(fF.simulation,fF.simulations,fF.stochastic,fF.deterministic,fF.spatial,fF.inference,fF.moment_closure,fF.synthesis,fF.data,fF.units,fF.simulator,fF.parameters,fF.sweeps,fE.all_used_rates(),fF.plot,fF.quiet)));},this.systems));},used_parameters:function(){var fB;fB=A.distinct(A.collect(function(fC){return fC.all_used_parameters();},new B({$:1,$0:this.top,$1:this.systems})));return A.distinct(A.filter(function(fC){return A.exists(function(fD){return fD===fC.name;},fB);},A.collect(function(fC){return fC.settings.parameters;},new B({$:1,$0:this.top,$1:this.systems}))));}},null,L);L.initials_to_svg=function(fB){return L.stack_crn_svg_exports(M.initials_to_svg,fB);};L.reactions_to_svgs=function(fB){return L.list_crn_svg_exports(function(fC){return A.map(function(fD){return M.reaction_to_svg(fC,fD);},fC.reactions);},fB);};L.reactions_to_svg=function(fB){return L.stack_crn_svg_exports(M.reactions_to_svg,fB);};L.stack_crn_svg_exports=function(fB,fC){return S.stackv(cD.New(0,0),50,new B({$:1,$0:fB(fC.top),$1:A.map(function(fD){var fE;fE=fB(fD);return S.stackv(cD.New(0,0),15,A.ofArray([S.label_box({$:1,$0:"c-export__system-header"},20,fD.name),fE]));},fC.systems)}));};L.list_crn_svg_exports=function(fB,fC){return A.append(fB(fC.top),A.concat(A.map(function(fD){return A.append(fB(fD),A.ofArray([S.label_box({$:1,$0:"c-export__system-header"},20,fD.name)]));},fC.systems)));};L.get_parse=function(){var fB;fB=M.parse_with_modules(B.Empty,O.get_defaults());return function(fC){return dz.op_GreaterGreaterEquals(fB,function(fD){return L.parse_model(fD[0],fD[1]);},fC[0],fC[1]);};};L.parse_model=function(fB,fC){var fD,fE;function fF(fG){return L.New(fB,fG);}fD=(fE=L.parse_systems(fB.settings,fC),function(fG){return dz.op_GreaterGreaterDot(D.spaces(),fE,fG[0],fG[1]);});return function(fG){return dz.op_BarGreaterGreater(fD,fF,fG[0],fG[1]);};};L.parse_systems=function(fB,fC){return D.pfix(function(fD){var fE;function fF(fG){return D.preturn(A.append(fD,A.ofArray([fG])));}fE=L.parse_with_systems(fB,fC,fD);return function(fG){return dz.op_GreaterGreaterEquals(fE,fF,fG[0],fG[1]);};},B.Empty);};L.parse_with_systems=function(fB,fC,fD){var fE,fF,fG,fH;function fI(fM){var fN;function fO(fP,fQ){var fR,fS,fT,fU,fV,fW;fR=A.map((fS=(fT=(fU=fB.rates,function(fX){return M.species_to_rates(fU,fX);}),function(fX){return R.map(fT,fX);}),function(fX){return cc.map(a.id,a.id,fS,fX);}),fP.reactions);return M.New(fM,fP.settings.map((fV=(fW=fB.rates,function(fX){return M.species_to_rates(fW,fX);}),function(fX){return R.map(fV,fX);})),fR,fP.initials,fP.attributes);}fN=M.parse_with_modules_defaultSettings(fC,O.New(fB.simulation,fB.simulations,fB.stochastic,fB.deterministic,fB.spatial,fB.inference,fB.moment_closure,fB.synthesis,fB.data,fB.units,fB.simulator,B.Empty,B.Empty,new y.New([]),fB.plot,fB.quiet));return function(fP){return dz.op_BarGreaterGreater(fN,function(fQ){return fO(fQ[0],fQ[1]);},fP[0],fP[1]);};}function fJ(fM,fN){var fO,fP;function fQ(fS,fT){return dz.op_DotGreaterGreater(D.name(),D.spaces(),fS,fT);}function fR(fS){var fT,fU,fV;function fW(fX,fY){var fZ,f0,f1,f2,f3,f4,f5,f6;fZ=A.map((f0=(f1=(f2=fB.rates,function(f7){return M.species_to_rates(f2,f7);}),function(f7){return R.map(f1,f7);}),function(f7){return cc.map(a.id,a.id,f0,f7);}),fX.reactions);f3=fX.settings.map((f4=(f5=fB.rates,function(f7){return M.species_to_rates(f5,f7);}),function(f7){return R.map(f4,f7);}));f6=bb.fold(function(f7,f8,f9){return f7.Add(f8,f9);},fX.attributes,fU.attributes);return M.New(fM,f3,A.append(fU.reactions,fZ),A.append(fU.initials,fX.initials),f6);}fT=bc.tryFind(function(fX){return fX.name===fS;},fN);return fT==null?F.FailWith("System "+fS+" not defined"):(fU=fT.$0,(fV=M.parse_with_modules_defaultSettings(fC,fU.settings),function(fX){return dz.op_BarGreaterGreater(fV,function(fY){return fW(fY[0],fY[1]);},fX[0],fX[1]);}));}fO=(fP=D.kw("with"),function(fS){return dz.op_DotGreaterGreater(function(fT){return fQ(fT[0],fT[1]);},fP,fS[0],fS[1]);});return function(fS){return dz.op_GreaterGreaterEquals(fO,fR,fS[0],fS[1]);};}function fK(fM,fN){return dz.op_DotGreaterGreater(D.name(),D.spaces(),fM,fN);}function fL(fM){var fN,fO,fP,fQ,fR,fS,fT;function fU(fW){return true;}function fV(fW){return fW?D.braces(fJ(fM,fD)):D.braces(fI(fM));}fN=D.plookAheadWith((fO=D.choice([D.pTry((fP=(fQ=(fR=(fS=D.kw("{"),function(fW){return dz.op_GreaterGreaterDot(fS,D.name(),fW[0],fW[1]);}),function(fW){return dz.op_DotGreaterGreater(fR,D.spaces(),fW[0],fW[1]);}),(fT=D.kw("with"),function(fW){return dz.op_DotGreaterGreater(fQ,fT,fW[0],fW[1]);})),function(fW){return dz.op_BarGreaterGreater(fP,fU,fW[0],fW[1]);})),D.preturn(false)]),function(fW){return fO([fW[0],fW[1]]);}));return function(fW){return dz.op_GreaterGreaterEquals(fN,fV,fW[0],fW[1]);};}fE=(fF=(fG=D.kw("system"),function(fM){return dz.op_GreaterGreaterDot(fG,function(fN){return fK(fN[0],fN[1]);},fM[0],fM[1]);}),(fH=D.kw("="),function(fM){return dz.op_DotGreaterGreater(fF,fH,fM[0],fM[1]);}));return function(fM){return dz.op_GreaterGreaterEquals(fE,fL,fM[0],fM[1]);};};L.New=function(fB,fC){return new L({top:fB,systems:fC});};M=d.Crn=fu.Class({initialise:function(){return this.create_blank_attributes().update_empty_plot_labels();},substitute:function(fB){var fC;return this.update_settings((fC=this.settings,O.New(fC.simulation,fC.simulations,fC.stochastic,fC.deterministic,fC.spatial,fC.inference,fC.moment_closure,fC.synthesis,fC.data,fC.units,fC.simulator,bF.substitute(fB,this.settings.parameters),fC.sweeps,fC.rates,fC.plot,fC.quiet)));},get_instances:function(){return(this.to_simulation_runs())[0];},to_oslo:function(){return this.to_ode().to_oslo();},to_ssa:function(){var fB,fC,fD,fE,fF,fG,fH;fB=this.scale();fC=bF.to_env(fB.settings.parameters);fD=co.inline_rates_env(fC,fB.settings.rates);fE=V.to_initialpops_events(fC,fB.settings.simulation.initial,fB.initials);fF=fB.settings.stochastic.scale;fG=bf.create(fE[0],fE[1],fB.settings.simulation,fF);fH=Y.make_sim_reactions_pops(fC,fD,fF,bk.Equals(fB.settings.simulation.kinetics,"Deterministic")?A.map(function(fI){return cc.New(fI.catalysts,fI.reactants,fI.reverse,fI.rate.map(function(fJ){return fI.stochastic_to_deterministic(fJ);},a.id),fI.products);},fB.reactions):fB.reactions,fG.populations);return Y.create(fG,fB.settings.stochastic,fH[0],fH[2],fB.settings.parameters,fD);},to_sundials:function(){return this.to_ode().to_sundials();},to_lna:function(){var fB;fB=this.scale();return fB.to_ode().to_lna(fB.settings.stochastic.scale);},simulate_cme_callback:function(fB,fC,fD){var fE,fF,fG,fH;fE=bF.to_env(this.settings.parameters);fF=M.to_inlined_rates(this.settings);fG=this.to_ctmc();fH=this.to_cme(fG);fC(fG);return bg.simulate_callback(fE,fF,fB,fD,false,fH);},to_pde1d:function(){var fB,fC,fD,fE;fB=bF.to_env(this.settings.parameters);fC=(fD=this.settings.simulation.seed,fD==null?new cR.New():new cR.New$1(fD.$0));return this.to_pde(fC,(V.to_initialpops_events_poly(fB,this.settings.simulation.initial,this.initials,(fE=this.settings.spatial.nx,function(fF){return _5.accumulator_1d(fC,fE,fF);})))[0]);},to_pde2d:function(){var fB,fC,fD,fE;fB=bF.to_env(this.settings.parameters);fC=(fD=this.settings.simulation.seed,fD==null?new cR.New():new cR.New$1(fD.$0));return this.to_pde(fC,(V.to_initialpops_events_poly(fB,this.settings.simulation.initial,this.initials,(fE=this.settings.spatial.nx,function(fF){return _5.accumulator_2d(fC,fE,fF);})))[0]);},simulate_cmesundials_callback:function(fB,fC,fD){var fE,fF,fG,fH;fE=bF.to_env(this.settings.parameters);fF=M.to_inlined_rates(this.settings);fG=this.to_ctmc();fH=this.to_cme(fG);fC(fG);return fH.simulate_sundials_callback(fB,fE,fF,fD);},to_string:function(){var fB;fB=this;return this.to_string_with(R.is_not_empty,function(fC){return!bk.Equals(R.simplify(fC),{$:1,$0:fB.settings.simulation.initial});},void 0);},saturate_initials:function(){var fB,fC;function fD(fE){return fE[1];}fB=A.distinct(A.append(b$.elements(b$.union_all(bk.Equals,A.map(function(fE){return b$.union_all(bk.Equals,A.ofArray([fE.reactants,fE.products,fE.catalysts]));},this.reactions))),bc.fold(function(fE,fF){return fF.$==2?new B({$:1,$0:fF.$0,$1:fE}):fE;},B.Empty,A.distinct(A.collect(function(fE){return R.mentions(fD(fE));},A.ofSeq(K.ToSeq(this.settings.rates)))))));fC=A.map(function(fE){return fE.species;},this.initials);return M.New(this.name,this.settings,this.reactions,A.rev(db.fold_left(function(fE,fF){return A.exists(function(fG){return bk.Equals(fF,fG);},fC)?fE:new B({$:1,$0:V.create$4(false,{$:1,$0:0},fF,null,null),$1:fE});},A.rev(this.initials),fB)),this.attributes);},to_ctmc:function(){var fB;fB=this.initialise_ctmc();return fB[0].to_ctmc(cS.ofMap(this.settings.rates),1,fB[1],fB[2],fB[3]);},to_cme:function(fB){var fC,fD,fE;fC=this.scale();fD=V.to_initialpops_events(bF.to_env(fC.settings.parameters),fC.settings.simulation.initial,fC.initials);fE=bg.create(fD[0],fD[1],fC.settings.deterministic,fC.settings.simulation,1);return bg.New(fE.name,fE.simulator,fE.settings,[fB.ctmc],fE.probabilities);},update_empty_plot_labels:function(){return M.New(this.name,this.settings.update_empty_plot_labels(),this.reactions,this.initials,this.attributes);},create_blank_attributes:function(){return M.New(this.name,this.settings,this.reactions,this.initials,bc.fold(function(fB,fC){return bb.tryFind(fC.species.name,fB)==null?bb.add(fC.species.name,_8.New(fC.species.name,"",""),fB):fB;},this.attributes,this.saturate_initials().initials));},update_settings:function(fB){return M.New(this.name,fB,this.reactions,this.initials,this.attributes);},to_simulation_runs:function(){return this.settings.to_simulation_runs(this.name);},to_ode:function(){var fB;fB=A.ofSeq(this.initials);return cP.create(this.name,cc.normalise_list(this.reactions),fB,this.settings);},scale:function(){var fB,fC,fD;function fE(fH,fI,fJ){return fI===0?{$:2,$0:A.ofArray([fJ,{$:1,$0:fH}])}:fI===1?fJ:fI===2?{$:3,$0:ct.New(fJ,{$:1,$0:fH})}:{$:2,$0:A.ofArray([fJ,{$:1,$0:fv.pow(fH,1-fI)}])};}function fF(fH){return{$:2,$0:A.ofArray([R.expand(function(fI){return co.scale(fB,fI);},fH),{$:1,$0:fB}])};}function fG(fH){return{$:2,$0:A.ofArray([fH,{$:1,$0:fB}])};}fB=this.settings.stochastic.scale;return fB===1?this:M.New(this.name,(fC=this.settings,O.New(fC.simulation,fC.simulations,(fD=this.settings.stochastic,_7.New(1,fD.steps,fD.trajectories,fD.stationary_skiptime)),fC.deterministic,fC.spatial,fC.inference,fC.moment_closure,fC.synthesis,fC.data,fC.units,fC.simulator,fC.parameters,fC.sweeps,fC.rates,fC.plot,fC.quiet)),A.map(function(fH){return fH.scale(function(fI,fJ){return function(fK){return fE(fI,fJ,fK);};},fB,fF);},this.reactions),A.map(function(fH){return fH.scale(fG);},this.initials),this.attributes);},to_pde:function(fB,fC){var fD,fE,fF;fD=cc.normalise_list(this.reactions);fE=cP.get_matrices(this.initials,fD);return _5.create(this.name,fC,this.settings.simulation,(fF=this.settings.spatial,_6.New(this.settings.parameters,fF.diffusibles,fF.dimensions,fF.boundary,fF.xmax,fF.nx,fF.dt,fF.default_diffusion,fF.random)),fE[1],fE[2],cP.get_rates(fE[0],fD,bk.Equals(this.settings.simulation.kinetics,"Stochastic")),this.settings.rates,fB);},to_string_with:function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN;bF.to_env(this.settings.parameters);fE=this.settings.to_string(Q.to_string,Q.to_string_plot);fF=(fG=A.filter(function(fO){return fB(fO.value);},this.initials),A.map((fH=(fI=function(fO){return R.to_string(a.id,fO);},function(fO){return V.to_string(be.to_string,fI,fC,fO);}),(fJ=function(fO){return function(fP){return fO("| "+_2.toSafe(fP));};}(a.id),function(fO){return fJ(fH(fO));})),fG));fK=A.map((fL=(fM=function(fO){return R.to_string(a.id,fO);},function(fO){return cc.to_string(be.to_string,fM,Q.to_string,fO);}),(fN=function(fO){return function(fP){return fO("| "+_2.toSafe(fP));};}(a.id),function(fO){return fN(fL(fO));})),this.reactions);return fE+(fF.$===0?"":"\\n"+dk.concat("\\n",fF))+(fK.$===0?"":"\\n"+dk.concat("\\n",fK));},to_sbml:function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY;function fZ(){var gd;gd=fG[0];fG[0]=gd+1;return gd;}function f0(gd){var ge;return bl.mkSId(gd+(ge=fZ(),a.String(ge)));}function f1(){return f0("s_id");}function f2(){return f0("r_id");}function f3(gd,ge,gf,gg,gh){return[gd,[gd,ge,gf,gg,gh]];}function f4(gd){var ge;ge=K.TryFind(gd,fI);return ge!=null&&ge.$==1?ge.$0[4]:F.FailWith("Error - getSId - key "+gd+" not found.");}function f5(gd){var ge,gf;ge=bl.mkUnitSId("k_unit_"+(gf=gd,a.String(gf)));return[ge,bl.create_unitDefinition(ge,new B({$:1,$0:bl.u_set_multiplier(fE,bl.u_set_scale(fD,bl.u_set_exponent(-1,bl.create_sbmlUnit(dV.Second)))),$1:gd!==1?A.ofArray([bl.u_set_scale(fF,bl.u_set_exponent(1-gd,bl.create_sbmlUnit(dV.Mole))),bl.u_set_exponent(gd-1,bl.create_sbmlUnit(dV.Litre))]):B.Empty}))];}function f6(gd){var ge,gf,gg;ge=cS.tryFind(fJ,gd);return ge==null?(gf=f5(gd),(gg=gf[0],(cS.add(fJ,gd,[gg,gf[1]]),gg))):ge.$0[0];}function f7(gd,ge){return function(gf){var gg,gh,gi;gg=cS.tryFind(fU,[gd,ge]);return gg==null?(gh=bl.mkSId(gd),(gi=bl.p_set_units(gf,bl.p_set_value(ge,bl.create_parameter(gh))),(cS.add(fU,[gd,ge],[gh,gi]),[gh,gi]))):[gg.$0[0],gg.$0[1]];};}function f8(gd,ge){return cS.add(fV,gd,ge);}function f9(gd,ge){var gf;gf=bl.create_initialAssignment(gd,{$:2,$0:dW.Times,$1:A.ofArray([{$:3,$0:{$:0,$0:1},$1:{$:1,$0:fP}},ge])});return function(gg){return bl.model_add_initialAssignment(gf,gg);};}function f_(gd){return((function(ge){return f7(ge[0],ge[1]);}([gd,R["eval"](fB,{$:0,$0:gd})]))(fO))[0];}function f$(gd,ge,gf,gg,gh){return gf.$==1?gg?bl.sp_set_boundaryCondition(true,bl.sp_set_constant(gg,bl.sp_set_initialConcentration(gf.$0,bl.sp_set_name(ge,bl.create_species(gh,fQ))))):bl.sp_set_constant(gg,bl.sp_set_initialConcentration(gf.$0,bl.sp_set_name(ge,bl.create_species(gh,fQ)))):(f8(gh,R.to_mathML(f_,gf)),gg?bl.sp_set_boundaryCondition(true,bl.sp_set_constant(gg,bl.sp_set_name(ge,bl.create_species(gh,fQ)))):bl.sp_set_constant(gg,bl.sp_set_name(ge,bl.create_species(gh,fQ))));}function ga(gd){return b$.collectm(function(ge){return bl.sr_set_stoichiometry(ge.multiplicity,bl.create_speciesReference(f4(ge.element)));},gd);}function gb(gd,ge){var gf;gf=ge[1];return function(gg){return bl.model_add_parameter(gf,gg);};}function gc(gd,ge){var gf;gf=ge[1];return function(gg){return bl.model_add_unitDefinition(gf,gg);};}fB=(fC=bF.to_env(this.settings.parameters),function(gd){return di.find(fC,gd);});fD=0;fE=1;fF=this.settings.units.concentration.$0;fG=[0];fH=A.map(function(gd){return[gd.species.name,bl.mkString(gd.species.name),gd.value,gd.constant,f1()];},this.initials);fI=K.OfArray(U.ofSeq(A.map(function(gd){return f3(gd[0],gd[1],gd[2],gd[3],gd[4]);},fH)));fJ=cS.empty();fK=bl.mkUnitSId("time");cS.add(fJ,-1,[fK,bl.create_unitDefinition(fK,A.ofArray([bl.u_set_multiplier(fE,bl.u_set_scale(fD,bl.create_sbmlUnit(dV.Second)))]))]);fL=bl.mkUnitSId("substance");fM=bl.u_set_scale(fF,bl.create_sbmlUnit(dV.Mole));cS.add(fJ,-2,[fL,bl.create_unitDefinition(fL,A.ofArray([fM]))]);fN=bl.mkUnitSId("volume");cS.add(fJ,-3,[fN,bl.create_unitDefinition(fN,A.ofArray([bl.create_sbmlUnit(dV.Litre)]))]);fO=bl.mkUnitSId("dimless");cS.add(fJ,-4,[fO,bl.create_unitDefinition(fO,A.ofArray([bl.create_sbmlUnit(dV.Dimensionless)]))]);fP=bl.mkUnitSId("concentration");cS.add(fJ,-5,[fP,bl.create_unitDefinition(fP,A.ofArray([fM,bl.u_set_exponent(-1,bl.create_sbmlUnit(dV.Litre))]))]);fQ=bl.mkSId("c");fR=bl.mkSId("c_size");fS=this.settings.stochastic.scale/6.0221415*fv.pow(10,-23-fF);fT=bl.p_set_units(fN,bl.p_set_value(fS,bl.create_parameter(fR)));fU=cS.empty();fV=cS.empty();cS.empty();fW=K.OfArray(U.ofSeq(A.map(function(gd){return[gd.name,{$:1,$0:gd.value}];},this.settings.parameters)));return cS.fold(function(gd,ge,gf){return(f9(gd,ge))(gf);},fV,cS.fold(function(gd,ge,gf){return(gb(gd,ge))(gf);},fU,cS.fold(function(gd,ge,gf){return(gc(gd,ge))(gf);},fJ,(fX=(fY=bl.model_add_compartment(bl.cmt_set_size(fS,bl.create_compartment(fQ)),bl.empty_model()),bl.model_set_species(A.map(function(gd){return f$(gd[0],gd[1],gd[2],gd[3],gd[4]);},fH),fY)),bl.model_set_reactions(A.map(function(gd){var ge,gf,gg,gh,gi,gj,gk,gl,gm,gn;function go(gq,gr){return gr===1?gq:{$:1,$0:dX.Power,$1:gq,$2:{$:3,$0:{$:0,$0:gr},$1:{$:1,$0:fO}}};}function gp(gq,gr){return gr===1?gq:{$:1,$0:dX.Divide,$1:gq,$2:{$:3,$0:{$:0,$0:gr},$1:{$:1,$0:fO}}};}ge=cc.map(function(gq){return gq.name;},a.id,a.id,gd);return bl.r_set_kineticLaw((gf=ge.rate,gf.$==1?bl.create_kineticLaw(R.to_mathML(f4,R.substitute(fW,R.map(function(gq){return co.to_matlab(be.to_string,"time",gq);},gf.$0)))):(gg=gf.$0,(gh=R["eval"](fB,gg),(gi=f6(b$.size(ge.reactants)),(gj=gg.$==0?(gk=(function(gq){return f7(gq[0],gq[1]);}([gg.$0,gh]))(gi),[gk[0],gk[1],false]):(gl=bl.mkSId("k"),[gl,bl.p_set_units(gi,bl.p_set_value(gh,bl.create_parameter(gl))),true]),gj[2]?bl.kl_add_parameter(gj[1],bl.kl_add_parameter(fT,bl.create_kineticLaw({$:2,$0:dW.Times,$1:new B({$:1,$0:{$:4,$0:fR},$1:new B({$:1,$0:{$:4,$0:gj[0]},$1:b$.collectm(function(gq){return gp(go({$:4,$0:f4(gq.element)},gq.multiplicity),db.fac(gq.multiplicity));},ge.reactants)})})}))):bl.kl_add_parameter(fT,bl.create_kineticLaw({$:2,$0:dW.Times,$1:new B({$:1,$0:{$:4,$0:fR},$1:new B({$:1,$0:{$:4,$0:gj[0]},$1:b$.collectm(function(gq){return gp(go({$:4,$0:f4(gq.element)},gq.multiplicity),db.fac(gq.multiplicity));},ge.reactants)})})}))))))),bl.r_set_reversible(false,(gm=(gn=bl.create_reaction(f2()),bl.r_set_reactants(ga(ge.reactants),gn)),bl.r_set_products(ga(ge.products),gm))));},cc.normalise_list(this.reactions)),fX)))));},to_matlab:function(){var fB,fC,fD;fB=this.saturate_initials().create_blank_attributes();fC=this.settings.simulator;return fC=="Oslo"||fC=="Sundials"?cP.to_matlab(fB.to_ode()):a.String(fC)+" simulator does not support MATLAB export, try Oslo or Sundials";},initialise_ctmc:function(){var fB,fC,fD,fE,fF,fG;function fH(fI,fJ){return fC;}fB=this.scale();fC=A.map(function(fI){return bk.Equals(fB.settings.simulation.kinetics,"Deterministic")?cc.New(fI.catalysts,fI.reactants,fI.reverse,fI.rate.map(function(fJ){return fI.stochastic_to_deterministic(fJ);},a.id),fI.products):fI;},cc.normalise_list(fB.reactions));fD=bF.to_env(fB.settings.parameters);fE=A.map(function(fI){return[fI.species,F.toInt(R["eval"](function(fJ){return di.find(fD,fJ);},fI.value))];},fB.initials);fF=_3.New(function(fI){return function(fJ){return fH(fI,fJ);};});fG=fF.initialise_ctmc(fE);return[fF,fG[0],fG[1],fG[2]];},disambiguate_species_to_rates:function(){var fB,fC,fD,fE,fF;return M.New(this.name,this.settings.map((fB=(fC=this.settings.rates,function(fG){return M.species_to_rates(fC,fG);}),function(fG){return R.map(fB,fG);})),A.map((fD=(fE=(fF=this.settings.rates,function(fG){return M.species_to_rates(fF,fG);}),function(fG){return R.map(fE,fG);}),function(fG){return cc.map(a.id,a.id,fD,fG);}),this.reactions),this.initials,this.attributes);},saturate_plots:function(){var fB,fC,fD,fE,fF;function fG(fH){return fH.plots.$==0?fB.settings.simulator=="MC"?fH:P.New(fH.name,fH.initial,fH["final"],fH.points,A.map(function(fI){return{$:0,$0:{$:2,$0:fI.species}};},fB.initials),fH.plotcolours,fH.seed,fH.kinetics,fH.times,fH.prune,fH.multicore,fH.data,fH.sweeps):fH;}fB=this.settings.simulation.plots.$==0?this.settings.simulator=="MC"?M.New(this.name,(fC=this.settings,O.New(fC.simulation,fC.simulations,fC.stochastic,fC.deterministic,fC.spatial,fC.inference,bD.saturate_plots(this.all_species(),this.settings.moment_closure),fC.synthesis,fC.data,fC.units,fC.simulator,fC.parameters,fC.sweeps,fC.rates,fC.plot,fC.quiet)),this.reactions,this.initials,this.attributes):M.New(this.name,(fD=this.settings,O.New((fE=this.settings.simulation,P.New(fE.name,fE.initial,fE["final"],fE.points,A.map(function(fH){return{$:0,$0:{$:2,$0:fH}};},this.all_species()),fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps)),fD.simulations,fD.stochastic,fD.deterministic,fD.spatial,fD.inference,fD.moment_closure,fD.synthesis,fD.data,fD.units,fD.simulator,fD.parameters,fD.sweeps,fD.rates,fD.plot,fD.quiet)),this.reactions,this.initials,this.attributes):this;return M.New(fB.name,(fF=fB.settings,O.New(fG(fB.settings.simulation),A.map(fG,fB.settings.simulations),fF.stochastic,fF.deterministic,fF.spatial,fF.inference,fF.moment_closure,fF.synthesis,fF.data,fF.units,fF.simulator,fF.parameters,fF.sweeps,fF.rates,fF.plot,fF.quiet)),fB.reactions,fB.initials,fB.attributes);},all_used_rates:function(){var fB;function fC(fD){return fD.$==1?{$:1,$0:fD.$0}:null;}return this.settings.all_used_rates((fB=function(fD){return A.choose(fC,fD);},function(fD){return fB(R.mentions(fD));}),this.reactions);},all_species:function(){return A.distinct(A.append(A.distinctBy(function(fB){return fB.name;},A.map(function(fB){return fB.species;},this.initials)),A.collect(function(fB){return fB.get_allSpecies();},this.reactions)));},all_used_parameters:function(){var fB,fC,fD,fE,fF,fG,fH;function fI(fJ){return fJ.$==0?{$:1,$0:fJ.$0}:null;}fB=(fC=function(fJ){return A.choose(fI,fJ);},function(fJ){return fC(R.mentions(fJ));});fD=A.collect(function(fJ){var fK;return A.append((fK=fJ.time,fK==null?B.Empty:R.mentions(fK.$0)),R.mentions(fJ.value));},this.initials);fE=A.collect(function(fJ){var fK,fL;return A.append((fK=fJ.rate,fK.$==1?fB(fK.$0):R.mentions(fK.$0)),(fL=fJ.reverse,fL!=null&&fL.$==1?fL.$0.$==1?fB(fL.$0.$0):R.mentions(fL.$0.$0):B.Empty));},this.reactions);fF=A.collect(fB,A.append(this.settings.simulation.plots,A.concat(A.map(function(fJ){return fJ.plots;},this.settings.simulations))));fG=A.collect(fB,A.map(function(fJ){return fJ[1];},A.ofSeq(K.ToSeq(this.settings.rates))));fH=A.collect(function(fJ){return fJ.sweeps;},this.settings.simulations);return A.distinct(A.append(fD,A.append(fE,A.append(fF,A.append(fG,A.collect(function(fJ){return A.collect(function(fK){return A.append(fK.variables,A.collect(R.mentions,A.concat(fK.values)));},fJ.assignments);},fH.$==0?this.settings.sweeps:A.filter(function(fJ){return A.contains(fJ.name,fH);},this.settings.sweeps)))))));}},null,M);M.species_to_rates=function(fB,fC){var fD;return fC.$==3?co.Time:fC.$==0?{$:0,$0:fC.$0}:fC.$==1?{$:1,$0:fC.$0}:(fD=fC.$0,fB.ContainsKey(fD.name)?{$:1,$0:fD.name}:{$:2,$0:fD});};M.get_default_svg_style=function(){return"\\r\\n  .crnsvgvalue {\\r\\n      text-anchor: end;\\r\\n      stroke: black;\\r\\n      fill: black;\\r\\n      stroke-width: 0;\\r\\n      font-family: Verdana, Arial, sans-serif;\\r\\n      font-size: 15px;\\r\\n  }\\r\\n  .crnsvgrate {\\r\\n      text-anchor: middle;\\r\\n      stroke: black;\\r\\n      fill: black;\\r\\n      stroke-width: 0;\\r\\n      font-family: Verdana, Arial, sans-serif;\\r\\n      font-size: 15px;\\r\\n  }\\r\\n  path.crnsvgrate { stroke-width: 2; fill: none; stroke-linejoin: round }\\r\\n  .crnsvgplus { text-anchor: start }\\r\\n  .crnsvgspeciestext { text-anchor: start }\\r\\n  ";};M.initials_to_svg=function(fB){var fC,fD,fE;function fF(fG){return A.head(fG).box_dim.x;}fC=cD.New(30,10);fD=A.map(function(fG){return A.ofArray([M.svg_label_box({$:1,$0:"crnsvgvalue"},R.to_string(a.id,fG.value)),M.get_svg(fB,fG.species.name,true)]);},A.filter(function(fG){return!bk.Equals(fG.value,{$:1,$0:0});},fB.initials));fE=fD.$==0?0:fF(A.maxBy(fF,fD));return S.stackv(fC,10,A.map(function(fG){var fH,fI;fH=S.stackhc(cD.New(fE+10,fC.y),M.get_svgListMargin(),fG);return cE.New((fI=fH.box_group,cF.New(fI.name,fI.content,fI.anchors,fI.debug_anchors,fI.sub_groups,{$:1,$0:cD.New(fE,0)})),fH.box_dim);},A.map(function(fG){var fH;return fG.$==1?(fH=fG.$0,new B({$:1,$0:cE.New(fH.box_group,cD.New(0,fH.box_dim.y)),$1:fG.$1})):B.Empty;},fD)));};M.reactions_to_svg=function(fB){var fC,fD;fC=fB.reactions;return fC.$==0?M.svg_raw_box(""):(fD=A.map(function(fE){return M.reaction_to_svg(fB,fE);},fC),S.stackv(cD.New(0,0),M.get_svgListMargin(),fD));};M.get_parse=function(){var fB,fC,fD,fE,fF;function fG(fH){return fH[0];}fB=(fC=(fD=O.parse(Q.parse(),Q.parse_plot()),function(fH){return dz.op_DotGreaterGreater(fD,D.spaces(),fH[0],fH[1]);}),(fE=(fF=be.get_parse(),function(fH){return M.parse_instructions(fF,fH);}),function(fH){return dz.op_GreaterGreaterEquals(fC,fE,fH[0],fH[1]);}));return function(fH){return dz.op_BarGreaterGreater(fB,fG,fH[0],fH[1]);};};M.to_inlined_rates=function(fB){return co.inline_rates_env(bF.to_env(fB.parameters),fB.rates);};M.svg_label_box=function(fB,fC){var fD;fD=S.label_box(fB,S.default_letter_width(),fC);return cE.New(fD.box_group,cD.New(fD.box_dim.x,22));};M.get_svg=function(fB,fC,fD){var fE,fF;fE=bb.tryFind(fC,fB.attributes);fF=fE!=null&&fE.$==1?fE.$0.svg:"";return fF===""?M.svg_label_box({$:1,$0:"crnsvgvalue crnsvgspeciestext"},fC):M.svg_raw_box(fD&&dk.StartsWith(fF,"<svg")?"<g"+dk.Remove(dk.Remove(fF,0,4),fF.length-10,6)+"</g>":fF);};M.get_svgListMargin=function(){return 20;};M.create=function(fB,fC,fD,fE,fF,fG){return fG?M.New(fB,fC,fD,fE,fF).saturate_initials().saturate_plots():M.New(fB,fC,fD,fE,fF).saturate_initials();};M.svg_raw_box=function(fB){return M.svg_raw_box_sized(fB,M.try_grab("width",150,fB),M.try_grab("height",60,fB));};M.reaction_to_svg=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fN){return fN.multiplicity===1?A.ofArray([M.get_svg(fB,fN.element.name,true)]):A.ofArray([M.svg_label_box({$:1,$0:"crnsvgvalue"},a.String(fN.multiplicity)),M.get_svg(fB,fN.element.name,true)]);}function fM(fN){return S.stackhc(cD.New(0,0),10,A.collect(a.id,A.mapi(function(fO,fP){return fO===0?fP:new B({$:1,$0:M.svg_label_box({$:1,$0:"crnsvgvalue crnsvgplus"},"+"),$1:fP});},A.map(fL,fN))));}fD=cD.New(0,0);fE=b$.is_empty(fC.reactants)?null:{$:1,$0:fM(fC.reactants)};fF=b$.is_empty(fC.catalysts)?null:{$:1,$0:fM(fC.catalysts)};fG=b$.is_empty(fC.products)?null:{$:1,$0:fM(fC.products)};fH=fF!=null&&fF.$==1?(fI=fF.$0,fE!=null&&fE.$==1?{$:1,$0:S.stackhc(fD,20,A.ofArray([fE.$0,M.svg_label_box({$:1,$0:"crnsvgvalue"},"~"),fI]))}:{$:1,$0:fI}):fE;fJ=M.rate_box_svg(fC.rate,fC.reverse);fK=S.stackhc(fD,20,fH!=null&&fH.$==1?fG!=null&&fG.$==1?A.ofArray([fH.$0,fJ,fG.$0]):A.ofArray([fH.$0,fJ]):fG!=null&&fG.$==1?A.ofArray([fJ,fG.$0]):F.FailWith("invalid reaction"));return cE.New(fK.box_group,cD.New(fK.box_dim.x*1.05,fK.box_dim.y));};M.parse_instructions=function(fB,fC){return M.parse_instructions_modules(fB,B.Empty,fC);};M.svg_raw_box_sized=function(fB,fC,fD){return cE.New(cF.New("",{$:1,$0:fB},B.Empty,false,B.Empty,null),cD.New(fC,fD));};M.try_grab=function(fB,fC,fD){var fE,fF,fG;fE=(function(fH){return function(fI){return fH(_2.toSafe(fI)+"=\\"");};}(a.id))(fB);fF=fE.length;return fD.indexOf(fE)!=-1?(fG=fD.substring(fD.indexOf(fE)+fF),fG.indexOf("\\"")!=-1?a.Number(dk.Substring(fG,0,fG.indexOf("\\""))):fC):fC;};M.rate_box_svg=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fM){return fM.to_string_bare(function(fN){return R.to_string(a.id,fN);},Q.to_string);}fD=13;fE=fL(fB);fF=fC!=null&&fC.$==1?{$:1,$0:fL(fC.$0)}:null;fG=(fH=fF!=null&&fF.$==1?fD*(fI=dk.length(fE),(fJ=dk.length(fF.$0),bk.Compare(fI,fJ)===1?fI:fJ)):fD*dk.length(fE),(fK=50,bk.Compare(fH,fK)===1?fH:fK));return cE.New(S.content_group(fF!=null&&fF.$==1?{$:0,$0:A.ofArray([el.New({$:1,$0:"crnsvgrate"},A.ofArray([{$:0,$0:cD.New(0,20)},{$:1,$0:cD.New(fG,20)},{$:1,$0:cD.New(fG-10,10)},{$:0,$0:cD.New(fG,25)},{$:1,$0:cD.New(0,25)},{$:1,$0:cD.New(10,35)}]),null),el.New(null,B.Empty,{$:1,$0:em.New(fE,cD.New(fG/2,17),{$:1,$0:"crnsvgrate"},S.default_letter_width(),cD.New(fG,17))}),el.New(null,B.Empty,{$:1,$0:em.New(fF.$0,cD.New(fG/2,38),{$:1,$0:"crnsvgrate"},S.default_letter_width(),cD.New(fG,38))})])}:{$:0,$0:A.ofArray([el.New({$:1,$0:"crnsvgrate"},A.ofArray([{$:0,$0:cD.New(0,20)},{$:1,$0:cD.New(fG,20)},{$:1,$0:cD.New(fG-10,10)}]),null),el.New(null,B.Empty,{$:1,$0:em.New(fE,cD.New(fG/2,17),{$:1,$0:"crnsvgrate"},S.default_letter_width(),cD.New(fG,17))})])}),cD.New(fG,40));};M.parse_instructions_modules=function(fB,fC,fD){var fE;function fF(fG,fH){var fI;fI=A.append(fC,fG);return[M.create_from_instructions(fD,[fI,fH]),fI];}fE=eY.parse(fB,fD);return function(fG){return dz.op_BarGreaterGreater(fE,function(fH){return fF(fH[0],fH[1]);},fG[0],fG[1]);};};M.parse_with_modules=function(fB,fC){var fD,fE,fF;fD=O.parse_defaults(Q.parse(),Q.parse_plot(),fC);fE=(fF=be.get_parse(),function(fG){return M.parse_instructions_modules(fF,fB,fG);});return function(fG){return dz.op_GreaterGreaterEquals(fD,fE,fG[0],fG[1]);};};M.create_from_instructions=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL;fD=eY.convert_instructions(fC[0],fC[1]);fE=fD[1];(function(fM){var fN,fO,fP;while(true)if(fM.$==1){if(fM.$1.$==0)return null;else{fN=fM.$0[0];fO=fM.$0[1];fP=fM.$1;A.iter(function(fQ,fR){return function(fS){var fT,fU;fT=(fU=fS[1],dg.Filter(function(fV){return fU.Contains(fV);},fQ));!fT.get_IsEmpty()?F.FailWith(((((fu.Curried(function(fV,fW,fX,fY){return fV("Naming conflict: "+_2.toSafe(fW)+" and "+_2.toSafe(fX)+" \\""+_2.toSafe(fY)+"\\" share the same name");},4))(a.id))(fR))(fS[0]))(A.head(A.ofSeq(fT)))):void 0;};}(fO,fN),fP);fM=fP;}}else return null;}(A.ofArray([["parameter",new dh.New$1(cx.OfSeq(A.map(function(fM){return fM.name;},fB.parameters)))],["initial",new dh.New$1(cx.OfSeq(A.map(function(fM){return fM.species.name;},fE)))],["rates",new dh.New$1(cx.OfSeq(A.map(function(fM){return fM[0];},A.ofSeq(K.ToSeq(fB.rates)))))]])));fF=A.filter((fG=fB.rates,function(fM){return fG.ContainsKey(fM);}),A.map(function(fM){return fM.species.name;},fE));return fF.$==0?M.create("",fB.map((fH=(fI=fB.rates,function(fM){return M.species_to_rates(fI,fM);}),function(fM){return R.map(fH,fM);})),A.map((fJ=(fK=(fL=fB.rates,function(fM){return M.species_to_rates(fL,fM);}),function(fM){return R.map(fK,fM);}),function(fM){return cc.map(a.id,a.id,fJ,fM);}),fD[0]),fE,bb.empty(),true):F.FailWith("Name conflict: an initial species and a rate share the name \\""+A.head(fF)+"\\"");};M.parse_with_modules_defaultSettings=function(fB,fC){var fD,fE,fF,fG;function fH(fI){return fC.from_default_directive_list(fI);}fD=(fE=O.parse_directives_defaults(fC,Q.parse(),Q.parse_plot()),function(fI){return dz.op_BarGreaterGreater(fE,fH,fI[0],fI[1]);});fF=(fG=be.get_parse(),function(fI){return M.parse_instructions_modules(fG,fB,fI);});return function(fI){return dz.op_GreaterGreaterEquals(fD,fF,fI[0],fI[1]);};};M.New=function(fB,fC,fD,fE,fF){return new M({name:fB,settings:fC,reactions:fD,initials:fE,attributes:fF});};A.map=function(fB,fC){var fD,fE,fF,fG,fH;if(fC.$==0)return fC;else{fG=new B({$:1});fD=fG;fE=fC;fF=true;while(fF){fD.$0=fB(fE.$0);fE=fE.$1;fE.$==0?fF=false:fD=(fH=new B({$:1}),fD.$1=fH,fH);}fD.$1=B.Empty;return fG;}};A.ofArray=function(fB){var fC,fD,fE;fC=B.Empty;for(fD=U.length(fB)-1,fE=0;fD>=fE;fD--)fC=new B({$:1,$0:U.get(fB,fD),$1:fC});return fC;};A.collect=function(fB,fC){return A.ofSeq(bc.collect(fB,fC));};A.iter=function(fB,fC){var fD;fD=fC;while(fD.$==1){fB(A.head(fD));fD=A.tail(fD);}};A.ofSeq=function(fB){var fC,fD,fE,fF,fG,fH;if(fB instanceof B)return fB;else if(fB instanceof a.Array)return A.ofArray(fB);else{fC=da.Get(fB);try{fE=fC.MoveNext();if(!fE)fD=B.Empty;else{fG=new B({$:1});fF=fG;while(fE){fF.$0=fC.Current();fC.MoveNext()?fF=(fH=new B({$:1}),fF.$1=fH,fH):fE=false;}fF.$1=B.Empty;fD=fG;}return fD;}finally{if(typeof fC=="object"&&"Dispose"in fC)fC.Dispose();}}};A.init=function(fB,fC){return A.ofArray(U.init(fB,fC));};A.mapi=function(fB,fC){var fD,fE,fF,fG,fH,fI;if(fC.$==0)return fC;else{fH=new B({$:1});fD=fH;fE=fC;fF=0;fG=true;while(fG){fD.$0=fB(fF,fE.$0);fE=fE.$1;fE.$==0?fG=false:(fD=(fI=new B({$:1}),fD.$1=fI,fI),fF=fF+1);}fD.$1=B.Empty;return fH;}};A.unzip=function(fB){var fC,fD,fE,fF;fC=[];fD=[];fE=da.Get(fB);try{while(fE.MoveNext()){fF=fE.Current();fC.push(fF[0]);fD.push(fF[1]);}}finally{if(typeof fE=="object"&&"Dispose"in fE)fE.Dispose();}return[A.ofArray(fC.slice(0)),A.ofArray(fD.slice(0))];};A.zip=function(fB,fC){return A.map2(function(fD,fE){return[fD,fE];},fB,fC);};A.maxBy=function(fB,fC){var fD,fE,fF,fG,fH;A.nonEmpty(fC);fD=fC.$0;fE=fB(fD);fF=fC.$1;while(fF.$==1){fG=fF.$0;fH=fB(fG);bk.Compare(fH,fE)===1?(fD=fG,fE=fH):void 0;fF=fF.$1;}return fD;};A.filter=function(fB,fC){return A.ofSeq(bc.filter(fB,fC));};A.rev=function(fB){var fC,fD;fC=B.Empty;fD=fB;while(fD.$==1){fC=new B({$:1,$0:fD.$0,$1:fC});fD=fD.$1;}return fC;};A.max=function(fB){var fC,fD,fE;A.nonEmpty(fB);fC=fB.$0;fD=fB.$1;while(fD.$==1){fE=fD.$0;bk.Compare(fE,fC)===1?fC=fE:void 0;fD=fD.$1;}return fC;};A.sort=function(fB){var fC;fC=U.ofList(fB);U.sortInPlace(fC);return A.ofArray(fC);};A.append=function(fB,fC){var fD,fE,fF,fG,fH;if(fB.$==0)return fC;else if(fC.$==0)return fB;else{fG=new B({$:1});fD=fG;fE=fB;fF=true;while(fF){fD.$0=fE.$0;fE=fE.$1;fE.$==0?fF=false:fD=(fH=new B({$:1}),fD.$1=fH,fH);}fD.$1=fC;return fG;}};A.length=function(fB){var fC,fD;fC=fB;fD=0;while(fC.$==1){fC=A.tail(fC);fD=fD+1;}return fD;};A.iteri=function(fB,fC){var fD,fE;fD=fC;fE=0;while(fD.$==1){fB(fE,A.head(fD));fD=A.tail(fD);fE=fE+1;}};A.exists=function(fB,fC){var fD,fE;fD=false;fE=fC;while(!fD&&fE.$==1){fD=fB(fE.$0);fE=fE.$1;}return fD;};A.map2=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ;fE=fC.$==1&&fD.$==1;if(!fE)return fC.$==1||fD.$==1?A.badLengths():fC;else{fI=new B({$:1});fF=fI;fG=fC;fH=fD;while(fE){fF.$0=fB(fG.$0,fH.$0);fG=fG.$1;fH=fH.$1;fG.$==1&&fH.$==1?fF=(fJ=new B({$:1}),fF.$1=fJ,fJ):fE=false;}if(fG.$==1||fH.$==1)A.badLengths();fF.$1=B.Empty;return fI;}};A.reduce=function(fB,fC){var fD,fE;A.nonEmpty(fC);fD=fC.$0;fE=fC.$1;while(fE.$==1){fD=fB(fD,fE.$0);fE=fE.$1;}return fD;};A.choose=function(fB,fC){return A.ofSeq(bc.choose(fB,fC));};A.distinct=function(fB){return A.ofSeq(bc.distinct(fB));};A.groupBy=function(fB,fC){var fD;function fE(fF,fG){return[fF,A.ofArray(fG)];}fD=U.groupBy(fB,U.ofList(fC));U.mapInPlace(function(fF){return fE(fF[0],fF[1]);},fD);return A.ofArray(fD);};A.contains=function(fB,fC){var fD,fE;fD=false;fE=fC;while(!fD&&fE.$==1){fD=bk.Equals(fB,fE.$0);fE=fE.$1;}return fD;};A.head=function(fB){return fB.$==1?fB.$0:A.listEmpty();};A.nonEmpty=function(fB){if(fB.$==0)A.listEmpty();};A.sortBy=function(fB,fC){var fD;fD=U.ofList(fC);U.sortInPlaceBy(fB,fD);return A.ofArray(fD);};A.min=function(fB){var fC,fD,fE;A.nonEmpty(fB);fC=fB.$0;fD=fB.$1;while(fD.$==1){fE=fD.$0;bk.Compare(fE,fC)===-1?fC=fE:void 0;fD=fD.$1;}return fC;};A.partition=function(fB,fC){var fD;fD=U.partition(fB,U.ofList(fC));return[A.ofArray(fD[0]),A.ofArray(fD[1])];};A.tail=function(fB){return fB.$==1?fB.$1:A.listEmpty();};A.foldBack=function(fB,fC,fD){return U.foldBack(fB,U.ofList(fC),fD);};A.badLengths=function(){return F.FailWith("The lists have different lengths.");};A.concat=function(fB){return A.ofSeq(bc.concat(fB));};A.zip3=function(fB,fC,fD){return A.map3(function(fE,fF,fG){return[fE,fF,fG];},fB,fC,fD);};A.listEmpty=function(){return F.FailWith("The input list was empty.");};A.distinctBy=function(fB,fC){return A.ofSeq(bc.distinctBy(fB,fC));};A.indexed=function(fB){return A.mapi(function(fC,fD){return[fC,fD];},fB);};A.map3=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL;fF=fC.$==1&&fD.$==1&&fE.$==1;if(!fF)return fC.$==1||fD.$==1||fE.$==1?A.badLengths():fC;else{fK=new B({$:1});fG=fK;fH=fC;fI=fD;fJ=fE;while(fF){fG.$0=fB(fH.$0,fI.$0,fJ.$0);fH=fH.$1;fI=fI.$1;fJ=fJ.$1;fH.$==1&&fI.$==1&&fJ.$==1?fG=(fL=new B({$:1}),fG.$1=fL,fL):fF=false;}if(fH.$==1||fI.$==1||fJ.$==1)A.badLengths();fG.$1=B.Empty;return fK;}};A.unzip3=function(fB){var fC,fD,fE,fF,fG;fC=[];fD=[];fE=[];fF=da.Get(fB);try{while(fF.MoveNext()){fG=fF.Current();fC.push(fG[0]);fD.push(fG[1]);fE.push(fG[2]);}}finally{if(typeof fF=="object"&&"Dispose"in fF)fF.Dispose();}return[A.ofArray(fC.slice(0)),A.ofArray(fD.slice(0)),A.ofArray(fE.slice(0))];};A.forAll=function(fB,fC){var fD,fE;fD=true;fE=fC;while(fD&&fE.$==1){fD=fB(fE.$0);fE=fE.$1;}return fD;};A.mapi2=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK;fE=fC.$==1&&fD.$==1;if(!fE)return fC.$==1||fD.$==1?A.badLengths():fC;else{fJ=new B({$:1});fF=fJ;fG=fC;fH=fD;fI=0;while(fE){fF.$0=fB(fI,fG.$0,fH.$0);fG=fG.$1;fH=fH.$1;fG.$==1&&fH.$==1?(fF=(fK=new B({$:1}),fF.$1=fK,fK),fI=fI+1):fE=false;}if(fG.$==1||fH.$==1)A.badLengths();fF.$1=B.Empty;return fJ;}};A.replicate=function(fB,fC){return A.ofArray(U.create(fB,fC));};A.scan=function(fB,fC,fD){return A.ofSeq(bc.scan(fB,fC,fD));};N=d.GuiIG=fu.Class({to_ig:function(){function fB(fF){return[fF.source,fF.target,fF.prior];}function fC(fF){return[fF.location,A.map(fB,fF.parameters)];}function fD(fF){var fG,fH;fG=dk.SplitChars(fF,["."],0);return!bk.Equals(fG,null)&&fG.length===1?new bH({$:0,$0:U.get(fG,0)}):!bk.Equals(fG,null)&&fG.length===2?(fH=U.get(fG,1),new bH({$:1,$0:[U.get(fG,0),fH]})):(function(fI){return function(fJ){return fI("bad location encoding "+_2.toSafe(fJ));};}(F.FailWith))(fF);}function fE(fF,fG){return[fD(fF),A.map(fC,fG)];}return J.New(this.task,K.Map(function(fF,fG){return fG.to_model();},this.nodes),K.OfArray(U.ofSeq(bc.map(function(fF){return fE(fF[0],fF[1]);},K.ToSeq(this.edges)))),this.expanded);}},null,N);N.from_ig=function(fB){function fC(fF,fG){return bK.New(fF,A.map(function(fH){return bJ.New(fH[0],fH[1],fH[2]);},fG));}function fD(fF){return fF.$==1?fF.$0[0]+"."+fF.$0[1]:fF.$0;}function fE(fF,fG){return[fD(fF),A.map(function(fH){return fC(fH[0],fH[1]);},fG)];}return N.New(fB.task,K.Map(function(fF,fG){return bj.from_model(fG);},fB.nodes),K.OfArray(U.ofSeq(bc.map(function(fF){return fE(fF[0],fF[1]);},K.ToSeq(fB.edges)))),fB.expanded);};N.New=function(fB,fC,fD,fE){return new N({task:fB,nodes:fC,edges:fD,expanded:fE});};O=d.Crn_settings=fu.Class({update_simulation:function(fB){return O.New(fB,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet);},map_plots:function(fB,fC){return O.New(this.simulation.map(fC),A.map(function(fD){return fD.map(fC);},this.simulations),this.stochastic,this.deterministic,_6.map(fC,this.spatial),this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,K.Map(function(fD,fE){return(function(){return fB;}(fD))(fE);},this.rates),this.plot.map(fC),this.quiet);},map:function(fB){return O.New(this.simulation.map(fB),A.map(function(fC){return fC.map(fB);},this.simulations),this.stochastic,this.deterministic,_6.map(fB,this.spatial),this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,K.Map(function(fC,fD){return(function(){return fB;}(fC))(fD);},this.rates),this.plot.map(fB),this.quiet);},update_empty_plot_labels:function(){var fB;fB=_1.plot_label(this.simulator,this.spatial.dimensions,this.units);return O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot.update_empty_labels(fB[0],fB[1]),this.quiet);},to_simulation_runs:function(fB){var fC,fD,fE;fC=this;fD=bF.to_env(this.parameters);fE=A.unzip(A.map(function(fF){var fG;function fH(fI,fJ,fK,fL){return C.create$5(fB,fI,fJ,fK,fF,fL);}fG=A.collect(function(fI){return fI.data;},fF.filter_data(fC.data));return[A.map(function(fI){return fH(fI[0],fI[1],fI[2],fI[3]);},ek.eval_label(fD,fF.filter_sweeps(fC.sweeps))),fG];},this.simulations.$===0?A.ofArray([this.simulation]):this.simulations));return[A.concat(fE[0]),A.concat(fE[1])];},to_string:function(fB,fC){var fD;function fE(fG,fH){return(function(fI){return function(fJ){return fI("[\\n  "+_2.toSafe(fJ)+"\\n]");};}(a.id))(dk.concat(";\\n  ",A.map(fG,fH)));}function fF(fG,fH,fI){return fG?"":(((fu.Curried3(function(fJ,fK,fL){return fJ("directive "+_2.toSafe(fK)+" "+_2.toSafe(fL)+"\\n");}))(a.id))(fH))(fI);}fD=O.get_defaults();return fF(bk.Equals(this.simulation,fD.simulation),"simulation",this.simulation.to_string(fC))+fF(bk.Equals(this.simulations,fD.simulations),"simulations",fE(function(fG){return(((fu.Curried3(function(fH,fI,fJ){return fH(_2.toSafe(fI)+" = "+_2.toSafe(fJ));}))(a.id))(fG.name))(fG.to_string(fC));},this.simulations))+fF(bk.Equals(this.simulator,fD.simulator),"simulator",_1.get_to_string(this.simulator))+fF(bk.Equals(this.stochastic,fD.stochastic),"stochastic",_7.to_string(this.stochastic))+fF(bk.Equals(this.deterministic,fD.deterministic),"deterministic",bO.to_string(this.deterministic))+fF(bk.Equals(this.units,fD.units),"units",this.units.get_to_string())+fF(bk.Equals(this.spatial,fD.spatial),"spatial",_6.to_string(fC,this.spatial))+fF(bk.Equals(this.parameters,fD.parameters),"parameters",bF.to_string(this.parameters))+fF(bk.Equals(this.inference,fD.inference),"inference",(b0.get_to_string())(this.inference))+fF(bk.Equals(this.sweeps,fD.sweeps),"sweeps",b9.list_to_string(this.sweeps))+fF(bk.Equals(this.data,fD.data),"data","["+dk.concat("; ",A.map(function(fG){return fG.file;},this.data))+"]")+fF(bk.Equals(this.rates,fD.rates),"rates",fE(function(fG){return(((fu.Curried3(function(fH,fI,fJ){return fH(_2.toSafe(fI)+" = "+_2.toSafe(fJ));}))(a.id))(fG[0]))(fB(fG[1]));},A.ofSeq(K.ToSeq(this.rates))));},update_times:function(fB){return O.New(this.simulation.update_times(fB),this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet);},to_inference_runs:function(fB){var fC,fD,fE;fC=A.unzip3(A.map(function(fF){var fG;fG=A.unzip3(A.map(function(fH){var fI,fJ,fK,fL,fM,fN;fI=fH.filter_data(fF.data);fJ=A.collect(function(fO){return A.map(function(fP){return fH["final"]<A.max(fP.times)?Z.filter_by_tmax(fH["final"],fP):fP;},fO.data);},fI);fK=fH.filter_sweeps(fF.sweeps);fL=fI.get_Length();fM=fK.get_Length();(fL===1?fM===0||(fN=[fL,fM],false):(fN=[fL,fM],false))?void 0:fN[0]!==fN[1]?(function(fO){return function(fP){return fO("Incompatible number of sweeps and data in simulation "+_2.toSafe(fP));};}(F.FailWith))(fH.name):void 0;return[A.map(function(fO){return fH.update_times(fO.times);},fJ),fJ,fK];},fF.simulations.$===0?A.ofArray([fF.simulation]):fF.simulations));return[A.concat(fG[0]),A.concat(fG[1]),A.concat(fG[2])];},fB));fD=fC[2];fE=bF.expand_multiples(bk.Equals(fD,A.ofArray([B.Empty]))?A.ofArray([A.ofArray([b9.create$7()])]):fD,this.parameters);return[fE[1],fC[1],fE[0],fC[0],fE[2]];},from_directive_list:function(fB){return O.checkSweepParameters(bc.fold(function(fC,fD){return fC.from_directive(fD);},this,fB));},all_used_rates:function(fB,fC){var fD;fD=this;return K.OfArray(U.ofSeq(A.map(function(fE){return[fE,fD.rates.get_Item(fE)];},function(fE){var fF,fG,fH;while(true){fG=new dh.New$1(cx.OfSeq((function(fI){return function(fJ){return A.collect(fI,fJ);};}(function(fI){return fB(fD.rates.get_Item(fI));}))(fE)));fH=A.ofSeq((fF=new dh.New$1(cx.OfSeq(fE)),dg.Filter(function(fI){return!fF.Contains(fI);},fG)));if(fH.$==0)return fE;else fE=A.append(fE,fH);}}(A.append(A.collect(function(fE){var fF,fG;return A.append((fF=fE.rate,fF.$==1?fB(fF.$0):B.Empty),(fG=fE.reverse,fG!=null&&fG.$==1?fG.$0.$==1?fB(fG.$0.$0):B.Empty:B.Empty));},fC),A.collect(fB,A.append(this.simulation.plots,A.concat(A.map(function(fE){return fE.plots;},this.simulations)))))))));},substitute:function(fB){return O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,bF.substitute(fB,this.parameters),this.sweeps,this.rates,this.plot,this.quiet);},from_directive:function(fB){return fB.$==1?O.New(this.simulation,fB.$0,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==2?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,fB.$0,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==3?O.New(this.simulation,this.simulations,fB.$0,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==4?O.New(this.simulation,this.simulations,this.stochastic,fB.$0,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==5?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,fB.$0,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==6?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,fB.$0,this.sweeps,this.rates,this.plot,this.quiet):fB.$==7?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,fB.$0,this.plot,this.quiet):fB.$==8?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,fB.$0,this.rates,this.plot,this.quiet):fB.$==9?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,A.map(b3.empty,fB.$0),this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==10?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,fB.$0,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==11?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,fB.$0,this.quiet):fB.$==12?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,fB.$0,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==13?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,fB.$0,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==14?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,fB.$0,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):O.New(fB.$0,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet);},from_default_directive_list:function(fB){return bc.fold(function(fC,fD){return fC.from__default_directive(fD);},this,fB);},from__default_directive:function(fB){var fC,fD,fE;function fF(fI){function fJ(fK){return fK.name!==fI.name;}return function(fK){return A.filter(fJ,fK);};}function fG(fI){function fJ(fK){return fK.name!==fI.name;}return function(fK){return A.filter(fJ,fK);};}function fH(fI){function fJ(fK){return fK.name!==fI.name;}return function(fK){return A.filter(fJ,fK);};}return fB.$==1?(fC=fB.$0,O.New(this.simulation,A.append(bc.fold(function(fI,fJ){return(fF(fJ))(fI);},this.simulations,fC),fC),this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet)):fB.$==2?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,fB.$0,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==3?O.New(this.simulation,this.simulations,fB.$0,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==4?O.New(this.simulation,this.simulations,this.stochastic,fB.$0,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==5?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,fB.$0,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==6?(fD=fB.$0,O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,A.append(bc.fold(function(fI,fJ){return(fG(fJ))(fI);},this.parameters,fD),fD),this.sweeps,this.rates,this.plot,this.quiet)):fB.$==7?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,bc.fold(function(fI,fJ){return fI.Add(fJ[0],fJ[1]);},this.rates,A.ofSeq(K.ToSeq(fB.$0))),this.plot,this.quiet):fB.$==8?(fE=fB.$0,O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,A.append(bc.fold(function(fI,fJ){return(fH(fJ))(fI);},this.sweeps,fE),fE),this.rates,this.plot,this.quiet)):fB.$==9?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,A.map(b3.empty,fB.$0),this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==10?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,fB.$0,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==11?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,fB.$0,this.quiet):fB.$==12?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,fB.$0,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==13?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,fB.$0,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):fB.$==14?O.New(this.simulation,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,fB.$0,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet):O.New(fB.$0,this.simulations,this.stochastic,this.deterministic,this.spatial,this.inference,this.moment_closure,this.synthesis,this.data,this.units,this.simulator,this.parameters,this.sweeps,this.rates,this.plot,this.quiet);}},null,O);O.parse=function(fB,fC){return O.parse_defaults(fB,fC,O.get_defaults());};O.parse_defaults=function(fB,fC,fD){var fE;function fF(fG){return fD.from_directive_list(fG);}fE=e0.parse_list(fB,fC);return function(fG){return dz.op_BarGreaterGreater(fE,fF,fG[0],fG[1]);};};O.get_defaults=function(){return O.New(P.get_defaults(),B.Empty,_7.get_defaults(),bO.get_defaults(),_6.get_defaults(),b0.get_defaults(),bD.defaults(),b2.get_defaults(),B.Empty,b7.get_defaults(),_1.get_defaults(),B.Empty,B.Empty,new y.New([]),b_.get_defaults(),false);};O.checkSweepParameters=function(fB){var fC;fC=A.distinct(A.map(function(fD){return fD.name;},fB.parameters));A.iter(function(fD){if(!A.contains(fD,fC))((function(fE){return function(fF){return fE("Sweep variable "+_2.toSafe(fF)+" not initialised");};}(F.FailWith))(fD));},A.collect(function(fD){return fD.get_mentions();},fB.sweeps));return fB;};O.parse_directives_defaults=function(fB,fC,fD){var fE,fF;return D.sepBy((fE=D.kw("directive"),(fF=O.parse_directive_defaults(fB,fC,fD),function(fG){return dz.op_GreaterGreaterDot(fE,fF,fG[0],fG[1]);})),D.spaces());};O.parse_directive_defaults=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6,f7,f8,f9,f_,f$,ga,gb,gc,gd,ge,gf,gg,gh,gi,gj,gk,gl,gm;function gn(gC){return bc.fold(function(gD,gE){var gF;gF=gE[0];if(gD.ContainsKey(gF))throw new cW.New((function(gG){return function(gH){return gG("Failed trying to parse duplicate rate expression "+_2.toSafe(gH));};}(a.id))(gF));else return gD.Add(gF,gE[1]);},new y.New([]),gC);}function go(gC){return{$:4,$0:gC};}function gp(gC){return{$:3,$0:gC};}function gq(gC){return{$:1,$0:gC};}function gr(gC){return{$:0,$0:gC};}function gs(gC){return{$:2,$0:gC};}function gt(gC){return{$:6,$0:gC};}function gu(gC){return{$:8,$0:gC};}function gv(gC){return{$:9,$0:gC};}function gw(gC){return{$:5,$0:gC};}function gx(gC){return{$:10,$0:gC};}function gy(gC){return{$:7,$0:gC};}function gz(gC){return{$:11,$0:gC};}function gA(gC){return{$:13,$0:gC};}function gB(gC){return{$:12,$0:gC};}fE=(fF=D.list_of((fG=(fH=D.skw("="),function(gC){return dz.op_GreaterGreaterDot(fH,fC,gC[0],gC[1]);}),function(gC){return dz.op_DotGreaterGreaterDot(D.name(),fG,gC[0],gC[1]);})),(fI=function(gC){return D.preturn(gn(gC));},function(gC){return dz.op_GreaterGreaterEquals(fF,fI,gC[0],gC[1]);}));fJ=D.choice([(fK=(fL=D.kw("deterministic"),(fM=bO.parse_defaults(fB.deterministic),function(gC){return dz.op_GreaterGreaterDot(fL,fM,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(fK,go,gC[0],gC[1]);}),(fN=(fO=D.kw("stochastic"),(fP=_7.parse_defaults(fB.stochastic),function(gC){return dz.op_GreaterGreaterDot(fO,fP,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(fN,gp,gC[0],gC[1]);}),(fQ=(fR=D.kw("simulations"),(fS=D.list_of(P.parse_named_defaults(fB.simulation,fD)),function(gC){return dz.op_GreaterGreaterDot(fR,fS,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(fQ,gq,gC[0],gC[1]);}),(fT=(fU=D.kw("simulation"),(fV=P.parse_defaults(fB.simulation,fD),function(gC){return dz.op_GreaterGreaterDot(fU,fV,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(fT,gr,gC[0],gC[1]);}),(fW=(fX=D.kw("simulator"),(fY=_1.get_parse(),function(gC){return dz.op_GreaterGreaterDot(fX,fY,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(fW,gs,gC[0],gC[1]);}),(fZ=(f0=D.kw("parameters"),(f1=D.list_of(bX.get_parse()),function(gC){return dz.op_GreaterGreaterDot(f0,f1,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(fZ,gt,gC[0],gC[1]);}),(f2=(f3=D.kw("sweeps"),(f4=D.list_of(b9.get_parse()),function(gC){return dz.op_GreaterGreaterDot(f3,f4,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(f2,gu,gC[0],gC[1]);}),(f5=(f6=D.kw("data"),(f7=D.list_of(D.name()),function(gC){return dz.op_GreaterGreaterDot(f6,f7,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(f5,gv,gC[0],gC[1]);}),(f8=(f9=D.kw("inference"),(f_=b0.parse_defaults(fB.inference),function(gC){return dz.op_GreaterGreaterDot(f9,f_,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(f8,gw,gC[0],gC[1]);}),(f$=(ga=D.kw("spatial"),(gb=_6.parse_defaults(fB.spatial,fD),function(gC){return dz.op_GreaterGreaterDot(ga,gb,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(f$,gx,gC[0],gC[1]);}),(gc=(gd=D.kw("rates"),function(gC){return dz.op_GreaterGreaterDot(gd,fE,gC[0],gC[1]);}),function(gC){return dz.op_BarGreaterGreater(gc,gy,gC[0],gC[1]);}),(ge=(gf=D.kw("plot_settings"),(gg=b_.parse_defaults(fB.plot,fD),function(gC){return dz.op_GreaterGreaterDot(gf,gg,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(ge,gz,gC[0],gC[1]);}),(gh=(gi=D.kw("moments"),(gj=bD.parse_defaults(fB.moment_closure),function(gC){return dz.op_GreaterGreaterDot(gi,gj,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(gh,gA,gC[0],gC[1]);}),(gk=(gl=D.kw("units"),(gm=b7.get_parse(),function(gC){return dz.op_GreaterGreaterDot(gl,gm,gC[0],gC[1]);})),function(gC){return dz.op_BarGreaterGreater(gk,gB,gC[0],gC[1]);})]);return function(gC){return fJ([gC[0],gC[1]]);};};O.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ){return new O({simulation:fB,simulations:fC,stochastic:fD,deterministic:fE,spatial:fF,inference:fG,moment_closure:fH,synthesis:fI,data:fJ,units:fK,simulator:fL,parameters:fM,sweeps:fN,rates:fO,plot:fP,quiet:fQ});};P=d.Simulation_settings=fu.Class({map:function(fB){return P.New(this.name,this.initial,this["final"],this.points,A.map(fB,this.plots),this.plotcolours,this.seed,this.kinetics,this.times,this.prune,this.multicore,this.data,this.sweeps);},get_print_interval:function(){return this.points>0?(this["final"]-this.initial)/this.points:0;},filter_sweeps:function(fB){return this.sweeps.$===0?fB:A.map(function(fC){try{return bc.find(function(fD){return fD.name===fC;},fB);}catch(fD){return F.FailWith("sweep "+fC+" not found in settings");}},this.sweeps);},filter_data:function(fB){return this.data.$===0?fB:A.map(function(fC){try{return bc.find(function(fD){return fD.file===fC;},fB);}catch(fD){return F.FailWith("dataset "+fC+" not found in settings");}},this.data);},to_string:function(fB){return this.to_string_defaults(P.get_defaults(),fB);},to_string_defaults:function(fB,fC){return"{"+(this.initial===fB.initial?"":(function(fD){return function(fE){return fD("initial="+_2.toSafe(fE)+"; ");};}(a.id))(a.String(this.initial)))+(this["final"]===fB["final"]?"":(function(fD){return function(fE){return fD("final="+_2.toSafe(fE)+"; ");};}(a.id))(a.String(this["final"])))+(this.points===fB.points?"":(function(fD){return function(fE){return fD("points="+_2.toSafe(fE)+"; ");};}(a.id))(a.String(this.points)))+(bk.Equals(this.plots,fB.plots)?"":(function(fD){return function(fE){return fD("plots=["+_2.toSafe(fE)+"]; ");};}(a.id))(dk.concat("; ",A.map(fC,this.plots))))+(A.exists(function(fD){return fD!=="";},this.plotcolours)?(function(fD){return function(fE){return fD("plotcolours=["+_2.toSafe(fE)+"]; ");};}(a.id))(dk.concat("; ",A.map(function(fD){return"\\""+fD+"\\"";},this.plotcolours))):"")+(bk.Equals(this.seed,fB.seed)?"":(function(fD){return function(fE){return fD("seed="+a.String(fE));};}(a.id))(this.seed.$0))+(bk.Equals(this.kinetics,fB.kinetics)?"":(function(fD){return function(fE){return fD("kinetics="+_2.toSafe(fE)+"; ");};}(a.id))(cu.get_to_string(this.kinetics)))+(bk.Equals(this.times,fB.times)?"":(function(fD){return function(fE){return fD("times=["+_2.toSafe(fE)+"]; ");};}(a.id))(dk.concat("; ",A.map(function(fD){var fE;fE=fD;return a.String(fE);},this.times))))+(bk.Equals(this.prune,fB.prune)?"":(function(fD){return function(fE){return fD("prune="+_2.toSafe(fE)+"; ");};}(a.id))(a.String(this.prune)))+(bk.Equals(this.multicore,fB.multicore)?"":(function(fD){return function(fE){return fD("multicore="+_2.toSafe(fE)+"; ");};}(a.id))(a.String(this.multicore)))+(bk.Equals(this.data,fB.data)?"":(function(fD){return function(fE){return fD("data=["+_2.toSafe(fE)+"]; ");};}(a.id))(dk.concat("; ",this.data)))+(bk.Equals(this.sweeps,fB.sweeps)?"":(function(fD){return function(fE){return fD("sweeps=["+_2.toSafe(fE)+"]; ");};}(a.id))(dk.concat("; ",this.sweeps)))+"}";},update_times:function(fB){return P.New(this.name,this.initial,this["final"],this.points,this.plots,this.plotcolours,this.seed,this.kinetics,fB,this.prune,this.multicore,this.data,this.sweeps);}},null,P);P.get_defaults=function(){return P.New("",0,1000,1000,B.Empty,B.Empty,null,"Contextual",B.Empty,true,false,B.Empty,B.Empty);};P.parse_named=function(fB){return P.parse_named_defaults(P.get_defaults(),fB);};P.parse=function(fB){return P.parse_defaults(P.get_defaults(),fB);};P.parse_named_defaults=function(fB,fC){return D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(D.name(),D.op_GreaterGreaterDot(D.skw("="),P.parse_defaults(fB,fC))),function(fD){var fE;fE=fD[1];return P.New(fD[0],fE.initial,fE["final"],fE.points,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);});};P.parse_defaults=function(fB,fC){return D.record(fB,A.ofArray([["initial",D.op_BarGreaterGreater(D.op_DotGreaterGreater(D.pfloat(),D.spaces()),function(fD){return function(fE){return P.New(fE.name,fD,fE["final"],fE.points,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);};})],["final",D.op_BarGreaterGreater(D.op_DotGreaterGreater(D.pfloat(),D.spaces()),function(fD){return function(fE){return P.New(fE.name,fE.initial,fD,fE.points,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);};})],["points",D.op_BarGreaterGreater(D.op_DotGreaterGreater(D.pint32(),D.spaces()),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fD,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);};})],["plots",D.op_BarGreaterGreater(D.list_of(D.op_DotGreaterGreater(fC,D.spaces())),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fD,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);};})],["plotcolours",D.op_BarGreaterGreater(D.list_of(D.op_DotGreaterGreater(D.pcolour(),D.spaces())),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fE.plots,fD,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);};})],["seed",D.op_BarGreaterGreater(D.op_DotGreaterGreater(D.pint32(),D.spaces()),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fE.plots,fE.plotcolours,{$:1,$0:fD},fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);};})],["kinetics",D.op_BarGreaterGreater(D.op_DotGreaterGreater(cu.get_parse(),D.spaces()),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fE.plots,fE.plotcolours,fE.seed,fD,fE.times,fE.prune,fE.multicore,fE.data,fE.sweeps);};})],["prune",D.op_BarGreaterGreater(D.op_DotGreaterGreater(D.pbool(),D.spaces()),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fD,fE.multicore,fE.data,fE.sweeps);};})],["multicore",D.op_BarGreaterGreater(D.op_DotGreaterGreater(D.pbool(),D.spaces()),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fD,fE.data,fE.sweeps);};})],["data",D.op_BarGreaterGreater(D.list_of(D.op_DotGreaterGreater(D.name(),D.spaces())),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fD,fE.sweeps);};})],["sweeps",D.op_BarGreaterGreater(D.list_of(D.op_DotGreaterGreater(D.name(),D.spaces())),function(fD){return function(fE){return P.New(fE.name,fE.initial,fE["final"],fE.points,fE.plots,fE.plotcolours,fE.seed,fE.kinetics,fE.times,fE.prune,fE.multicore,fE.data,fD);};})]]));};P.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN){return new P({name:fB,initial:fC,"final":fD,points:fE,plots:fF,plotcolours:fG,seed:fH,kinetics:fI,times:fJ,prune:fK,multicore:fL,data:fM,sweeps:fN});};Q.from_string_plot=function(fB){return D.from_string(Q.parse_plot(),fB);};Q.to_string_plot=function(fB){var fC;return fB.$==0&&(fB.$0.$==2&&(fC=fB.$0.$0,true))?be.to_string(fC):Q.to_string(fB);};Q.parse_plot=function(){dA.$cctor();return dA.parse_plot;};Q.to_string=function(fB){return R.to_string(function(fC){return co.to_string(be.to_string,fC);},fB);};Q.from_string=function(fB){return D.from_string(Q.parse(),fB);};Q.parse=function(){dA.$cctor();return dA.parse;};Q.all_species=function(fB,fC){return A.collect(function(fD){return fD.$==2?A.ofArray([fD.$0]):fD.$==1?Q.all_species(fB,fB.get_Item(fD.$0)):B.Empty;},R.mentions(fC));};R.map=function(fB,fC){return fC.$==1?{$:1,$0:fC.$0}:fC.$==2?{$:2,$0:A.map(function(fD){return R.map(fB,fD);},fC.$0)}:fC.$==3?{$:3,$0:ct.New(R.map(fB,fC.$0.div1),R.map(fB,fC.$0.div2))}:fC.$==4?{$:4,$0:cs.New(R.map(fB,fC.$0.base_),R.map(fB,fC.$0.exponent))}:fC.$==5?{$:5,$0:A.map(function(fD){return R.map(fB,fD);},fC.$0)}:fC.$==6?{$:6,$0:cr.New(R.map(fB,fC.$0.sub1),R.map(fB,fC.$0.sub2))}:fC.$==7?{$:7,$0:R.map(fB,fC.$0)}:fC.$==8?{$:8,$0:R.map(fB,fC.$0)}:fC.$==9?{$:9,$0:cq.New(R.map(fB,fC.$0.div),R.map(fB,fC.$0.modulo))}:fC.$==10?{$:10,$0:R.map(fB,fC.$0)}:fC.$==11?{$:11,$0:R.map(fB,fC.$0)}:fC.$==12?{$:12,$0:R.map(fB,fC.$0)}:fC.$==13?{$:13,$0:R.mapBool(fB,fC.$0),$1:R.map(fB,fC.$1),$2:R.map(fB,fC.$2)}:{$:0,$0:fB(fC.$0)};};R.to_string=function(fB,fC){var fD,fE;function fF(fG){return R.to_string(fB,fG);}return fC.$==1?a.String(fC.$0):fC.$==3?"("+fF(fC.$0.div1)+" / "+fF(fC.$0.div2)+")":fC.$==4?"("+fF(fC.$0.base_)+" ^ "+fF(fC.$0.exponent)+")":fC.$==2?(fD=fC.$0,fD.get_Length()===1?"prod("+fF(A.head(fD))+")":R.bracket(A.reduce(function(fG,fH){return fG+" * "+fH;},A.map(fF,fD)))):fC.$==5?(fE=fC.$0,fE.get_Length()===1?"sum("+fF(A.head(fE))+")":R.bracket(A.reduce(function(fG,fH){return fG+" + "+fH;},A.map(fF,fE)))):fC.$==6?"("+fF(fC.$0.sub1)+" - "+fF(fC.$0.sub2)+")":fC.$==7?"|"+fF(fC.$0)+"|":fC.$==8?"log("+fF(fC.$0)+")":fC.$==9?fF(fC.$0.div)+" % "+fF(fC.$0.modulo):fC.$==10?"ceiling("+fF(fC.$0)+")":fC.$==11?"floor("+fF(fC.$0)+")":fC.$==12?"round("+fF(fC.$0)+")":fC.$==13?"if "+R.to_string_bool(fB,fC.$0)+" then "+fF(fC.$1)+" else "+fF(fC.$2):fB(fC.$0);};R.mapBool=function(fB,fC){function fD(fF){return R.mapBool(fB,fF);}function fE(fF){return R.map(fB,fF);}return fC.$==1?cp.BFalse:fC.$==2?{$:2,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==3?{$:3,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==4?{$:4,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==5?{$:5,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==6?{$:6,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==7?{$:7,$0:fD(fC.$0)}:fC.$==8?{$:8,$0:fD(fC.$0),$1:fD(fC.$1)}:fC.$==9?{$:9,$0:fD(fC.$0),$1:fD(fC.$1)}:cp.BTrue;};R["eval"]=function(fB,fC){function fD(fE){return R["eval"](fB,fE);}return fC.$==1?fC.$0:fC.$==2?bc.fold(function(fE,fF){return fE*fD(fF);},1,fC.$0):fC.$==3?fD(fC.$0.div1)/fD(fC.$0.div2):fC.$==4?fv.pow(fD(fC.$0.base_),fD(fC.$0.exponent)):fC.$==5?bc.fold(function(fE,fF){return fE+fD(fF);},0,fC.$0):fC.$==6?fD(fC.$0.sub1)-fD(fC.$0.sub2):fC.$==7?fv.abs(fD(fC.$0)):fC.$==8?fv.log(fD(fC.$0)):fC.$==9?R.moduloFloat(fD(fC.$0.div),fD(fC.$0.modulo)):fC.$==10?fv.ceil(fD(fC.$0)):fC.$==11?fv.floor(fD(fC.$0)):fC.$==12?fv.round(fD(fC.$0)):fC.$==13?R.evalBool(fB,fC.$0)?fD(fC.$1):fD(fC.$2):fB(fC.$0);};R.to_lambda=function(fB){return new cN({$:0,$0:R.to_lambda_inner(fB)});};R.bracket=function(fB){return fB===""?"":"("+fB+")";};R.to_string_bool=function(fB,fC){function fD(fF){return R.to_string(fB,fF);}function fE(fF){return R.to_string_bool(fB,fF);}return fC.$==1?"false":fC.$==2?fD(fC.$0)+" < "+fD(fC.$1):fC.$==3?fD(fC.$0)+" <= "+fD(fC.$1):fC.$==4?fD(fC.$0)+" = "+fD(fC.$1):fC.$==5?fD(fC.$0)+" >= "+fD(fC.$1):fC.$==6?fD(fC.$0)+" >= "+fD(fC.$1):fC.$==7?"not "+fE(fC.$0):fC.$==8?fE(fC.$0)+" && "+fE(fC.$1):fC.$==9?fE(fC.$0)+" || "+fE(fC.$1):"true";};R.expand=function(fB,fC){function fD(fE){return R.expand(fB,fE);}return fC.$==1?{$:1,$0:fC.$0}:fC.$==2?{$:2,$0:A.map(fD,fC.$0)}:fC.$==3?{$:3,$0:ct.New(fD(fC.$0.div1),fD(fC.$0.div2))}:fC.$==4?{$:4,$0:cs.New(fD(fC.$0.base_),fD(fC.$0.exponent))}:fC.$==5?{$:5,$0:A.map(fD,fC.$0)}:fC.$==6?{$:6,$0:cr.New(fD(fC.$0.sub1),fD(fC.$0.sub2))}:fC.$==7?{$:7,$0:fD(fC.$0)}:fC.$==8?{$:8,$0:fD(fC.$0)}:fC.$==9?{$:9,$0:cq.New(fD(fC.$0.div),fD(fC.$0.modulo))}:fC.$==10?{$:10,$0:fD(fC.$0)}:fC.$==11?{$:11,$0:fD(fC.$0)}:fC.$==12?{$:12,$0:fD(fC.$0)}:fC.$==13?{$:13,$0:R.expandBool(fB,fC.$0),$1:fD(fC.$1),$2:fD(fC.$2)}:fB(fC.$0);};R.simplify=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4;switch(fB.$==1?1:fB.$==2?(fC=fB.$0,2):fB.$==3?(fC=[fB,fB.$0.div1,fB.$0.div2],3):fB.$==4?(fC=[fB.$0.base_,fB.$0.exponent],4):fB.$==5?fB.$0.$==1?fB.$0.$1.$==0?(fC=fB.$0.$0,5):(fC=fB.$0,6):(fC=fB.$0,6):fB.$==6?(fC=[fB.$0.sub1,fB.$0.sub2],7):fB.$==7?(fC=fB.$0,8):fB.$==8?(fC=fB.$0,9):fB.$==9?(fC=[fB.$0.div,fB.$0.modulo],10):fB.$==10?(fC=fB.$0,11):fB.$==11?(fC=fB.$0,12):fB.$==12?(fC=fB.$0,13):fB.$==13?(fC=[fB.$0,fB.$1,fB.$2],14):0){case 0:return fB;case 1:return fB;case 2:if(fC.$==1&&(fC.$1.$==0&&(fE=fC.$0,true)))fD=R.simplify(fE);else if(A.exists(function(f5){return bk.Equals(f5,{$:1,$0:0});},fC))fD={$:1,$0:0};else{fH=A.filter((fF={$:1,$0:1},function(f5){return!bk.Equals(fF,f5);}),fC);fI=A.collect(function(f5){return f5.$==2?f5.$0:A.ofArray([f5]);},fH);fJ=R.split_floats(A.map(R.simplify,fI));switch(fJ[0].$==0?fJ[1].$==0?0:(fG=[fJ[1],fJ[0]],2):fJ[1].$==0?1:(fG=[fJ[1],fJ[0]],2)){case 0:fD={$:1,$0:1};break;case 1:fD={$:1,$0:bc.fold(function(f5,f6){return f5*f6;},1,fJ[0])};break;case 2:fD=(fK=fG[0],fL={$:1,$0:bc.fold(function(f5,f6){return f5*f6;},1,fG[1])},bk.Equals(fL,{$:1,$0:0})?fL:bk.Equals(fL,{$:1,$0:1})?{$:2,$0:fK}:{$:2,$0:new B({$:1,$0:fL,$1:fK})});break;}}return fD;case 3:fM=R.simplify(fC[1]);fN=R.simplify(fC[2]);return bk.Equals(fM,{$:1,$0:0})?fM:R.div(fM,fN);case 4:fO=R.simplify(fC[0]);fP=R.simplify(fC[1]);return bk.Equals(fO,{$:1,$0:0})?fO:R.power$1(fO,fP);case 5:return R.simplify(fC);case 6:fS=R.split_floats(A.map(R.simplify,fC));switch(fS[0].$==0?fS[1].$==0?0:(fR=[fS[1],fS[0]],2):fS[1].$==0?1:(fR=[fS[1],fS[0]],2)){case 0:fQ={$:1,$0:0};break;case 1:fQ={$:1,$0:bc.sum(fS[0])};break;case 2:fQ=(fT={$:1,$0:bc.sum(fR[1])},fU=R.simpleFactoring(A.collect(function(f5){return f5.$==5?f5.$0:A.ofArray([f5]);},fR[0])),bk.Equals(fT,{$:1,$0:0})?fU.get_Length()===1?A.head(fU):{$:5,$0:fU}:{$:5,$0:new B({$:1,$0:fT,$1:fU})});break;}return fQ;case 7:fV=R.simplify(fC[0]);fW=R.simplify(fC[1]);return bk.Equals(fV,fW)?{$:1,$0:0}:R.sub(fV,fW);case 8:fZ=R.simplify(fC);switch(fZ.$==1?fZ.$0===0?0:(fY=fZ,2):fZ.$==6?fZ.$0.sub1.$==1?fZ.$0.sub1.$0===0?(fY=fZ.$0.sub2,1):(fY=fZ,2):(fY=fZ,2):(fY=fZ,2)){case 0:fX={$:1,$0:0};break;case 1:fX={$:7,$0:fY};break;case 2:fX={$:7,$0:fY};break;}return fX;case 9:return{$:8,$0:R.simplify(fC)};case 10:f0=R.simplify(fC[0]);f1=R.simplify(fC[1]);return bk.Equals(f1,{$:1,$0:1})||bk.Equals(f0,{$:1,$0:0})?{$:1,$0:0}:{$:9,$0:cq.New(f0,f1)};case 11:return{$:10,$0:R.simplify(fC)};case 12:return{$:11,$0:R.simplify(fC)};case 13:return{$:12,$0:R.simplify(fC)};case 14:f2=fC[1];f3=fC[2];f4=R.simplifyBool(fC[0]);return f4.$==0?R.simplify(f2):f4.$==1?R.simplify(f3):{$:13,$0:f4,$1:R.simplify(f2),$2:R.simplify(f3)};}};R.from_string=function(fB,fC){return D.from_string(R.parse(fB),fC);};R.is_not_empty=function(fB){return!bk.Equals(R.simplify(fB),{$:1,$0:0});};R.mentions=function(fB){function fC(fE,fF){var fG;switch(fF.$==1?1:fF.$==2?2:fF.$==3?3:fF.$==4?4:fF.$==5?5:fF.$==6?6:fF.$==7?(fG=fF.$0,7):fF.$==8?(fG=fF.$0,7):fF.$==9?8:fF.$==10?(fG=fF.$0,9):fF.$==11?(fG=fF.$0,9):fF.$==12?(fG=fF.$0,9):fF.$==13?10:0){case 0:return new B({$:1,$0:fF.$0,$1:fE});case 1:return fE;case 2:return bc.fold(fC,fE,fF.$0);case 3:return fC(fC(fE,fF.$0.div1),fF.$0.div2);case 4:return fC(fC(fE,fF.$0.base_),fF.$0.exponent);case 5:return bc.fold(fC,fE,fF.$0);case 6:return fC(fC(fE,fF.$0.sub1),fF.$0.sub2);case 7:return fC(fE,fG);case 8:return fC(fC(fE,fF.$0.div),fF.$0.modulo);case 9:return fC(fE,fG);case 10:return fC(fC(fD(fE,fF.$0),fF.$1),fF.$2);}}function fD(fE,fF){return fF.$==1?fE:fF.$==2?fC(fC(fE,fF.$0),fF.$1):fF.$==3?fC(fC(fE,fF.$0),fF.$1):fF.$==4?fC(fC(fE,fF.$0),fF.$1):fF.$==5?fC(fC(fE,fF.$0),fF.$1):fF.$==6?fC(fC(fE,fF.$0),fF.$1):fF.$==7?fD(fE,fF.$0):fF.$==8?fD(fD(fE,fF.$0),fF.$1):fF.$==9?fD(fD(fE,fF.$0),fF.$1):fE;}return A.rev(fC(B.Empty,fB));};R.moduloFloat=function(fB,fC){return(fB%fC+fC)%fC;};R.evalBool=function(fB,fC){function fD(fF){return R["eval"](fB,fF);}function fE(fF){return R.evalBool(fB,fF);}return fC.$==1?false:fC.$==2?fD(fC.$0)<fD(fC.$1):fC.$==3?fD(fC.$0)<=fD(fC.$1):fC.$==4?fD(fC.$0)===fD(fC.$1):fC.$==5?fD(fC.$0)>=fD(fC.$1):fC.$==6?fD(fC.$0)>fD(fC.$1):fC.$==7?!fE(fC.$0):fC.$==8?fE(fC.$0)&&fE(fC.$1):fC.$==9?fE(fC.$0)||fE(fC.$1):true;};R.mul=function(fB,fC){var fD;switch(fB.$==1?fB.$0===0?(fD=fC,0):fB.$0===1?fC.$==1?fC.$0===0?(fD=fB,0):fC.$0===1?(fD=fC,1):(fD=fC,1):fC.$==2?(fD=fC,1):(fD=fC,1):fC.$==1?fC.$0===0?(fD=fB,0):fC.$0===1?(fD=fB,1):(fD=[fB.$0,fC.$0],2):fC.$==2?fC.$0.$==1?fC.$0.$0.$==1?(fD=[fB.$0,fC.$0.$0.$0,fC.$0.$1],3):(fD=[fB,fC.$0],4):(fD=[fB,fC.$0],4):5:fB.$==2?fC.$==1?fC.$0===0?(fD=fB,0):fC.$0===1?(fD=fB,1):fB.$0.$==1?fB.$0.$0.$==1?(fD=[fB.$0.$0.$0,fC.$0,fB.$0.$1],3):(fD=[fC,fB.$0],4):(fD=[fC,fB.$0],4):fC.$==2?(fD=[fC,fB.$0],4):(fD=[fC,fB.$0],4):fC.$==1?fC.$0===0?(fD=fB,0):fC.$0===1?(fD=fB,1):5:fC.$==2?(fD=[fB,fC.$0],4):5){case 0:return{$:1,$0:0};case 1:return fD;case 2:return{$:1,$0:fD[0]*fD[1]};case 3:return{$:2,$0:new B({$:1,$0:{$:1,$0:fD[0]*fD[1]},$1:fD[2]})};case 4:return{$:2,$0:new B({$:1,$0:fD[0],$1:fD[1]})};case 5:return{$:2,$0:A.ofArray([fB,fC])};}};R.to_lambda_inner=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY;switch(fB.$==1?(fC=fB.$0,1):fB.$==2?fB.$0.$==1?fB.$0.$1.$==1?fB.$0.$1.$1.$==0?(fC=[fB.$0.$0,fB.$0.$1.$0],2):(fC=fB.$0,3):(fC=fB.$0,3):(fC=fB.$0,3):fB.$==3?(fC=[fB.$0.div1,fB.$0.div2],4):fB.$==4?(fC=[fB.$0.base_,fB.$0.exponent],5):fB.$==5?fB.$0.$==1?fB.$0.$1.$==1?fB.$0.$1.$1.$==0?(fC=[fB.$0.$0,fB.$0.$1.$0],6):(fC=fB.$0,7):(fC=fB.$0,7):(fC=fB.$0,7):fB.$==6?(fC=[fB.$0.sub1,fB.$0.sub2],8):fB.$==7?(fC=fB.$0,9):fB.$==8?(fC=fB.$0,10):fB.$==9?(fC=[fB.$0.div,fB.$0.modulo],11):fB.$==10?(fC=fB.$0,12):fB.$==11?(fC=fB.$0,13):fB.$==12?(fC=fB.$0,14):fB.$==13?(fC=[fB.$0,fB.$1,fB.$2],15):(fC=fB.$0,0)){case 0:return function(fZ){return fZ(fC);};case 1:return function(){return fC;};case 2:fD=R.to_lambda_inner(fC[0]);fE=R.to_lambda_inner(fC[1]);return function(fZ){return fD(fZ)*fE(fZ);};case 3:fF=A.map(R.to_lambda_inner,fC);return function(fZ){var f0,f1;f0=1;f1=da.Get(fF);try{while(f1.MoveNext())f0=f0*(f1.Current())(fZ);}finally{if(typeof f1=="object"&&"Dispose"in f1)f1.Dispose();}return f0;};case 4:fG=R.to_lambda_inner(fC[0]);fH=R.to_lambda_inner(fC[1]);return function(fZ){return fG(fZ)/fH(fZ);};case 5:fI=R.to_lambda_inner(fC[0]);fJ=R.to_lambda_inner(fC[1]);return function(fZ){return fv.pow(fI(fZ),fJ(fZ));};case 6:fK=R.to_lambda_inner(fC[0]);fL=R.to_lambda_inner(fC[1]);return function(fZ){return fK(fZ)+fL(fZ);};case 7:fM=A.map(R.to_lambda_inner,fC);return function(fZ){var f0,f1;f0=0;f1=da.Get(fM);try{while(f1.MoveNext())f0=f0+(f1.Current())(fZ);}finally{if(typeof f1=="object"&&"Dispose"in f1)f1.Dispose();}return f0;};case 8:fN=R.to_lambda_inner(fC[0]);fO=R.to_lambda_inner(fC[1]);return function(fZ){return fN(fZ)-fO(fZ);};case 9:fP=R.to_lambda_inner(fC);return function(fZ){return fv.abs(fP(fZ));};case 10:fQ=R.to_lambda_inner(fC);return function(fZ){return fv.log(fQ(fZ));};case 11:fR=R.to_lambda_inner(fC[0]);fS=R.to_lambda_inner(fC[1]);return function(fZ){return R.moduloFloat(fR(fZ),fS(fZ));};case 12:fT=R.to_lambda_inner(fC);return function(fZ){return fv.ceil(fT(fZ));};case 13:fU=R.to_lambda_inner(fC);return function(fZ){return fv.floor(fU(fZ));};case 14:fV=R.to_lambda_inner(fC);return function(fZ){return fv.round(fV(fZ));};case 15:fW=R.to_lambda_bool(fC[0]);fX=R.to_lambda_inner(fC[1]);fY=R.to_lambda_inner(fC[2]);return function(fZ){return fW(fZ)?fX(fZ):fY(fZ);};}};R.expandBool=function(fB,fC){function fD(fF){return R.expandBool(fB,fF);}function fE(fF){return R.expand(fB,fF);}return fC.$==1?cp.BFalse:fC.$==2?{$:2,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==3?{$:3,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==4?{$:4,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==5?{$:5,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==6?{$:6,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==7?{$:7,$0:fD(fC.$0)}:fC.$==8?{$:8,$0:fD(fC.$0),$1:fD(fC.$1)}:fC.$==9?{$:9,$0:fD(fC.$0),$1:fD(fC.$1)}:cp.BTrue;};R.split_floats=function(fB){var fC,fD,fE,fF,fG,fH,fI;fC=B.Empty;fD=B.Empty;fE=fB;while(true)if(fE.$==1){if(fE.$0.$==1){fF=fE.$1;fG=fE.$0.$0;fC=new B({$:1,$0:fG,$1:fC});fE=fF;}else{fH=fE.$0;fI=fE.$1;fD=new B({$:1,$0:fH,$1:fD});fE=fI;}}else return[A.rev(fC),A.rev(fD)];};R.div=function(fB,fC){var fD;switch(fC.$==1?fC.$0===0?(fD=fB,0):fC.$0===1?fB.$==1?fB.$0===0?(fD=fC,1):(fD=fB,2):(fD=fB,2):fB.$==1?fB.$0===0?(fD=fC,1):(fD=[fB.$0,fC.$0],3):4:fB.$==1?fB.$0===0?(fD=fC,1):4:4){case 0:return F.FailWith("Division by 0");case 1:return{$:1,$0:0};case 2:return fD;case 3:return{$:1,$0:fD[0]/fD[1]};case 4:return{$:3,$0:ct.New(fB,fC)};}};R.power$1=function(fB,fC){var fD;switch(fC.$==1?fC.$0===0?(fD=fB,0):fC.$0===1?fB.$==1?fB.$0===1?1:(fD=fB,2):(fD=fB,2):fB.$==1?fB.$0===1?1:(fD=[fB.$0,fC.$0],3):4:fB.$==1?fB.$0===1?1:4:4){case 0:return{$:1,$0:1};case 1:return{$:1,$0:1};case 2:return fD;case 3:return{$:1,$0:fv.pow(fD[0],fD[1])};case 4:return{$:4,$0:cs.New(fB,fC)};}};R.simpleFactoring=function(fB){var fC,fD,fE,fF;return fB.$==1?(fC=fB.$1,(fD=fB.$0,R.isFactor(fD)?(fE=(R.splitFactor(fD))[1],(fF=A.partition(function(fG){return R.isFactor(fG)&&bk.Equals((R.splitFactor(fG))[1],fE);},fC),new B({$:1,$0:bc.fold(R.addFactors,fD,fF[0]),$1:R.simpleFactoring(fF[1])}))):new B({$:1,$0:fD,$1:R.simpleFactoring(fC)}))):B.Empty;};R.sub=function(fB,fC){var fD;switch(fC.$==1?fC.$0===0?(fD=fB,0):fB.$==1?(fD=[fB.$0,fC.$0],1):2:2){case 0:return fD;case 1:return{$:1,$0:fD[0]-fD[1]};case 2:return{$:6,$0:cr.New(fB,fC)};}};R.simplifyBool=function(fB){var fC;function fD(fG){return fG?cp.BTrue:cp.BFalse;}function fE(fG,fH,fI,fJ){var fK,fL,fM;fK=R.simplify(fG);fL=R.simplify(fH);return(fK.$==1?fL.$==1?(fM=[fK.$0,fL.$0],true):(fM=[fK,fL],false):(fM=[fK,fL],false))?fD((fI(fM[0]))(fM[1])):fJ([fM[0],fM[1]]);}function fF(fG,fH,fI,fJ){var fK,fL,fM;fL=R.simplifyBool(fG);fM=R.simplifyBool(fH);switch(fL.$==0?fM.$==0?0:fM.$==1?1:(fK=[fL,fM],4):fL.$==1?fM.$==0?2:fM.$==1?3:(fK=[fL,fM],4):(fK=[fL,fM],4)){case 0:return fD((fI(true))(true));case 1:return fD((fI(true))(false));case 2:return fD((fI(false))(true));case 3:return fD((fI(false))(false));case 4:return fJ([fK[0],fK[1]]);}}return fB.$==1?cp.BFalse:fB.$==2?fE(fB.$0,fB.$1,function(fG){return function(fH){return fG<fH;};},function(fG){return{$:2,$0:fG[0],$1:fG[1]};}):fB.$==3?fE(fB.$0,fB.$1,function(fG){return function(fH){return fG<=fH;};},function(fG){return{$:3,$0:fG[0],$1:fG[1]};}):fB.$==4?fE(fB.$0,fB.$1,function(fG){return function(fH){return fG===fH;};},function(fG){return{$:4,$0:fG[0],$1:fG[1]};}):fB.$==5?fE(fB.$0,fB.$1,function(fG){return function(fH){return fG>=fH;};},function(fG){return{$:5,$0:fG[0],$1:fG[1]};}):fB.$==6?fE(fB.$0,fB.$1,function(fG){return function(fH){return fG>fH;};},function(fG){return{$:6,$0:fG[0],$1:fG[1]};}):fB.$==7?(fC=R.simplifyBool(fB.$0),fC.$==0?cp.BFalse:fC.$==1?cp.BTrue:{$:7,$0:fC}):fB.$==8?fF(fB.$0,fB.$1,function(fG){return function(fH){return fG&&fH;};},function(fG){return{$:8,$0:fG[0],$1:fG[1]};}):fB.$==9?fF(fB.$0,fB.$1,function(fG){return function(fH){return fG||fH;};},function(fG){return{$:9,$0:fG[0],$1:fG[1]};}):cp.BTrue;};R.parse=function(fB){function fC(fD){return{$:0,$0:fD};}return R.exp(function(fD){return R.op_BarGreaterGreater(fB,fC,fD[0],fD[1]);});};R.to_mathML=function(fB,fC){return fC.$==1?{$:3,$0:{$:1,$0:fC.$0},$1:null}:fC.$==2?{$:2,$0:dW.Times,$1:A.map(function(fD){return R.to_mathML(fB,fD);},fC.$0)}:fC.$==3?{$:1,$0:dX.Divide,$1:R.to_mathML(fB,fC.$0.div1),$2:R.to_mathML(fB,fC.$0.div2)}:fC.$==4?{$:1,$0:dX.Power,$1:R.to_mathML(fB,fC.$0.base_),$2:R.to_mathML(fB,fC.$0.exponent)}:fC.$==5?{$:2,$0:dW.Plus,$1:A.map(function(fD){return R.to_mathML(fB,fD);},fC.$0)}:fC.$==6?{$:1,$0:dX.Subtract,$1:R.to_mathML(fB,fC.$0.sub1),$2:R.to_mathML(fB,fC.$0.sub2)}:fC.$==7?{$:0,$0:eE.Abs,$1:R.to_mathML(fB,fC.$0)}:fC.$==8?{$:0,$0:{$:31,$0:null},$1:R.to_mathML(fB,fC.$0)}:fC.$==9?{$:1,$0:dX.Mod,$1:R.to_mathML(fB,fC.$0.div),$2:R.to_mathML(fB,fC.$0.modulo)}:fC.$==10?{$:0,$0:eE.Ceiling,$1:R.to_mathML(fB,fC.$0)}:fC.$==11?{$:0,$0:eE.Floor,$1:R.to_mathML(fB,fC.$0)}:fC.$==12?F.FailWith("Conversion of rounding expression to MathML not supported."):fC.$==13?F.FailWith("Conversion of conditional expressions to MathML not supported."):{$:4,$0:fB(fC.$0)};};R.substitute=function(fB,fC){var fD,fE;function fF(fG){return R.substitute(fB,fG);}return fC.$==1?{$:1,$0:fC.$0}:fC.$==2?{$:2,$0:A.map(fF,fC.$0)}:fC.$==3?{$:3,$0:ct.New(fF(fC.$0.div1),fF(fC.$0.div2))}:fC.$==4?{$:4,$0:cs.New(fF(fC.$0.base_),fF(fC.$0.exponent))}:fC.$==5?{$:5,$0:A.map(fF,fC.$0)}:fC.$==6?{$:6,$0:cr.New(fF(fC.$0.sub1),fF(fC.$0.sub2))}:fC.$==7?{$:7,$0:fF(fC.$0)}:fC.$==8?{$:8,$0:fF(fC.$0)}:fC.$==9?{$:9,$0:cq.New(fF(fC.$0.div),fF(fC.$0.modulo))}:fC.$==10?{$:10,$0:fF(fC.$0)}:fC.$==11?{$:11,$0:fF(fC.$0)}:fC.$==12?{$:12,$0:fF(fC.$0)}:fC.$==13?{$:13,$0:R.substituteBool(fB,fC.$0),$1:fF(fC.$1),$2:fF(fC.$2)}:(fD=fC.$0,(fE=K.TryFind(fD,fB),fE!=null&&fE.$==1?fE.$0:{$:0,$0:fD}));};R.to_lambda_bool=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ;return fB.$==1?function(){return false;}:fB.$==2?(fC=R.to_lambda_inner(fB.$0),(fD=R.to_lambda_inner(fB.$1),function(fR){return fC(fR)<fD(fR);})):fB.$==3?(fE=R.to_lambda_inner(fB.$0),(fF=R.to_lambda_inner(fB.$1),function(fR){return fE(fR)<=fF(fR);})):fB.$==4?(fG=R.to_lambda_inner(fB.$0),(fH=R.to_lambda_inner(fB.$1),function(fR){return fG(fR)===fH(fR);})):fB.$==5?(fI=R.to_lambda_inner(fB.$0),(fJ=R.to_lambda_inner(fB.$1),function(fR){return fI(fR)>=fJ(fR);})):fB.$==6?(fK=R.to_lambda_inner(fB.$0),(fL=R.to_lambda_inner(fB.$1),function(fR){return fK(fR)>fL(fR);})):fB.$==7?(fM=R.to_lambda_bool(fB.$0),function(fR){return!fM(fR);}):fB.$==8?(fN=R.to_lambda_bool(fB.$0),(fO=R.to_lambda_bool(fB.$1),function(fR){return fN(fR)&&fO(fR);})):fB.$==9?(fP=R.to_lambda_bool(fB.$0),(fQ=R.to_lambda_bool(fB.$1),function(fR){return fP(fR)||fQ(fR);})):function(){return true;};};R.isFactor=function(fB){return fB.$==0||fB.$==2&&(fB.$0.$==1&&(fB.$0.$0.$==1?fB.$0.$1.$==1&&(fB.$0.$1.$0.$==0&&fB.$0.$1.$1.$==0):fB.$0.$0.$==0&&(fB.$0.$1.$==1&&(fB.$0.$1.$0.$==1&&fB.$0.$1.$1.$==0))));};R.splitFactor=function(fB){var fC;switch(fB.$==0?(fC=fB.$0,0):fB.$==2?fB.$0.$==1?fB.$0.$0.$==1?fB.$0.$1.$==1?fB.$0.$1.$0.$==0?fB.$0.$1.$1.$==0?(fC=[fB.$0.$1.$0.$0,fB.$0.$0.$0],1):2:2:2:fB.$0.$0.$==0?fB.$0.$1.$==1?fB.$0.$1.$0.$==1?fB.$0.$1.$1.$==0?(fC=[fB.$0.$0.$0,fB.$0.$1.$0.$0],1):2:2:2:2:2:2){case 0:return[1,fC];case 1:return[fC[1],fC[0]];case 2:return F.FailWith("unexpected factor");}};R.addFactors=function(fB,fC){var fD;fD=R.splitFactor(fB);return{$:2,$0:A.ofArray([{$:1,$0:fD[0]+(R.splitFactor(fC))[0]},{$:0,$0:fD[1]}])};};R.exp=function(fB){var fC,fD,fE,fF,fG,fH,fI;function fJ(fL,fM){return{$:6,$0:cr.New(fL,fM)};}function fK(fL,fM){return{$:5,$0:A.ofArray([fL,fM])};}fC=(fD=D.choice([(fE=D.skw("-"),function(fL){return R.op_GreaterGreaterPercent(fE,function(fM){return function(fN){return fJ(fM,fN);};},fL[0],fL[1]);}),(fF=D.skw("+"),function(fL){return R.op_GreaterGreaterPercent(fF,function(fM){return function(fN){return fK(fM,fN);};},fL[0],fL[1]);})]),function(fL){return fD([fL[0],fL[1]]);});return D.chainl1Try((fG=D.choice([D.pTry(R.op_GreaterGreaterEquals((fH=D.kw("-"),(fI=R.term(fB),function(fL){return R.op_GreaterGreaterDot(fH,fI,fL[0],fL[1]);})),function(fL){return D.preturn({$:6,$0:cr.New({$:1,$0:0},fL)});})),D.pTry(R.term(fB))]),function(fL){return fG([fL[0],fL[1]]);}),fC);};R.op_BarGreaterGreater=function(fB,fC,fD,fE){return(D.op_BarGreaterGreater(fB,fC))([fD,fE]);};R.substituteBool=function(fB,fC){function fD(fF){return R.substituteBool(fB,fF);}function fE(fF){return R.substitute(fB,fF);}return fC.$==1?cp.BFalse:fC.$==2?{$:2,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==3?{$:3,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==4?{$:4,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==5?{$:5,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==6?{$:6,$0:fE(fC.$0),$1:fE(fC.$1)}:fC.$==7?{$:7,$0:fD(fC.$0)}:fC.$==8?{$:8,$0:fD(fC.$0),$1:fD(fC.$1)}:fC.$==9?{$:9,$0:fD(fC.$0),$1:fD(fC.$1)}:cp.BTrue;};R.op_GreaterGreaterEquals=function(fB,fC){return D.op_GreaterGreaterEquals(fB,fC);};R.op_GreaterGreaterDot=function(fB,fC,fD,fE){return(D.op_GreaterGreaterDot(fB,fC))([fD,fE]);};R.term=function(fB){var fC,fD,fE,fF;function fG(fI,fJ){return{$:2,$0:A.ofArray([fI,fJ])};}function fH(fI,fJ){return{$:9,$0:cq.New(fI,fJ)};}fC=(fD=D.choice([(fE=D.skw("*"),function(fI){return R.op_GreaterGreaterPercent(fE,function(fJ){return function(fK){return fG(fJ,fK);};},fI[0],fI[1]);}),(fF=D.skw("%"),function(fI){return R.op_GreaterGreaterPercent(fF,function(fJ){return function(fK){return fH(fJ,fK);};},fI[0],fI[1]);})]),function(fI){return fD([fI[0],fI[1]]);});return D.chainl1Try(R.factor(fB),fC);};R.op_GreaterGreaterPercent=function(fB,fC,fD,fE){return(D.op_GreaterGreaterPercent(fB,fC))([fD,fE]);};R.one=function(){fm.$cctor();return fm.one;};R.zero=function(){fm.$cctor();return fm.zero;};R.factor=function(fB){var fC,fD,fE,fF;function fG(fJ,fK){return{$:3,$0:ct.New(fJ,fK)};}function fH(fJ,fK){return{$:4,$0:cs.New(fJ,fK)};}function fI(fJ,fK){return{$:4,$0:cs.New(fJ,fK)};}return D.chainl1Try(R.irr(fB),(fC=D.choice([(fD=D.skw("/"),function(fJ){return R.op_GreaterGreaterPercent(fD,function(fK){return function(fL){return fG(fK,fL);};},fJ[0],fJ[1]);}),(fE=D.skw("^"),function(fJ){return R.op_GreaterGreaterPercent(fE,function(fK){return function(fL){return fH(fK,fL);};},fJ[0],fJ[1]);}),(fF=D.skw("**"),function(fJ){return R.op_GreaterGreaterPercent(fF,function(fK){return function(fL){return fI(fK,fL);};},fJ[0],fJ[1]);})]),function(fJ){return fC([fJ[0],fJ[1]]);}));};R.irr=function(fB){return D.pTry(function(fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY;function fZ(ge,gf){return R.op_DotGreaterGreater(D.pfloat(),D.spaces(),ge,gf);}function f0(ge){return{$:1,$0:ge};}function f1(ge,gf){return R.op_DotGreaterGreater(D.pint32(),D.spaces(),ge,gf);}function f2(ge){return{$:1,$0:ge};}function f3(ge,gf){return R.es(fB,ge,gf);}function f4(ge){return{$:5,$0:ge};}function f5(ge,gf){return R.es(fB,ge,gf);}function f6(ge){return{$:2,$0:ge};}function f7(ge,gf){return R.e(fB,ge,gf);}function f8(ge){return{$:8,$0:ge};}function f9(ge,gf){return R.e(fB,ge,gf);}function f_(ge){return{$:10,$0:ge};}function f$(ge,gf){return R.e(fB,ge,gf);}function ga(ge){return{$:11,$0:ge};}function gb(ge,gf){return R.e(fB,ge,gf);}function gc(ge){return{$:12,$0:ge};}function gd(ge,gf){return R.bexp$1(fB,ge,gf);}return(D.choice([function(ge){return R.op_BarGreaterGreater(function(gf){return fZ(gf[0],gf[1]);},f0,ge[0],ge[1]);},(fD=function(ge){return f2(a.id(ge));},function(ge){return R.op_BarGreaterGreater(function(gf){return f1(gf[0],gf[1]);},fD,ge[0],ge[1]);}),(fE=(fF=D.kw("sum"),function(ge){return R.op_GreaterGreaterDot(fF,function(gf){return f3(gf[0],gf[1]);},ge[0],ge[1]);}),function(ge){return R.op_BarGreaterGreater(fE,f4,ge[0],ge[1]);}),(fG=(fH=D.kw("prod"),function(ge){return R.op_GreaterGreaterDot(fH,function(gf){return f5(gf[0],gf[1]);},ge[0],ge[1]);}),function(ge){return R.op_BarGreaterGreater(fG,f6,ge[0],ge[1]);}),(fI=(fJ=D.kw("log"),function(ge){return R.op_GreaterGreaterDot(fJ,function(gf){return f7(gf[0],gf[1]);},ge[0],ge[1]);}),function(ge){return R.op_BarGreaterGreater(fI,f8,ge[0],ge[1]);}),(fK=(fL=D.kw("ceiling"),function(ge){return R.op_GreaterGreaterDot(fL,function(gf){return f9(gf[0],gf[1]);},ge[0],ge[1]);}),function(ge){return R.op_BarGreaterGreater(fK,f_,ge[0],ge[1]);}),(fM=(fN=D.kw("floor"),function(ge){return R.op_GreaterGreaterDot(fN,function(gf){return f$(gf[0],gf[1]);},ge[0],ge[1]);}),function(ge){return R.op_BarGreaterGreater(fM,ga,ge[0],ge[1]);}),(fO=(fP=D.kw("round"),function(ge){return R.op_GreaterGreaterDot(fP,function(gf){return gb(gf[0],gf[1]);},ge[0],ge[1]);}),function(ge){return R.op_BarGreaterGreater(fO,gc,ge[0],ge[1]);}),R.op_GreaterGreaterEquals((fQ=(fR=(fS=(fT=(fU=D.kw("if"),function(ge){return R.op_GreaterGreaterDot(fU,function(gf){return gd(gf[0],gf[1]);},ge[0],ge[1]);}),(fV=D.kw("then"),function(ge){return R.op_DotGreaterGreater(fT,fV,ge[0],ge[1]);})),(fW=R.exp(fB),function(ge){return R.op_DotGreaterGreaterDot(fS,fW,ge[0],ge[1]);})),(fX=D.kw("else"),function(ge){return R.op_DotGreaterGreater(fR,fX,ge[0],ge[1]);})),(fY=R.exp(fB),function(ge){return R.op_DotGreaterGreaterDot(fQ,fY,ge[0],ge[1]);})),function(ge){var gf;gf=ge[0];return D.preturn({$:13,$0:gf[0],$1:gf[1],$2:ge[1]});}),fB,function(ge){return R.e(fB,ge[0],ge[1]);}]))([fC[0],fC[1]]);});};R.op_DotGreaterGreater=function(fB,fC,fD,fE){return(D.op_DotGreaterGreater(fB,fC))([fD,fE]);};R.es=function(fB,fC,fD){return(D.paren(D.sepBy(R.exp(fB),D.kw(";"))))([fC,fD]);};R.e=function(fB,fC,fD){return(D.paren(R.exp(fB)))([fC,fD]);};R.op_DotGreaterGreaterDot=function(fB,fC,fD,fE){return(D.op_DotGreaterGreaterDot(fB,fC))([fD,fE]);};R.bexp$1=function(fB,fC,fD){var fE;function fF(fH,fI){return R.bexp$1(fB,fH,fI);}function fG(fH){return{$:7,$0:fH};}return(D.choice([R.op_GreaterGreaterEquals((fE=D.kw("not"),function(fH){return R.op_GreaterGreaterDot(fE,function(fI){return fF(fI[0],fI[1]);},fH[0],fH[1]);}),function(fH){return D.preturn(fG(fH));}),R.op_GreaterGreaterEquals(function(fH){return R.bterm(fB,fH[0],fH[1]);},function(fH){var fI,fJ,fK;function fL(fN,fO){return R.bexp$1(fB,fN,fO);}function fM(fN,fO){return R.bexp$1(fB,fN,fO);}fI=D.choice([R.op_GreaterGreaterEquals((fJ=D.kw("&&"),function(fN){return R.op_GreaterGreaterDot(fJ,function(fO){return fL(fO[0],fO[1]);},fN[0],fN[1]);}),function(fN){return D.preturn({$:8,$0:fH,$1:fN});}),R.op_GreaterGreaterEquals((fK=D.kw("||"),function(fN){return R.op_GreaterGreaterDot(fK,function(fO){return fM(fO[0],fO[1]);},fN[0],fN[1]);}),function(fN){return D.preturn({$:9,$0:fH,$1:fN});}),D.preturn(fH)]);return function(fN){return fI([fN[0],fN[1]]);};}),D.paren(function(fH){return R.bexp$1(fB,fH[0],fH[1]);})]))([fC,fD]);};R.bterm=function(fB,fC,fD){var fE,fF,fG,fH;return(D.choice([(fE=D.kw("true"),(fF=D.preturn(cp.BTrue),function(fI){return R.op_GreaterGreaterDot(fE,fF,fI[0],fI[1]);})),(fG=D.kw("false"),(fH=D.preturn(cp.BFalse),function(fI){return R.op_GreaterGreaterDot(fG,fH,fI[0],fI[1]);})),R.op_GreaterGreaterEquals(R.exp(fB),function(fI){var fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT;fJ=D.choice([R.op_GreaterGreaterEquals((fK=D.kw("<="),(fL=R.exp(fB),function(fU){return R.op_GreaterGreaterDot(fK,fL,fU[0],fU[1]);})),function(fU){return D.preturn({$:3,$0:fI,$1:fU});}),R.op_GreaterGreaterEquals((fM=D.kw("<"),(fN=R.exp(fB),function(fU){return R.op_GreaterGreaterDot(fM,fN,fU[0],fU[1]);})),function(fU){return D.preturn({$:2,$0:fI,$1:fU});}),R.op_GreaterGreaterEquals((fO=D.kw("="),(fP=R.exp(fB),function(fU){return R.op_GreaterGreaterDot(fO,fP,fU[0],fU[1]);})),function(fU){return D.preturn({$:4,$0:fI,$1:fU});}),R.op_GreaterGreaterEquals((fQ=D.kw(">="),(fR=R.exp(fB),function(fU){return R.op_GreaterGreaterDot(fQ,fR,fU[0],fU[1]);})),function(fU){return D.preturn({$:5,$0:fI,$1:fU});}),R.op_GreaterGreaterEquals((fS=D.kw(">"),(fT=R.exp(fB),function(fU){return R.op_GreaterGreaterDot(fS,fT,fU[0],fU[1]);})),function(fU){return D.preturn({$:6,$0:fI,$1:fU});})]);return function(fU){return fJ([fU[0],fU[1]]);};})]))([fC,fD]);};S.to_string=function(fB,fC){return S.to_string_normalise(true,fB,fC);};S.to_string_normalise=function(fB,fC,fD){return"<svg xmlns=\\"http://www.w3.org/2000/svg\\" height=\\""+S.display_float(fD.box_dim.y)+"\\" width=\\""+S.display_float(fD.box_dim.x)+"\\">\\r\\n  <style>"+fC+"</style>\\r\\n  "+S.group_to_string(fB,fD.box_group)+"\\r\\n</svg>";};S.stackhc=function(fB,fC,fD){var fE,fF;function fG(fH,fI){return function(fJ){var fK;return[new B({$:1,$0:(fK=fJ.box_group,cF.New(fK.name,fK.content,fK.anchors,fK.debug_anchors,fK.sub_groups,{$:1,$0:cD.New(fI.x,fI.y+(fE-fJ.box_dim.y)/2)})),$1:fH}),cD.New(fI.x+fJ.box_dim.x+fC,fI.y)];};}fE=A.max(A.map(function(fH){return fH.box_dim.y;},fD));fF=bc.fold(function(fH,fI){return(function(fJ){return fG(fJ[0],fJ[1]);}(fH))(fI);},[B.Empty,fB],fD);return cE.New(cF.New("",{$:0,$0:B.Empty},B.Empty,false,fF[0],null),cD.New(fF[1].x-fC+fB.x,fE+2*fB.y));};S.stackv=function(fB,fC,fD){var fE;function fF(fG,fH){return function(fI){var fJ;return[new B({$:1,$0:(fJ=fI.box_group,cF.New(fJ.name,fJ.content,fJ.anchors,fJ.debug_anchors,fJ.sub_groups,{$:1,$0:fH})),$1:fG}),cD.New(fH.x,fH.y+fI.box_dim.y+fC)];};}fE=bc.fold(function(fG,fH){return(function(fI){return fF(fI[0],fI[1]);}(fG))(fH);},[B.Empty,fB],fD);return cE.New(cF.New("",{$:0,$0:B.Empty},B.Empty,false,fE[0],null),cD.New((fD.$==0?0:A.max(A.map(function(fG){return fG.box_dim.x;},fD)))+2*fB.x,fE[1].y-fC+fB.y));};S.display_float=function(fB){return a.String(fv.floor(fB*1000)/1000);};S.group_to_string=function(fB,fC){return"<g"+(S.translate_to_string())(fC.offset)+">\\r\\n  "+S.content_to_string(fB,fC.content)+(fC.debug_anchors?dk.concat(" ",A.map(S.debug_anchor,fC.anchors)):"")+S.string_of_list(function(fD){return S.group_to_string(fB,fD);},"\\r\\n  ",fC.sub_groups)+"\\r\\n</g>";};S.label_box=function(fB,fC,fD){var fE;fE=fC*dk.length(fD);return cE.New(cF.New("",{$:0,$0:A.ofArray([el.New(fB,B.Empty,{$:1,$0:em.New(fD,cD.New(0,S.text_height()),fB,fC,cD.New(fE,S.text_height()))})])},B.Empty,false,B.Empty,null),cD.New(fE,S.text_height()));};S.default_letter_width=function(){en.$cctor();return en.default_letter_width;};S.translate_to_string=function(){en.$cctor();return en.translate_to_string;};S.content_to_string=function(fB,fC){return fC.$==1?fC.$0:S.string_of_list(function(fD){return S.path_to_string(fB,fD);},"\\r\\n  ",fC.$0);};S.debug_anchor=function(fB){return(((fu.Curried3(function(fC,fD,fE){return fC("<circle cx=\\""+fD.toFixed(6)+"\\" cy=\\""+fE.toFixed(6)+"\\" r=\\"5\\" stroke=\\"#DDDDFF\\" stroke-width=\\"0.5\\"/>");}))(a.id))(fB.anchor_point.x))(fB.anchor_point.y);};S.string_of_list=function(fB,fC,fD){return fD.$==0?"":A.reduce(function(fE,fF){return fE+fC+fF;},A.map(fB,fD));};S.text_height=function(){en.$cctor();return en.text_height;};S.content_group=function(fB){return cF.New("",fB,B.Empty,false,B.Empty,null);};S.path_to_string=function(fB,fC){var fD,fE,fF,fG;fD=(fE=fC.commands,fE.$==0?"":"<path "+(fF=fC.path_class,fF!=null&&fF.$==1?"class=\\""+fF.$0+"\\" ":"")+"d=\\""+S.string_of_list(S.path_command_to_string,"\\r\\n         ",fE)+"\\" />");fG=fC.path_label;return fG!=null&&fG.$==1?fD+"\\r\\n"+S.label_to_string(fB,fG.$0):fD;};S.fontsize=function(){en.$cctor();return en.fontsize;};S.translate_point_by=function(fB,fC){return cD.New(fB.x+fC.x,fB.y+fC.y);};S.transform_anchor_by=function(fB,fC){return dB.New(fC.anchor_id,fB(fC.anchor_point));};S.transform_path_command_by=function(fB,fC){return fC.$==1?{$:1,$0:fB(fC.$0)}:fC.$==2?{$:2,$0:fB(fC.$0),$1:fC.$1}:fC.$==3?e2.ClosePath:{$:0,$0:fB(fC.$0)};};S.transform_label_by=function(fB,fC){return em.New(fC.label_text,fB(fC.label_anchor),fC.label_class,fC.letter_width,fB(fC.label_dir));};S.transform_path_by=function(fB,fC){var fD;return el.New(fC.path_class,A.map(function(fE){return S.transform_path_command_by(fB,fE);},fC.commands),(fD=fC.path_label,fD!=null&&fD.$==1?{$:1,$0:S.transform_label_by(fB,fD.$0)}:null));};S.on_option=function(fB,fC,fD){return fD!=null&&fD.$==1?fB(fD.$0):fC;};S.point_to_string=function(fB){return S.display_float(fB.x)+","+S.display_float(fB.y);};S.transform_group_by=function(fB,fC){return cF.New(fC.name,S.transform_content_by(fB,fC.content),A.map(function(fD){return S.transform_anchor_by(fB,fD);},fC.anchors),fC.debug_anchors,A.map(function(fD){return S.transform_group_by(fB,fD);},fC.sub_groups),fC.offset);};S.path_command_to_string=function(fB){return fB.$==1?"L "+S.point_to_string(fB.$0):fB.$==2?"A "+S.arc_to_string(fB.$1)+" "+S.point_to_string(fB.$0):fB.$==3?"z":"M "+S.point_to_string(fB.$0);};S.label_to_string=function(fB,fC){var fD,fE;fD=fB?S.normalise_label(fC):fC;return"<text "+(fE=fD.label_class,fE!=null&&fE.$==1?"class=\\""+fE.$0+"\\" ":"")+" x=\\""+S.display_float(fD.label_anchor.x)+"\\" y=\\""+S.display_float(fD.label_anchor.y)+"\\" transform=\\"rotate("+S.display_float(S.label_angle(fD))+" "+S.point_to_string(fD.label_anchor)+")\\">"+fD.label_text+"</text>";};S.transform_content_by=function(fB,fC){return fC.$==1?{$:1,$0:fC.$0}:{$:0,$0:A.map(function(fD){return S.transform_path_by(fB,fD);},fC.$0)};};S.arc_to_string=function(fB){return S.display_float(fB.rx)+","+S.display_float(fB.ry)+" "+S.display_float(fB.angle)+" "+S.flag_to_string(fB.large_flag)+","+S.flag_to_string(fB.sweep_flag);};S.normalise_label=function(fB){var fC,fD,fE,fF,fG,fH,fI;fC=S.sub(fB.label_dir,fB.label_anchor);fD=S.ang(fC)%360;fE=fD<270&&fD>90?(fF=(fG=S.rotate_point_around(S.origo(),-90,fC),S.scale_to(S.half_text_height(),fG)),(fH=S.rotate_point_around(S.origo(),-180,fC),(fI=S.translate_point_by(fF,fB.label_anchor),[fI,S.translate_point_by(fH,fI)]))):[fB.label_anchor,fB.label_dir];return em.New(fB.label_text,fE[0],fB.label_class,fB.letter_width,fE[1]);};S.label_angle=function(fB){return S.ang(S.sub(fB.label_dir,fB.label_anchor));};S.flag_to_string=function(fB){return fB?"1":"0";};S.sub=function(fB,fC){return cD.New(fB.x-fC.x,fB.y-fC.y);};S.ang=function(fB){return S.rad_to_deg(S.dir(fB));};S.rotate_point_around=function(fB,fC,fD){var fE,fF,fG;fE=S.sub(fD,fB);fF=S.norm(fE);fG=S.dir(fE)+S.pi()*fC/180;return S.translate_point_by(fB,cD.New(fF*fv.cos(fG),fF*fv.sin(fG)));};S.origo=function(){en.$cctor();return en.origo;};S.scale_to=function(fB,fC){return S.scale_by(fB/S.norm(fC),fC);};S.half_text_height=function(){en.$cctor();return en.half_text_height;};S.dir=function(fB){var fC,fD;fC=fB.x;fD=fB.y;return fC===0?fD===0?0:fD>0?S.pi()/2:3*S.pi()/2:fD===0?fC>0?0:S.pi():fC>0?fv.atan(fD/fC):fv.atan(fD/fC)+S.pi();};S.rad_to_deg=function(fB){return 180*fB/S.pi();};S.norm=function(fB){return fv.sqrt(fB.x*fB.x+fB.y*fB.y);};S.pi=function(){en.$cctor();return en.pi;};S.scale_by=function(fB,fC){return cD.New(fB*fC.x,fB*fC.y);};T=d.Populations=fu.Class({set_population:function(fB,fC){var fD;U.set(this.index_to_species,fB,(fD=U.get(this.index_to_species,fB),W.New(fD.constant,fC,fD.species,fD.initial,fD.input,fD.spatial_initial,fD.max)));},get_population:function(fB){return U.get(this.index_to_species,fB).value;},get_get_pop_info_list:function(){return A.ofArray(this.index_to_species);},find_index:function(fB){return cS.find(this.species_to_index,fB);},get_get_pop_array:function(){return U.map(function(fB){return fB.value;},this.index_to_species);},get_get_count:function(){return this.index_to_species.length;},is_constant:function(fB){return U.get(this.index_to_species,fB).constant;},tryFind_index:function(fB){return cS.tryFind(this.species_to_index,fB);},get_clone:function(){return T.New(this.index_to_species.slice(),cS.copy(this.species_to_index));},map_population:function(fB){return T.New(U.map(function(fC){return W.create$1(fC.constant,fB(fC.value),fC.species,fC.initial,fC.input,fC.max);},this.index_to_species),cS.copy(this.species_to_index));},add_pop_info:function(fB){var fC,fD,fE,fF;return(fC=cS.tryFind(this.species_to_index,fB.species),fC!=null&&fC.$==1)?F.FailWith("Adding pop_info for species twice"):(fD=this.index_to_species.length,(fE=this.index_to_species.concat([fB]),(fF=cS.copy(this.species_to_index),(cS.add(fF,fB.species,fD),T.New(fE,fF)))));}},null,T);T.test_integer_or_constant=function(fB){return U.fold(function(fC,fD){var fE;fE=fD.value;return(fv.round(fE)-fE===0||fD.constant)&&fC;},true,fB.index_to_species);};T.scale=function(fB,fC){return fB.map_population(function(fD){return fC*fD;});};T.merge=function(fB,fC,fD){return U.fold(function(fE,fF){var fG,fH,fI;fG=cS.tryFind(fE.species_to_index,fF.species);return fG!=null&&fG.$==1?(fH=fG.$0,(fI=U.get(fE.index_to_species,fH),(U.set(fE.index_to_species,fH,W.New(fI.constant,fB(fI.value,fF.value),fI.species,fI.initial,fI.input,fI.spatial_initial,fI.max)),fE))):fE.add_pop_info(fF);},fC,fD.index_to_species);};T.create=function(fB){var fC,fD;fC=U.ofList(fB);fD=cS.empty();A.iteri(function(fE,fF){U.set(fC,fE,fF);return cS.add(fD,fF.species,fE);},fB);return T.New(fC,fD);};T.empty=function(){return T.New([],cS.empty());};T.New=function(fB,fC){return new T({index_to_species:fB,species_to_index:fC});};U.map=function(fB,fC){var fD,fE,fF;fD=new a.Array(fC.length);for(fE=0,fF=fC.length-1;fE<=fF;fE++)fD[fE]=fB(fC[fE]);return fD;};U.ofSeq=function(fB){var fC,fD;if(fB instanceof a.Array)return fB.slice();else if(fB instanceof B)return U.ofList(fB);else{fC=[];fD=da.Get(fB);try{while(fD.MoveNext())fC.push(fD.Current());return fC;}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}}};U.mapi2=function(fB,fC,fD){var fE,fF,fG;U.checkLength(fC,fD);fE=new a.Array(fC.length);for(fF=0,fG=fC.length-1;fF<=fG;fF++)fE[fF]=fB(fF,fC[fF],fD[fF]);return fE;};U.mapi=function(fB,fC){var fD,fE,fF;fD=new a.Array(fC.length);for(fE=0,fF=fC.length-1;fE<=fF;fE++)fD[fE]=fB(fE,fC[fE]);return fD;};U.iter=function(fB,fC){var fD,fE;for(fD=0,fE=fC.length-1;fD<=fE;fD++)fB(fC[fD]);};U.ofList=function(fB){var fC,fD;fD=[];fC=fB;while(!(fC.$==0)){fD.push(A.head(fC));fC=A.tail(fC);}return fD;};U.iteri=function(fB,fC){var fD,fE;for(fD=0,fE=fC.length-1;fD<=fE;fD++)fB(fD,fC[fD]);};U.fold=function(fB,fC,fD){var fE,fF,fG;fE=fC;for(fF=0,fG=fD.length-1;fF<=fG;fF++)fE=fB(fE,fD[fF]);return fE;};U.exists=function(fB,fC){var fD,fE,fF,fG;fD=false;fE=0;fG=U.length(fC);while(!fD&&fE<fG)if(fB(fC[fE]))fD=true;else fE=fE+1;return fD;};U.create=function(fB,fC){var fD,fE,fF;fD=new a.Array(fB);for(fE=0,fF=fB-1;fE<=fF;fE++)fD[fE]=fC;return fD;};U.init=function(fB,fC){var fD,fE,fF;fB<0?F.FailWith("Negative size given."):null;fD=new a.Array(fB);for(fE=0,fF=fB-1;fE<=fF;fE++)fD[fE]=fC(fE);return fD;};U.tryFindIndex=function(fB,fC){var fD,fE;fD=null;fE=0;while(fE<fC.length&&fD==null){fB(fC[fE])?fD={$:1,$0:fE}:void 0;fE=fE+1;}return fD;};U.collect=function(fB,fC){return a.Array.prototype.concat.apply([],U.map(fB,fC));};U.concat=function(fB){return a.Array.prototype.concat.apply([],U.ofSeq(fB));};U.checkLength=function(fB,fC){if(fB.length!==fC.length)F.FailWith("The arrays have different lengths.");};U.min=function(fB){var fC,fD,fE,fF;U.nonEmpty(fB);fC=fB[0];for(fD=1,fE=fB.length-1;fD<=fE;fD++){fF=fB[fD];bk.Compare(fF,fC)===-1?fC=fF:void 0;}return fC;};U.max=function(fB){var fC,fD,fE,fF;U.nonEmpty(fB);fC=fB[0];for(fD=1,fE=fB.length-1;fD<=fE;fD++){fF=fB[fD];bk.Compare(fF,fC)===1?fC=fF:void 0;}return fC;};U.last=function(fB){U.nonEmpty(fB);return fB[fB.length-1];};U.sortInPlace=function(fB){U.mapInPlace(function(fC){return fC[0];},U.mapiInPlace(function(fC,fD){return[fD,fC];},fB).sort(bk.Compare));};U.map2=function(fB,fC,fD){var fE,fF,fG;U.checkLength(fC,fD);fE=new a.Array(fD.length);for(fF=0,fG=fD.length-1;fF<=fG;fF++)fE[fF]=fB(fC[fF],fD[fF]);return fE;};U.nonEmpty=function(fB){if(fB.length===0)F.FailWith("The input array was empty.");};U.average=function(fB){return a.Number(U.sum(fB))/fB.length;};U.sum=function(fB){var fC,fD;fC=0;fD=0;for(;fD<fB.length;fD++)fC+=fB[fD];return fC;};U.unzip=function(fB){var fC,fD,fE,fF,fG;fC=[];fD=[];for(fE=0,fF=fB.length-1;fE<=fF;fE++){fG=fB[fE];fC.push(fG[0]);fD.push(fG[1]);}return[fC,fD];};U.fold2=function(fB,fC,fD,fE){var fF,fG,fH;U.checkLength(fD,fE);fF=fC;for(fG=0,fH=fD.length-1;fG<=fH;fG++)fF=fB(fF,fD[fG],fE[fG]);return fF;};U.head=function(fB){U.nonEmpty(fB);return fB[0];};U.findIndex=function(fB,fC){var fD;fD=U.tryFindIndex(fB,fC);return fD==null?F.FailWith("KeyNotFoundException"):fD.$0;};U.sortInPlaceBy=function(fB,fC){U.mapInPlace(function(fD){return fD[0];},U.mapiInPlace(function(fD,fE){return[fE,[fB(fE),fD]];},fC).sort(function(fD,fE){return bk.Compare(fD[1],fE[1]);}));};U.partition=function(fB,fC){var fD,fE,fF,fG;fD=[];fE=[];for(fF=0,fG=fC.length-1;fF<=fG;fF++)if(fB(fC[fF]))fD.push(fC[fF]);else fE.push(fC[fF]);return[fD,fE];};U.reduce=function(fB,fC){var fD,fE,fF;U.nonEmpty(fC);fD=fC[0];for(fE=1,fF=fC.length-1;fE<=fF;fE++)fD=fB(fD,fC[fE]);return fD;};U.foldBack=function(fB,fC,fD){var fE,fF,fG,fH,fI;fE=fD;fG=fC.length;for(fH=1,fI=fG;fH<=fI;fH++)fE=fB(fC[fG-fH],fE);return fE;};U.unzip3=function(fB){var fC,fD,fE,fF,fG,fH;fC=[];fD=[];fE=[];for(fF=0,fG=fB.length-1;fF<=fG;fF++){fH=fB[fF];fC.push(fH[0]);fD.push(fH[1]);fE.push(fH[2]);}return[fC,fD,fE];};U.pick=function(fB,fC){var fD;fD=U.tryPick(fB,fC);return fD==null?F.FailWith("KeyNotFoundException"):fD.$0;};U.filter=function(fB,fC){var fD,fE,fF;fD=[];for(fE=0,fF=fC.length-1;fE<=fF;fE++)if(fB(fC[fE]))fD.push(fC[fE]);return fD;};U.sumBy=function(fB,fC){var fD,fE;fD=0;fE=0;for(;fE<fC.length;fE++)fD+=fB(fC[fE]);return fD;};U.tryPick=function(fB,fC){var fD,fE,fF;fD=null;fE=0;while(fE<fC.length&&fD==null){fF=fB(fC[fE]);fF!=null&&fF.$==1?fD=fF:void 0;fE=fE+1;}return fD;};U.choose=function(fB,fC){var fD,fE,fF,fG;fD=[];for(fE=0,fF=fC.length-1;fE<=fF;fE++){fG=fB(fC[fE]);fG==null?void 0:fD.push(fG.$0);}return fD;};U.forall=function(fB,fC){var fD,fE,fF,fG;fD=true;fE=0;fG=U.length(fC);while(fD&&fE<fG)if(fB(fC[fE]))fE=fE+1;else fD=false;return fD;};U.exists2=function(fB,fC,fD){var fE,fF,fG,fH;U.checkLength(fC,fD);fE=false;fF=0;fH=U.length(fC);while(!fE&&fF<fH)if(fB(fC[fF],fD[fF]))fE=true;else fF=fF+1;return fE;};U.zip=function(fB,fC){var fD,fE,fF;U.checkLength(fB,fC);fD=U.create(fB.length,null);for(fE=0,fF=fB.length-1;fE<=fF;fE++)fD[fE]=[fB[fE],fC[fE]];return fD;};V=d.Initial=fu.Class({scale:function(fB){return V.New(this.constant,fB(this.value),this.species,this.time,this.spatial);}},null,V);V.create$1=function(fB,fC,fD){return V.create$4(false,fB,fC,fD,null);};V.create$4=function(fB,fC,fD,fE,fF){return V.New(fB,fC,fD,fE,fF);};V.to_initialpops_events=function(fB,fC,fD){function fE(fF){return fF.value;}return V.to_initialpops_events_poly(fB,fC,fD,function(fF){return bc.sumBy(fE,fF);});};V.to_initialpops_events_poly=function(fB,fC,fD,fE){var fF,fG,fH;function fI(fN){return di.find(fB,fN);}function fJ(fN,fO){function fP(fQ,fR){var fS;fS=W.create(bc.exists(function(fT){return fT.constant;},fR),fE(fR),fQ);return W.New(fS.constant,fS.value,fS.species,false,fS.input,fS.spatial_initial,fS.max);}return cT.create(T.create(A.ofSeq(bc.map(function(fQ){return fP(fQ[0],fQ[1]);},bc.groupBy(function(fQ){return fQ.species;},fO)))),fN);}function fK(fN,fO,fP){return W.create(fP,fO,fN);}function fL(fN){var fO;fO=bc.length(bc.filter(function(fP){return fP.constant;},fN));return fO===0?false:fO===1?bc.length(fN)===1||F.FailWith("Constancy overload"):F.FailWith("Constancy overload");}function fM(fN,fO){return[fN,fE(bc.filter(function(fP){var fQ;fQ=fP.time;return fQ==null||fQ.$0===fC;},fO)),fL(fO)];}fF=A.map((fG=function(fN){return R["eval"](fI,fN);},function(fN){return V["eval"](fG,fN);}),fD);fH=A.ofSeq(bc.map(function(fN){return fJ(fN[0],fN[1]);},bc.groupBy(function(fN){return fN.time.$0;},A.filter(function(fN){var fO;fO=fN.time;return fO==null?false:fO.$0!==fC;},fF))));return[T.create(A.ofSeq(bc.map(function(fN){return fK(fN[0],fN[1],fN[2]);},bc.map(function(fN){return fM(fN[0],fN[1]);},bc.groupBy(function(fN){return fN.species;},fF))))),fH];};V.from_gui=function(fB,fC,fD){var fE;return V.create$4(fD.constant,fC(fD.value),fB(fD.species),(fE=fD.time,fE==null?null:{$:1,$0:fC(fE.$0)}),fD.spatial);};V.create$3=function(fB,fC,fD,fE){return V.create$4(fB,fC,fD,fE,null);};V.to_gui=function(fB,fC,fD){var fE;return V.create$4(fD.constant,fC(fD.value),fB(fD.species),(fE=fD.time,fE==null?null:{$:1,$0:fC(fE.$0)}),fD.spatial);};V.mapValues=function(fB,fC){var fD;return V.create$4(fC.constant,fB(fC.value),fC.species,(fD=fC.time,fD==null?null:{$:1,$0:fB(fD.$0)}),fC.spatial);};V["eval"]=function(fB,fC){var fD;return V.create$4(fC.constant,fB(fC.value),fC.species,(fD=fC.time,fD==null?null:{$:1,$0:fB(fD.$0)}),fC.spatial);};V.to_string=function(fB,fC,fD,fE){var fF,fG,fH;return(fE.constant?"constant ":"")+fC(fE.value)+" "+fB(fE.species)+(fF=fE.spatial,fF!=null&&fF.$==1?(fG=fF.$0,!bk.Equals(fG,cd.defaults())?"{ spatial = "+cd.to_string(fG)+"}":""):(fH=fE.time,fH==null?"":" @ "+fC(fH.$0)));};V.parse=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK;function fL(fN,fO){return D.preturn(V.create$4(fN[0][0][0],fN[0][1],fN[0][0][1],fN[1],fO));}function fM(fN){return D.op_LessQmarkGreater(D.record(V.create$4(false,fD,fN,null,null),A.ofArray([["spatial",D.op_BarGreaterGreater(cd.parser(),function(fO){return function(fP){return V.New(fP.constant,fP.value,fP.species,fP.time,{$:1,$0:fO});};})],["time",D.op_BarGreaterGreater(fC,function(fO){return function(fP){return V.New(fP.constant,fP.value,fP.species,{$:1,$0:fO},fP.spatial);};})],["value",D.op_BarGreaterGreater(fC,function(fO){return function(fP){return V.New(fP.constant,fO,fP.species,fP.time,fP.spatial);};})],["constant",D.op_BarGreaterGreater(D.op_DotGreaterGreater(D.pbool(),D.spaces()),function(fO){return function(fP){return V.New(fO,fP.value,fP.species,fP.time,fP.spatial);};})]])),"{InitialFields}");}fE=D.kw("constant");fF=D.kw("init");fG=D.kw("spatial");fH=D.opt(D.op_GreaterGreaterPlus(D.kw("@"),fC));fI=D.op_BarGreaterGreater(D.opt(fE),function(fN){return fN!=null;});fJ=D.braces(D.op_GreaterGreaterDot(D.op_GreaterGreaterDot(fG,D.kw("=")),cd.parser()));fK=D.choice([D.op_GreaterGreaterEquals(D.op_DotGreaterGreater(D.op_GreaterGreaterDot(fF,D.op_PlusGreaterGreaterPlus(fI,fB)),D.spaces()),function(fN){var fO;fO=D.choice([D.op_BarGreaterGreater(fM(fN[1]),function(fP){return V.create$4(fN[0],fP.value,fP.species,fP.time,fP.spatial);}),D.op_GreaterGreaterEquals(D.op_PlusGreaterGreaterPlus(fC,fH),function(fP){return fL([[fN,fP[0]],fP[1]],null);})]);return function(fP){return fO([fP[0],fP[1]]);};}),D.op_LessQmarkGreater(D.pTry(D.op_GreaterGreaterEquals(D.op_PlusGreaterGreater(fB,D.kw("=")),fM)),"<species> = <record>"),D.op_GreaterGreaterEquals(D.op_DotGreaterGreaterDot(D.op_LessQmarkGreater(D.pTry(D.op_PlusGreaterGreaterPlus(D.op_PlusGreaterGreaterPlus(D.op_DotGreaterGreaterDot(fI,fC),fB),fH)),"<value> <species>"),D.opt(fJ)),function(fN){var fO;fO=fN[0];return fL([[[fO[0][0][0],fO[0][1]],fO[0][0][1]],fO[1]],fN[1]);})]);return function(fN){return fK([fN[0],fN[1]]);};};V.New=function(fB,fC,fD,fE,fF){return new V({constant:fB,value:fC,species:fD,time:fE,spatial:fF});};W=d.Population=fu.Class({},null,W);W.create=function(fB,fC,fD){return W.create$1(fB,fC,fD,true,true,null);};W.create$1=function(fB,fC,fD,fE,fF,fG){return W.New(fB,fC,fD,fE,fF,null,fG);};W.New=function(fB,fC,fD,fE,fF,fG,fH){return new W({constant:fB,value:fC,species:fD,initial:fE,input:fF,spatial_initial:fG,max:fH});};X=d.OdeOslo=fu.Class({simulate_callback:function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ;function fK(fO,fP){return fv.pow(fO,fP);}function fL(fO,fP){return fO[fP];}function fM(fO,fP){var fR,fS,fT;function fQ(fU){return fU.$==1?fO:fL(fP,fU.$0);}for(fR=0,fS=fH.length-1;fR<=fS;fR++){fI.set_Item(fR,(fT=U.get(fH,fR),fT.$==1?(fT.$0.get_key())(fQ):bc.fold(function(fU,fV){return fU*fK(fP[fV[0]],fV[1]);},fT.$0,U.get(fG,fR))));}return cO.matrMultVec(fF,cL.ofArray(fI.ToArray()));}function fN(fO,fP){function fQ(fR){return fR.$==1?fO:fL(fP,fR.$0);}return U.map(function(fR){return R["eval"](fQ,fR);},fE.plots);}fE=this;fF=this.stoich;fG=this.powers;fH=this.rateDs;fI=cH.create(fH.length,1);fJ=cI.simulate_callback(fB,fC,cI.create(this.name,this.simulator,function(fO){return function(fP){return fN(fO,fP);};},fu.Curried(cv.interpolate_float,5),this.settings,this.concs,function(fO){return function(fP){return fM(fO,fP);};}));U.iteri(function(fO,fP){return fJ.simulator.populations.set_population(fO,fP);},cL.toArray(fJ.concs));fD(fJ.simulator.populations);return X.New(this.name,fJ.simulator,this.plots,this.settings,this.stoich,this.powers,this.rateDs,this.concs);},simulate:function(){return(this.simulate_state())[1];},simulate_state:function(){var fB;fB=[B.Empty];return[this.simulate_callback([false],function(fC){fB[0]=new B({$:1,$0:fC,$1:fB[0]});},a.ignore),this.process_simulation(fB[0])];},process_simulation:function(fB){var fC,fD;fC=this.simulator.settings.times;fD=A.map(Q.to_string_plot,this.simulator.settings.plots);return fC.$==0?Z.from_rows_reverse(fD,fB):Z.from_rows_reverse(fD,cv.interpolate_reverse(function(fE,fF,fG){return fu.Curried(cv.interpolate_float,2,[fE,fF,fG]);},A.rev(fB),fC));}},null,X);X.New=function(fB,fC,fD,fE,fF,fG,fH,fI){return new X({name:fB,simulator:fC,plots:fD,settings:fE,stoich:fF,powers:fG,rateDs:fH,concs:fI});};Y=d.Ssa=fu.Class({simulate_callback:function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ;function fR(fT,fU){function fV(fW){return fW.$==0?fU.get_population(fW.$0):fT;}return U.map(function(fW){return R["eval"](fV,fW);},fF.plots);}function fS(fT,fU){var fV;fV=fT/fU.total_propensity;return function(fW){var fX,fY,fZ,f0,f1,f2;return fW.$==1?(fX=fW.$0,(fY=fW.$1,fX.time<fU.simulator.currenttime+fV?(fZ=fR(fU.simulator.currenttime,fU.simulator.populations),(f0=0.99999999,(fC(cv.New(fU.simulator.currenttime,fZ)),fC(cv.New(f0*fX.time+(1-f0)*fU.simulator.currenttime,fZ)),f1=fX.target,f1=="OutputPoint"?void 0:A.iter(function(f3){Y.incPop(fU.simulator.populations,ca.New(fU.simulator.populations.find_index(f3.species),F.toInt(f3.value*fU.settings.scale)));},f1.$0.get_get_pop_info_list()),U.iteri(function(f3,f4){return U.set(fM,f3,cU.New(f4.reaction,Y.calculate_reaction_prop(fN,fU.simulator.populations,f4.reaction),f4.dependencies));},fM),(fS(fT-(fX.time-fU.simulator.currenttime)*fU.total_propensity,Y.New((f2=fU.simulator,bf.New(f2.settings,f2.populations,f2.events,fX.time,f2.nextprinttime,f2.stepsdone)),fU.plots,fU.settings,fU.reactions,U.fold(function(f3,f4){return f3+f4.propensity;},0,fM))))(fY)))):[fV,new B({$:1,$0:fX,$1:fY}),fU])):[fV,B.Empty,fU];};}fF=this;fG=this.settings;fH=(fI=this.simulator.settings.seed,fI!=null&&fI.$==1?new cR.New$1(fI.$0):new cR.New());bk.Equals(T.test_integer_or_constant(this.simulator.populations),false)?F.FailWith("Can\'t use non-integer initial conditions without specifying the species as constant"):void 0;fJ=(fK=fG.steps,fK!=null&&fK.$==1?{$:1,$0:this.simulator.stepsdone+fK.$0}:null);fL=this.reactions;fM=U.create(cS.count(fL),null);cS.iter(function(fT,fU){return U.set(fM,fT,fU);},fL);fN=fG.scale;fO=this.simulator.settings["final"];fP=this.simulator.settings.get_print_interval();fQ=function(fT,fU,fV,fW){var fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6,f7,f8,f9,f_;while(true){f0=fH.NextDouble();f1=f0>0?fv.log(1/f0):0;f2=(fS(f1,fU))(fV);f3=f2[2];f4=f2[1];f5=f2[0];f6=f3.simulator.currenttime+f5;if(f4.$==0)return f3;else{if(fE!=null)((fE.$0(f3.simulator.currenttime))(f5))(f3.simulator.populations);f7=_1.shouldPrint(fO,f6,f3.simulator.nextprinttime,fJ,fT,f3.simulator.currenttime)?(fW(cv.New(f3.simulator.currenttime,fR(f3.simulator.currenttime,f3.simulator.populations))),Y.New((fX=f3.simulator,bf.New(fX.settings,fX.populations,fX.events,fX.currenttime,f6+fP,fX.stepsdone)),f3.plots,f3.settings,f3.reactions,f3.total_propensity)):f3;if(_1.shouldStop(fO,f7.simulator.currenttime,f7.simulator.stepsdone,fB,fJ))return f7;else{f8=Y.New((fY=f7.simulator,bf.New(fY.settings,fY.populations,fY.events,f6,fY.nextprinttime,fY.stepsdone)),f7.plots,f7.settings,f7.reactions,f7.total_propensity);f9=Y.pickReactionRandom(f8.total_propensity,fM,fH);Y.executeReaction(f8.simulator.populations,f9[0]);f_=Y.update_props_direct(fN,f8.total_propensity,fM,f9[1],f8.simulator.populations);fT=false;fU=Y.New((fZ=f8.simulator,bf.New(fZ.settings,fZ.populations,fZ.events,fZ.currenttime,fZ.nextprinttime,f8.simulator.stepsdone+1)),f8.plots,f8.settings,f8.reactions,f_);fV=f4;}}}}(true,this,this.simulator.events,fC);fD(fQ.simulator.populations);return fQ;},simulate_trajectories_callback:function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ;fD=this;fE=(fF=this.simulator.settings.seed,fF!=null&&fF.$==1?new cR.New$1(fF.$0):new cR.New());fG=(this.simulator.settings["final"]-this.simulator.settings.initial)/this.simulator.settings.points;fH=A.init(this.simulator.settings.points,function(fK){return fD.simulator.settings.initial+fG*fK;});fI=this.simulator.populations;fJ=A.map(Q.to_string_plot,this.simulator.settings.plots);(function(fK,fL){var fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY;while(true){if(fK>=fD.settings.trajectories||fB[0])return null;else{fQ=(fM=fD.simulator.settings.seed,fM!=null&&fM.$==1?fM.$0+fK:fE.Next$1());fR=[B.Empty];fS=function(fZ){return function(f0){fZ[0]=new B({$:1,$0:f0,$1:fZ[0]});};}(fR);fT=Y.New((fN=fD.simulator,bf.New((fO=fD.simulator.settings,P.New(fO.name,fO.initial,fO["final"],fO.points,fO.plots,fO.plotcolours,{$:1,$0:fQ},fO.kinetics,fO.times,fO.prune,fO.multicore,fO.data,fO.sweeps)),fI.get_clone(),fN.events,fN.currenttime,fN.nextprinttime,fN.stepsdone)),fD.plots,fD.settings,fD.reactions,fD.total_propensity);fT.simulate_callback([false],fS,a.ignore,null);fU=cv.interpolate_reverse(function(fZ,f0,f1){return fu.Curried(cv.zero_order_hold,2,[fZ,f0,f1]);},A.rev(fR[0]),fH);fV=A.map(Q.to_string_plot,fD.simulator.settings.plots);fW=Z.from_rows_reverse(fV,fU);fX=(fP=fL.columns,(((fu.Curried3(function(fZ,f0,f1){return A.map2(function(f2,f3){return(fZ(f2))(f3);},f0,f1);}))((fu.Curried3(function(fZ,f0,f1){function f2(f3,f4){var f5;f5=c_.online_meanvar(f3.mean,f3.stdev*f3.stdev,f4,fZ+1);return cw.New(f5[0],fv.sqrt(f5[1]));}return bE.New(f1.name,(((fu.Curried3(A.map2))(f2))(f0.values))(f1.values));}))(fK)))(fP))(fW.columns));fY=Z.New(fL.times,fX);fC(fY);fK=fK+1;fL=fY;}}}(0,Z.from_array_columns(fH,U.create(fJ.get_Length(),U.create(this.simulator.settings.points,cw.New(0,0))),fJ)));}},null,Y);Y.incPop=function(fB,fC){if(!fB.is_constant(fC.element))fB.set_population(fC.element,fB.get_population(fC.element)+fC.multiplicity);};Y.calculate_reaction_prop=function(fB,fC,fD){var fE,fG,fH,fI,fJ,fK;function fF(fL){return fC.get_population(fL);}fG=fD.rate;if(fG.$==1)return(fG.$0.get_key())(function(fL){return fL.$==1?F.FailWith("Time dependent rates not supported in SSA."):fF(fL.$0)/fB;})*fB;else{fH=fG.$0;fI=b$.to_mlist(fD.reactants);switch(fI.$==1?fI.$0.multiplicity===1?fI.$1.$==1?fI.$1.$0.multiplicity===1?fI.$1.$1.$==0?(fE=[fI.$0.element,fI.$1.$0.element],4):(fE=fI,5):(fE=fI,5):(fE=fI.$0.element,1):fI.$0.multiplicity===2?fI.$1.$==0?(fE=fI.$0.element,2):(fE=fI,5):fI.$0.multiplicity===3?fI.$1.$==0?(fE=fI.$0.element,3):(fE=fI,5):(fE=fI,5):0){case 0:return fH;case 1:return fH*fF(fE);case 2:fJ=fF(fE);return fH*fJ*(fJ-1)*0.5;case 3:fK=fF(fE);return fH*fK*(fK-1)*(fK-2)/6;case 4:return fH*fF(fE[0])*fF(fE[1]);case 5:return db.fold_left(function(fL,fM){return fL*db.binom(F.toInt(fF(fM.element)),fM.multiplicity);},fH,fE);}}};Y.pickReactionRandom=function(fB,fC,fD){var fE,fF;fE=fD.NextDouble()*fB;fF=U.length(fC);return function(fG,fH){var fI,fJ;while(true){fI=U.get(fC,fH);fJ=fG+fI.propensity;if(fJ>fE)return[fI.reaction,fI.dependencies];else if(fH+1>=fF)return fJ!==fB?F.FailWith("Incorrect total propensity used!"):F.FailWith("Index outside range");else{fG=fJ;fH=fH+1;}}}(0,0);};Y.executeReaction=function(fB,fC){function fD(fE,fF){return!fE.is_constant(fF.element)?fE.set_population(fF.element,fE.get_population(fF.element)-fF.multiplicity):null;}b$.iterm(function(fE){return fD(fB,fE);},fC.reactants);b$.iterm(function(fE){Y.incPop(fB,fE);},fC.products);};Y.update_props_direct=function(fB,fC,fD,fE,fF){var fG;fG=fC+db.fold_left(function(fH,fI){var fJ,fK;fJ=U.get(fD,fI);fK=Y.calculate_reaction_prop(fB,fF,fJ.reaction);U.set(fD,fI,cU.New(fJ.reaction,fK,fJ.dependencies));return fH+(fK-fJ.propensity);},0,fE);return fG<0?0:fG;};Y.make_sim_reactions_pops=function(fB,fC,fD,fE,fF){var fG,fH,fI,fJ,fK;function fL(fO,fP,fQ){return[fO,Y.calculate_reaction_prop(fD,fF,fO),fQ];}function fM(fO,fP,fQ){return[fO,fQ];}function fN(fO,fP,fQ){return[fO,fP,Y.calculate_reaction_deps(fO,fI)];}fG=A.map(function(fO){return fL(fO[0],fO[1],fO[2]);},cc.get_sim_reactions_products(fD,fF,fB,fC,fE));fH=(fI=A.map(function(fO){return fM(fO[0],fO[1],fO[2]);},fG),A.map(function(fO){return fN(fO[0],fO[1],fO[2]);},fG));fJ=cS.empty();fK=db.fold_left(function(fO,fP){return(function(fQ){var fR,fS;fR=fQ[0];fS=fQ[1];return function(fT){var fU;fU=fT[1];cS.add(fJ,fR,cU.New(fT[0],fU,fT[2]));return[fR+1,fS+fU];};}(fO))(fP);},[0,0],fH);return[fJ,fK[0],fK[1]];};Y.create=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ,fK,fL,fM,fN,fO;fH=K.Map(function(fP,fQ){return(function(){var fR,fS,fT;fR=(fS=(fT=fB.populations,function(fU){return fT.find_index(fU);}),function(fU){return cY.map(fS,fU);});return function(fU){return R.map(fR,fU);};}(fP))(fQ);},fG);Y.empty();return Y.New(fB,U.ofList(A.map((fI=(fJ=(fK=(fL=(fM=fB.populations,function(fP){return fM.find_index(fP);}),function(fP){return co.map(fL,fP);}),(fN=(fO=bF.to_env(fF),function(fP){return co.inline_keys(fO,fH,fP);}),function(fP){return fN(fK(fP));})),function(fP){return R.expand(fJ,fP);}),function(fP){return R.simplify(fI(fP));}),fB.settings.plots)),fC,fD,fE);};Y.calculate_reaction_deps=function(fB,fC){var fD;function fE(fG,fH){function fI(fJ){return fJ.$==1?B.Empty:A.ofArray([fJ.$0]);}return db.disjoint(function(fJ,fK){return fJ===fK;},db.union(function(fJ,fK){return fJ===fK;},b$.nonzero_elements(fG.reactants),fH.$==0?B.Empty:A.collect(fI,R.mentions(fH.$0))),fD);}function fF(fG,fH){return function(fI){return fE(fI[0],fI[1])?[fG,fH+1]:[new B({$:1,$0:fH,$1:fG}),fH+1];};}fD=b$.nonzero_elements(b$.difference(function(fG,fH){return fG===fH;},fB.products,fB.reactants));return A.rev((db.fold_left(function(fG,fH){return(function(fI){return fF(fI[0],fI[1]);}(fG))(fH);},[B.Empty,0],fC))[0]);};Y.empty=function(){return Y.New(bf.empty(),[],_7.get_defaults(),cS.empty(),0);};Y.New=function(fB,fC,fD,fE,fF){return new Y({simulator:fB,plots:fC,settings:fD,reactions:fE,total_propensity:fF});};Z.to_rows=function(fB){return A.rev(Z.to_rows_reverse(fB));};Z.to_rows_reverse=function(fB){function fC(fD,fE){return function(fF){return[new B({$:1,$0:cv.create(fF,A.map(A.head,fE)),$1:fD}),A.map(A.tail,fE)];};}return(bc.fold(function(fD,fE){return(function(fF){return fC(fF[0],fF[1]);}(fD))(fE);},[B.Empty,Z.get_column_values(fB)],fB.times))[0];};Z.from_array_columns=function(fB,fC,fD){return Z.New(fB,A.ofSeq(bc.map2(function(fE,fF){return bE.create(A.ofArray(fF),fE);},fD,fC)));};Z.from_rows_reverse=function(fB,fC){var fD;function fE(fF,fG){return bE.New(fG.name,new B({$:1,$0:fF,$1:fG.values}));}return bc.fold(function(fF,fG){return Z.New(new B({$:1,$0:fG.time,$1:fF.times}),A.map2(fE,A.ofArray(fG.values),fF.columns));},Z.New(B.Empty,A.map((fD=B.Empty,function(fF){return bE.create(fD,fF);}),fB)),fC);};Z.get_column_values=function(fB){return A.map(function(fC){return fC.values;},fB.columns);};Z.from_rows=function(fB,fC){return Z.reverse(Z.from_rows_reverse(fB,fC));};Z.qsummary=function(fB){var fC;fC=A.head(fB).times;return Z.New(fC,A.concat(A.init(A.head(fB).columns.get_Length(),function(fD){var fE,fF,fG,fH,fI;fE=A.map(function(fJ){return fJ.columns.get_Item(fD).values;},fB);fF=A.head(fB).columns.get_Item(fD).name;fG=A.unzip(A.init(fC.get_Length(),function(fJ){var fK;fK=A.map(function(fL){return bc.nth(fJ,fL);},fE);return[d3.summary(fK),d3.qsummary(fK)];}));fH=fG[0];fI=fG[1];return A.ofArray([bE.create(A.map(function(fJ){return fJ.mean;},fH),fF+" Mean"),bE.create(A.map(function(fJ){return fv.sqrt(fJ.variance);},fH),fF+" Std"),bE.create(A.map(function(fJ){return fJ.lb95;},fI),fF+" L95"),bE.create(A.map(function(fJ){return fJ.ub95;},fI),fF+" U95")]);})));};Z.reverse=function(fB){return Z.New(A.rev(fB.times),A.map(bE.reverse,fB.columns));};Z.filter_by_tmax=function(fB,fC){var fD,fE;fD=bc.tryFindIndex(function(fF){return fF>fB;},fC.times);return fD==null?fC:(fE=fD.$0,Z.New(fC.times.GetSlice({$:1,$0:0},{$:1,$0:fE-1}),A.map(function(fF){return bE.New(fF.name,fF.values.GetSlice({$:1,$0:0},{$:1,$0:fE-1}));},fC.columns)));};Z.likelihood=function(fB,fC,fD){return bc.sum(A.map3(function(fE,fF,fG){return bc.sum(A.map2(function(fH,fI){return(fE(fH))(fI);},fF.values,fG.values));},fB,fC.columns,fD.columns));};Z.New=function(fB,fC){return{times:fB,columns:fC};};_0=d.OdeSundials=fu.Class({simulate:function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1;function f2(f6){var f7;return f6.time>=fC.currenttime&&(f7=f6.target,f7.$==0?U.exists(function(f8){return f8!==0;},f7.$0.get_get_pop_array()):true);}function f3(f6,f7){return F.toInt(f7.getStoich(fF.is_constant(f6),f6));}function f4(f6,f7){var f8,f9,f_;f8=U.create(fX,1);for(f9=0,f_=fX-1;f9<=f_;f9++)U.set(f8,f9,(U.get(fZ,f9).get_key())(function(f$){return f$.$==1?f6:U.get(f7,f$.$0);}));return f8;}function f5(f6,f7,f8){return function(f9){var f_,f$,ga,gb,gc,gd,ge,gf,gg,gh,gi,gj,gk,gl,gm,gn,go,gp,gq;gc=f9.time;gd=U.tryFindIndex(function(gr){return gr>=f6;},fN);if(gd!=null&&gd.$==1){ge=gd.$0;gf=(f_=U.tryFindIndex(function(gr){return gr>gc;},fN),f_!=null&&f_.$==1?f_.$0:fN.length)-ge;gg=U.sub(fN,ge,gf);gh=gf===0?[[f6],1,true]:U.get(gg,0)>f6?[[f6].concat(gg),gf+1,true]:[gg,gf,false];gi=gh[0];gj=gh[1];gk=gh[2];gl=U.get(gi,gj-1)<gc?[gi.concat([gc]),gj+1,true]:[gi,gj,false];gm=gl[1];gn=gl[2];go={sN:fO,rNM:fS,stoichM:fU,powersM:fV,ratesM:fR,rNF:fX,stoichF:fY,functionalRates:f4,concs:f7,t:gl[0],tN:gm,sundialsOutput:function(gr,gs){function gt(gu){return gu.$==1?gr:U.get(gs,gu.$0);}(!gk||gr!==f6)&&(gr===fG&&!gn||gr!==gc)?U.iteri(function(gu,gv){U.get(f0,gu).push((gv.get_key())(gt));},f1):void 0;return null;},stiff:fB.settings.stiff,abstol:fB.settings.abstolerance,reltol:fB.settings.reltolerance};f$=[fw.fnSundialsSolver(go),go.conc];gp=f$[0];gq=f$[1];if(gp!==0)throw new cX.New((function(gr){return function(gs){return gr("Sundials solver failed with code: "+a.String(gs));};}(a.id))(gp));return[gc,(ga=f9.target,ga.$==0?(gb=K.OfArray(U.ofSeq(A.map(function(gr){var gs;return[(gs=fF.tryFind_index(gr.species),gs==null?F.FailWith("Unknown species in event"):gs.$0),gr.value];},ga.$0.get_get_pop_info_list()))),U.mapi(function(gr,gs){var gt;gt=K.TryFind(gr,gb);return gt==null?gs:gs+gt.$0;},gq)):gq),f8+gm];}else return[f6,f7,f8];};}fB=this;fC=this.simulator;fD=this.reactions;fE=fC.settings;fF=fC.populations;fG=fE["final"];fH=fE.times.$!==0?[fE.times,A.map(function(f6){return f6.target=="OutputPoint"?cT.New(A.max(fE.times)+1,f6.target):f6;},A.filter(f2,fC.events))]:(fI=fE.initial,(fJ=fE.get_print_interval(),(fK=A.init(fE.points+1,function(f6){return fI+f6*fJ;}),(fL=A.filter(f2,fC.events),[A.sort(A.append(fK,A.collect(function(f6){return f6.target=="OutputPoint"?B.Empty:A.ofArray([f6.time-1E-08,f6.time]);},fL))),fL]))));fM=fH[0];fN=U.ofList(fM);fO=fF.get_get_count();fP=U.length(this.plots);fQ=A.filter(function(f6){return f6.rate.$==0;},fD);fR=U.ofList(A.map(function(f6){var f7;f7=f6.rate;return f7.$==0?f7.$0:F.FailWith("Unexpected reaction type");},fQ));fS=A.length(fQ);fT=F.range(0,fO-1);fU=U.ofSeq(bc.collect(function(f6){return bc.map(function(f7){return f3(f7,f6);},fT);},fQ));fV=U.create(fO*fS,0);A.iteri(function(f6,f7){return b$.iterm(function(f8){U.set(fV,fO*f6+f8.element,f8.multiplicity);},f7.reactants);},fQ);fW=A.filter(function(f6){return f6.rate.$==1;},fD);fX=A.length(fW);fY=U.ofSeq(bc.collect(function(f6){return bc.map(function(f7){return f3(f7,f6);},fT);},fW));fZ=U.create(fX,null);A.iteri(function(f6,f7){var f8;f8=f7.rate;return f8.$==1?U.set(fZ,f6,f8.$0):F.FailWith("Unexpected reaction type");},fW);f0=U.init(fP,function(){return[];});f1=U.map(R.to_lambda,this.plots);bc.fold(function(f6,f7){return(function(f8){return f5(f8[0],f8[1],f8[2]);}(f6))(f7);},[fE.initial,this.concs,0],fH[1]);return Z.from_array_columns(fM,U.ofSeq(bc.map(U.ofSeq,f0)),A.map(Q.to_string_plot,fE.plots));}},null,_0);_0.New=function(fB,fC,fD,fE,fF){return new _0({simulator:fB,plots:fC,reactions:fD,settings:fE,concs:fF});};_1.get_to_string=function(fB){return fB=="Sundials"?"sundials":fB=="SSA"?"stochastic":fB=="CME"?"cme":fB=="CMESundials"?"cmesundials":fB=="LNA"?"lna":fB=="PDE"?"pde":fB=="MC"?"mc":"deterministic";};_1.shouldPrint=function(fB,fC,fD,fE,fF,fG){return fF||(fC>=fD||fC>=fB||fE!=null);};_1.shouldStop=function(fB,fC,fD,fE,fF){return fC>=fB||fE[0]||fF!=null&&fF.$==1&&fD>=fF.$0;};_1.plot_label=function(fB,fC,fD){var fE,fF,fG,fH,fI;fF="Concentration ("+fD.concentration.get_to_string()+")";fG="Individuals";fH="Distance ("+fD.space.get_to_string()+")";fI="Time ("+fD.time.get_to_string()+")";switch(fB=="Sundials"?1:fB=="SSA"?2:fB=="CME"?3:fB=="CMESundials"?3:fB=="LNA"?4:fB=="PDE"?5:fB=="MC"?6:0){case 0:return[fI,fF];case 1:return[fI,fF];case 2:return[fI,fG];case 3:return[fI,fG];case 4:return[fI,fG];case 5:return fC===1?[fH,fI]:[fH,fH];case 6:return[fI,fG];}};_1.get_defaults=function(){return"SSA";};_1.get_parse=function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ;fB=D.choice([(fC=D.kw("deterministic"),function(fK){return dz.op_GreaterGreaterPercent(fC,"Oslo",fK[0],fK[1]);}),(fD=D.kw("stochastic"),function(fK){return dz.op_GreaterGreaterPercent(fD,"SSA",fK[0],fK[1]);}),(fE=D.kw("lna"),function(fK){return dz.op_GreaterGreaterPercent(fE,"LNA",fK[0],fK[1]);}),(fF=D.kw("cme"),function(fK){return dz.op_GreaterGreaterPercent(fF,"CME",fK[0],fK[1]);}),(fG=D.kw("cmesundials"),function(fK){return dz.op_GreaterGreaterPercent(fG,"CMESundials",fK[0],fK[1]);}),(fH=D.kw("sundials"),function(fK){return dz.op_GreaterGreaterPercent(fH,"Sundials",fK[0],fK[1]);}),(fI=D.kw("pde"),function(fK){return dz.op_GreaterGreaterPercent(fI,"PDE",fK[0],fK[1]);}),(fJ=D.kw("mc"),function(fK){return dz.op_GreaterGreaterPercent(fJ,"MC",fK[0],fK[1]);})]);return function(fK){return fB([fK[0],fK[1]]);};};_2.toSafe=function(fB){return fB==null?"":fB;};_2.prettyPrint=function(fB){var fC,fD;function fE(fF,fG){return fF+" = "+_2.prettyPrint(fG);}return fB===null?"null":(fC=typeof fB,fC=="string"?"\\""+fB+"\\"":fC=="object"?fB instanceof a.Array?"[|"+dk.concat("; ",U.map(_2.prettyPrint,fB))+"|]":(fD=a.String(fB),fD==="[object Object]"?"{"+dk.concat("; ",U.map(function(fF){return fE(fF[0],fF[1]);},dj.GetFields(fB)))+"}":fD):a.String(fB));};_2.printArray=function(fB,fC){return fC===null?"null":"[|"+dk.concat("; ",U.map(fB,fC))+"|]";};_3=d.Calculus=fu.Class({to_ctmc:function(fB,fC,fD,fE,fF){var fG,fH,fI,fJ;function fK(fP){return fF.index.from_species.get_Item(fP);}function fL(fP,fQ){return[fD,[fP,fQ],fE];}function fM(fP,fQ){var fR,fS;fR=b$.to_map(fP.reactants);fS=b$.to_map(fP.products);return K.Fold(function(fT,fU,fV){var fW;fW=K.TryFind(fU,fT);return fW==null?fT.Add(fU,fV):fT.Add(fU,fW.$0+fV);},K.Fold(function(fT,fU,fV){var fW;fW=fT.get_Item(fU)-fV;return fW===0?fT.Remove(fU):fT.Add(fU,fW);},fQ,fR),fS);}function fN(fP,fQ){var fR;fR=K.TryFind(fQ,fP);return fR!=null&&fR.$==1?fR.$0>0:true;}function fO(fP,fQ,fR){var fS;fS=_9.containsKey(fH,fQ);_9.add(fG,fP,new B({$:1,$0:ba.New(fS?_9.find(fH,fQ):(_9.add(fG,fQ,B.Empty),_9.add(fH,fQ,fQ),fQ),fR),$1:_9.find(fG,fP)}));return fS;}fG=_9.empty();fH=_9.empty();_9.add(fG,fD,B.Empty);_9.add(fH,fD,fD);fI=cS.map((fJ=function(fP){return co.map(fK,fP);},function(fP){return R.map(fJ,fP);}),fB);(function(fP){var fQ,fR,fS,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6;function fT(f7,f8){return function(f9){var f_;f_=(fF.react_st(f8))(f9);return[A.append(f7,f_),A.ofSeq(bc.distinct(A.append(new B({$:1,$0:f9,$1:f8}),_.get_all_product_species(f_))))];};}while(true){if(fP.$==1){fU=fP.$1;fV=fP.$0[0];fW=fP.$0[1][0];fX=fP.$0[1][1];fY=fP.$0[2];fZ=fM(fW,fV);f0=fO(fV,fZ,fX);if(f0)fP=fU;else{f1=A.ofSeq(bc.distinct((fQ=_.get_product_species(fW),(function(f7){return function(f8){return A.filter(f7,f8);};}(function(f7){return fN(fV,f7);}))(fQ))));f2=A.ofSeq((fR=K.ToSeq(fV),(function(f7){return function(f8){return bc.map(f7,f8);};}(function(f7){return f7[0];}))(fR)));f3=(function(f7,f8){return function(f9){return bc.fold(function(f_,f$){return(f7(f_))(f$);},f8,f9);};}(function(f7){return fT(f7[0],f7[1]);},[B.Empty,f2]))(f1);f4=A.ofSeq(bc.distinct(A.append(f3[0],fY)));f5=(fS=(function(f7){return function(f8){return A.map(f7,f8);};}(function(f7){return function(f8){return[f8,_.calculate_reaction_prop(fC,f7,f8,fI)];};}(fZ)))(f4),(function(f7){return function(f8){return A.filter(f7,f8);};}(function(f7){return _.nonzero_prop(f7[0],f7[1]);}))(fS));f6=(function(f7){return function(f8){return A.map(f7,f8);};}(function(f7,f8){return function(f9){return[f7,[f9[0],f9[1]],f8];};}(fZ,f4)))(f5);fP=A.append(fU,f6);}}else return null;}}(A.map(function(fP){return fL(fP[0],fP[1]);},A.filter(function(fP){return _.nonzero_prop(fP[0],fP[1]);},A.map(function(fP){return[fP,_.calculate_reaction_prop(fC,fD,fP,fI)];},fE)))));return{ctmc:_.New(fG,fD),to_species:fF.index.to_species};},initialise_ctmc:function(fB){var fC,fD,fE;function fF(fI){return fI[1];}function fG(fI){return 0<fI;}function fH(fI,fJ){return function(fK){var fL;fL=(fD.react_st(fJ))(fK);return[A.distinct(A.append(fI,fL)),A.distinct(A.append(new B({$:1,$0:fK,$1:fJ}),_.get_all_product_species(fL)))];};}fC=A.map(function(fI){return fI[1];},fB);fD=this.get_adapt();fE=fD.init(A.map(function(fI){return fI[0];},fB));return[K.OfArray(U.ofSeq(A.filter(function(fI){return fG(fF(fI));},A.zip(fE,fC)))),(bc.fold(function(fI,fJ){return(function(fK){return fH(fK[0],fK[1]);}(fI))(fJ);},[B.Empty,B.Empty],fE))[0],fD];},get_adapt:function(){var fB,fC;function fD(fF,fG){var fH,fI,fJ,fK;function fL(fN){return eh.index(fC,fN);}function fM(fN){return co.map(fL,fN);}fH=A.map(function(fN){return U.get(fC.to_species,fN);},fF);fI=U.get(fC.to_species,fG);fJ=(fB.react(fH))(fI);A.map(function(fN){return eh.index(fC,fN);},_.get_all_product_species(fJ));return A.map((fK=function(fN){return R.map(fM,fN);},function(fN){return cc.map(fL,a.id,fK,fN);}),fJ);}function fE(fF){return eh.add(fC,fF);}fB=this;fC=eh.empty();return ei.New(function(fF){return A.map(fE,fF);},function(fF){return function(fG){return fD(fF,fG);};},fC);}},null,_3);_3.New=function(fB){return new _3({react:fB});};_4=d.Lna=fu.Class({simulate_callback:function(fB,fC){var fD,fE,fF,fG,fH,fI;function fJ(fM){return[c2.array(fM,{$:1,$0:0},{$:1,$0:fG-1}),c2.array(fM,{$:1,$0:fG},{$:1,$0:2*fG-1}),U.init(fG,function(fN){return c2.array(fM,{$:1,$0:(2+fN)*fG},{$:1,$0:(3+fN)*fG-1});})];}function fK(fM,fN){var fO,fP,fQ,fR,fS,fT,fU,fV;fO=fJ(cL.toArray(fN));fP=cL.ofArray(fO[0]);fQ=cL.ofArray(fO[1]);fR=cO.ofArray(fO[2]);fS=(fD.props(fM))(fP);fT=fD.drift(fS);fU=fD.jacobian(fP);fV=cO.add(cO.add(cO.matrMultMatr(fU,fR),cO.matrMultMatr(fR,_4.OsloTranspose(fU))),fT);return cL.ofArray(U.concat(A.ofArray([cL.toArray(cO.matrMultVec(cO.ofArray(fD.stoich),fS)),cL.toArray(cO.matrMultVec(fU,fQ)),U.collect(function(fW){return cL.toArray(fV.get_Item(fW));},U.ofSeq(F.range(0,fG-1)))])));}function fL(fM,fN){function fO(fQ){return fN[fQ];}function fP(fQ){var fR;fR=fN[2*fG+fQ*(fG+1)];return fR<0?0:fv.sqrt(fR);}return U.map(function(fQ){function fR(fS,fT){return fT.$==0?fS(fT.$0):fM;}return fD.outputconcentrations?cw.create(R["eval"](function(fS){return fR(fO,fS);},fQ),R["eval"](function(fS){return fR(fP,fS);},fQ)/fF):cw.create(fE*R["eval"](function(fS){return fR(fO,fS);},fQ),R["eval"](function(fS){return fR(fP,fS);},fQ)*fF);},fD.ode.plots);}fD=this;fE=this.scale;fF=fv.sqrt(fE);A.exists(function(fM){return fM.target!="OutputPoint";},this.ode.simulator.events)?F.FailWith("Events not supported for LNA integration"):void 0;fG=U.length(this.initials);fH=cL.ofArray(this.initials.concat(U.create(fG+fG*fG,0)));return _4.New((fI=this.ode,X.New(fI.name,cI.simulate_callback(fB,fC,cI.create(this.ode.name,this.ode.simulator,function(fM){return function(fN){return fL(fM,fN);};},fu.Curried(cw.interpolate,5),this.ode.settings,fH,function(fM){return function(fN){return fK(fM,fN);};})).simulator,fI.plots,fI.settings,fI.stoich,fI.powers,fI.rateDs,fI.concs)),this.outputconcentrations,this.initials,this.stoich,this.covariance,this.times,this.nextprinttime,this.jacobian,this.drift,this.props,this.stepsdone,this.scale);}},null,_4);_4.OsloTranspose=function(fB){var fC,fD,fE,fF,fG,fH,fI;fC=cO.numCols(fB);fD=cO.numRows(fB);fE=cO.zeros(fC,fD);for(fF=0,fG=fD-1;fF<=fG;fF++){for(fH=0,fI=fC-1;fH<=fI;fH++)(fE.get_Item(fH))[fF]=(fB.get_Item(fF))[fH];}return fE;};_4.initialise=function(fB,fC,fD,fE){var fF,fG;function fH(fK){return fK.$==1?F.FailWith("Functional rates not yet implemented"):fK.$0;}function fI(fK){return U.mapi(function(fL,fM){return U.map(function(fN){var fO;function fP(fQ,fR){return fQ===fN;}return A.exists(function(fQ){return fP(fQ[0],fQ[1]);},U.get(fB.powers,fL))?(fO=U.get(fB.powers,fL),bc.fold(function(fQ,fR){var fS,fT;fS=fR[0];fT=fR[1];return fS===fN?fQ*fT*fv.pow(fK[fS],fT-1):fQ*fv.pow(fK[fS],fT);},fH(fM),fO)):0;},U.ofSeq(F.range(0,fF-1)));},fB.rateDs);}function fJ(fK,fL){var fM,fN,fO,fP;fM=new a.Float64Array(fG);for(fN=0,fO=fG-1;fN<=fO;fN++){fM[fN]=(fP=U.get(fB.rateDs,fN),fP.$==1?fP.$0.$0(function(fQ){return fQ.$==1?fK:fL[fQ.$0];}):bc.fold(function(fQ,fR){return fQ*fv.pow(fL[fR[0]],fR[1]);},fP.$0,U.get(fB.powers,fN)));}return fM;}fF=fC.length;fG=U.get(fC,0).length;return _4.New(fB,true,fD,fC,cO.zeros(0,0),B.Empty,0,function(fK){var fL;fL=fI(fK);return cO.matrMultMatr(cO.ofArray(fC),cO.ofArray(fL));},function(fK){return U.reduce(cO.add,U.mapi(function(fL){var fM;fM=cO.copyCol(fB.stoich,fL);return cO.matrMultScal(_4.CrossProduct(fM,fM),fK[fL]);},U.ofSeq(F.range(0,fG-1))));},function(fK){return function(fL){return fJ(fK,fL);};},0,fE);};_4.CrossProduct=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;fD=fB.length;fE=fC.length;fF=cO.zeros(fD,fE);for(fG=0,fH=fD-1;fG<=fH;fG++){for(fI=0,fJ=fE-1;fI<=fJ;fI++){fK=fB[fG]*fC[fI];(U.get(fF.MatrixData,fG))[fI]=fK;}}return fF;};_4.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM){return new _4({ode:fB,outputconcentrations:fC,initials:fD,stoich:fE,covariance:fF,times:fG,nextprinttime:fH,jacobian:fI,drift:fJ,props:fK,stepsdone:fL,scale:fM});};_5.simulate_1d_callback=function(fB,fC,fD){var fE,fF,fG,fH;function fI(fK,fL){function fM(fN,fO){return fO.$==1?fK:U.get(U.get(fL,fN),fO.$0);}return U.map(function(fN){return U.init(fF.nx,function(fO){return R["eval"](function(fP){return fM(fO,fP);},fN);});},fG);}function fJ(fK){return cv.New(fK.t,fI(fK.t,fK.u));}fE=_5.inline_parameters(fD);fF=fE[1];fG=fE[2];fH=fE[0];bc.iter(function(fK){return fC(fJ(fK));},fD.settings.boundary=="ZeroFlux"?c4.neumann_solve(fD.sim_settings.initial,_5.generate_initialconditions1d(fD.rng,fD.settings,fD.populations.index_to_species),function(fK,fL){return(fH(fK))(fL);},fF,1):c4.periodic_solve(fD.sim_settings.initial,_5.generate_initialconditions1d(fD.rng,fD.settings,fD.populations.index_to_species),function(fK,fL){return(fH(fK))(fL);},fF));};_5.simulate_2d_callback=function(fB,fC,fD){var fE,fF,fG,fH;function fI(fJ,fK){return U.map(function(fL){return U.init(fF.nx,function(fM){return U.init(fF.nx,function(fN){var fO;function fP(fQ){return fQ.$==1?fJ:U.get(fO,fQ.$0);}fO=U.get(U.get(fK,fM),fN);return R["eval"](fP,fL);});});},fG);}fE=_5.inline_parameters(fD);fF=fE[1];fG=fE[2];fH=fE[0];bc.iter(fC,bc.map(function(fJ){return cv.New(fJ.t,fI(fJ.t,fJ.u));},fD.settings.boundary=="ZeroFlux"?c8.neumann_solve(fD.sim_settings.initial,_5.generate_initialconditions2d(fD.rng,fD.settings,fD.populations.index_to_species),function(fJ,fK){return(fH(fJ))(fK);},fF):c8.periodic_solve(fD.sim_settings.initial,_5.generate_initialconditions2d(fD.rng,fD.settings,fD.populations.index_to_species),function(fJ,fK){return(fH(fJ))(fK);},fF)));};_5.accumulator_1d=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK;function fL(fM,fN){return(_5.perturb(fB,fI.random))(fN);}fE=A.partition(function(fM){return fM.spatial!=null;},A.ofSeq(fD));fF=fE[0];fG=bc.sumBy(function(fM){return fM.value;},fE[1]);fH=U.init(fC,function(fM){return[fM/(fC-1),fG];});return fF.$==1?fF.$1.$==0?(fI=fF.$0.spatial.$0,U.map(function(fM){return fL(fM[0],fM[1]);},A.foldBack(function(fM,fN){return U.map(function(fO){return fM.apply1d(fO[0],fO[1]);},fN);},fI.rectangles,A.foldBack(function(fM,fN){return U.map(function(fO){return fM.apply1d(fO[0],fO[1]);},fN);},fI.points,(fJ=fI.core,fJ==null?fH:(fK=fJ.$0,U.map(function(fM){return fK.apply1d(fM[0],fM[1]);},fH))))))):F.FailWith("Received more than one spatial initial condition for species _"):U.map(function(fM){return fM[1];},fH);};_5.inline_parameters=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL;function fM(fT){var fU;function fV(fW){var fX;fX=fB.populations.tryFind_index(fW);return fX==null?(function(fY){return function(fZ){return fY("Could not locate species "+_2.toSafe(fZ));};}(F.FailWith))(fW.name):fX.$0;}fU=function(fW){return cY.map(fV,fW);};return function(fW){return R.map(fU,fW);};}function fN(fT){return co.eval_massaction(fC,fT);}function fO(fT){return co.eval_function(fC,fD,fT);}function fP(fT){return fT.map(a.id,function(fU){return fU.get_key();});}function fQ(fT){return fT.$==2?{$:1,$0:fT.$0}:fT.$==1?F.FailWith("Not implemented yet"):null;}function fR(fT){return bc.findIndex(function(fU){return bk.Equals(fU,fT);},fG);}function fS(fT){return co.inline_keys(fC,fD,fT);}fC=bF.to_env(fB.settings.parameters);fD=K.Map(function(fT,fU){return(fM(fT))(fU);},co.inline_rates_env(fC,fB.rateExpressions));fE=_5.reaction_term(fB.stoich,fB.powers,U.map((fF=function(fT){return cb.map2(fN,fO,fT);},function(fT){return fP(fF(fT));}),fB.rates));fG=A.distinct(A.collect((fH=function(fT){return A.choose(fQ,fT);},function(fT){return fH(R.mentions(fT));}),fB.sim_settings.plots));fI=U.ofList(A.map((fJ=(fK=(fL=function(fT){return co.map(fR,fT);},function(fT){return fS(fL(fT));}),function(fT){return R.expand(fK,fT);}),function(fT){return R.simplify(fJ(fT));}),fB.sim_settings.plots));return[fE,_5.map_settings(fC,A.map(fB.species_index,fG),fB),fI];};_5.generate_initialconditions1d=function(fB,fC,fD){var fE,fF,fG;fE=(fF=fC.random,fF>0?function(fH){return fH*(1+fF*(fB.NextDouble()-0.5));}:a.id);fG=U.map(function(fH){return U.map(fE,fH.value);},fD);return U.init(fC.nx,function(fH){return U.init(U.length(fD),function(fI){return U.get(U.get(fG,fI),fH);});});};_5.accumulator_2d=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN;function fO(fR,fS){return fL.apply2d(fR,fS);}function fP(fR){return fR[1];}function fQ(fR){return fR[1];}fE=A.partition(function(fR){return fR.spatial!=null;},A.ofSeq(fD));fF=fE[0];fG=bc.sumBy(function(fR){return fR.value;},fE[1]);fH=U.init(fC,function(fR){return U.init(fC,function(fS){return[[fR/(fC-1),fS/(fC-1)],fG];});});return fF.$==1?fF.$1.$==0?(fI=fF.$0.spatial.$0,(fJ=A.foldBack(function(fR,fS){function fT(fU,fV){return fR.apply2d(fU,fV);}return U.map(function(fU){return U.map(function(fV){return fT(fV[0],fV[1]);},fU);},fS);},fI.rectangles,A.foldBack(function(fR,fS){function fT(fU,fV){return fR.apply2d(fU,fV);}return U.map(function(fU){return U.map(function(fV){return fT(fV[0],fV[1]);},fU);},fS);},fI.points,(fK=fI.core,fK==null?fH:(fL=fK.$0,U.map(function(fR){return U.map(function(fS){return fO(fS[0],fS[1]);},fR);},fH))))),U.map((fM=(fN=_5.perturb(fB,fI.random),function(fR){return fN(fP(fR));}),function(fR){return U.map(fM,fR);}),fJ))):F.FailWith("Received more than one spatial initial condition for species _"):U.map(function(fR){return U.map(fQ,fR);},fH);};_5.generate_initialconditions2d=function(fB,fC,fD){var fE,fF,fG;fE=(fF=fC.random,fF>0?function(fH){return fH*(1+fF*(fB.NextDouble()-0.5));}:a.id);fG=U.map(function(fH){return U.map(function(fI){return U.map(fE,fI);},fH.value);},fD);return U.init(fC.nx,function(fH){return U.init(fC.nx,function(fI){return U.init(U.length(fD),function(fJ){return U.get(U.get(U.get(fG,fJ),fH),fI);});});});};_5.perturb=function(fB,fC){return fC>0?function(fD){return fD*(1+fC*(fB.NextDouble()-0.5));}:a.id;};_5.create=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ){return _5.New(fB,function(fK){return fC.find_index(fK);},fC,fD,fE,cO.ofArray(fF),fG,fH,fI,fJ);};_5.map_settings=function(fB,fC,fD){var fE,fF,fG,fH,fI;fE=fD.settings;fF=fD.populations.get_get_count();fG=U.map(function(fJ){var fK;fK=K.TryFind({$:0,$0:{$:2,$0:fJ.species}},K.OfArray(U.ofSeq(fE.diffusibles)));return fK==null?fE.default_diffusion:R["eval"](function(fL){return di.find(fB,fL);},fK.$0);},fD.populations.index_to_species);fH=fE.xmax/(fE.nx-1);fI=fE.dt>0?fE.dt:0.2*fH*fH/U.max(fG);return c7.New(fF,F.toInt(fv.ceil((fD.sim_settings["final"]-fD.sim_settings.initial)/fI/fD.sim_settings.points)),fE.nx,0,fE.xmax,0,fE.xmax,fD.sim_settings["final"],fI,fG,U.ofList(fC));};_5.reaction_term=function(fB,fC,fD){var fE,fF,fG,fH,fI;function fJ(fL,fM){return fM===1?fL:fM===2?fL*fL:fv.pow(fL,fM);}function fK(fL,fM){var fO,fP,fQ;function fN(fR){return fR.$==1?fL:U.get(fM,fR.$0);}for(fO=0,fP=fD.length-1;fO<=fP;fO++){fE[fO]=(fQ=U.get(fD,fO),fQ.$==1?fQ.$0(fN):U.fold2(function(fR,fS,fT){return fR*fJ(U.get(fM,fS),fT);},fQ.$0,U.get(fH,fO),U.get(fI,fO)));}cO.matrMultVecStore(fB,fE,fF);return fF;}fE=cL.ofArray(new a.Float64Array(fD.length));fF=new a.Float64Array(cO.numRows(fB));fG=U.map(U.ofList,fC);fH=U.map(function(fL){return U.map(function(fM){return fM[0];},fL);},fG);fI=U.map(function(fL){return U.map(function(fM){return fM[1];},fL);},fG);return function(fL){return function(fM){return fK(fL,fM);};};};_5.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK){return{name:fB,species_index:fC,populations:fD,sim_settings:fE,settings:fF,stoich:fG,powers:fH,rates:fI,rateExpressions:fJ,rng:fK};};_6.map=function(fB,fC){function fD(fE,fF){return[fB(fE),fF];}return _6.New(fC.parameters,A.map(function(fE){return fD(fE[0],fE[1]);},fC.diffusibles),fC.dimensions,fC.boundary,fC.xmax,fC.nx,fC.dt,fC.default_diffusion,fC.random);};_6.to_string=function(fB,fC){var fD,fE;fD=_6.get_defaults();fE=dk.concat("; ",A.choose(a.id,A.ofArray([fC.dimensions===fD.dimensions?null:{$:1,$0:(function(fF){return function(fG){return fF("dimensions = "+a.String(fG));};}(a.id))(fC.dimensions)},bk.Equals(fC.boundary,fD.boundary)?null:{$:1,$0:(function(fF){return function(fG){return fF("boundary = "+_2.toSafe(fG));};}(a.id))(a.String(fC.boundary))},fC.diffusibles.$==0?null:{$:1,$0:(function(fF){return function(fG){return fF("diffusibles = ["+_2.toSafe(fG)+"]");};}(a.id))(_6.diffusibles_to_string(fB,fC.diffusibles))},fC.default_diffusion===fD.default_diffusion?null:{$:1,$0:(function(fF){return function(fG){return fF("default_diffusion = "+_2.toSafe(fG));};}(a.id))(a.String(fC.default_diffusion))},fC.xmax===fD.xmax?null:{$:1,$0:(function(fF){return function(fG){return fF("xmax = "+_2.toSafe(fG));};}(a.id))(a.String(fC.xmax))},fC.nx===fD.nx?null:{$:1,$0:(function(fF){return function(fG){return fF("nx = "+a.String(fG));};}(a.id))(fC.nx)},fC.dt===fD.dt?null:{$:1,$0:(function(fF){return function(fG){return fF("dt = "+_2.toSafe(fG));};}(a.id))(a.String(fC.dt))},fC.random===fD.random?null:{$:1,$0:(function(fF){return function(fG){return fF("random = "+_2.toSafe(fG));};}(a.id))(a.String(fC.random))}])));return(function(fF){return function(fG){return fF("{ "+_2.toSafe(fG)+" }");};}(a.id))(fE);};_6.get_defaults=function(){return _6.New(B.Empty,B.Empty,1,"Periodic",1,20,0,0,0);};_6.diffusibles_to_string=function(fB,fC){function fD(fE,fF){return(((fu.Curried3(function(fG,fH,fI){return fG(_2.toSafe(fH)+"="+_2.toSafe(fI));}))(a.id))(fB(fE)))(R.to_string(a.id,fF));}return dk.concat("; ",A.map(function(fE){return fD(fE[0],fE[1]);},fC));};_6.get_parse=function(){var fB;fB=_6.get_defaults();return function(fC){return _6.parse_defaults(fB,fC);};};_6.parse_defaults=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ;function fK(fV,fW){return dz.op_DotGreaterGreater(D.pint32(),D.spaces(),fV,fW);}function fL(fV,fW){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),fV,fW);}function fM(fV,fW){return _6.New(fW.parameters,fV,fW.dimensions,fW.boundary,fW.xmax,fW.nx,fW.dt,fW.default_diffusion,fW.random);}function fN(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fW.dimensions,fW.boundary,fW.xmax,fW.nx,fW.dt,fV,fW.random);}function fO(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fV,fW.boundary,fW.xmax,fW.nx,fW.dt,fW.default_diffusion,fW.random);}function fP(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fW.dimensions,fW.boundary,fW.xmax,fW.nx,fW.dt,fW.default_diffusion,fV);}function fQ(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fW.dimensions,fW.boundary,fV,fW.nx,fW.dt,fW.default_diffusion,fW.random);}function fR(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fW.dimensions,fW.boundary,fW.xmax,fV,fW.dt,fW.default_diffusion,fW.random);}function fS(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fW.dimensions,fW.boundary,fW.xmax,fW.nx,fV,fW.default_diffusion,fW.random);}function fT(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fW.dimensions,"Periodic",fW.xmax,fW.nx,fW.dt,fW.default_diffusion,fW.random);}function fU(fV,fW){return _6.New(fW.parameters,fW.diffusibles,fW.dimensions,"ZeroFlux",fW.xmax,fW.nx,fW.dt,fW.default_diffusion,fW.random);}return D.record(fB,A.ofArray([["diffusibles",(fD=D.list_of((fE=(fF=D.skw("="),(fG=R.parse(D.name()),function(fV){return dz.op_GreaterGreaterDot(fF,fG,fV[0],fV[1]);})),function(fV){return dz.op_DotGreaterGreaterDot(fC,fE,fV[0],fV[1]);})),function(fV){return dz.op_BarGreaterGreater(fD,function(fW){return function(fX){return fM(fW,fX);};},fV[0],fV[1]);})],["default_diffusion",function(fV){return dz.op_BarGreaterGreater(function(fW){return fL(fW[0],fW[1]);},function(fW){return function(fX){return fN(fW,fX);};},fV[0],fV[1]);}],["dimensions",function(fV){return dz.op_BarGreaterGreater(function(fW){return fK(fW[0],fW[1]);},function(fW){return function(fX){return fO(fW,fX);};},fV[0],fV[1]);}],["random",function(fV){return dz.op_BarGreaterGreater(function(fW){return fL(fW[0],fW[1]);},function(fW){return function(fX){return fP(fW,fX);};},fV[0],fV[1]);}],["xmax",function(fV){return dz.op_BarGreaterGreater(function(fW){return fL(fW[0],fW[1]);},function(fW){return function(fX){return fQ(fW,fX);};},fV[0],fV[1]);}],["nx",function(fV){return dz.op_BarGreaterGreater(function(fW){return fK(fW[0],fW[1]);},function(fW){return function(fX){return fR(fW,fX);};},fV[0],fV[1]);}],["dt",function(fV){return dz.op_BarGreaterGreater(function(fW){return fL(fW[0],fW[1]);},function(fW){return function(fX){return fS(fW,fX);};},fV[0],fV[1]);}],["boundary",(fH=D.choice([(fI=D.kw("Periodic"),function(fV){return dz.op_BarGreaterGreater(fI,function(fW){return function(fX){return fT(fW,fX);};},fV[0],fV[1]);}),(fJ=D.kw("ZeroFlux"),function(fV){return dz.op_BarGreaterGreater(fJ,function(fW){return function(fX){return fU(fW,fX);};},fV[0],fV[1]);})]),function(fV){return fH([fV[0],fV[1]]);})]]));};_6.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ){return{parameters:fB,diffusibles:fC,dimensions:fD,boundary:fE,xmax:fF,nx:fG,dt:fH,default_diffusion:fI,random:fJ};};_7.get_defaults=function(){return _7.New(1,null,1,null);};_7.to_string=function(fB){return _7.to_string_defaults(_7.get_defaults(),fB);};_7.to_string_defaults=function(fB,fC){function fD(fF,fG){return fG!=null&&fG.$==1?(function(fH){return function(fI){return fH("name = "+a.String(fI)+"; ");};}(a.id))(fG.$0):"";}function fE(fF,fG){return fG!=null&&fG.$==1?(function(fH){return function(fI){return fH("name = "+fI.toFixed(6));};}(a.id))(fG.$0):"";}return db.emit_record(fB,A.ofArray([["scale",function(fF){return a.String(fF.scale);}],["steps",function(fF){return fD("steps",fF.steps);}],["trajectories",function(fF){return a.String(fF.trajectories);}],["stationary_skiptime",function(fF){return fE("stationary_skiptime",fF.stationary_skiptime);}]]),fC);};_7.get_parse=function(){return _7.parse_defaults(_7.get_defaults());};_7.parse_defaults=function(fB){function fC(fG,fH){return _7.New(fG,fH.steps,fH.trajectories,fH.stationary_skiptime);}function fD(fG,fH){return _7.New(fH.scale,{$:1,$0:fG},fH.trajectories,fH.stationary_skiptime);}function fE(fG,fH){return _7.New(fH.scale,fH.steps,fG,fH.stationary_skiptime);}function fF(fG,fH){return _7.New(fH.scale,fH.steps,fH.trajectories,{$:1,$0:fG});}return D.record(fB,A.ofArray([["scale",function(fG){return dz.op_BarGreaterGreater(D.pfloat(),function(fH){return function(fI){return fC(fH,fI);};},fG[0],fG[1]);}],["steps",function(fG){return dz.op_BarGreaterGreater(D.pint32(),function(fH){return function(fI){return fD(fH,fI);};},fG[0],fG[1]);}],["trajectories",function(fG){return dz.op_BarGreaterGreater(D.pint32(),function(fH){return function(fI){return fE(fH,fI);};},fG[0],fG[1]);}],["stationary_skiptime",function(fG){return dz.op_BarGreaterGreater(D.pfloat(),function(fH){return function(fI){return fF(fH,fI);};},fG[0],fG[1]);}]]));};_7.New=function(fB,fC,fD,fE){return{scale:fB,steps:fC,trajectories:fD,stationary_skiptime:fE};};_8.New=function(fB,fC,fD){return{name:fB,structure:fC,svg:fD};};_9.empty=function(){return c$.New(new y.New([]));};_9.toSeq=function(fB){return K.ToSeq(fB.map);};_9.find=function(fB,fC){return fB.map.get_Item(fC);};_9.add=function(fB,fC,fD){fB.map=fB.map.Add(fC,fD);};_9.containsKey=function(fB,fC){return fB.map.ContainsKey(fC);};_9.count=function(fB){return fB.map.get_Count();};_9.keys=function(fB){return bc.map(function(fC){return a.id(fC[0],fC[1]);},K.ToSeq(fB.map));};_=d.Ctmc=fu.Class({statespace_for_CME_integration:function(fB,fC){var fD,fE,fF,fG,fH;function fI(fJ,fK){var fL;fL=K.TryFind(fK,fJ);return fL==null?0:fL.$0;}fD=_9.count(this.graph);fE=cO.zeros(fD,fC);fF=new a.Float64Array(fD);fG=K.OfArray(U.ofSeq(bc.mapi(function(fJ,fK){return[fK,fJ];},_9.keys(this.graph))));fF[fG.get_Item(this.initial_state)]=1;fH=new df.New(fD,fD);bc.iteri(function(fJ,fK){var fM,fN,fO,fP,fQ,fR,fS,fT,fU;function fL(fV,fW){var fX;fX=U.findIndex(function(fY){return fV===fY;},fN);U.set(fP,fX,U.get(fP,fX)+fW);}fM=bc.sortBy(function(fV){return fV[0];},bc.map(function(fV){return[fG.get_Item(fV.target),R["eval"](function(fW){return di.find(fB,fW);},fV.propensity)];},fK[1]));fN=U.ofSeq(bc.distinct(bc.map(function(fV){return fV[0];},fM)));fO=U.length(fN);fP=U.init(fO,function(){return 0;});bc.iter(function(fV){return fL(fV[0],fV[1]);},fM);fQ=U.sum(fP);fR=fQ===0?new es.New$1(fP,fN,fO):new es.New$1([-fQ].concat(fP),[fJ].concat(fN),1+fO);fH.set_Item(fJ,fR);for(fS=0,fT=fC-1;fS<=fT;fS++){fU=+fI(fK[0],fS);(U.get(fE.MatrixData,fJ))[fS]=fU;}},_9.toSeq(this.graph));return[fH,fE,fF];},statespace_for_CME_sundials:function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fM,fN){var fO;fO=K.TryFind(fN,fM);return fO==null?0:fO.$0;}fD=_9.count(this.graph);fE=cO.zeros(fD,fC);fF=K.OfArray(U.ofSeq(bc.mapi(function(fM,fN){return[fN,fM];},_9.keys(this.graph))));fG=fF.get_Item(this.initial_state);fH=U.init(fD,function(fM){return fM===fG?1:0;});fI=U.unzip3(U.ofSeq(bc.mapi(function(fM,fN){var fO,fP,fQ,fR,fS,fT,fU;fO=U.ofSeq(bc.sortBy(function(fV){return fV[0];},bc.map(function(fV){return[fF.get_Item(fV.target),R["eval"](function(fW){return di.find(fB,fW);},fV.propensity)];},fN[1])));fP=U.unzip(fO);fQ=fP[0];fR=U.create(fQ.length,fM);for(fS=0,fT=fC-1;fS<=fT;fS++){fU=+fL(fN[0],fS);(U.get(fE.MatrixData,fM))[fS]=fU;}return[fQ,fR,fP[1]];},_9.toSeq(this.graph))));fJ=fI[2];fK=U.map(U.sum,fJ);return[[U.concat(fJ),U.concat(fI[0]),U.concat(fI[1]),fK],fE,fH];}},null,_);_.calculate_reaction_prop=function(fB,fC,fD,fE){var fF,fI,fJ,fK,fL,fM;function fG(fN){var fO;fO=K.TryFind(fN,fC);return fO!=null&&fO.$==1?fO.$0:0;}function fH(fN){return fN.$==2?{$:1,$0:fG(fN.$0)}:fN.$==3?F.FailWith("Unexpected [time] in CTMC rate"):fN.$==1?R.expand(fH,fE.get_Item(fN.$0)):{$:0,$0:fN.$0};}fI=fD.rate;if(fI.$==1)return R.expand(fH,fI.$0);else{fJ=fI.$0;fK=b$.to_mlist(fD.reactants);switch(fK.$==1?fK.$0.multiplicity===1?fK.$1.$==1?fK.$1.$0.multiplicity===1?fK.$1.$1.$==0?(fF=[fK.$0.element,fK.$1.$0.element],4):(fF=fK,5):(fF=fK,5):(fF=fK.$0.element,1):fK.$0.multiplicity===2?fK.$1.$==0?(fF=fK.$0.element,2):(fF=fK,5):fK.$0.multiplicity===3?fK.$1.$==0?(fF=fK.$0.element,3):(fF=fK,5):(fF=fK,5):0){case 0:return fJ;case 1:return{$:2,$0:A.ofArray([fJ,{$:1,$0:fG(fF)}])};case 2:fL={$:1,$0:fG(fF)};return{$:2,$0:A.ofArray([fJ,fL,{$:6,$0:cr.New(fL,{$:1,$0:1})},{$:1,$0:0.5}])};case 3:fM={$:1,$0:fG(fF)};return{$:3,$0:ct.New({$:2,$0:A.ofArray([fJ,fM,{$:6,$0:cr.New(fM,{$:1,$0:1})},{$:6,$0:cr.New(fM,{$:1,$0:2})}])},{$:1,$0:6})};case 4:return{$:2,$0:A.ofArray([fJ,{$:1,$0:fG(fF[0])},{$:1,$0:fG(fF[1])}])};case 5:return db.fold_left(function(fN,fO){return{$:2,$0:A.ofArray([fN,{$:1,$0:db.binom(F.toInt(fG(fO.element)),fO.multiplicity)}])};},fJ,fF);}}};_.nonzero_prop=function(fB,fC){return!bk.Equals(R.simplify(fC),{$:1,$0:0});};_.get_all_product_species=function(fB){return A.collect(_.get_product_species,fB);};_.get_product_species=function(fB){return b$.elements(fB.products);};_.New=function(fB,fC){return new _({graph:fB,initial_state:fC});};$=x.List=fu.Class({GetEnumerator:function(){return da.Get(this);},GetEnumerator0:function(){return da.Get0(this);}},null,$);ba.New=function(fB,fC){return{target:fB,propensity:fC};};bb.of_list=function(fB){return db.fold_right(function(fC,fD){return(function(fE){var fF,fG;fF=fE[0];fG=fE[1];return function(fH){return bb.add(fF,fG,fH);};}(fC))(fD);},fB,bb.empty());};bb.find=function(fB,fC){return fC.get_Item(fB);};bb.add=function(fB,fC,fD){return fD.Add(fB,fC);};bb.empty=function(){dN.$cctor();return dN.empty;};bb.tryFind=function(fB,fC){return K.TryFind(fB,fC);};bb.fold=function(fB,fC,fD){return K.Fold(fB,fC,fD);};bc.map=function(fB,fC){return{GetEnumerator:function(){var fD;fD=da.Get(fC);return new dc.New(null,null,function(fE){return fD.MoveNext()&&(fE.c=fB(fD.Current()),true);},function(){fD.Dispose();});}};};bc.iter=function(fB,fC){var fD;fD=da.Get(fC);try{while(fD.MoveNext())fB(fD.Current());}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}};bc.choose=function(fB,fC){return bc.collect(function(fD){var fE;fE=fB(fD);return fE==null?B.Empty:A.ofArray([fE.$0]);},fC);};bc.head=function(fB){var fC;fC=da.Get(fB);try{return fC.MoveNext()?fC.Current():bc.insufficient();}finally{if(typeof fC=="object"&&"Dispose"in fC)fC.Dispose();}};bc.tryFind=function(fB,fC){var fD,fE,fF;fD=da.Get(fC);try{fE=null;while(fE==null&&fD.MoveNext()){fF=fD.Current();fB(fF)?fE={$:1,$0:fF}:void 0;}return fE;}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}};bc.collect=function(fB,fC){return bc.concat(bc.map(fB,fC));};bc.length=function(fB){var fC,fD;fC=0;fD=da.Get(fB);try{while(fD.MoveNext())fC=fC+1;return fC;}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}};bc.groupBy=function(fB,fC){return bc.delay(function(){return U.groupBy(fB,U.ofSeq(fC));});};bc.filter=function(fB,fC){return{GetEnumerator:function(){var fD;fD=da.Get(fC);return new dc.New(null,null,function(fE){var fF,fG,fH;fF=fD.MoveNext();fG=fD.Current();fH=false;while(fF)if(fB(fG)){fE.c=fG;fH=true;fF=false;}else if(fD.MoveNext())fG=fD.Current();else fF=false;return fH;},function(){fD.Dispose();});}};};bc.isEmpty=function(fB){var fC;fC=da.Get(fB);try{return!fC.MoveNext();}finally{if(typeof fC=="object"&&"Dispose"in fC)fC.Dispose();}};bc.fold=function(fB,fC,fD){var fE,fF;fE=fC;fF=da.Get(fD);try{while(fF.MoveNext())fE=fB(fE,fF.Current());return fE;}finally{if(typeof fF=="object"&&"Dispose"in fF)fF.Dispose();}};bc.scan=function(fB,fC,fD){return{GetEnumerator:function(){var fE;fE=da.Get(fD);return new dc.New(false,null,function(fF){return fF.s?fE.MoveNext()&&(fF.c=fB(fF.c,fE.Current()),true):(fF.c=fC,fF.s=true,true);},function(){fE.Dispose();});}};};bc.distinct=function(fB){return bc.distinctBy(a.id,fB);};bc.concat=function(fB){return{GetEnumerator:function(){var fC;fC=da.Get(fB);return new dc.New(null,null,function(fD){var fE;while(true){fE=fD.s;if(bk.Equals(fE,null)){if(fC.MoveNext()){fD.s=da.Get(fC.Current());fD=fD;}else{fC.Dispose();return false;}}else if(fE.MoveNext()){fD.c=fE.Current();return true;}else{fD.Dispose();fD.s=null;fD=fD;}}},function(fD){var fE;fE=fD.s;!bk.Equals(fE,null)?fE.Dispose():void 0;!bk.Equals(fC,null)?fC.Dispose():void 0;});}};};bc.sumBy=function(fB,fC){return bc.fold(function(fD,fE){return fD+fB(fE);},0,fC);};bc.init=function(fB,fC){return bc.take(fB,bc.initInfinite(fC));};bc.map2=function(fB,fC,fD){return{GetEnumerator:function(){var fE,fF;fE=da.Get(fC);fF=da.Get(fD);return new dc.New(null,null,function(fG){return fE.MoveNext()&&fF.MoveNext()&&(fG.c=fB(fE.Current(),fF.Current()),true);},function(){fE.Dispose();fF.Dispose();});}};};bc.exists=function(fB,fC){var fD,fE;fD=da.Get(fC);try{fE=false;while(!fE&&fD.MoveNext())fE=fB(fD.Current());return fE;}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}};bc.delay=function(fB){return{GetEnumerator:function(){return da.Get(fB());}};};bc.append=function(fB,fC){return{GetEnumerator:function(){var fD,fE;fD=da.Get(fB);fE=[true];return new dc.New(fD,null,function(fF){var fG;return fF.s.MoveNext()?(fF.c=fF.s.Current(),true):(fG=fF.s,!bk.Equals(fG,null)?fG.Dispose():void 0,fF.s=null,fE[0]&&(fE[0]=false,fF.s=da.Get(fC),fF.s.MoveNext()?(fF.c=fF.s.Current(),true):(fF.s.Dispose(),fF.s=null,false)));},function(fF){var fG;fG=fF.s;!bk.Equals(fG,null)?fG.Dispose():void 0;});}};};bc.find=function(fB,fC){var fD;fD=bc.tryFind(fB,fC);return fD==null?F.FailWith("KeyNotFoundException"):fD.$0;};bc.sum=function(fB){return bc.fold(function(fC,fD){return fC+fD;},0,fB);};bc.skip=function(fB,fC){return{GetEnumerator:function(){var fD;fD=da.Get(fC);return new dc.New(true,null,function(fE){var fF,fG;if(fE.s){for(fF=1,fG=fB;fF<=fG;fF++)if(!fD.MoveNext())bc.insufficient();fE.s=false;}else null;return fD.MoveNext()&&(fE.c=fD.Current(),true);},function(){fD.Dispose();});}};};bc.unfold=function(fB,fC){return{GetEnumerator:function(){return new dc.New(fC,null,function(fD){var fE;fE=fB(fD.s);return fE==null?false:(fD.c=fE.$0[0],fD.s=fE.$0[1],true);},void 0);}};};bc.distinctBy=function(fB,fC){return{GetEnumerator:function(){var fD,fE;fD=da.Get(fC);fE=new e1.New$3();return new dc.New(null,null,function(fF){var fG,fH;if(fD.MoveNext()){fG=fD.Current();fH=fE.Add(fB(fG));while(!fH&&fD.MoveNext()){fG=fD.Current();fH=fE.Add(fB(fG));}return fH&&(fF.c=fG,true);}else return false;},function(){fD.Dispose();});}};};bc.take=function(fB,fC){fB<0?bc.nonNegative():void 0;return{GetEnumerator:function(){var fD;fD=[da.Get(fC)];return new dc.New(0,null,function(fE){var fF;fE.s=fE.s+1;return fE.s>fB?false:(fF=fD[0],bk.Equals(fF,null)?bc.insufficient():fF.MoveNext()?(fE.c=fF.Current(),fE.s===fB?(fF.Dispose(),fD[0]=null):void 0,true):(fF.Dispose(),fD[0]=null,bc.insufficient()));},function(){var fE;fE=fD[0];!bk.Equals(fE,null)?fE.Dispose():void 0;});}};};bc.initInfinite=function(fB){return{GetEnumerator:function(){return new dc.New(0,null,function(fC){fC.c=fB(fC.s);fC.s=fC.s+1;return true;},void 0);}};};bc.mapi=function(fB,fC){return bc.map2(fB,bc.initInfinite(a.id),fC);};bc.iteri=function(fB,fC){var fD,fE;fD=0;fE=da.Get(fC);try{while(fE.MoveNext()){fB(fD,fE.Current());fD=fD+1;}}finally{if(typeof fE=="object"&&"Dispose"in fE)fE.Dispose();}};bc.sortBy=function(fB,fC){return bc.delay(function(){var fD;fD=U.ofSeq(fC);U.sortInPlaceBy(fB,fD);return fD;});};bc.findIndex=function(fB,fC){var fD;fD=bc.tryFindIndex(fB,fC);return fD==null?F.FailWith("KeyNotFoundException"):fD.$0;};bc.rev=function(fB){return bc.delay(function(){return U.ofSeq(fB).slice().reverse();});};bc.forall2=function(fB,fC,fD){return!bc.exists2(function(fE,fF){return!fB(fE,fF);},fC,fD);};bc.tryFindIndex=function(fB,fC){var fD,fE,fF;fD=da.Get(fC);try{fE=true;fF=0;while(fE&&fD.MoveNext())if(fB(fD.Current()))fE=false;else fF=fF+1;return fE?null:{$:1,$0:fF};}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}};bc.takeWhile=function(fB,fC){return bc.delay(function(){return bc.enumUsing(da.Get(fC),function(fD){return bc.enumWhile(function(){return fD.MoveNext()&&fB(fD.Current());},bc.delay(function(){return[fD.Current()];}));});});};bc.exists2=function(fB,fC,fD){var fE,fF,fG,fH;fE=da.Get(fC);try{fG=da.Get(fD);try{fH=false;while(!fH&&fE.MoveNext()&&fG.MoveNext())fH=fB(fE.Current(),fG.Current());fF=fH;}finally{if(typeof fG=="object"&&"Dispose"in fG)fG.Dispose();}return fF;}finally{if(typeof fE=="object"&&"Dispose"in fE)fE.Dispose();}};bc.compareWith=function(fB,fC,fD){var fE,fF,fG,fH,fI;fE=da.Get(fC);try{fG=da.Get(fD);try{fH=0;fI=true;while(fI&&fH===0)if(fE.MoveNext())fH=fG.MoveNext()?fB(fE.Current(),fG.Current()):1;else if(fG.MoveNext())fH=-1;else fI=false;fF=fH;}finally{if(typeof fG=="object"&&"Dispose"in fG)fG.Dispose();}return fF;}finally{if(typeof fE=="object"&&"Dispose"in fE)fE.Dispose();}};bc.nth=function(fB,fC){var fD,fE;if(fB<0)F.FailWith("negative index requested");fD=-1;fE=da.Get(fC);try{while(fD<fB){!fE.MoveNext()?bc.insufficient():void 0;fD=fD+1;}return fE.Current();}finally{if(typeof fE=="object"&&"Dispose"in fE)fE.Dispose();}};bc.min=function(fB){var fC,fD,fE;fC=da.Get(fB);try{if(!fC.MoveNext())bc.seqEmpty();fD=fC.Current();while(fC.MoveNext()){fE=fC.Current();bk.Compare(fE,fD)===-1?fD=fE:void 0;}return fD;}finally{if(typeof fC=="object"&&"Dispose"in fC)fC.Dispose();}};bc.max=function(fB){var fC,fD,fE;fC=da.Get(fB);try{if(!fC.MoveNext())bc.seqEmpty();fD=fC.Current();while(fC.MoveNext()){fE=fC.Current();bk.Compare(fE,fD)===1?fD=fE:void 0;}return fD;}finally{if(typeof fC=="object"&&"Dispose"in fC)fC.Dispose();}};bc.seqEmpty=function(){return F.FailWith("The input sequence was empty.");};bd=x.Dictionary=fu.Class({Add:function(fB,fC){this.add(fB,fC);},add:function(fB,fC){var fD,fE,fF;fD=this;fE=this.hash(fB);fF=this.data[fE];fF==null?(this.count=this.count+1,this.data[fE]=new a.Array({K:fB,V:fC})):(U.exists(function(fG){return fD.equals.apply(null,[(F.KeyValue(fG))[0],fB]);},fF)?dd.alreadyAdded():void 0,this.count=this.count+1,fF.push({K:fB,V:fC}));},get_Item:function(fB){return this.get(fB);},ContainsKey:function(fB){var fC,fD;fC=this;fD=this.data[this.hash(fB)];return fD==null?false:U.exists(function(fE){return fC.equals.apply(null,[(F.KeyValue(fE))[0],fB]);},fD);},get_Values:function(){return new dP.New(this);},set:function(fB,fC){var fD,fE,fF,fG;fD=this;fE=this.hash(fB);fF=this.data[fE];fF==null?(this.count=this.count+1,this.data[fE]=new a.Array({K:fB,V:fC})):(fG=U.tryFindIndex(function(fH){return fD.equals.apply(null,[(F.KeyValue(fH))[0],fB]);},fF),fG==null?(this.count=this.count+1,fF.push({K:fB,V:fC})):fF[fG.$0]={K:fB,V:fC});},get:function(fB){var fC,fD;fC=this;fD=this.data[this.hash(fB)];return fD==null?dd.notPresent():U.pick(function(fE){var fF;fF=F.KeyValue(fE);return fC.equals.apply(null,[fF[0],fB])?{$:1,$0:fF[1]}:null;},fD);},set_Item:function(fB,fC){this.set(fB,fC);},GetEnumerator:function(){return da.Get0(this);},GetEnumerator0:function(){return da.Get0(U.concat(dj.GetFieldValues(this.data)));}},w,bd);bd.New$5=fu.Ctor(function(){bd.New$6.call(this,[],bk.Equals,bk.Hash);},bd);bd.New$6=fu.Ctor(function(fB,fC,fD){var fE,fF;w.New.call(this);this.equals=fC;this.hash=fD;this.count=0;this.data=[];fE=da.Get(fB);try{while(fE.MoveNext()){fF=fE.Current();this.set(fF.K,fF.V);}}finally{if(typeof fE=="object"&&"Dispose"in fE)fE.Dispose();}},bd);be.to_string=function(fB){return fB.name;};be.get_from_string=function(){var fB;fB=be.get_parse();return function(fC){return D.from_string(fB,fC);};};be.get_parse=function(){return D.op_BarGreaterGreater(D.name_kw(ej.kwList()),be.create);};be.create=function(fB){return be.New(fB);};be.New=function(fB){return{name:fB};};bf.create=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;function fP(fR,fS){return fR+fS;}function fQ(fR,fS){return fR+fS;}fF=fE!==1?[T.scale(fB,fE),A.map(function(fR){var fS;fS=fR.target;return fS.$==0?cT.New(fR.time,{$:0,$0:T.scale(fS.$0,fE)}):fR;},fC)]:[fB,fC];fG=fF[0];fH=new B({$:1,$0:cT.New(fD["final"],"OutputPoint"),$1:A.filter(function(fR){var fS;fS=fR.target;return fS.$==0?U.exists(function(fT){return fT!==0;},fS.$0.get_get_pop_array()):true;},fF[1])});fI=A.choose(function(fR){return fR.target.$==0?{$:1,$0:fR.time}:null;},fH);fJ=fI.$==0?[fG,A.sortBy(function(fR){return fR.time;},fH)]:(fK=A.min(fI),fK<fD.initial?(fL=A.partition(function(fR){return fR.target.$==0&&fR.time<fD.initial;},fH),[T.merge(function(fR,fS){return fR+fS;},fG,(fM=(fu.Curried3(T.merge))(fP),A.reduce(function(fR,fS){return(fM(fR))(fS);},A.choose(function(fR){var fS;fS=fR.target;return fS.$==0?{$:1,$0:fS.$0}:null;},fL[0])))),A.sortBy(function(fR){return fR.time;},fL[1])]):fK===fD.initial?(fN=A.partition(function(fR){return fR.target.$==0&&fR.time===fK;},fH),[T.merge(function(fR,fS){return fR+fS;},fG,(fO=(fu.Curried3(T.merge))(fQ),A.reduce(function(fR,fS){return(fO(fR))(fS);},A.choose(function(fR){var fS;fS=fR.target;return fS.$==0?{$:1,$0:fS.$0}:null;},fN[0])))),A.sortBy(function(fR){return fR.time;},fN[1])]):[fG,A.sortBy(function(fR){return fR.time;},fH)]);return bf.New(fD,fJ[0],fJ[1],fD.initial,fD.initial,0);};bf.empty=function(){return bf.New(P.get_defaults(),T.empty(),B.Empty,0,0,0);};bf.New=function(fB,fC,fD,fE,fF,fG){return{settings:fB,populations:fC,events:fD,currenttime:fE,nextprinttime:fF,stepsdone:fG};};bg=d.Cme=fu.Class({simulate_sundials:function(fB,fC){return this.simulate_sundials_callback([false],fB,fC,a.ignore);},simulate_sundials_callback:function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6,f7;function fT(f8){return co.inline_keys(fC,fD,f8);}function fU(f8){return R.expand(fL,f8);}fV=this.simulator;fW=fV.settings;fX=fW.times.$!==0?fW.times:(fF=fW.initial,fG=fW.get_print_interval(),A.init(fW.points+1,function(f8){return fF+f8*fG;}));if(A.exists(function(f8){return f8.target!="OutputPoint";},fV.events))F.FailWith("Events not supported for CME integration");fY=this.statespace[0].statespace_for_CME_sundials(fC,fV.populations.index_to_species.length);fZ=fY[1];f0=fY[0][0];f1=fY[2];f2=cO.ofRows(U.init(cO.numRows(fZ),function(f8){return cL.ofArray(U.init(cO.numCols(fZ),function(f9){return fv.pow((U.get(fZ.MatrixData,f8))[f9],2);}));}));f3=U.ofList(fX);f4=f1.length;f5=fX.get_Length();f6=[];f7={stateN:f4,transN:f0.length,propensities:f0,sources:fY[0][2],targets:fY[0][1],diagonals:fY[0][3],prob_mass:f1,timesToReturnParam:f3,numTimesToReturnParam:f5,sundialsOutput:function(f8,f9){f6.push(cL.ofArray(f9));return null;},stiff:this.settings.stiff,abstol:this.settings.abstolerance,reltol:this.settings.reltolerance};fJ=[fw.fnSundialsCMESolver(f7),f7.prob_mass];fI=fJ[0];fI!==0?(function(f8){return function(f9){return f8("Sundials solver failed with code: "+a.String(f9));};}(F.FailWith))(fI):void 0;fK=A.ofSeq(f6);fL=(fM=(fN=(fO=(fP=fV.populations,function(f8){return fP.find_index(f8);}),function(f8){return cY.map(fO,f8);}),function(f8){return R.map(fN,f8);}),function(f8){return fM(fT(f8));});fQ=U.map(function(f8){return R.simplify(fU(f8));},U.ofList(fV.settings.plots));fR=bh.New(fX,A.map(cL.toArray,fK),cO.toArray(fZ),cS.map_key(function(f8){return f8.name;},fV.populations.species_to_index));fS=A.map2(function(f8,f9){function f_(ga){return cL.dot(f9,cO.copyCol(fZ,ga));}function f$(ga,gb){var gc;gc=cL.dot(f9,cO.copyCol(f2,gb))-ga*ga;return gc<0?0:fv.sqrt(gc);}return cv.New(f8,U.map(function(ga){var gb,gc;return ga.$==0&&(ga.$0.$==0&&(gb=ga.$0.$0,true))?(gc=f_(gb),cw.New(gc,f$(gc,gb))):F.FailWith("Species functions are not supported in plots (use single species only).");},fQ));},fX,fK);A.iter(fE,fS);return[bg.New(this.name,this.simulator,this.settings,this.statespace,fR),this.process_simulation(fS)];},process_simulation:function(fB){var fC,fD;fC=this.simulator.settings.times;fD=A.map(Q.to_string_plot,this.simulator.settings.plots);return fC.$===0?Z.from_rows(fD,fB):Z.from_rows(fD,cv.interpolate_reverse(function(fE,fF,fG){return fu.Curried(cw.interpolate,2,[fE,fF,fG]);},fB,fC));}},null,bg);bg.get_times=function(fB){return fB.times;};bg.simulate_callback=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT;function fU(fX){return co.inline_keys(fB,fC,fX);}function fV(fX){return R.expand(fI,fX);}function fW(fX,fY){function fZ(f1){return cL.dot(fY,cO.copyCol(fQ,f1));}function f0(f1,f2){var f3;f3=cL.dot(fY,cO.copyCol(fR,f2))-f1*f1;return f3<0?0:fv.sqrt(f3);}fS[0]=new B({$:1,$0:fX,$1:fS[0]});fT[0]=new B({$:1,$0:fY,$1:fT[0]});return U.map(function(f1){var f2,f3;return f1.$==0&&(f1.$0.$==0&&(f2=f1.$0.$0,true))?(f3=fZ(f2),cw.New(f3,f0(f3,f2))):F.FailWith("Species functions are not supported in plots (use single species only).");},fN);}fH=fG.simulator;fI=(fJ=(fK=(fL=(fM=fH.populations,function(fX){return fM.find_index(fX);}),function(fX){return cY.map(fL,fX);}),function(fX){return R.map(fK,fX);}),function(fX){return fJ(fU(fX));});fN=U.map(function(fX){return R.simplify(fV(fX));},U.ofList(fH.settings.plots));A.exists(function(fX){return fX.target!="OutputPoint";},fH.events)?F.FailWith("Events not supported for CME integration"):void 0;fF?bg.consoleWrite("Converting state-space to sparse matrix for CME integration"):void 0;fO=fG.statespace[0].statespace_for_CME_integration(fB,fH.populations.index_to_species.length);fP=fO[0];fQ=fO[1];fR=cO.ofRows(U.init(cO.numRows(fQ),function(fX){return cL.ofArray(U.init(cO.numCols(fQ),function(fY){return fv.pow((U.get(fQ.MatrixData,fX))[fY],2);}));}));fF?bg.consoleWrite("Integrating CME for probabilities"):void 0;fS=[B.Empty];fT=[B.Empty];return bg.New(fG.name,cI.simulate_callback(fD,fE,cI.create(fG.name,fG.simulator,function(fX){return function(fY){return fW(fX,fY);};},fu.Curried(cw.interpolate,5),fG.settings,fO[2],function(){var fX;function fY(fZ){return fP.timesRight(fZ);}fX=function(fZ){return fY(cL.toArray(fZ));};return function(fZ){return cL.ofArray(fX(fZ));};})).simulator,fG.settings,fG.statespace,bh.New(A.rev(fS[0]),db.rev_map(cL.toArray,fT[0]),cO.toArray(fQ),cS.map_key(function(fX){return fX.name;},fH.populations.species_to_index)));};bg.create=function(fB,fC,fD,fE,fF){var fG;fG=bg.get_empty();return bg.New(fG.name,bf.create(fB,fC,fE,fF),fD,fG.statespace,fG.probabilities);};bg.consoleWrite=function(fB){fx.log(fB);};bg.get_empty=function(){return bg.New("None",bf.empty(),bO.get_defaults(),[_.New(_9.empty(),new y.New([]))],bh.get_empty());};bg.New=function(fB,fC,fD,fE,fF){return new bg({name:fB,simulator:fC,settings:fD,statespace:fE,probabilities:fF});};bh.get_bounds=function(fB,fC){var fD,fE;fD=cS.find(fB.species,fC);fE=U.init(U.length(fB.stoichiometry),function(fF){return U.get(U.get(fB.stoichiometry,fF),fD);});return[fE,F.toInt(U.max(fE)),F.toInt(U.min(fE))];};bh.probability_map=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN;function fO(fR,fS){return[fR,bc.map(function(fT){return fT[0];},fS)];}function fP(fR){return fL.times$2(fR);}function fQ(fR){return fR<fN?0:fR;}fE=bh.get_bounds(fC,fD);fF=fE[2];fG=fE[1];fH=fE[0];fI=K.OfArray(U.ofSeq(bc.map(function(fR){return fO(fR[0],fR[1]);},bc.groupBy(function(fR){return fR[1];},U.mapi(function(fR,fS){return[fR,F.toInt(fS)];},fH)))));fJ=U.length(fH);fK=U.map(function(fR){var fS,fT,fU;fS=K.TryFind(fR,fI);return fS!=null&&fS.$==1?(fT=fS.$0,(fU=bc.length(fT),[U.create(fU,1),U.ofSeq(fT),fU])):[[],[],0];},U.ofSeq(F.range(fF,fG)));fL=new df.New$1(fG-fF+1,fJ,U.map(function(fR){return db.fst3(fR[0],fR[1],fR[2]);},fK),U.map(function(fR){return db.snd3(fR[0],fR[1],fR[2]);},fK),U.map(function(fR){return db.trd3(fR[0],fR[1],fR[2]);},fK));return A.map((fM=fB==null?a.id:(fN=fB.$0,function(fR){return U.map(fQ,fR);}),function(fR){return fM(fP(fR));}),fC.stateprobabilities);};bh.get_empty=function(){return bh.New(B.Empty,B.Empty,[],cS.empty());};bh.New=function(fB,fC,fD,fE){return{times:fB,stateprobabilities:fC,stoichiometry:fD,species:fE};};bi.simulate_callback=function(fB,fC,fD,fE,fF){var fG,fH;function fI(fJ){return di.find(fG,fJ);}bi.init(fE);fG=bF.to_env(fE.parameters);fH=function(fJ){return R["eval"](fI,fJ);};(function(fJ){var fK,fM,fN,fO,fP,fQ,fR,fS;function fL(fT,fU){var fV;fV=fE.spDict.get_Item(fT);return fV.isExplored?null:{$:1,$0:fV};}while(true){fM=bi.timeToNextReaction(fE);fN=bi.enactEvents(fM,fC,fE);fO=fE.now+fN;if(bi.isPrintTime(fE,fO,fJ)){fK=bi.createRow(fE.now,bi.evaluatePlots(fE));fC(fK);fE.dataPoints=new B({$:1,$0:fK,$1:fE.dataPoints});fE.nextPrintTime=fO+fE.simulation.get_print_interval();}if(bi.isStopTime(fE,fB)||fE.totalProp===0)return fE;else{fE.now=fO;fP=bi.pickNextReaction(fE);if(fP!=null&&fP.$==1){fQ=fP.$0;bi.executeReaction(fE,fQ);fR=(function(fT){return function(fU){return A.choose(fT,fU);};}(function(fT){return fL(fT[0],fT[1]);}))(fQ.prods);if(fE.mustPlotAll)A.iter(fD,(function(fT){return function(fU){return A.map(fT,fU);};}(function(fT){return fE.printSpecies(fT.payload);}))(fR));else if(!(fR.$==0))bi.extendPlotPatterns(fE,(function(fT){return function(fU){return A.map(fT,fU);};}(function(fT){return fT.payload;}))(fR));fS=da.Get(fR);try{while(fS.MoveNext())((function(fT){return function(){var fU,fV,fW,fX,fZ,f0,f1,f2,f3,f4,f5,f6,f7,f8,f9,f_,f$,ga;fU=fT.Current();fV=A.ofSeq(bc.map(function(gb){return gb.K;},bc.filter(function(gb){return fE.spDict.get_Item(gb.V).isExplored;},fE.sidDict)));fU.isExplored=true;fW=(fF.react(fV))(fU.payload);fX=da.Get(fW);function fY(gb){return[fE.sidDict.get_Item(gb.element),gb.multiplicity];}try{while(fX.MoveNext()){fZ=fX.Current();f0=da.Get(fZ.products);try{while(f0.MoveNext()){f1=f0.Current();!fE.sidDict.ContainsKey(f1.element)?(f2=cZ.New(bi.newSID(fE),f1.element,0,false,false,new dh.New$1(null)),fE.sidDict.Add(f1.element,f2.id),fE.spDict.Add(f2.id,f2)):void 0;}}finally{if(typeof f0=="object"&&"Dispose"in f0)f0.Dispose();}f3=A.map(fY,fZ.reactants);f4=A.map(fY,fZ.products);f5=cc.map(a.id,fH,function(gb){var gc;return R.simplify(R.expand((gc=fE.rates,function(gd){return co.inline_keys(fG,gc,gd);}),gb));},fZ);f6=bi.scaleReaction(fE,f5);f7=c0.New(bi.newRID(fE),f6,f3,f4,0);f8=bi.calculate_reaction_prop(fE,f7);f9=c0.New(f7.id,f7.payload,f7.reacts,f7.prods,f8);fE.totalProp=fE.totalProp+f8;fE.rxDict.Add(f9.id,f9);f_=A.map(function(gb){return gb[0];},A.append(f3,f4));f$=da.Get(f_);try{while(f$.MoveNext()){ga=fE.spDict.get_Item(f$.Current());ga.deps=ga.deps.Add(f9.id);}}finally{if(typeof f$=="object"&&"Dispose"in f$)f$.Dispose();}}return;}finally{if(typeof fX=="object"&&"Dispose"in fX)fX.Dispose();}};}(fS))());}finally{if(typeof fS=="object"&&"Dispose"in fS)fS.Dispose();}fE.stepsDone=fE.stepsDone+1;fJ=false;}else return fE;}}}(true));};bi.to_crn=function(fB,fC){var fD,fE,fF,fG,fH;function fI(fK){var fL,fM,fN;fL=fB.printSpecies(fK);return _8.New(fL.name,(fM=fL.structural,fM==null?"":fM.$0),(fN=fL.svg,fN==null?"":fN.$0));}function fJ(fK){return be.New(fK.name);}fD=(fE=fB.printSpecies,function(fK){return fJ(fE(fK));});fF=A.append(A.ofSeq(bc.map(function(fK){return V.create$3(fK.isConstant,{$:1,$0:fK.population},fD(fK.payload),null);},fB.spDict.get_Values())),A.collect(function(fK){var fL,fM;return fB.now>=fK.time?B.Empty:(fL=fK.time-fB.now,(fM=fK.target,fM=="OutputPoint"?B.Empty:A.map(function(fN){return V.create$3(fN.constant,{$:1,$0:fN.value},fD(fN.species),{$:1,$0:{$:1,$0:fL}});},A.ofArray(fM.$0.index_to_species))));},fB.events));return M.create(fC.name,(fG=fC.settings,O.New(fG.simulation,fG.simulations,(fH=fC.settings.stochastic,_7.New(1,fH.steps,fH.trajectories,fH.stationary_skiptime)),fG.deterministic,fG.spatial,fG.inference,fG.moment_closure,fG.synthesis,fG.data,fG.units,fG.simulator,fG.parameters,fG.sweeps,fG.rates,fG.plot,fG.quiet)),A.ofSeq(bc.map(function(fK){function fL(fM){return fM.$==0?{$:2,$0:fD(fM.$0)}:co.Time;}return cc.map(fD,function(fM){return{$:1,$0:fM};},function(fM){return R.map(fL,fM);},fK.payload);},fB.rxDict.get_Values())),fF,bb.of_list(A.map(function(fK){var fL;fL=fI(fK.payload);return[fL.name,fL];},A.ofSeq(fB.spDict.get_Values()))),true);};bi.to_ctmc=function(fB,fC){var fD,fE,fF;function fG(fH,fI){return[fH,R.map(function(fJ){return fJ.$==1?co.Time:{$:2,$0:fJ.$0};},fI)];}bF.to_env(fB.parameters);fD=A.ofSeq(bc.map(function(fH){return[fH.payload,F.toInt(fH.population)];},fB.spDict.get_Values()));fE=K.OfArray(U.ofSeq(A.map(function(fH){return fG(fH[0],fH[1]);},A.ofSeq(K.ToSeq(fB.rates)))));fF=fC.initialise_ctmc(fD);return[fC.to_ctmc(cS.ofMap(fE),fB.stochastic.scale,fF[0],fF[1],fF[2]),function(fH){var fI,fJ,fK;fI=fB.printSpecies(fH);return _8.New(fI.name,(fJ=fI.structural,fJ==null?"":fJ.$0),(fK=fI.svg,fK==null?"":fK.$0));}];};bi.init=function(fB){!bc.fold(function(fC,fD){var fE;fE=fD.population;return(fv.round(fE)-fE===0||fD.isConstant)&&fC;},true,A.ofSeq(fB.spDict.get_Values()))?F.FailWith("Can\'t use non-integer initial conditions without specifying the species as constant"):void 0;fB.events=A.sortBy(function(fC){return fC.time;},fB.events);};bi.isPrintTime=function(fB,fC,fD){return _1.shouldPrint(fB.simulation["final"],fC,fB.nextPrintTime,bi.getFinalStep(fB),fD,fB.now);};bi.createRow=function(fB,fC){return cv.New(fB,fC);};bi.evaluatePlots=function(fB){function fC(fE){return bc.fold(function(fF,fG){return fF+fB.spDict.get_Item(fG).population;},0,fB.plotDict.get_Item(fE));}function fD(fE){return fE.$==0?fC(fE.$0):fB.now;}return fB.mustPlotAll?U.ofSeq(bc.map(function(fE){return fE.population;},bc.filter(function(fE){return fE.isExplored;},fB.spDict.get_Values()))):U.ofList(A.map(function(fE){return R["eval"](fD,fE);},fB.simulation.plots));};bi.isStopTime=function(fB,fC){return _1.shouldStop(fB.simulation["final"],fB.now,fB.stepsDone,fC,bi.getFinalStep(fB));};bi.pickNextReaction=function(fB){var fC,fD,fE;fC=fB.totalProp;fD=fB.random.NextDouble()*fC;fE=fB.rxDict;return function(fF,fG){var fH,fI;while(true){fH=fE.get_Item(fG);fI=fF+fH.prop;if(fI>fD)return{$:1,$0:fH};else if(fG+1>=fE.count)return fI===0?null:fI!==fC?F.FailWith("Incorrect total propensity used."):F.FailWith("Index outside range");else{fF=fI;fG=fG+1;}}}(0,0);};bi.executeReaction=function(fB,fC){fB.totalProp=bi.update_props_direct(fB,A.ofSeq(new dh.New$1(cx.OfSeq(bc.concat(A.append(A.choose(function(fD){var fE;fE=fB.spDict.get_Item(fD[0]);return fE.isConstant?null:(fE.population=fE.population-fD[1],{$:1,$0:fE.deps});},fC.reacts),A.choose(function(fD){var fE;fE=fB.spDict.get_Item(fD[0]);return fE.isConstant?null:(fE.population=fE.population+fD[1],{$:1,$0:fE.deps});},fC.prods)))))));};bi.extendPlotPatterns=function(fB,fC){A.iter(function(fD){A.iter(function(fE){var fF;if(fE.$==1);else{fF=fE.$0;bc.iter(function(fG){if((fB.matchesSpecies(fF))(fG))fB.plotDict.set_Item(fF,A.append(fB.plotDict.get_Item(fF),A.ofArray([fB.sidDict.get_Item(fG)])));},fC);}},R.mentions(fD));},fB.simulation.plots);};bi.newSID=function(fB){var fC;fC=fB.nextSID;fB.nextSID=fC+1;return fC;};bi.newRID=function(fB){var fC;fC=fB.nextRID;fB.nextRID=fC+1;return fC;};bi.calculate_reaction_prop=function(fB,fC){var fD,fE,fH,fI,fJ,fK,fL;function fF(fM){return fB.spDict.get_Item(fM).population;}function fG(fM){return fF(fM)/fD;}fH=fC.payload.rate;if(fH.$==1){fD=fB.stochastic.scale;return R["eval"](function(fM){return fM.$==1?fB.now:fG(fB.sidDict.get_Item(fM.$0));},fH.$0)*fD;}else{fI=fH.$0;fJ=fC.reacts;switch(fJ.$==1?fJ.$0[1]===1?fJ.$1.$==1?fJ.$1.$0[1]===1?fJ.$1.$1.$==0?(fE=[fJ.$0[0],fJ.$1.$0[0]],4):(fE=fJ,5):(fE=fJ,5):(fE=fJ.$0[0],1):fJ.$0[1]===2?fJ.$1.$==0?(fE=fJ.$0[0],2):(fE=fJ,5):fJ.$0[1]===3?fJ.$1.$==0?(fE=fJ.$0[0],3):(fE=fJ,5):(fE=fJ,5):0){case 0:return fI;case 1:return fI*fF(fE);case 2:fK=fF(fE);return fI*fK*(fK-1)*0.5;case 3:fL=fF(fE);return fI*fL*(fL-1)*(fL-2)/6;case 4:return fI*fF(fE[0])*fF(fE[1]);case 5:return db.fold_left(function(fM,fN){return fM*db.binom(F.toInt(fF(fN[0])),fN[1]);},fI,fE);}}};bi.scaleReaction=function(fB,fC){function fD(fE,fF,fG){return fG*fv.pow(fE,1-fF);}return fC.scale(function(fE,fF){return function(fG){return fD(fE,fF,fG);};},fB.stochastic.scale,a.id);};bi.enactEvents=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV;fF=fB/fD.totalProp;fG=fD.events;if(fG.$==1){fH=fG.$0;if(fH.time>=fD.now+fF)return fF;else{fD.events=fG.$1;fI=bi.evaluatePlots(fD);fJ=0.99999999;fK=fJ*fH.time+(1-fJ)*fD.now;fL=bi.createRow(fD.now,fI);fM=bi.createRow(fK,fI);fC(fL);fC(fM);fD.dataPoints=new B({$:1,$0:fM,$1:new B({$:1,$0:fL,$1:fD.dataPoints})});fN=fH.time-fD.now;fO=fD.totalProp;fP=fH.target;if(fP=="OutputPoint");else{fQ=fP.$0.index_to_species;for(fR=0,fS=fQ.length-1;fR<=fS;fR++){fT=U.get(fQ,fR);fU=fD.sidDict.get_Item(fT.species);fV=fD.spDict.get_Item(fU);fD.spDict.set_Item(fU,cZ.New(fV.id,fV.payload,fV.population+fT.value,fV.isExplored,fV.isConstant,fV.deps));}}return bi.enactEvents(fB-fN*fO,fC,fD);}}else return fF;};bi.timeToNextReaction=function(fB){var fC;fC=fB.random.NextDouble();return fC>0?fv.log(1/fC):0;};bi.getFinalStep=function(fB){var fC;fC=fB.stochastic.steps;return fC!=null&&fC.$==1?{$:1,$0:fB.stepsDone+fC.$0}:null;};bi.update_props_direct=function(fB,fC){var fD,fE;fD=0;A.iter(function(fF){var fG,fH;fG=fB.rxDict.get_Item(fF);fH=bi.calculate_reaction_prop(fB,fG);fD=fD+(fH-fG.prop);fG.prop=fH;},fC);fE=fB.totalProp+fD;return fE<0?0:fE;};bj=d.GuiModel=fu.Class({to_model:function(){return L.New(this.top.to_crn(),A.map(function(fB){return fB.to_crn();},this.systems));}},null,bj);bj.from_model=function(fB){return bj.New(z.from_crn(fB.top),A.map(z.from_crn,fB.systems));};bj.New=function(fB,fC){return new bj({top:fB,systems:fC});};bk.Equals=function(fB,fC){var fD,fE,fF,fG;if(fB===fC)return true;else{fD=typeof fB;if(fD=="object"){if(fB===null||fB===void 0||fC===null||fC===void 0)return false;else if("Equals"in fB)return fB.Equals(fC);else if(fB instanceof a.Array&&fC instanceof a.Array)return bk.arrayEquals(fB,fC);else if(fB instanceof a.Date&&fC instanceof a.Date)return bk.dateEquals(fB,fC);else{fE=[true];for(var fH in fB)if(function(fI){fE[0]=!fB.hasOwnProperty(fI)||fC.hasOwnProperty(fI)&&bk.Equals(fB[fI],fC[fI]);return!fE[0];}(fH))break;if(fE[0]){for(var fI in fC)if(function(fJ){fE[0]=!fC.hasOwnProperty(fJ)||fB.hasOwnProperty(fJ);return!fE[0];}(fI))break;}return fE[0];}}else return fD=="function"&&("$Func"in fB?fB.$Func===fC.$Func&&fB.$Target===fC.$Target:"$Invokes"in fB&&"$Invokes"in fC&&bk.arrayEquals(fB.$Invokes,fC.$Invokes));}};bk.arrayEquals=function(fB,fC){var fD,fE;if(U.length(fB)===U.length(fC)){fD=true;fE=0;while(fD&&fE<U.length(fB)){!bk.Equals(U.get(fB,fE),U.get(fC,fE))?fD=false:void 0;fE=fE+1;}return fD;}else return false;};bk.dateEquals=function(fB,fC){return fB.getTime()===fC.getTime();};bk.Compare=function(fB,fC){var fD,fE,fF,fG,fH,fI;if(fB===fC)return 0;else{fE=typeof fB;switch(fE=="function"?1:fE=="boolean"?2:fE=="number"?2:fE=="string"?2:fE=="object"?3:0){case 0:return typeof fC=="undefined"?0:-1;case 1:return F.FailWith("Cannot compare function values.");case 2:return fB<fC?-1:1;case 3:if(fB===null)fF=-1;else if(fC===null)fF=1;else if("CompareTo"in fB)fF=fB.CompareTo(fC);else if("CompareTo0"in fB)fF=fB.CompareTo0(fC);else if(fB instanceof a.Array&&fC instanceof a.Array)fF=bk.compareArrays(fB,fC);else if(fB instanceof a.Date&&fC instanceof a.Date)fF=bk.compareDates(fB,fC);else{fG=[0];for(var fJ in fB)if(function(fK){return!fB.hasOwnProperty(fK)?false:!fC.hasOwnProperty(fK)?(fG[0]=1,true):(fG[0]=bk.Compare(fB[fK],fC[fK]),fG[0]!==0);}(fJ))break;if(fG[0]===0){for(var fK in fC)if(function(fL){return!fC.hasOwnProperty(fL)?false:!fB.hasOwnProperty(fL)&&(fG[0]=-1,true);}(fK))break;}fF=fG[0];}return fF;}}};bk.Hash=function(fB){var fC;fC=typeof fB;return fC=="function"?0:fC=="boolean"?fB?1:0:fC=="number"?fB:fC=="string"?bk.hashString(fB):fC=="object"?fB==null?0:fB instanceof a.Array?bk.hashArray(fB):bk.hashObject(fB):0;};bk.compareArrays=function(fB,fC){var fD,fE;if(U.length(fB)<U.length(fC))return -1;else if(U.length(fB)>U.length(fC))return 1;else{fD=0;fE=0;while(fD===0&&fE<U.length(fB)){fD=bk.Compare(U.get(fB,fE),U.get(fC,fE));fE=fE+1;}return fD;}};bk.compareDates=function(fB,fC){return bk.Compare(fB.getTime(),fC.getTime());};bk.hashString=function(fB){var fC,fD,fE;if(fB===null)return 0;else{fC=5381;for(fD=0,fE=fB.length-1;fD<=fE;fD++)fC=bk.hashMix(fC,fB[fD].charCodeAt());return fC;}};bk.hashArray=function(fB){var fC,fD,fE;fC=-34948909;for(fD=0,fE=U.length(fB)-1;fD<=fE;fD++)fC=bk.hashMix(fC,bk.Hash(U.get(fB,fD)));return fC;};bk.hashObject=function(fB){var fC,fD;if("GetHashCode"in fB)return fB.GetHashCode();else{fC=[0];for(var fE in fB)if(function(fF){fC[0]=bk.hashMix(bk.hashMix(fC[0],bk.hashString(fF)),bk.Hash(fB[fF]));return false;}(fE))break;return fC[0];}};bk.hashMix=function(fB,fC){return(fB<<5)+fB+fC;};bl.to_xml=function(fB){var fC;fC=dl.init(bl.preamble());bl.xml_of_model(fC,1,fB);dl.append(fC,bl.postamble());return dl.value(fC);};bl.preamble=function(){dT.$cctor();return dT.preamble;};bl.xml_of_model=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ;dl.append(fB,bl.tagopen(fC,"model",A.ofArray([["id",bl.oMap(bl.string_of_SId,fD.id)],["name",bl.oMap(bl.string_of_SBMLString,fD.name)]])));dl.append(fB,bl.newline());bl.xml_of_elmtlist(fB,fC+1,(fE=fC+2,function(fK){bl.xml_of_unitDefinition(fB,fE,fK);}),"listOfUnitDefinitions",fD.listOfUnitDefinitions);bl.xml_of_elmtlist(fB,fC+1,(fF=fC+2,function(fK){bl.xml_of_compartment(fB,fF,fK);}),"listOfCompartments",fD.listOfCompartments);bl.xml_of_elmtlist(fB,fC+1,(fG=fC+2,function(fK){bl.xml_of_species(fB,fG,fK);}),"listOfSpecies",fD.listOfSpecies);bl.xml_of_elmtlist(fB,fC+1,(fH=fC+2,function(fK){bl.xml_of_parameter(fB,fH,fK);}),"listOfParameters",fD.listOfParameters);bl.xml_of_elmtlist(fB,fC+1,(fI=fC+2,function(fK){bl.xml_of_initialAssignment(fB,fI,fK);}),"listOfInitialAssignments",fD.listOfInitialAssignments);bl.xml_of_elmtlist(fB,fC+1,(fJ=fC+2,function(fK){bl.xml_of_reaction(fB,fJ,fK);}),"listOfReactions",fD.listOfReactions);dl.append(fB,bl.tagclose(fC,"model"));dl.append(fB,bl.newline());};bl.postamble=function(){dT.$cctor();return dT.postamble;};bl.tagopen=function(fB,fC,fD){return bl.indent(fB,"<"+fC+bl.string_of_params(fD)+">");};bl.oMap=function(fB,fC){return fC!=null&&fC.$==1?{$:1,$0:fB(fC.$0)}:null;};bl.string_of_SId=function(fB){return fB.$0;};bl.string_of_SBMLString=function(fB){return fB.$0;};bl.newline=function(){dT.$cctor();return dT.newline;};bl.xml_of_elmtlist=function(fB,fC,fD,fE,fF){if(fF.$==0);else{dl.append(fB,bl.tagopen(fC,fE,B.Empty));dl.append(fB,bl.newline());A.iter(function(fG){fD(fG);dl.append(fB,bl.newline());},fF);dl.append(fB,bl.tagclose(fC,fE));dl.append(fB,bl.newline());}};bl.xml_of_unitDefinition=function(fB,fC,fD){var fE;dl.append(fB,bl.tagopen(fC,"unitDefinition",A.ofArray([["id",{$:1,$0:bl.string_of_UnitSId(fD.id)}],["name",bl.oMap(bl.string_of_SBMLString,fD.name)]])));dl.append(fB,bl.newline());bl.xml_of_elmtlist(fB,fC+1,(fE=fC+2,function(fF){bl.xml_of_sbmlUnit(fB,fE,fF);}),"listOfUnits",fD.listOfUnits);dl.append(fB,bl.tagclose(fC,"unitDefinition"));};bl.xml_of_compartment=function(fB,fC,fD){dl.append(fB,bl.tagsingle(fC,"compartment",A.ofArray([["id",{$:1,$0:bl.string_of_SId(fD.id)}],["name",bl.oMap(bl.string_of_SBMLString,fD.name)],["compartmentType",bl.oMap(bl.string_of_SId,fD.compartmentType)],["spatialDimensions",bl.oMap(a.String,fD.spatialDimensions)],["size",bl.oMap(a.String,fD.size)],["units",bl.oMap(bl.string_of_UnitSId,fD.units)],["outside",bl.oMap(bl.string_of_SId,fD.outside)],["constant",bl.oMap(bl.string_of_bool,fD.constant)]])));};bl.xml_of_species=function(fB,fC,fD){dl.append(fB,bl.tagsingle(fC,"species",A.ofArray([["id",{$:1,$0:bl.string_of_SId(fD.id)}],["name",bl.oMap(bl.string_of_SBMLString,fD.name)],["speciesType",bl.oMap(bl.string_of_SId,fD.speciesType)],["compartment",{$:1,$0:bl.string_of_SId(fD.compartment)}],["initialAmount",bl.oMap(a.String,fD.initialAmount)],["initialConcentration",bl.oMap(a.String,fD.initialConcentration)],["substanceUnits",bl.oMap(bl.string_of_UnitSId,fD.substanceUnits)],["hasOnlySubstanceUnits",bl.oMap(bl.string_of_bool,fD.hasOnlySubstanceUnits)],["boundaryCondition",bl.oMap(bl.string_of_bool,fD.boundaryCondition)],["charge",bl.oMap(a.String,fD.charge)],["constant",bl.oMap(bl.string_of_bool,fD.constant)]])));};bl.xml_of_parameter=function(fB,fC,fD){dl.append(fB,bl.tagsingle(fC,"parameter",A.ofArray([["id",{$:1,$0:bl.string_of_SId(fD.id)}],["name",bl.oMap(bl.string_of_SBMLString,fD.name)],["value",bl.oMap(a.String,fD.value)],["units",bl.oMap(bl.string_of_UnitSId,fD.units)],["constant",bl.oMap(bl.string_of_bool,fD.constant)]])));};bl.xml_of_initialAssignment=function(fB,fC,fD){dl.append(fB,bl.tagopen(fC,"initialAssignment",A.ofArray([["symbol",{$:1,$0:bl.string_of_SId(fD.symbol)}]])));dl.append(fB,bl.newline());bl.xml_of_MathML(fB,fC+1,fD.math);dl.append(fB,bl.newline());dl.append(fB,bl.tagclose(fC,"initialAssignment"));};bl.xml_of_reaction=function(fB,fC,fD){var fE,fF,fG;dl.append(fB,bl.tagopen(fC,"reaction",A.ofArray([["id",{$:1,$0:bl.string_of_SId(fD.id)}],["name",bl.oMap(bl.string_of_SBMLString,fD.name)],["reversible",bl.oMap(bl.string_of_bool,fD.reversible)],["fast",bl.oMap(bl.string_of_bool,fD.fast)]])));dl.append(fB,bl.newline());bl.xml_of_elmtlist(fB,fC+1,(fE=fC+2,function(fH){bl.xml_of_speciesReference(fB,fE,fH);}),"listOfReactants",fD.listOfReactants);bl.xml_of_elmtlist(fB,fC+1,(fF=fC+2,function(fH){bl.xml_of_speciesReference(fB,fF,fH);}),"listOfProducts",fD.listOfProducts);fG=fD.kineticLaw;fG!=null&&fG.$==1?(bl.xml_of_kineticLaw(fB,fC+1,fG.$0),dl.append(fB,bl.newline())):void 0;dl.append(fB,bl.tagclose(fC,"reaction"));};bl.tagclose=function(fB,fC){return bl.indent(fB,"</"+fC+">");};bl.mkSId=function(fB){bl.testId(fB);return{$:0,$0:fB};};bl.mkString=function(fB){return{$:0,$0:bl.stringMap(function(fC){return fC==="<"?bl.openAngle():fC===">"?bl.closeAngle():fC;},fB)};};bl.mkUnitSId=function(fB){bl.testId(fB);return{$:0,$0:fB};};bl.create_sbmlUnit=function(fB){return eB.New(fB,null,null,null,null);};bl.u_set_scale=function(fB,fC){return eB.New(fC.kind,fC.exponent,{$:1,$0:fB},fC.multiplier,fC.offset);};bl.create_parameter=function(fB){return ey.New(fB,null,null,null,null);};bl.p_set_value=function(fB,fC){return ey.New(fC.id,fC.name,{$:1,$0:fB},fC.units,fC.constant);};bl.p_set_units=function(fB,fC){return ey.New(fC.id,fC.name,fC.value,{$:1,$0:fB},fC.constant);};bl.create_speciesReference=function(fB){return eC.New(null,null,fB,null);};bl.sr_set_stoichiometry=function(fB,fC){return eC.New(fC.id,fC.name,fC.species,{$:1,$0:fB});};bl.empty_model=function(){dT.$cctor();return dT.empty_model;};bl.model_add_compartment=function(fB,fC){return dU.New(fC.id,fC.name,fC.listOfUnitDefinitions,A.append(fC.listOfCompartments,A.ofArray([fB])),fC.listOfSpecies,fC.listOfParameters,fC.listOfInitialAssignments,fC.listOfReactions);};bl.model_set_species=function(fB,fC){return dU.New(fC.id,fC.name,fC.listOfUnitDefinitions,fC.listOfCompartments,fB,fC.listOfParameters,fC.listOfInitialAssignments,fC.listOfReactions);};bl.model_set_reactions=function(fB,fC){return dU.New(fC.id,fC.name,fC.listOfUnitDefinitions,fC.listOfCompartments,fC.listOfSpecies,fC.listOfParameters,fC.listOfInitialAssignments,fB);};bl.create_reaction=function(fB){return eA.New(fB,null,null,null,B.Empty,B.Empty,null);};bl.r_set_reactants=function(fB,fC){return eA.New(fC.id,fC.name,fC.reversible,fC.fast,fB,fC.listOfProducts,fC.kineticLaw);};bl.r_set_products=function(fB,fC){return eA.New(fC.id,fC.name,fC.reversible,fC.fast,fC.listOfReactants,fB,fC.kineticLaw);};bl.r_set_reversible=function(fB,fC){return eA.New(fC.id,fC.name,{$:1,$0:fB},fC.fast,fC.listOfReactants,fC.listOfProducts,fC.kineticLaw);};bl.r_set_kineticLaw=function(fB,fC){return eA.New(fC.id,fC.name,fC.reversible,fC.fast,fC.listOfReactants,fC.listOfProducts,{$:1,$0:fB});};bl.create_kineticLaw=function(fB){return eD.New(fB,B.Empty);};bl.kl_add_parameter=function(fB,fC){return eD.New(fC.math,A.append(fC.listOfParameters,A.ofArray([fB])));};bl.create_species=function(fB,fC){return ex.New(fB,null,null,fC,null,null,null,null,null,null,null);};bl.sp_set_name=function(fB,fC){return ex.New(fC.id,{$:1,$0:fB},fC.speciesType,fC.compartment,fC.initialAmount,fC.initialConcentration,fC.substanceUnits,fC.hasOnlySubstanceUnits,fC.boundaryCondition,fC.charge,fC.constant);};bl.sp_set_initialConcentration=function(fB,fC){return ex.New(fC.id,fC.name,fC.speciesType,fC.compartment,fC.initialAmount,{$:1,$0:fB},fC.substanceUnits,fC.hasOnlySubstanceUnits,fC.boundaryCondition,fC.charge,fC.constant);};bl.sp_set_constant=function(fB,fC){return ex.New(fC.id,fC.name,fC.speciesType,fC.compartment,fC.initialAmount,fC.initialConcentration,fC.substanceUnits,fC.hasOnlySubstanceUnits,fC.boundaryCondition,fC.charge,{$:1,$0:fB});};bl.sp_set_boundaryCondition=function(fB,fC){return ex.New(fC.id,fC.name,fC.speciesType,fC.compartment,fC.initialAmount,fC.initialConcentration,fC.substanceUnits,fC.hasOnlySubstanceUnits,{$:1,$0:fB},fC.charge,fC.constant);};bl.model_add_initialAssignment=function(fB,fC){return dU.New(fC.id,fC.name,fC.listOfUnitDefinitions,fC.listOfCompartments,fC.listOfSpecies,fC.listOfParameters,A.append(fC.listOfInitialAssignments,A.ofArray([fB])),fC.listOfReactions);};bl.create_initialAssignment=function(fB,fC){return ez.New(fB,fC);};bl.model_add_parameter=function(fB,fC){return dU.New(fC.id,fC.name,fC.listOfUnitDefinitions,fC.listOfCompartments,fC.listOfSpecies,A.append(fC.listOfParameters,A.ofArray([fB])),fC.listOfInitialAssignments,fC.listOfReactions);};bl.create_compartment=function(fB){return ew.New(fB,null,null,null,null,null,null,null);};bl.cmt_set_size=function(fB,fC){return ew.New(fC.id,fC.name,fC.compartmentType,fC.spatialDimensions,{$:1,$0:fB},fC.units,fC.outside,fC.constant);};bl.model_add_unitDefinition=function(fB,fC){return dU.New(fC.id,fC.name,A.append(fC.listOfUnitDefinitions,A.ofArray([fB])),fC.listOfCompartments,fC.listOfSpecies,fC.listOfParameters,fC.listOfInitialAssignments,fC.listOfReactions);};bl.create_unitDefinition=function(fB,fC){return ev.New(fB,null,fC);};bl.u_set_exponent=function(fB,fC){return eB.New(fC.kind,{$:1,$0:fB},fC.scale,fC.multiplier,fC.offset);};bl.u_set_multiplier=function(fB,fC){return eB.New(fC.kind,fC.exponent,fC.scale,{$:1,$0:fB},fC.offset);};bl.space=function(){dT.$cctor();return dT.space;};bl.xmltag=function(fB){return"<?xml"+bl.string_of_params(fB)+"?>";};bl.indent=function(fB,fC){function fD(fE){return fE===0?fC:bl.indent_string()+fD(fE-1);}return fB<0?F.FailWith("Sbml.indent: negative indentation"):fD(fB);};bl.string_of_params=function(fB){function fC(fD,fE){return fE!=null&&fE.$==1?bl.space()+fD+bl.equals()+bl.quote(fE.$0):bl.empty();}return fB.$==0?bl.empty():A.reduce(function(fD,fE){return fD+bl.empty()+fE;},A.map(function(fD){return fC(fD[0],fD[1]);},fB));};bl.string_of_UnitSId=function(fB){return fB.$0;};bl.xml_of_sbmlUnit=function(fB,fC,fD){dl.append(fB,bl.tagsingle(fC,"unit",A.ofArray([["kind",{$:1,$0:bl.string_of_unitKind(fD.kind)}],["exponent",bl.oMap(a.String,fD.exponent)],["scale",bl.oMap(a.String,fD.scale)],["multiplier",bl.oMap(a.String,fD.multiplier)],["offset",bl.oMap(a.String,fD.offset)]])));};bl.tagsingle=function(fB,fC,fD){return bl.indent(fB,"<"+fC+bl.string_of_params(fD)+"/>");};bl.string_of_bool=function(fB){return fB?"true":"false";};bl.xml_of_MathML=function(fB,fC,fD){dl.append(fB,bl.tagopen(fC,"math",A.ofArray([["xmlns",{$:1,$0:"http://www.w3.org/1998/Math/MathML"}]])));dl.append(fB,bl.newline());bl.xml_of_mathExpr(fB,fC+1,fD);dl.append(fB,bl.newline());dl.append(fB,bl.tagclose(fC,"math"));};bl.xml_of_speciesReference=function(fB,fC,fD){dl.append(fB,bl.tagsingle(fC,"speciesReference",A.ofArray([["id",bl.oMap(bl.string_of_SId,fD.id)],["name",bl.oMap(bl.string_of_SBMLString,fD.name)],["species",{$:1,$0:bl.string_of_SId(fD.species)}],["stoichiometry",bl.oMap(a.String,fD.stoichiometry)]])));};bl.xml_of_kineticLaw=function(fB,fC,fD){var fE;dl.append(fB,bl.tagopen(fC,"kineticLaw",B.Empty));dl.append(fB,bl.newline());bl.xml_of_MathML(fB,fC+1,fD.math);dl.append(fB,bl.newline());bl.xml_of_elmtlist(fB,fC+1,(fE=fC+2,function(fF){bl.xml_of_parameter(fB,fE,fF);}),"listOfParameters",fD.listOfParameters);dl.append(fB,bl.tagclose(fC,"kineticLaw"));};bl.testId=function(fB){bl.stringIteri(function(fC,fD){if(fC===0){if(!(bl.isLetter(fD)||bl.isUnderscore(fD)))throw e4.New(fB);else return null;}else if(!(bl.isLetter(fD)||bl.isUnderscore(fD)||bl.isDigit(fD)))throw e4.New(fB);else return null;},fB);};bl.stringMap=function(fB,fC){var fD;fD=[""];dk.iter(function(fE){fD[0]=fD[0]+fB(fE);},fC);return fD[0];};bl.openAngle=function(){dT.$cctor();return dT.openAngle;};bl.closeAngle=function(){dT.$cctor();return dT.closeAngle;};bl.indent_string=function(){dT.$cctor();return dT.indent_string;};bl.empty=function(){dT.$cctor();return dT.empty;};bl.equals=function(){dT.$cctor();return dT.equals;};bl.quote=function(fB){return bl.quotemark()+fB+bl.quotemark();};bl.string_of_unitKind=function(fB){return fB.$==1?"becqerel":fB.$==2?"candela":fB.$==3?"coulomb":fB.$==4?"dimensionless":fB.$==5?"farad":fB.$==6?"gram":fB.$==7?"gray":fB.$==8?"henry":fB.$==9?"hertz":fB.$==10?"item":fB.$==11?"joule":fB.$==12?"katal":fB.$==13?"kelvin":fB.$==14?"kilogram":fB.$==15?"litre":fB.$==16?"lumen":fB.$==17?"lux":fB.$==18?"metre":fB.$==19?"mole":fB.$==20?"newton":fB.$==21?"ohm":fB.$==22?"pascal":fB.$==23?"radian":fB.$==24?"second":fB.$==25?"siemens":fB.$==26?"sievert":fB.$==27?"steradians":fB.$==28?"tesla":fB.$==29?"volt":fB.$==30?"watt":fB.$==31?"weber":"ampere";};bl.xml_of_mathExpr=function(fB,fC,fD){var fE,fF,fG,fH;if(fD.$==1){dl.append(fB,bl.tagopen(fC,"apply",B.Empty));dl.append(fB,bl.newline());dl.append(fB,bl.tagsimple(fC+1,bl.string_of_bOp(fD.$0)));dl.append(fB,bl.newline());bl.xml_of_mathExpr(fB,fC+1,fD.$1);dl.append(fB,bl.newline());bl.xml_of_mathExpr(fB,fC+1,fD.$2);dl.append(fB,bl.newline());dl.append(fB,bl.tagclose(fC,"apply"));}else if(fD.$==2){dl.append(fB,bl.tagopen(fC,"apply",B.Empty));dl.append(fB,bl.newline());dl.append(fB,bl.tagsimple(fC+1,bl.string_of_nOp(fD.$0)));dl.append(fB,bl.newline());A.iter(function(fI){bl.xml_of_mathExpr(fB,fC+1,fI);dl.append(fB,bl.newline());},fD.$1);dl.append(fB,bl.tagclose(fC,"apply"));}else if(fD.$==3){fE=fD.$1;fF=fD.$0;fG=fE!=null&&fE.$==1?A.ofArray([["units",{$:1,$0:bl.string_of_UnitSId(fE.$0)}]]):B.Empty;fF.$==1?(dl.append(fB,bl.tagopen(fC,"cn",new B({$:1,$0:["type",{$:1,$0:"real"}],$1:fG}))),dl.append(fB,a.String(fF.$0)),dl.append(fB,bl.tagclose(0,"cn"))):fF.$==2?dl.append(fB,bl.tagsimple(fC,bl.string_of_bool(fF.$0))):fF.$==3?dl.append(fB,bl.tagsimple(fC,"notanumber")):fF.$==4?dl.append(fB,bl.tagsimple(fC,"pi")):fF.$==5?dl.append(fB,bl.tagsimple(fC,"infinity")):fF.$==6?dl.append(fB,bl.tagsimple(fC,"exponentiale")):(dl.append(fB,bl.tagopen(fC,"cn",new B({$:1,$0:["type",{$:1,$0:"integer"}],$1:fG}))),dl.append(fB,a.String(fF.$0)),dl.append(fB,bl.tagclose(0,"cn")));}else if(fD.$==4){dl.append(fB,bl.tagopen(fC,"ci",B.Empty));dl.append(fB,bl.string_of_SId(fD.$0));dl.append(fB,bl.tagclose(0,"ci"));}else{fH=fD.$0;(function(fI){var fJ,fK,fL,fM;while(true){if(fI.$==30){if(fJ=fI.$0,fJ!=null&&fJ.$==1){fK=fI.$0.$0;dl.append(fB,bl.tagopen(fC,bl.string_of_uOp(fH),B.Empty));dl.append(fB,bl.newline());return bl.xml_of_qualifier(fB,fC+1,{$:0,$0:fK});}else fI={$:30,$0:{$:1,$0:{$:3,$0:{$:0,$0:2},$1:null}}};}else if(fI.$==31){if(fL=fI.$0,fL!=null&&fL.$==1){fM=fI.$0.$0;dl.append(fB,bl.tagopen(fC,bl.string_of_uOp(fH),B.Empty));dl.append(fB,bl.newline());return bl.xml_of_qualifier(fB,fC+1,{$:1,$0:fM});}else fI={$:31,$0:{$:1,$0:{$:3,$0:{$:0,$0:10},$1:null}}};}else return dl.append(fB,bl.tagopen(fC,bl.string_of_uOp(fI),B.Empty));}}(fH));dl.append(fB,bl.newline());bl.xml_of_mathExpr(fB,fC+1,fD.$1);dl.append(fB,bl.tagclose(fC,bl.string_of_uOp(fH)));dl.append(fB,bl.newline());}};bl.stringIteri=function(fB,fC){var fD,fE;for(fD=0,fE=dk.length(fC)-1;fD<=fE;fD++)fB(fD,fC[fD]);};bl.isLetter=function(fB){return"a"<=fB&&fB<="z"||"A"<=fB&&fB<="Z";};bl.isUnderscore=function(fB){return fB==="_";};bl.isDigit=function(fB){return"0"<=fB&&fB<="9";};bl.quotemark=function(){dT.$cctor();return dT.quotemark;};bl.tagsimple=function(fB,fC){return bl.tagsingle(fB,fC,B.Empty);};bl.string_of_bOp=function(fB){return fB.$==1?"divide":fB.$==2?"power":fB.$==3?"minus":fB.$==4?"max":fB.$==5?"mod":"neq";};bl.string_of_nOp=function(fB){return fB.$==1?"or":fB.$==2?"xor":fB.$==3?"plus":fB.$==4?"times":fB.$==5?"eq":fB.$==6?"leq":fB.$==7?"lt":fB.$==8?"geq":fB.$==9?"gt":"and";};bl.string_of_uOp=function(fB){return fB.$==1?"minus":fB.$==2?"abs":fB.$==3?"exp":fB.$==4?"ln":fB.$==5?"floor":fB.$==32?"ceiling":fB.$==33?"factorial":fB.$==30?"root":fB.$==31?"log":fB.$==6?"sin":fB.$==7?"cos":fB.$==8?"tan":fB.$==9?"sec":fB.$==10?"csc":fB.$==11?"cot":fB.$==12?"arcsin":fB.$==13?"arccos":fB.$==14?"arctan":fB.$==15?"arcsec":fB.$==16?"arccsc":fB.$==17?"arccot":fB.$==18?"sinh":fB.$==19?"cosh":fB.$==20?"tanh":fB.$==21?"sech":fB.$==22?"csch":fB.$==23?"coth":fB.$==24?"arcsinh":fB.$==25?"arccosh":fB.$==26?"arctanh":fB.$==27?"arcsech":fB.$==28?"arccsch":fB.$==29?"arccoth":"not";};bl.xml_of_qualifier=function(fB,fC,fD){var fE,fF;if(fD.$==1){fE="logbase";dl.append(fB,bl.tagopen(fC,fE,B.Empty));dl.append(fB,bl.newline());bl.xml_of_mathExpr(fB,fC+1,fD.$0);dl.append(fB,bl.newline());dl.append(fB,bl.tagclose(fC,fE));}else{fF="degree";dl.append(fB,bl.tagopen(fC,fF,B.Empty));dl.append(fB,bl.newline());bl.xml_of_mathExpr(fB,fC+1,fD.$0);dl.append(fB,bl.newline());dl.append(fB,bl.tagclose(fC,fF));}};bo.New=function(fB,fC,fD,fE){return{values:fB,logLikelihood:fC,logPrior:fD,iteration:fE};};bq=bp.AssociativeArray=fu.Class({Item:function(fB){return U.get(this.objects,this.map.Item(fB));},get_Names:function(){return this.map.get_Keys();},ToArray:function(){return U.ofSeq(this.objects);},get__dataArray:function(){return this.objects;},Item$1:function(fB){return U.get(this.objects,fB);},get__namesMap:function(){return this.map;},ToMap:function(){return K.OfArray(U.zip(this.get_Names(),this.ToArray()));},CopyWithNewValues:function(fB){return new bq.New(this.map,fB);}},w,bq);bq.ofSeq=function(fB){return bq.ofArray(U.ofSeq(fB));};bq.ofArray=function(fB){var fC,fD;fC=U.length(fB);fD=U.init(fC,function(fE){return U.get(fB,fE).get_Data();});return new bq.New(new dm.New(U.init(fC,function(fE){return U.get(fB,fE).get_Name();})),fD);};bq.New=fu.Ctor(function(fB,fC){w.New.call(this);this.map=fB;this.objects=fC;},bq);br.New=function(fB,fC,fD){return{pType:fB,lb:fC,ub:fD};};bs.New=function(fB,fC){return{accepted:fB,altered:fC};};bt.group_sweeps=function(fB){return A.map(function(fC){return A.length(fC)>1?A.map(bt.append_sweepstr_columns,fC):fC;},function(fC,fD){var fE,fF,fG;while(true)if(fD.$==1){fE=fD.$1;fF=fD.$0;fG=A.partition(function(fH){return function(fI){return bt.same_sweep(fH,fI);};}(fF),fE);fC=new B({$:1,$0:new B({$:1,$0:fF,$1:fG[0]}),$1:fC});fD=fG[1];}else return A.rev(fC);}(B.Empty,fB));};bt.append_sweepstr_columns=function(fB){var fC;fC=di.to_string(fB.instance.environment);return bt.New(fB.instance,Z.New(fB.table.times,A.map(function(fD){return bE.New((((fu.Curried3(function(fE,fF,fG){return fE(_2.toSafe(fF)+" ("+_2.toSafe(fG)+")");}))(a.id))(fD.name))(fC),fD.values);},fB.table.columns)));};bt.same_sweep=function(fB,fC){return C.same_sweep(fB.instance,fC.instance);};bt.to_table=function(fB){return fB.table;};bt.create=function(fB,fC){return bt.New(fB,fC);};bt.New=function(fB,fC){return{instance:fB,table:fC};};bv.New=function(fB,fC,fD,fE){return{iteration:fB,state:fC,mlesims:fD,summary:fE};};bx.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL){return{space:fB,state:fC,thinningSkippedCount:fD,chain:fE,burnin:fF,randGen:fG,innovationGens:fH,mle:fI,priors:fJ,indexes:fK,accepted:fL};};by.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK){return{space:fB,state:fC,thinningSkippedCount:fD,chain:fE,stats:fF,randGen:fG,innovationGens:fH,mle:fI,priors:fJ,indexes:fK};};bz.structured_tabbed=function(fB,fC,fD){return bz.arbitrary_tabbed(fB,bz.to_tab_items(fC,fD));};bz.structured_tabbed_embedded=function(fB,fC){return bz.make_embedded(bz.arbitrary_tabbed_content(fB,bz.to_tab_items(fB,fC)));};bz.arbitrary_tabbed=function(fB,fC){return bz.make_page(fB,bz.arbitrary_tabbed_content("top_tabs",fC));};bz.arbitrary_tabbed_content=function(fB,fC){var fD,fE;function fF(fG,fH){return(((((fu.Curried(function(fI,fJ,fK,fL,fM){return fI("<div id=\\""+_2.toSafe(fJ)+_2.toSafe(fK)+"\\" class=\\"tabcontent cliplot "+_2.toSafe(fL)+"\\">\\n\\u0009"+_2.toSafe(fM)+"\\n</div>");},5))(a.id))(fB))(bz.to_identifier(fG)))(fB))(fH);}fD="<ul class=\\"tab cliplot\\">"+dk.concat("\\n",A.mapi(function(fG,fH){var fI;fI=fH[0];return((((((fu.Curried(function(fJ,fK,fL,fM,fN,fO){return fJ("\\u0009<li class=\\"cliplot\\"><a href=\\"javascript:void(0)\\" class=\\"tablinks cliplot "+_2.toSafe(fK)+"\\" onclick=\\"openTab(event, \'"+_2.toSafe(fL)+"\', \'"+_2.toSafe(fM)+"\')\\""+_2.toSafe(fN)+">"+_2.toSafe(fO)+"</a></li>");},6))(a.id))(fB))(fB))(bz.to_identifier(fI)))(fG===0?" id=\\"cliplot_defaultOpen\\"":""))(fI);},fC))+"\\n</ul>";fE=dk.concat("\\n",A.map(function(fG){return fF(fG[0],fG[1]);},fC));return(((fu.Curried3(function(fG,fH,fI){return fG(_2.toSafe(fH)+" "+_2.toSafe(fI));}))(a.id))(fD))(fE);};bz.make_embedded=function(fB){return((((fu.Curried(function(fC,fD,fE,fF){return fC("<div class=\\"cliplot\\">"+_2.toSafe(fD)+" "+_2.toSafe(fE)+" "+_2.toSafe(fF)+"</div>");},4))(a.id))(bz.local_styles()))(fB))(bz.unified_scripts());};bz.to_tab_items=function(fB,fC){var fD,fE,fF;fD="<ul class=\\"tab tab2 cliplot\\">\\n\\u0009"+dk.concat("\\n",A.init(fC.comparisons.get_Length(),function(fG){return(((((fu.Curried(function(fH,fI,fJ,fK,fL){return fH("\\u0009\\u0009<li><a href=\\"javascript:void(0)\\" class=\\"complinks cliplot "+_2.toSafe(fI)+"\\" onclick=\\"openComparison(event, \'"+_2.toSafe(fJ)+"\', \'cliplot_comparison_"+a.String(fK)+"\')\\">Comparison "+a.String(fL)+"</a></li>");},5))(a.id))(fB))(fB))(fG+1))(fG+1);}))+"\\n\\u0009</ul>";fE=((fu.Curried(function(fG,fH,fI,fJ,fK){return fG("\\u0009<div id=\\""+_2.toSafe(fH)+"cliplot_comparison_"+a.String(fI)+"\\" class=\\"compcontent cliplot "+_2.toSafe(fJ)+"\\">\\n\\u0009\\u0009"+_2.toSafe(fK)+"\\n</div>");},5))(a.id))(fB);fF=dk.concat("\\n",A.mapi(function(fG,fH){return((fE(fG+1))(fB))(fH[1]);},fC.comparisons));return A.append(A.ofArray([["Model",fC.model],["Comparisons",(((fu.Curried3(function(fG,fH,fI){return fG(_2.toSafe(fH)+"\\n"+_2.toSafe(fI));}))(a.id))(fD))(fF)],["Posterior marginals",fC.posterior],["Correlation",fC.correlation],["MCMC traces",fC.traces],["Parameter summary",fC.psummary]]),fC.variations);};bz.make_page=function(fB,fC){return(((((fu.Curried(function(fD,fE,fF,fG,fH){return fD("<!DOCTYPE html><html>"+_2.toSafe(fE)+" "+_2.toSafe(fF)+"<body><h2 class=\\"cliplot\\">"+_2.toSafe(fG)+"</h2>"+_2.toSafe(fH)+"</body></html>");},5))(a.id))(bz.page_header_scripts()))(bz.local_styles()))(fB))(fC);};bz.to_identifier=function(fB){return(function(fC){return function(fD){return fC("cliplot_"+_2.toSafe(fD));};}(a.id))(dk.map(function(fC){return dZ.IsLetterOrDigit(fC)?fC:"_";},fB));};bz.local_styles=function(){d0.$cctor();return d0.local_styles;};bz.unified_scripts=function(){d0.$cctor();return d0.unified_scripts;};bz.plot_comparisons=function(fB,fC,fD,fE,fF){function fG(fH,fI){var fJ,fK;fJ=A.mapi(function(fL){return fH.instance.settings.plotcolours.get_Length()>fL?bz.colour_of_string(0.6,fH.instance.settings.plotcolours.get_Item(fL)):[d9.Grey(),d9.Black()];},fH.table.columns);return d8.setVisibleRegion({$:0,$0:0},d8.setTitle(U.head(dk.SplitChars(A.head(fI.columns).name,["("],0)),d8.setYlabel(fF,d8.setXlabel(fE,(fK=A.zip3(fH.table.columns,fI.columns,fJ),bc.fold(function(fL,fM){var fN,fO;fN=fM[2];fO=bz.plot_comparison(fH.table.times,fM[0],fI.times,fM[1],fN[0],fN[1],fD);return d8.addMarkers(fO[0],d8.addPolyline(fO[1],fL));},d8.Empty(),fK))))));}return(((fu.Curried3(A.map2))(fG))(fB))(fC);};bz.plot_correlation=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;fD=A.length(fC);fE=U.mapi(function(fL,fM){return U.mapi(function(fN,fO){return fL<=fN?a.NaN:fO;},fM);},fB);fF=ec.init(fD,fD,function(fL,fM){return U.get(U.get(fE,fD-fM-1),fL);});fG=A.ofArray([[-1,"#0000AA"],[-0.8,"#2222AA"],[-0.6,"#4444AA"],[-0.4,"#6666AA"],[-0.2,"#8888AA"],[0,"#AAAAAA"],[0.2,"#AA8888"],[0.4,"#AA6666"],[0.6,"#AA4444"],[0.8,"#AA2222"],[1,"#AA0000"]]);fH={$:0,$0:dk.Join(",",U.ofSeq(A.mapi(function(fL,fM){var fN,fO;fN=fM[0];fO=fM[1];return fL===0?(((fu.Curried3(function(fP,fQ,fR){return fP(fQ.toFixed(6)+"="+_2.toSafe(fR));}))(a.id))(fN))(fO):fL===A.length(fG)-1?(((fu.Curried3(function(fP,fQ,fR){return fP(_2.toSafe(fQ)+"="+fR.toFixed(6));}))(a.id))(fO))(fN):((((fu.Curried(function(fP,fQ,fR,fS){return fP(_2.toSafe(fQ)+"="+fR.toFixed(6)+"="+_2.toSafe(fS));},4))(a.id))(fO))(fN))(fO);},fG)))};fI=U.init(fD+1,a.id);fJ=U.init(fD+1,a.id);fK=d8.createLabelledAxis(fJ,A.rev(fC));return d8.addHeatmap(eb.setName(null,eb.setPalette(fH,eb.createHeatmap(fI,fI,fF))),d_.New(fD*25+50+30+60,fD*25+30+50,"Correlation in the joint posterior samples",d8.Empty().Xlabel,d8.createTiltedLabelledAxis(fJ,fC,90),d8.Empty().Ylabel,fK,d8.Empty().GridLines,d8.Empty().Plots,d$.Visible,d8.Empty().IsNavigationEnabled,false,{$:0,$0:0},d8.Empty().TooltipDelay));};bz.plot_variation=function(fB,fC,fD){var fE,fF,fG;function fH(fJ,fK){return fK.get_Length();}function fI(fJ,fK){return function(fL){var fM,fN,fO,fP,fQ,fR;fM=fL[1];fN=fM.get_Length();fO=A.unzip(A.sortBy(function(fS){return fS[0];},A.map2(function(fS,fT){return[fS,U.average(fB.get_Item(fT))];},fM,fD.GetSlice({$:1,$0:fJ},{$:1,$0:fJ+fN-1}))));fP=fO[1];fQ=U.init(fP.get_Length(),function(fS){return fS+1;});return[fJ+fN,new B({$:1,$0:d8.setVisibleRegion({$:0,$0:0},d8.setYlabel("Parameter value",d8.setTitle(fL[0],(fR=d8.addMarkers(ed.setShape(ee.Circle,ed.createMarkers(fQ,fP)),d8.Empty()),d8.setXaxis(d8.setLabelsVisibility(true,d8.createTiltedLabelledAxis(fQ,fO[0],90)),fR))))),$1:fK})];};}fE=(fF=120+25*A.max(A.map(function(fJ){return fH(fJ[0],fJ[1]);},fC)),(fG=400,bk.Compare(fF,fG)===1?fF:fG));return[(bc.fold(function(fJ,fK){return(function(fL){return fI(fL[0],fL[1]);}(fJ))(fK);},[0,B.Empty],fC))[1],fE];};bz.plot_trace=function(fB,fC,fD){return d8.setVisibleRegion({$:0,$0:1},d8.setTitle(fD,d8.setYlabel("Parameter values",d8.setXlabel("Sample",d8.addPolyline(ef.setThickness(2,ef.createPolyline(U.ofSeq(fB),U.ofSeq(fC))),d8.Empty())))));};bz.plot_marginal=function(fB,fC,fD){return d8.setVisibleRegion({$:0,$0:0},d8.setTitle(fC,d8.setYlabel("Frequency",d8.setXlabel(fD?"Log10(value)":"value",d8.addHistogram(eg.setBinCount(30,eg.createHistogram(fD?U.map(function(fE){return fv.log(fE)/fv.log(10);},fB):fB)),d8.Empty())))));};bz.page_header_scripts=function(){d0.$cctor();return d0.page_header_scripts;};bz.plot_comparison=function(fB,fC,fD,fE,fF,fG,fH){var fI,fJ;function fK(fM,fN){return fM<fJ;}function fL(fM,fN){return fM<fJ;}fI=fH==null?[[fD,fE.values],[fB,fC.values]]:(fJ=fH.$0,[A.unzip(A.filter(function(fM){return fK(fM[0],fM[1]);},A.zip(fD,fE.values))),A.unzip(A.filter(function(fM){return fL(fM[0],fM[1]);},A.zip(fB,fC.values)))]);return[ed.setSize(3,ed.setFillColour(fG,ed.createMarkers(U.ofList(fI[0][0]),U.ofList(fI[0][1])))),ef.setThickness(2,ef.setStrokeColour(fF,ef.createPolyline(U.ofList(fI[1][0]),U.ofList(fI[1][1]))))];};bz.colour_of_string=function(fB,fC){var fD,fE;fD=d9.parse(fC);return fD==null?[d9.Gray(),d9.Black()]:(fE=fD.$0,[fE,bz.darken_colour(fB,fE)]);};bz.activate_idd_script=function(){d0.$cctor();return d0.activate_idd_script;};bz.cdn_scripts=function(){d0.$cctor();return d0.cdn_scripts;};bz.prepare_idd_script=function(){d0.$cctor();return d0.prepare_idd_script;};bz.footer_scripts_idd=function(){d0.$cctor();return d0.footer_scripts_idd;};bz.darken_colour=function(fB,fC){function fD(fE){return F.toInt(fE*fB)%256;}return fC.$==0?fC:{$:1,$0:e9.New(fD(fC.$0.R),fD(fC.$0.G),fD(fC.$0.B))};};bA=bu.mcmc_result=fu.Class({to_summary:function(){return dy.New(this.summary,bc.fold(function(fB,fC){return fB.Add(fC.name,fC);},K.Map(function(fB,fC){var fD;fD=dr.get_defaults();return dr.New(fB,fC,fC,fD.variance,fD.median,fD.lb,fD.ub,fD.l68,fD.u68,fD.l95,fD.u95,fD.ptype);},this.pfixed),this.parameters));}},null,bA);bA.New=function(fB,fC,fD,fE,fF,fG,fH,fI){return new bA({parameters:fB,posterior:fC,burnin:fD,pfixed:fE,mle:fF,mlesims:fG,postsims:fH,summary:fI});};bB.mcmc_to_results=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;function fQ(fT,fU){var fV;fV=bc.find(function(fW){return fW.name===A.head(fT).instance.model;},fG).settings;return du.New(fT,fU.data,fU.file,fV.plot.x_label,fV.plot.y_label);}function fR(fT){return fT[1];}function fS(fT,fU){return fU.get_Length()===fO;}fE=K.Map(function(fT){return U.ofList(A.map(function(fU){return fU.get_Item(fT);},fD.posterior));},A.head(fD.posterior));fF=c_.correlation_pearson(U.ofList(A.map(function(fT){return fE.get_Item(fT);},A.map(function(fT){return fT.name;},fD.parameters))));fG=new B({$:1,$0:fC.top,$1:fC.systems});fH=A.collect(function(fT){return fT.settings.data;},fG);fI=A.collect(function(fT){return A.collect(function(fU){return fU.data;},fT.settings.simulations);},fG);fJ=fI.$===0?fH:A.map(function(fT){return bc.find(function(fU){return fU.file===fT;},fH);},fI);fK=bt.group_sweeps(fD.mlesims);fL=fK.get_Length()===fJ.get_Length()?(((fu.Curried3(A.map2))(fQ))(fK))(fJ):F.FailWith("HTML report internal error: incompatible specification of simulations and data files");fM=A.map(function(fT){return[fT.file,A.map(function(fU){return U.get(dk.SplitChars(A.head(fU.columns).name,["("],0),0);},fT.data)];},fJ);fN=A.map(function(fT){return fT.name;},A.filter(function(fT){var fU;fU=fT.prior;return fU==null?false:bk.Equals(fU.$0.variation,"Multiple");},fB.parameters));fO=bc.sum(A.map(function(fT){return A.length(fR(fT));},fM));fP=A.distinct(A.append(fN,A.map(function(fT){return fT[0];},A.filter(function(fT){return fS(fT[0],fT[1]);},A.groupBy(a.id,A.map(function(fT){var fU;fU=dk.SplitChars(U.last(dk.SplitChars(fT.name,["."],0)),["_"],0);return dk.concat("_",U.sub(fU,0,U.length(fU)-1));},A.filter(function(fT){return fT.name.indexOf("_")!=-1&&bX.variable(fT);},A.collect(function(fT){return fT.settings.parameters;},new B({$:1,$0:fC.top,$1:fC.systems})))))))));return dt.New(bB.codify(fC.string()),fL,fF,fM,fD.parameters,fE,fP);};bB.results_to_html_content=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fM,fN){return bz.plot_marginal(fB.marginals.get_Item(fM),fM,fN);}fC=new B({$:1,$0:["logLikelihood",false],$1:A.map(function(fM){return[fM.name,bk.Equals(fM.ptype,"Log")];},fB.parameters)});fD=A.map(function(fM){return fL(fM[0],fM[1]);},fC);fE=A.map(function(fM){var fN;fN=fM[0];return bz.plot_trace(fB.marginals.get_Item("Iteration"),fB.marginals.get_Item(fN),fN);},fC);fF=A.map(function(fM){return fM.name;},fB.parameters);fG=A.choose(function(fM){var fN,fO;fN=A.filter(function(fP){return fP.indexOf(fM+"_")!=-1;},fF);return fN.$==0?null:(fO=bz.plot_variation(fB.marginals,fB.keys,fN),{$:1,$0:["Parameter variation: "+fM,bB.gridplot(fO[1],500,1,fO[0])]});},fB.multiple_paras);fH=bz.plot_correlation(fB.correlations,fF);fI=A.mapi(function(fM,fN){var fO;fO=bz.plot_comparisons(fN.sim,fN.dat,null,fN.xlabel,fN.ylabel);return[fB.comparisons.get_Length()>1?(function(fP){return function(fQ){return fP("Comparison "+a.String(fQ));};}(a.id))(fM+1):"Comparison",bB.gridplot_with_title(fN.name,200,150,6,fO)];},fB.comparisons);fJ=A.ofArray(["Parameter name","Type","Lower bound","Upper bound","MLE","Posterior mean","Posterior stdev","Posterior l95","Posterior l68","Posterior median","Posterior u68","Posterior u95"]);fK=A.map(function(fM){return new B({$:1,$0:fM.name,$1:new B({$:1,$0:bP.to_string(fM.ptype),$1:A.map(function(fN){return function(fO){return fN(dk.PadLeft(fO.toFixed(3),1));};}(a.id),A.ofArray([fM.lb,fM.ub,fM.mle,fM.mean,fv.sqrt(fM.variance),fM.l95,fM.l68,fM.median,fM.u68,fM.u95]))})});},fB.parameters);return dv.New(fB.model,fI,bB.gridplot(200,150,6,fD),dx.ofChart(fH),bB.gridplot(300,150,4,fE),bB.table(fJ,fK),fG);};bB.codify=function(fB){var fC;fC=A.ofArray(["directive","simulation","deterministic","inference","simulator","parameters","system","sweeps","data"]);return bc.fold(function(fD,fE){return dk.Replace(fD,fE,"<font color=\\"blue\\">"+fE+"</font>");},dk.Replace("<font face=\\"courier\\">"+fB+"<font>","\\n","<br> \\n"),fC);};bB.gridplot=function(fB,fC,fD,fE){return dx.ofSubplots(bB.subplots(fB,fC,fD,fE));};bB.table=function(fB,fC){var fD,fE,fF;fD=(fE=dk.concat("\\n",A.map(function(fG){return function(fH){return fG("\\u0009\\u0009<th>"+_2.toSafe(fH)+"</th>");};}(a.id),fB)),(function(fG){return function(fH){return fG("\\u0009<tr>\\n"+_2.toSafe(fH)+"\\n\\u0009</tr>");};}(a.id))(fE));fF=dk.concat("\\n",A.map(function(fG){var fH;fH=dk.concat("\\n",A.map(function(fI){return function(fJ){return fI("\\u0009\\u0009<td>"+_2.toSafe(fJ)+"</td>");};}(a.id),fG));return(function(fI){return function(fJ){return fI("\\u0009<tr>\\n"+_2.toSafe(fJ)+"\\n\\u0009</tr>");};}(a.id))(fH);},fC));return(((fu.Curried3(function(fG,fH,fI){return fG("<table id=\\"pTable\\">\\n"+_2.toSafe(fH)+"\\n"+_2.toSafe(fI)+"\\n</table>");}))(a.id))(fD))(fF);};bB.gridplot_with_title=function(fB,fC,fD,fE,fF){return dx.ofSubplots(d7.setTitle(fB,bB.subplots(fC,fD,fE,fF)));};bB.subplots=function(fB,fC,fD,fE){return d7.setSubplotSize(fB,fC,d7.createSubplots(1+(fE.get_Length()/fD>>0),fD,function(fF,fG){return fE.get_Length()>fF*fD+fG?{$:1,$0:fE.get_Item(fF*fD+fG)}:null;}));};bC=bn.Parameter=fu.Class({isFixed:function(){return this.range.pType.$===2;},isReal:function(){return this.range.pType.$===0;}},null,bC);bC.New=function(fB,fC,fD,fE,fF){return new bC({name:fB,range:fC,initValue:fD,prior:fE,summary:fF});};bD.to_string_monomial=function(fB){function fC(fD,fE){return fE===1?fD.name:(((fu.Curried3(function(fF,fG,fH){return fF(_2.toSafe(fG)+"^"+a.String(fH));}))(a.id))(fD.name))(fE);}return R.to_string(function(fD){var fE;function fF(fH){return fH[1];}function fG(fH){return 0!==fH;}fE=dk.concat("*",A.map(function(fH){return fC(fH[0],fH[1]);},A.filter(function(fH){return fG(fF(fH));},fD)));return(function(fH){return function(fI){return fH("<"+_2.toSafe(fI)+">");};}(a.id))(fE);},fB);};bD.saturate_plots=function(fB,fC){var fD;function fE(fG){return A.zip(fB,fG);}function fF(fG){return{$:0,$0:fG};}return fC.plots.$==0?b1.New(fC.order,fC.initial_minimum,fC.log_evaluation,A.map((fD=function(fG){return fE(A.ofArray(fG));},function(fG){return fF(fD(fG));}),bD.initAllOrders(fB.get_Length(),fC.order))):fC;};bD.defaults=function(){fc.$cctor();return fc.defaults;};bD.initAllOrders=function(fB,fC){function fD(fE,fF){var fG,fH;return fE.$==1?(fG=fE.$1,(fH=fE.$0,bc.fold(function(fI,fJ){return A.append(A.map(function(fK){var fL;fL=fK.slice();U.set(fL,fH,fJ);return fL;},fD(fG,fF-fJ)),fI);},B.Empty,A.ofSeq(F.range(0,fF))))):A.ofArray([U.create(fB,0)]);}return A.filter(function(fE){return!U.forall(function(fF){return fF===0;},fE);},fD(A.ofSeq(F.range(0,fB-1)),fC));};bD.parse=function(){fc.$cctor();return fc.parse;};bD.op_BarGreaterGreater=function(fB,fC){return D.op_BarGreaterGreater(fB,fC);};bD.op_GreaterGreaterDot=function(fB,fC){return D.op_GreaterGreaterDot(fB,fC);};bD.op_DotGreaterGreaterDot=function(fB,fC){return D.op_DotGreaterGreaterDot(fB,fC);};bD.op_DotGreaterGreater=function(fB,fC){return D.op_DotGreaterGreater(fB,fC);};bD.canonicalMonomial=function(fB){return A.ofSeq(K.ToSeq(bc.fold(function(fC,fD){var fE,fF,fG;fE=fD[0];fF=fD[1];fG=K.TryFind(fE,fC);return fG!=null&&fG.$==1?fC.Add(fE,fG.$0+fF):fC.Add(fE,fF);},new y.New([]),fB)));};bD.pmonomial=function(){fc.$cctor();return fc.pmonomial;};bD.parse_defaults=function(fB){return D.record(fB,A.ofArray([["order",bD.op_BarGreaterGreater(D.pint32(),function(fC){return function(fD){return b1.New(fC,fD.initial_minimum,fD.log_evaluation,fD.plots);};})],["initial_minimum",bD.op_BarGreaterGreater(D.pfloat(),function(fC){return function(fD){return b1.New(fD.order,fC,fD.log_evaluation,fD.plots);};})],["log_evaluation",bD.op_BarGreaterGreater(D.pbool(),function(fC){return function(fD){return b1.New(fD.order,fD.initial_minimum,fC,fD.plots);};})],["plots",bD.op_BarGreaterGreater(D.list_of(bD.pplot()),function(fC){return function(fD){return b1.New(fD.order,fD.initial_minimum,fD.log_evaluation,fC);};})]]));};bD.pplot=function(){fc.$cctor();return fc.pplot;};bE.create=function(fB,fC){return bE.New(fC,fB);};bE.reverse=function(fB){return bE.New(fB.name,A.rev(fB.values));};bE.New=function(fB,fC){return{name:fB,values:fC};};bF.to_env=function(fB){return K.OfArray(U.ofSeq(A.map(function(fC){return[fC.name,fC.value];},fB)));};bF.substitute=function(fB,fC){return A.map(function(fD){return bX.substitute(fB,fD);},fC);};bF.expand_multiples=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL;fD=A.partition(bX.is_multiple,fC);fE=fD[1];fF=fD[0];fG=A.map(bX.getname,fF);fH=[0];fI=A.unzip(A.map(function(fM){return ek.add_multiples(fH,fG,fM);},fB));fJ=A.concat(bF.create_multiples(A.concat(fI[0]),fF));fK=bc.fold(function(fM,fN){return fM.Add(fN.name,A.ofArray([fN.name]));},bc.fold(function(fM,fN){return bc.fold(function(fO,fP){var fQ,fR;fQ=fP[0];fR=fP[1];return fO.ContainsKey(fQ.name)?fO.Add(fQ.name,A.append(fO.get_Item(fQ.name),A.ofArray([fR.name]))):fO.Add(fQ.name,A.ofArray([fR.name]));},fM,A.zip(fF,fN));},new y.New([]),fJ),fE);fL=A.concat(fJ);return[fI[1],A.concat([fE,A.map(function(fM){return bX.create$1(fM.name,fM.value,null);},fF),fL]),fK];};bF.create_multiples=function(fB,fC){function fD(fE){return A.map2(function(fF,fG){var fH;return bX.create$1(fG,fF.value,(fH=fF.prior,fH==null?null:{$:1,$0:bW.vary(fH.$0)}));},fC,fE);}return A.map(function(fE){return A.map(fD,fE);},fB);};bF.to_string=function(fB){return(function(fC){return function(fD){return fC("[\\n  "+_2.toSafe(fD)+";\\n]");};}(a.id))(dk.concat(";\\n  ",A.map(bX.to_string,fB)));};bF.to_string_inline=function(fB){return dk.concat("; ",A.map(function(fC){return(((fu.Curried3(function(fD,fE,fF){return fD(_2.toSafe(fE)+" = "+_2.toSafe(fF));}))(a.id))(fC.name))(a.String(fC.value));},fB));};bF.remove=function(fB,fC){return bc.fold(function(fD,fE){return A.filter(function(fF){return fF.name!==fE;},fD);},fC,fB);};bG=d.Task=fu.Class({to_string:function(){var fB;fB=this;return(function(fC){return function(fD){return fC("directive task {"+_2.toSafe(fD)+"}");};}(a.id))(dk.Join(";",U.ofSeq(bc.delay(function(){var fC;return bc.append((fC=fB.task_type,fC!=null&&fC.$==1?[(function(fD){return function(fE){return fD("task="+_2.toSafe(fE));};}(a.id))(a.String(fC.$0).toLowerCase())]:[]),bc.delay(function(){return bc.append(fB.copies!==1?[(function(fD){return function(fE){return fD("copies="+a.String(fE));};}(a.id))(fB.copies)]:[],bc.delay(function(){return bc.append(fB.copy_id!==1?[(function(fD){return function(fE){return fD("copy_id="+a.String(fE));};}(a.id))(fB.copy_id)]:[],bc.delay(function(){return fB.nodes!==1?[(function(fD){return function(fE){return fD("nodes="+a.String(fE));};}(a.id))(fB.nodes)]:[];}));}));}));}))));}},null,bG);bG.New=function(fB,fC,fD,fE){return new bG({task_type:fB,copies:fC,copy_id:fD,nodes:fE});};bH=E.Location=fu.Class({get_to_string:function(){return this.$==1?this.$0[0]+"."+this.$0[1]:this.$0;}},null,bH);bI.get_to_string=function(fB){return fB=="Normal"?"Normal":fB=="LogNormal"?"LogNormal":fB=="TruncatedNormal"?"TruncatedNormal":"Fixed";};bJ.New=function(fB,fC,fD){return{source:fB,target:fC,prior:fD};};bK.New=function(fB,fC){return{location:fB,parameters:fC};};bL.j$60=function(){return bL._v$60?bL._v$60:bL._v$60=(cj.DecodeRecord(N,[["task",bL.j$61,1],["nodes",cj.DecodeStringMap(bL.j$17),0],["edges",cj.DecodeStringMap(cj.DecodeList(bL.j$63)),0],["expanded",cj.Id(),0]]))();};bM.j$13=function(){return bM._v$13?bM._v$13:bM._v$13=(cj.EncodeRecord(N,[["task",bM.j$14,1],["nodes",cj.EncodeStringMap(bM.j$16),0],["edges",cj.EncodeStringMap(cj.EncodeList(bM.j$73)),0],["expanded",cj.Id(),0]]))();};bL.j$17=function(){return bL._v$17?bL._v$17:bL._v$17=(cj.DecodeRecord(bj,[["top",bL.j$18,0],["systems",cj.DecodeList(bL.j$18),0]]))();};bM.j$16=function(){return bM._v$16?bM._v$16:bM._v$16=(cj.EncodeRecord(bj,[["top",bM.j$17,0],["systems",cj.EncodeList(bM.j$17),0]]))();};bM.j=function(){return bM._v?bM._v:bM._v=(cj.EncodeRecord(void 0,[["content_type",cj.Id(),0],["id",cj.Id(),0],["display_name",cj.Id(),0],["node_id",cj.Id(),1],["instance",cj.Id(),1],["content",cj.EncodeArray(cj.Id()),1],["save_content",cj.Id(),1]]))();};bM.j$82=function(){return bM._v$82?bM._v$82:bM._v$82=(cj.EncodeRecord(void 0,[["nodeId",cj.Id(),0],["iteration",cj.Id(),0],["lkincreased",cj.Id(),0],["state",bM.j$83,0],["mlesims",cj.EncodeList(bM.j$95),1],["summary",cj.Id(),0]]))();};bM.j$105=function(){return bM._v$105?bM._v$105:bM._v$105=(cj.EncodeRecord(void 0,[["nodeId",cj.Id(),0],["parameters",cj.EncodeList(bM.j$106),0]]))();};bM.j$8=function(){return bM._v$8?bM._v$8:bM._v$8=(cj.EncodeRecord(void 0,[["states",cj.EncodeArray(bM.j$9),0],["start_index",cj.Id(),0],["attributes",cj.EncodeArray(cj.Id()),0]]))();};bM.j$79=function(){return bM._v$79?bM._v$79:bM._v$79=(cj.EncodeRecord(void 0,[["value_type",bM.j$80,0],["instances",cj.EncodeList(bM.j$81),0]]))();};bM.j$78=function(){return bM._v$78?bM._v$78:bM._v$78=(cj.EncodeRecord(void 0,[["time",cj.Id(),0],["values",cj.EncodeArray(cj.Id()),0]]))();};bL.j$13=function(){return bL._v$13?bL._v$13:bL._v$13=(cj.DecodeRecord(C,[["model",cj.Id(),0],["sweep",cj.Id(),0],["assignment",cj.Id(),0],["environment",cj.DecodeStringMap(cj.Id()),0],["settings",bL.j$14,0],["name",cj.Id(),0]]))();};bM.j$77=function(){return bM._v$77?bM._v$77:bM._v$77=(cj.EncodeRecord(void 0,[["name",cj.Id(),0],["structural",cj.Id(),1],["svg",cj.Id(),1]]))();};bM.j$12=function(){return bM._v$12?bM._v$12:bM._v$12=(cj.EncodeRecord(void 0,[["time",cj.Id(),0],["values",cj.EncodeArray(cj.Id()),0]]))();};bM.j$7=function(){return bM._v$7?bM._v$7:bM._v$7=(cj.EncodeRecord(void 0,[["times",cj.EncodeList(cj.Id()),0],["stateprobabilities",cj.EncodeList(cj.EncodeArray(cj.Id())),0],["stoichiometry",cj.EncodeArray(cj.EncodeArray(cj.Id())),0],["species",cj.EncodeStringDictionary(cj.Id()),0]]))();};bM.j$6=function(){return bM._v$6?bM._v$6:bM._v$6=(cj.EncodeRecord(void 0,[["times",cj.EncodeList(cj.Id()),0],["values",cj.EncodeList(cj.Id()),0],["probabilities",cj.EncodeList(cj.EncodeArray(cj.Id())),0]]))();};bL.j$16=function(){return bL._v$16?bL._v$16:bL._v$16=(cj.DecodeRecord(void 0,[["times",cj.DecodeList(cj.Id()),0],["stateprobabilities",cj.DecodeList(cj.DecodeArray(cj.Id())),0],["stoichiometry",cj.DecodeArray(cj.DecodeArray(cj.Id())),0],["species",cj.DecodeStringDictionary(cj.Id()),0]]))();};bM.j$5=function(){return bM._v$5?bM._v$5:bM._v$5=(cj.EncodeRecord(void 0,[["time",cj.Id(),0],["values",cj.EncodeArray(cj.EncodeArray(cj.Id())),0]]))();};bM.j$4=function(){return bM._v$4?bM._v$4:bM._v$4=(cj.EncodeRecord(void 0,[["time",cj.Id(),0],["values",cj.EncodeArray(cj.EncodeArray(cj.EncodeArray(cj.Id()))),0]]))();};bM.j$1=function(){return bM._v$1?bM._v$1:bM._v$1=(cj.EncodeRecord(void 0,[["times",cj.EncodeList(cj.Id()),0],["columns",cj.EncodeList(bM.j$3),0]]))();};bL.j$7=function(){return bL._v$7?bL._v$7:bL._v$7=(cj.DecodeUnion(void 0,{Item1:13,Round:12,Floor:11,Ceiling:10,Modulo:9,Log:8,Absolute:7,Minus:6,Plus:5,Power:4,Divide:3,Times:2,Float:1,Key:0},[["Key",[["$0","Key",cj.Id(),0]]],["Float",[["$0","Float",cj.Id(),0]]],["Times",[["$0","Times",cj.DecodeList(bL.j$7),0]]],["Divide",[["$0","Divide",bL.j$12,0]]],["Power",[["$0","Power",bL.j$11,0]]],["Plus",[["$0","Plus",cj.DecodeList(bL.j$7),0]]],["Minus",[["$0","Minus",bL.j$10,0]]],["Absolute",[["$0","Absolute",bL.j$7,0]]],["Log",[["$0","Log",bL.j$7,0]]],["Modulo",[["$0","Modulo",bL.j$9,0]]],["Ceiling",[["$0","Ceiling",bL.j$7,0]]],["Floor",[["$0","Floor",bL.j$7,0]]],["Round",[["$0","Round",bL.j$7,0]]],["If",[["$0","Item1",bL.j$8,0],["$1","Item2",bL.j$7,0],["$2","Item3",bL.j$7,0]]]]))();};bL.j=function(){return bL._v?bL._v:bL._v=(cj.DecodeUnion(void 0,{Item1:13,Round:12,Floor:11,Ceiling:10,Modulo:9,Log:8,Absolute:7,Minus:6,Plus:5,Power:4,Divide:3,Times:2,Float:1,Key:0},[["Key",[["$0","Key",cj.DecodeList(cj.DecodeTuple([cj.Id(),cj.Id()])),0]]],["Float",[["$0","Float",cj.Id(),0]]],["Times",[["$0","Times",cj.DecodeList(bL.j),0]]],["Divide",[["$0","Divide",bL.j$6,0]]],["Power",[["$0","Power",bL.j$5,0]]],["Plus",[["$0","Plus",cj.DecodeList(bL.j),0]]],["Minus",[["$0","Minus",bL.j$4,0]]],["Absolute",[["$0","Absolute",bL.j,0]]],["Log",[["$0","Log",bL.j,0]]],["Modulo",[["$0","Modulo",bL.j$3,0]]],["Ceiling",[["$0","Ceiling",bL.j,0]]],["Floor",[["$0","Floor",bL.j,0]]],["Round",[["$0","Round",bL.j,0]]],["If",[["$0","Item1",bL.j$2,0],["$1","Item2",bL.j,0],["$2","Item3",bL.j,0]]]]))();};bL.j$61=function(){return bL._v$61?bL._v$61:bL._v$61=(cj.DecodeRecord(bG,[["task_type",bL.j$62,1],["copies",cj.Id(),0],["copy_id",cj.Id(),0],["nodes",cj.Id(),0]]))();};bL.j$63=function(){return bL._v$63?bL._v$63:bL._v$63=(cj.DecodeRecord(void 0,[["location",bL.j$64,0],["parameters",cj.DecodeList(bL.j$65),0]]))();};bM.j$14=function(){return bM._v$14?bM._v$14:bM._v$14=(cj.EncodeRecord(bG,[["task_type",bM.j$15,1],["copies",cj.Id(),0],["copy_id",cj.Id(),0],["nodes",cj.Id(),0]]))();};bM.j$73=function(){return bM._v$73?bM._v$73:bM._v$73=(cj.EncodeRecord(void 0,[["location",bM.j$74,0],["parameters",cj.EncodeList(bM.j$75),0]]))();};bL.j$18=function(){return bL._v$18?bL._v$18:bL._v$18=(cj.DecodeRecord(z,[["name",cj.Id(),0],["settings",bL.j$19,0],["reactions",cj.DecodeList(bL.j$51),0],["initials",cj.DecodeList(bL.j$54),0],["attributes",cj.DecodeStringMap(cj.Id()),0]]))();};bM.j$17=function(){return bM._v$17?bM._v$17:bM._v$17=(cj.EncodeRecord(z,[["name",cj.Id(),0],["settings",bM.j$18,0],["reactions",cj.EncodeList(bM.j$65),0],["initials",cj.EncodeList(bM.j$68),0],["attributes",cj.EncodeStringMap(cj.Id()),0]]))();};bM.j$83=function(){return bM._v$83?bM._v$83:bM._v$83=(cj.EncodeUnion(void 0,{SamplingPhase:1,BurninPhase:0},[["BurninPhase",[["$0","BurninPhase",bM.j$93,0]]],["SamplingPhase",[["$0","SamplingPhase",bM.j$84,0]]]]))();};bM.j$95=function(){return bM._v$95?bM._v$95:bM._v$95=(cj.EncodeRecord(void 0,[["instance",bM.j$96,0],["table",bM.j$55,0]]))();};bM.j$106=function(){return bM._v$106?bM._v$106:bM._v$106=(cj.EncodeRecord(void 0,[["name",cj.Id(),0],["range",bM.j$107,0],["initValue",cj.Id(),1]]))();};bM.j$9=function(){return bM._v$9?bM._v$9:bM._v$9=(cj.EncodeRecord(void 0,[["species",cj.EncodeStringMap(cj.Id()),0],["transitions",cj.EncodeArray(cj.Id()),0]]))();};bM.j$80=function(){return bM._v$80?bM._v$80:bM._v$80=(cj.EncodeUnion(void 0,"$",[null,null,null,null,null,null]))();};bM.j$81=function(){return bM._v$81?bM._v$81:bM._v$81=(cj.EncodeRecord(C,[["model",cj.Id(),0],["sweep",cj.Id(),0],["assignment",cj.Id(),0],["environment",cj.EncodeStringMap(cj.Id()),0],["settings",bM.j$19,0],["name",cj.Id(),0]]))();};bL.j$14=function(){return bL._v$14?bL._v$14:bL._v$14=(cj.DecodeRecord(P,[["name",cj.Id(),0],["initial",cj.Id(),0],["final",cj.Id(),0],["points",cj.Id(),0],["plots",cj.DecodeList(cj.Id()),0],["plotcolours",cj.DecodeList(cj.Id()),0],["seed",cj.Id(),1],["kinetics",bL.j$15,0],["times",cj.DecodeList(cj.Id()),0],["prune",cj.Id(),0],["multicore",cj.Id(),0],["data",cj.DecodeList(cj.Id()),0],["sweeps",cj.DecodeList(cj.Id()),0]]))();};bM.j$3=function(){return bM._v$3?bM._v$3:bM._v$3=(cj.EncodeRecord(void 0,[["name",cj.Id(),0],["values",cj.EncodeList(cj.Id()),0]]))();};bL.j$12=function(){return bL._v$12?bL._v$12:bL._v$12=(cj.DecodeRecord(void 0,[["div1",bL.j$7,0],["div2",bL.j$7,0]]))();};bL.j$11=function(){return bL._v$11?bL._v$11:bL._v$11=(cj.DecodeRecord(void 0,[["base_",bL.j$7,0],["exponent",bL.j$7,0]]))();};bL.j$10=function(){return bL._v$10?bL._v$10:bL._v$10=(cj.DecodeRecord(void 0,[["sub1",bL.j$7,0],["sub2",bL.j$7,0]]))();};bL.j$9=function(){return bL._v$9?bL._v$9:bL._v$9=(cj.DecodeRecord(void 0,[["div",bL.j$7,0],["modulo",bL.j$7,0]]))();};bL.j$8=function(){return bL._v$8?bL._v$8:bL._v$8=(cj.DecodeUnion(void 0,"$",[[0,[]],[1,[]],[2,[["$0","Item1",bL.j$7,0],["$1","Item2",bL.j$7,0]]],[3,[["$0","Item1",bL.j$7,0],["$1","Item2",bL.j$7,0]]],[4,[["$0","Item1",bL.j$7,0],["$1","Item2",bL.j$7,0]]],[5,[["$0","Item1",bL.j$7,0],["$1","Item2",bL.j$7,0]]],[6,[["$0","Item1",bL.j$7,0],["$1","Item2",bL.j$7,0]]],[7,[["$0","Item",bL.j$8,0]]],[8,[["$0","Item1",bL.j$8,0],["$1","Item2",bL.j$8,0]]],[9,[["$0","Item1",bL.j$8,0],["$1","Item2",bL.j$8,0]]]]))();};bL.j$6=function(){return bL._v$6?bL._v$6:bL._v$6=(cj.DecodeRecord(void 0,[["div1",bL.j,0],["div2",bL.j,0]]))();};bL.j$5=function(){return bL._v$5?bL._v$5:bL._v$5=(cj.DecodeRecord(void 0,[["base_",bL.j,0],["exponent",bL.j,0]]))();};bL.j$4=function(){return bL._v$4?bL._v$4:bL._v$4=(cj.DecodeRecord(void 0,[["sub1",bL.j,0],["sub2",bL.j,0]]))();};bL.j$3=function(){return bL._v$3?bL._v$3:bL._v$3=(cj.DecodeRecord(void 0,[["div",bL.j,0],["modulo",bL.j,0]]))();};bL.j$2=function(){return bL._v$2?bL._v$2:bL._v$2=(cj.DecodeUnion(void 0,"$",[[0,[]],[1,[]],[2,[["$0","Item1",bL.j,0],["$1","Item2",bL.j,0]]],[3,[["$0","Item1",bL.j,0],["$1","Item2",bL.j,0]]],[4,[["$0","Item1",bL.j,0],["$1","Item2",bL.j,0]]],[5,[["$0","Item1",bL.j,0],["$1","Item2",bL.j,0]]],[6,[["$0","Item1",bL.j,0],["$1","Item2",bL.j,0]]],[7,[["$0","Item",bL.j$2,0]]],[8,[["$0","Item1",bL.j$2,0],["$1","Item2",bL.j$2,0]]],[9,[["$0","Item1",bL.j$2,0],["$1","Item2",bL.j$2,0]]]]))();};bN.p=function(fB){return fB=="MC"?"MC":fB=="PDE"?"PDE":fB=="LNA"?"LNA":fB=="CMESundials"?"CMESundials":fB=="CME"?"CME":fB=="SSA"?"SSA":fB=="Sundials"?"Sundials":"Oslo";};bL.j$62=function(){return bL._v$62?bL._v$62:bL._v$62=(cj.DecodeUnion(void 0,"$",[null,null,null]))();};bL.j$64=function(){return bL._v$64?bL._v$64:bL._v$64=(cj.DecodeUnion(bH,{SystemLoc:1,NodeLoc:0},[["NodeLoc",[["$0","NodeLoc",cj.Id(),0]]],["SystemLoc",[["$0","SystemLoc",cj.DecodeTuple([cj.Id(),cj.Id()]),0]]]]))();};bL.j$65=function(){return bL._v$65?bL._v$65:bL._v$65=(cj.DecodeRecord(void 0,[["source",cj.Id(),0],["target",cj.Id(),0],["prior",bL.j$66,0]]))();};bM.j$15=function(){return bM._v$15?bM._v$15:bM._v$15=(cj.EncodeUnion(void 0,"$",[null,null,null]))();};bM.j$74=function(){return bM._v$74?bM._v$74:bM._v$74=(cj.EncodeUnion(bH,{SystemLoc:1,NodeLoc:0},[["NodeLoc",[["$0","NodeLoc",cj.Id(),0]]],["SystemLoc",[["$0","SystemLoc",cj.EncodeTuple([cj.Id(),cj.Id()]),0]]]]))();};bM.j$75=function(){return bM._v$75?bM._v$75:bM._v$75=(cj.EncodeRecord(void 0,[["source",cj.Id(),0],["target",cj.Id(),0],["prior",bM.j$76,0]]))();};bL.j$19=function(){return bL._v$19?bL._v$19:bL._v$19=(cj.DecodeRecord(O,[["simulation",bL.j$14,0],["simulations",cj.DecodeList(bL.j$14),0],["stochastic",bL.j$20,0],["deterministic",cj.Id(),0],["spatial",bL.j$22,0],["inference",bL.j$33,0],["moment_closure",bL.j$36,0],["synthesis",bL.j$37,0],["data",cj.DecodeList(bL.j$40),0],["units",bL.j$43,0],["simulator",bL.j$47,0],["parameters",cj.DecodeList(bL.j$23),0],["sweeps",cj.DecodeList(bL.j$48),0],["rates",cj.DecodeStringMap(cj.Id()),0],["plot",bL.j$50,0],["quiet",cj.Id(),0]]))();};bL.j$51=function(){return bL._v$51?bL._v$51:bL._v$51=(cj.DecodeRecord(cc,[["catalysts",cj.DecodeList(cj.Id()),0],["reactants",cj.DecodeList(cj.Id()),0],["reverse",bL.j$53,1],["rate",bL.j$53,0],["products",cj.DecodeList(cj.Id()),0]]))();};bL.j$54=function(){return bL._v$54?bL._v$54:bL._v$54=(cj.DecodeRecord(V,[["constant",cj.Id(),0],["value",cj.Id(),0],["species",cj.Id(),0],["time",cj.Id(),1],["spatial",bL.j$55,1]]))();};bM.j$18=function(){return bM._v$18?bM._v$18:bM._v$18=(cj.EncodeRecord(O,[["simulation",bM.j$19,0],["simulations",cj.EncodeList(bM.j$19),0],["stochastic",bM.j$21,0],["deterministic",cj.Id(),0],["spatial",bM.j$23,0],["inference",bM.j$40,0],["moment_closure",bM.j$43,0],["synthesis",bM.j$51,0],["data",cj.EncodeList(bM.j$54),0],["units",bM.j$57,0],["simulator",bM.j$61,0],["parameters",cj.EncodeList(bM.j$24),0],["sweeps",cj.EncodeList(bM.j$62),0],["rates",cj.EncodeStringMap(cj.Id()),0],["plot",bM.j$64,0],["quiet",cj.Id(),0]]))();};bM.j$65=function(){return bM._v$65?bM._v$65:bM._v$65=(cj.EncodeRecord(cc,[["catalysts",cj.EncodeList(cj.Id()),0],["reactants",cj.EncodeList(cj.Id()),0],["reverse",bM.j$67,1],["rate",bM.j$67,0],["products",cj.EncodeList(cj.Id()),0]]))();};bM.j$68=function(){return bM._v$68?bM._v$68:bM._v$68=(cj.EncodeRecord(V,[["constant",cj.Id(),0],["value",cj.Id(),0],["species",cj.Id(),0],["time",cj.Id(),1],["spatial",bM.j$69,1]]))();};bM.j$93=function(){return bM._v$93?bM._v$93:bM._v$93=(cj.EncodeRecord(void 0,[["space",cj.EncodeStringDictionary(bM.j$85),0],["state",bM.j$87,0],["stats",cj.EncodeArray(cj.Id()),0],["mle",bM.j$87,0],["priors",cj.EncodeArray(bM.j$88),0],["indexes",cj.EncodeArray(cj.Id()),0]]))();};bM.j$84=function(){return bM._v$84?bM._v$84:bM._v$84=(cj.EncodeRecord(void 0,[["space",cj.EncodeStringDictionary(bM.j$85),0],["state",bM.j$87,0],["thinningSkippedCount",cj.Id(),0],["chain",cj.EncodeList(bM.j$87),0],["mle",bM.j$87,0],["priors",cj.EncodeArray(bM.j$88),0],["indexes",cj.EncodeArray(cj.Id()),0]]))();};bM.j$96=function(){return bM._v$96?bM._v$96:bM._v$96=(cj.EncodeRecord(C,[["model",cj.Id(),0],["sweep",cj.Id(),0],["assignment",cj.Id(),0],["environment",cj.EncodeStringMap(cj.Id()),0],["settings",bM.j$104,0],["name",cj.Id(),0]]))();};bM.j$55=function(){return bM._v$55?bM._v$55:bM._v$55=(cj.EncodeRecord(void 0,[["times",cj.EncodeList(cj.Id()),0],["columns",cj.EncodeList(bM.j$56),0]]))();};bM.j$107=function(){return bM._v$107?bM._v$107:bM._v$107=(cj.EncodeRecord(void 0,[["pType",bM.j$108,0],["lb",cj.Id(),0],["ub",cj.Id(),0]]))();};bM.j$19=function(){return bM._v$19?bM._v$19:bM._v$19=(cj.EncodeRecord(P,[["name",cj.Id(),0],["initial",cj.Id(),0],["final",cj.Id(),0],["points",cj.Id(),0],["plots",cj.EncodeList(cj.Id()),0],["plotcolours",cj.EncodeList(cj.Id()),0],["seed",cj.Id(),1],["kinetics",bM.j$20,0],["times",cj.EncodeList(cj.Id()),0],["prune",cj.Id(),0],["multicore",cj.Id(),0],["data",cj.EncodeList(cj.Id()),0],["sweeps",cj.EncodeList(cj.Id()),0]]))();};bL.j$15=function(){return bL._v$15?bL._v$15:bL._v$15=(cj.DecodeUnion(void 0,"$",[null,null,null]))();};bL.j$66=function(){return bL._v$66?bL._v$66:bL._v$66=(cj.DecodeUnion(void 0,"$",[null,null,null,null]))();};bM.j$76=function(){return bM._v$76?bM._v$76:bM._v$76=(cj.EncodeUnion(void 0,"$",[null,null,null,null]))();};bL.j$20=function(){return bL._v$20?bL._v$20:bL._v$20=(cj.DecodeRecord(void 0,[["scale",cj.Id(),0],["steps",cj.Id(),1],["trajectories",cj.Id(),0],["stationary_skiptime",cj.Id(),1]]))();};bL.j$22=function(){return bL._v$22?bL._v$22:bL._v$22=(cj.DecodeRecord(void 0,[["parameters",cj.DecodeList(bL.j$23),0],["diffusibles",cj.DecodeList(cj.DecodeTuple([cj.Id(),bL.j$7])),0],["dimensions",cj.Id(),0],["boundary",bL.j$32,0],["xmax",cj.Id(),0],["nx",cj.Id(),0],["dt",cj.Id(),0],["default_diffusion",cj.Id(),0],["random",cj.Id(),0]]))();};bL.j$33=function(){return bL._v$33?bL._v$33:bL._v$33=(cj.DecodeRecord(void 0,[["name",cj.Id(),0],["burnin",cj.Id(),0],["samples",cj.Id(),0],["thin",cj.Id(),0],["noise_model",bL.j$34,0],["noise_parameter",bL.j$35,0],["prune",cj.Id(),0],["seed",cj.Id(),0],["seeds",cj.DecodeList(cj.Id()),0],["lowerbound",cj.Id(),1],["timer",cj.Id(),0],["partial_evaluation",cj.Id(),0],["print_console",cj.Id(),0],["print_summary",cj.Id(),0]]))();};bL.j$36=function(){return bL._v$36?bL._v$36:bL._v$36=(cj.DecodeRecord(void 0,[["order",cj.Id(),0],["initial_minimum",cj.Id(),0],["log_evaluation",cj.Id(),0],["plots",cj.DecodeList(bL.j),0]]))();};bL.j$37=function(){return bL._v$37?bL._v$37:bL._v$37=(cj.DecodeRecord(void 0,[["mode",bL.j$38,0],["solver",bL.j$39,0],["timeout",cj.Id(),1],["seed",cj.Id(),1]]))();};bL.j$40=function(){return bL._v$40?bL._v$40:bL._v$40=(cj.DecodeRecord(void 0,[["file",cj.Id(),0],["data",cj.DecodeList(bL.j$41),0]]))();};bL.j$43=function(){return bL._v$43?bL._v$43:bL._v$43=(cj.DecodeRecord(b7,[["concentration",bL.j$44,0],["time",bL.j$45,0],["space",bL.j$46,0]]))();};bL.j$47=function(){return bL._v$47?bL._v$47:bL._v$47=(cj.DecodeUnion(void 0,"$",[null,null,null,null,null,null,null,null]))();};bL.j$23=function(){return bL._v$23?bL._v$23:bL._v$23=(cj.DecodeRecord(bX,[["name",cj.Id(),0],["value",cj.Id(),0],["prior",bL.j$24,1]]))();};bL.j$48=function(){return bL._v$48?bL._v$48:bL._v$48=(cj.DecodeRecord(b9,[["name",cj.Id(),0],["assignments",cj.DecodeList(bL.j$49),0]]))();};bL.j$50=function(){return bL._v$50?bL._v$50:bL._v$50=(cj.DecodeRecord(b_,[["x_label",cj.Id(),0],["y_label",cj.Id(),0],["title",cj.Id(),0],["label_font_size",cj.Id(),0],["tick_font_size",cj.Id(),0],["x_ticks",cj.DecodeList(cj.Id()),0],["y_ticks",cj.DecodeList(cj.Id()),0],["x_min",cj.Id(),1],["x_max",cj.Id(),1],["y_min",cj.Id(),1],["y_max",cj.Id(),1],["v_boundaries",cj.DecodeList(cj.Id()),0],["h_boundaries",cj.DecodeList(cj.Id()),0]]))();};bL.j$53=function(){return bL._v$53?bL._v$53:bL._v$53=(cj.DecodeUnion(cb,{Function:1,MassAction:0},[["MassAction",[["$0","MassAction",cj.Id(),0]]],["Function",[["$0","Function",cj.Id(),0]]]]))();};bL.j$55=function(){return bL._v$55?bL._v$55:bL._v$55=(cj.DecodeRecord(void 0,[["random",cj.Id(),0],["core",bL.j$56,1],["points",cj.DecodeList(bL.j$57),0],["rectangles",cj.DecodeList(bL.j$58),0]]))();};bM.j$21=function(){return bM._v$21?bM._v$21:bM._v$21=(cj.EncodeRecord(void 0,[["scale",cj.Id(),0],["steps",cj.Id(),1],["trajectories",cj.Id(),0],["stationary_skiptime",cj.Id(),1]]))();};bM.j$23=function(){return bM._v$23?bM._v$23:bM._v$23=(cj.EncodeRecord(void 0,[["parameters",cj.EncodeList(bM.j$24),0],["diffusibles",cj.EncodeList(cj.EncodeTuple([cj.Id(),bM.j$33])),0],["dimensions",cj.Id(),0],["boundary",bM.j$39,0],["xmax",cj.Id(),0],["nx",cj.Id(),0],["dt",cj.Id(),0],["default_diffusion",cj.Id(),0],["random",cj.Id(),0]]))();};bM.j$40=function(){return bM._v$40?bM._v$40:bM._v$40=(cj.EncodeRecord(void 0,[["name",cj.Id(),0],["burnin",cj.Id(),0],["samples",cj.Id(),0],["thin",cj.Id(),0],["noise_model",bM.j$41,0],["noise_parameter",bM.j$42,0],["prune",cj.Id(),0],["seed",cj.Id(),0],["seeds",cj.EncodeList(cj.Id()),0],["lowerbound",cj.Id(),1],["timer",cj.Id(),0],["partial_evaluation",cj.Id(),0],["print_console",cj.Id(),0],["print_summary",cj.Id(),0]]))();};bM.j$43=function(){return bM._v$43?bM._v$43:bM._v$43=(cj.EncodeRecord(void 0,[["order",cj.Id(),0],["initial_minimum",cj.Id(),0],["log_evaluation",cj.Id(),0],["plots",cj.EncodeList(bM.j$44),0]]))();};bM.j$51=function(){return bM._v$51?bM._v$51:bM._v$51=(cj.EncodeRecord(void 0,[["mode",bM.j$52,0],["solver",bM.j$53,0],["timeout",cj.Id(),1],["seed",cj.Id(),1]]))();};bM.j$54=function(){return bM._v$54?bM._v$54:bM._v$54=(cj.EncodeRecord(void 0,[["file",cj.Id(),0],["data",cj.EncodeList(bM.j$55),0]]))();};bM.j$57=function(){return bM._v$57?bM._v$57:bM._v$57=(cj.EncodeRecord(b7,[["concentration",bM.j$58,0],["time",bM.j$59,0],["space",bM.j$60,0]]))();};bM.j$61=function(){return bM._v$61?bM._v$61:bM._v$61=(cj.EncodeUnion(void 0,"$",[null,null,null,null,null,null,null,null]))();};bM.j$24=function(){return bM._v$24?bM._v$24:bM._v$24=(cj.EncodeRecord(bX,[["name",cj.Id(),0],["value",cj.Id(),0],["prior",bM.j$25,1]]))();};bM.j$62=function(){return bM._v$62?bM._v$62:bM._v$62=(cj.EncodeRecord(b9,[["name",cj.Id(),0],["assignments",cj.EncodeList(bM.j$63),0]]))();};bM.j$64=function(){return bM._v$64?bM._v$64:bM._v$64=(cj.EncodeRecord(b_,[["x_label",cj.Id(),0],["y_label",cj.Id(),0],["title",cj.Id(),0],["label_font_size",cj.Id(),0],["tick_font_size",cj.Id(),0],["x_ticks",cj.EncodeList(cj.Id()),0],["y_ticks",cj.EncodeList(cj.Id()),0],["x_min",cj.Id(),1],["x_max",cj.Id(),1],["y_min",cj.Id(),1],["y_max",cj.Id(),1],["v_boundaries",cj.EncodeList(cj.Id()),0],["h_boundaries",cj.EncodeList(cj.Id()),0]]))();};bM.j$67=function(){return bM._v$67?bM._v$67:bM._v$67=(cj.EncodeUnion(cb,{Function:1,MassAction:0},[["MassAction",[["$0","MassAction",cj.Id(),0]]],["Function",[["$0","Function",cj.Id(),0]]]]))();};bM.j$69=function(){return bM._v$69?bM._v$69:bM._v$69=(cj.EncodeRecord(void 0,[["random",cj.Id(),0],["core",bM.j$70,1],["points",cj.EncodeList(bM.j$71),0],["rectangles",cj.EncodeList(bM.j$72),0]]))();};bM.j$85=function(){return bM._v$85?bM._v$85:bM._v$85=(cj.EncodeRecord(void 0,[["pType",bM.j$86,0],["lb",cj.Id(),0],["ub",cj.Id(),0]]))();};bM.j$87=function(){return bM._v$87?bM._v$87:bM._v$87=(cj.EncodeRecord(void 0,[["values",cj.EncodeStringDictionary(cj.Id()),0],["lglk",cj.Id(),0]]))();};bM.j$88=function(){return bM._v$88?bM._v$88:bM._v$88=(cj.EncodeUnion(void 0,"$",[null,[1,[["$0","Value",bM.j$89,0]]]]))();};bM.j$104=function(){return bM._v$104?bM._v$104:bM._v$104=(cj.EncodeRecord(P,[["name",cj.Id(),0],["initial",cj.Id(),0],["final",cj.Id(),0],["points",cj.Id(),0],["plots",cj.EncodeList(bM.j$97),0],["plotcolours",cj.EncodeList(cj.Id()),0],["seed",cj.Id(),1],["kinetics",bM.j$20,0],["times",cj.EncodeList(cj.Id()),0],["prune",cj.Id(),0],["multicore",cj.Id(),0],["data",cj.EncodeList(cj.Id()),0],["sweeps",cj.EncodeList(cj.Id()),0]]))();};bM.j$56=function(){return bM._v$56?bM._v$56:bM._v$56=(cj.EncodeRecord(void 0,[["name",cj.Id(),0],["values",cj.EncodeList(cj.Id()),0]]))();};bM.j$108=function(){return bM._v$108?bM._v$108:bM._v$108=(cj.EncodeUnion(void 0,"$",[null,null,null]))();};bM.j$20=function(){return bM._v$20?bM._v$20:bM._v$20=(cj.EncodeUnion(void 0,"$",[null,null,null]))();};bL.j$32=function(){return bL._v$32?bL._v$32:bL._v$32=(cj.DecodeUnion(void 0,"$",[null,null]))();};bL.j$34=function(){return bL._v$34?bL._v$34:bL._v$34=(cj.DecodeUnion(void 0,"$",[null,null]))();};bL.j$35=function(){return bL._v$35?bL._v$35:bL._v$35=(cj.DecodeUnion(void 0,"$",[[0,[["$0","Fixed",cj.Id(),0]]],null,null]))();};bL.j$38=function(){return bL._v$38?bL._v$38:bL._v$38=(cj.DecodeUnion(void 0,"$",[null,null]))();};bL.j$39=function(){return bL._v$39?bL._v$39:bL._v$39=(cj.DecodeUnion(void 0,"$",[null,null]))();};bL.j$41=function(){return bL._v$41?bL._v$41:bL._v$41=(cj.DecodeRecord(void 0,[["times",cj.DecodeList(cj.Id()),0],["columns",cj.DecodeList(bL.j$42),0]]))();};bL.j$44=function(){return bL._v$44?bL._v$44:bL._v$44=(cj.DecodeUnion(b4,{Molar:0},[["Molar",[["$0","Molar",cj.Id(),0]]]]))();};bL.j$45=function(){return bL._v$45?bL._v$45:bL._v$45=(cj.DecodeUnion(b5,{Seconds:0},[["Seconds",[["$0","Seconds",cj.Id(),0]]]]))();};bL.j$46=function(){return bL._v$46?bL._v$46:bL._v$46=(cj.DecodeUnion(b6,{Metres:0},[["Metres",[["$0","Metres",cj.Id(),0]]]]))();};bL.j$24=function(){return bL._v$24?bL._v$24:bL._v$24=(cj.DecodeRecord(void 0,[["interval",bL.j$25,0],["distribution",bL.j$26,0],["variation",bL.j$31,0]]))();};bL.j$49=function(){return bL._v$49?bL._v$49:bL._v$49=(cj.DecodeRecord(b8,[["variables",cj.DecodeList(cj.Id()),0],["values",cj.DecodeList(cj.DecodeList(bL.j$7)),0]]))();};bL.j$56=function(){return bL._v$56?bL._v$56:bL._v$56=(cj.DecodeRecord(ce,[["inner",cj.Id(),0],["outer",cj.Id(),0],["width",cj.Id(),0]]))();};bL.j$57=function(){return bL._v$57?bL._v$57:bL._v$57=(cj.DecodeRecord(cf,[["x",cj.Id(),0],["y",cj.Id(),0],["width",cj.Id(),0],["value",cj.Id(),0]]))();};bL.j$58=function(){return bL._v$58?bL._v$58:bL._v$58=(cj.DecodeRecord(cg,[["xmin",cj.Id(),0],["xmax",cj.Id(),0],["ymin",cj.Id(),0],["ymax",cj.Id(),0],["value",cj.Id(),0]]))();};bM.j$33=function(){return bM._v$33?bM._v$33:bM._v$33=(cj.EncodeUnion(void 0,{Item1:13,Round:12,Floor:11,Ceiling:10,Modulo:9,Log:8,Absolute:7,Minus:6,Plus:5,Power:4,Divide:3,Times:2,Float:1,Key:0},[["Key",[["$0","Key",cj.Id(),0]]],["Float",[["$0","Float",cj.Id(),0]]],["Times",[["$0","Times",cj.EncodeList(bM.j$33),0]]],["Divide",[["$0","Divide",bM.j$38,0]]],["Power",[["$0","Power",bM.j$37,0]]],["Plus",[["$0","Plus",cj.EncodeList(bM.j$33),0]]],["Minus",[["$0","Minus",bM.j$36,0]]],["Absolute",[["$0","Absolute",bM.j$33,0]]],["Log",[["$0","Log",bM.j$33,0]]],["Modulo",[["$0","Modulo",bM.j$35,0]]],["Ceiling",[["$0","Ceiling",bM.j$33,0]]],["Floor",[["$0","Floor",bM.j$33,0]]],["Round",[["$0","Round",bM.j$33,0]]],["If",[["$0","Item1",bM.j$34,0],["$1","Item2",bM.j$33,0],["$2","Item3",bM.j$33,0]]]]))();};bM.j$39=function(){return bM._v$39?bM._v$39:bM._v$39=(cj.EncodeUnion(void 0,"$",[null,null]))();};bM.j$41=function(){return bM._v$41?bM._v$41:bM._v$41=(cj.EncodeUnion(void 0,"$",[null,null]))();};bM.j$42=function(){return bM._v$42?bM._v$42:bM._v$42=(cj.EncodeUnion(void 0,"$",[[0,[["$0","Fixed",cj.Id(),0]]],null,null]))();};bM.j$44=function(){return bM._v$44?bM._v$44:bM._v$44=(cj.EncodeUnion(void 0,{Item1:13,Round:12,Floor:11,Ceiling:10,Modulo:9,Log:8,Absolute:7,Minus:6,Plus:5,Power:4,Divide:3,Times:2,Float:1,Key:0},[["Key",[["$0","Key",cj.EncodeList(cj.EncodeTuple([cj.Id(),cj.Id()])),0]]],["Float",[["$0","Float",cj.Id(),0]]],["Times",[["$0","Times",cj.EncodeList(bM.j$44),0]]],["Divide",[["$0","Divide",bM.j$50,0]]],["Power",[["$0","Power",bM.j$49,0]]],["Plus",[["$0","Plus",cj.EncodeList(bM.j$44),0]]],["Minus",[["$0","Minus",bM.j$48,0]]],["Absolute",[["$0","Absolute",bM.j$44,0]]],["Log",[["$0","Log",bM.j$44,0]]],["Modulo",[["$0","Modulo",bM.j$47,0]]],["Ceiling",[["$0","Ceiling",bM.j$44,0]]],["Floor",[["$0","Floor",bM.j$44,0]]],["Round",[["$0","Round",bM.j$44,0]]],["If",[["$0","Item1",bM.j$46,0],["$1","Item2",bM.j$44,0],["$2","Item3",bM.j$44,0]]]]))();};bM.j$52=function(){return bM._v$52?bM._v$52:bM._v$52=(cj.EncodeUnion(void 0,"$",[null,null]))();};bM.j$53=function(){return bM._v$53?bM._v$53:bM._v$53=(cj.EncodeUnion(void 0,"$",[null,null]))();};bM.j$58=function(){return bM._v$58?bM._v$58:bM._v$58=(cj.EncodeUnion(b4,{Molar:0},[["Molar",[["$0","Molar",cj.Id(),0]]]]))();};bM.j$59=function(){return bM._v$59?bM._v$59:bM._v$59=(cj.EncodeUnion(b5,{Seconds:0},[["Seconds",[["$0","Seconds",cj.Id(),0]]]]))();};bM.j$60=function(){return bM._v$60?bM._v$60:bM._v$60=(cj.EncodeUnion(b6,{Metres:0},[["Metres",[["$0","Metres",cj.Id(),0]]]]))();};bM.j$25=function(){return bM._v$25?bM._v$25:bM._v$25=(cj.EncodeRecord(void 0,[["interval",bM.j$26,0],["distribution",bM.j$27,0],["variation",bM.j$32,0]]))();};bM.j$63=function(){return bM._v$63?bM._v$63:bM._v$63=(cj.EncodeRecord(b8,[["variables",cj.EncodeList(cj.Id()),0],["values",cj.EncodeList(cj.EncodeList(bM.j$33)),0]]))();};bM.j$70=function(){return bM._v$70?bM._v$70:bM._v$70=(cj.EncodeRecord(ce,[["inner",cj.Id(),0],["outer",cj.Id(),0],["width",cj.Id(),0]]))();};bM.j$71=function(){return bM._v$71?bM._v$71:bM._v$71=(cj.EncodeRecord(cf,[["x",cj.Id(),0],["y",cj.Id(),0],["width",cj.Id(),0],["value",cj.Id(),0]]))();};bM.j$72=function(){return bM._v$72?bM._v$72:bM._v$72=(cj.EncodeRecord(cg,[["xmin",cj.Id(),0],["xmax",cj.Id(),0],["ymin",cj.Id(),0],["ymax",cj.Id(),0],["value",cj.Id(),0]]))();};bM.j$86=function(){return bM._v$86?bM._v$86:bM._v$86=(cj.EncodeUnion(void 0,"$",[[0,[]],[1,[]],[2,[]]]))();};bM.j$89=function(){return bM._v$89?bM._v$89:bM._v$89=(cj.EncodeUnion(void 0,"$",[[0,[[null,true,cj.Id()]]],[1,[[null,true,cj.Id()]]],[2,[[null,true,cj.Id()]]]]))();};bM.j$97=function(){return bM._v$97?bM._v$97:bM._v$97=(cj.EncodeUnion(void 0,{Item1:13,Round:12,Floor:11,Ceiling:10,Modulo:9,Log:8,Absolute:7,Minus:6,Plus:5,Power:4,Divide:3,Times:2,Float:1,Key:0},[["Key",[["$0","Key",bM.j$98,0]]],["Float",[["$0","Float",cj.Id(),0]]],["Times",[["$0","Times",cj.EncodeList(bM.j$97),0]]],["Divide",[["$0","Divide",bM.j$103,0]]],["Power",[["$0","Power",bM.j$102,0]]],["Plus",[["$0","Plus",cj.EncodeList(bM.j$97),0]]],["Minus",[["$0","Minus",bM.j$101,0]]],["Absolute",[["$0","Absolute",bM.j$97,0]]],["Log",[["$0","Log",bM.j$97,0]]],["Modulo",[["$0","Modulo",bM.j$100,0]]],["Ceiling",[["$0","Ceiling",bM.j$97,0]]],["Floor",[["$0","Floor",bM.j$97,0]]],["Round",[["$0","Round",bM.j$97,0]]],["If",[["$0","Item1",bM.j$99,0],["$1","Item2",bM.j$97,0],["$2","Item3",bM.j$97,0]]]]))();};bL.j$42=function(){return bL._v$42?bL._v$42:bL._v$42=(cj.DecodeRecord(void 0,[["name",cj.Id(),0],["values",cj.DecodeList(cj.Id()),0]]))();};bL.j$25=function(){return bL._v$25?bL._v$25:bL._v$25=(cj.DecodeUnion(void 0,"$",[null,null]))();};bL.j$26=function(){return bL._v$26?bL._v$26:bL._v$26=(cj.DecodeUnion(bU,{TruncatedNormal:3,LogNormal:2,Normal:1,Uniform:0},[["Uniform",[["$0","Uniform",bL.j$30,0]]],["Normal",[["$0","Normal",bL.j$29,0]]],["LogNormal",[["$0","LogNormal",bL.j$28,0]]],["TruncatedNormal",[["$0","TruncatedNormal",bL.j$27,0]]]]))();};bL.j$31=function(){return bL._v$31?bL._v$31:bL._v$31=(cj.DecodeUnion(void 0,"$",[null,null,null,null]))();};bM.j$38=function(){return bM._v$38?bM._v$38:bM._v$38=(cj.EncodeRecord(void 0,[["div1",bM.j$33,0],["div2",bM.j$33,0]]))();};bM.j$37=function(){return bM._v$37?bM._v$37:bM._v$37=(cj.EncodeRecord(void 0,[["base_",bM.j$33,0],["exponent",bM.j$33,0]]))();};bM.j$36=function(){return bM._v$36?bM._v$36:bM._v$36=(cj.EncodeRecord(void 0,[["sub1",bM.j$33,0],["sub2",bM.j$33,0]]))();};bM.j$35=function(){return bM._v$35?bM._v$35:bM._v$35=(cj.EncodeRecord(void 0,[["div",bM.j$33,0],["modulo",bM.j$33,0]]))();};bM.j$34=function(){return bM._v$34?bM._v$34:bM._v$34=(cj.EncodeUnion(void 0,"$",[[0,[]],[1,[]],[2,[["$0","Item1",bM.j$33,0],["$1","Item2",bM.j$33,0]]],[3,[["$0","Item1",bM.j$33,0],["$1","Item2",bM.j$33,0]]],[4,[["$0","Item1",bM.j$33,0],["$1","Item2",bM.j$33,0]]],[5,[["$0","Item1",bM.j$33,0],["$1","Item2",bM.j$33,0]]],[6,[["$0","Item1",bM.j$33,0],["$1","Item2",bM.j$33,0]]],[7,[["$0","Item",bM.j$34,0]]],[8,[["$0","Item1",bM.j$34,0],["$1","Item2",bM.j$34,0]]],[9,[["$0","Item1",bM.j$34,0],["$1","Item2",bM.j$34,0]]]]))();};bM.j$50=function(){return bM._v$50?bM._v$50:bM._v$50=(cj.EncodeRecord(void 0,[["div1",bM.j$44,0],["div2",bM.j$44,0]]))();};bM.j$49=function(){return bM._v$49?bM._v$49:bM._v$49=(cj.EncodeRecord(void 0,[["base_",bM.j$44,0],["exponent",bM.j$44,0]]))();};bM.j$48=function(){return bM._v$48?bM._v$48:bM._v$48=(cj.EncodeRecord(void 0,[["sub1",bM.j$44,0],["sub2",bM.j$44,0]]))();};bM.j$47=function(){return bM._v$47?bM._v$47:bM._v$47=(cj.EncodeRecord(void 0,[["div",bM.j$44,0],["modulo",bM.j$44,0]]))();};bM.j$46=function(){return bM._v$46?bM._v$46:bM._v$46=(cj.EncodeUnion(void 0,"$",[[0,[]],[1,[]],[2,[["$0","Item1",bM.j$44,0],["$1","Item2",bM.j$44,0]]],[3,[["$0","Item1",bM.j$44,0],["$1","Item2",bM.j$44,0]]],[4,[["$0","Item1",bM.j$44,0],["$1","Item2",bM.j$44,0]]],[5,[["$0","Item1",bM.j$44,0],["$1","Item2",bM.j$44,0]]],[6,[["$0","Item1",bM.j$44,0],["$1","Item2",bM.j$44,0]]],[7,[["$0","Item",bM.j$46,0]]],[8,[["$0","Item1",bM.j$46,0],["$1","Item2",bM.j$46,0]]],[9,[["$0","Item1",bM.j$46,0],["$1","Item2",bM.j$46,0]]]]))();};bM.j$26=function(){return bM._v$26?bM._v$26:bM._v$26=(cj.EncodeUnion(void 0,"$",[null,null]))();};bM.j$27=function(){return bM._v$27?bM._v$27:bM._v$27=(cj.EncodeUnion(bU,{TruncatedNormal:3,LogNormal:2,Normal:1,Uniform:0},[["Uniform",[["$0","Uniform",bM.j$31,0]]],["Normal",[["$0","Normal",bM.j$30,0]]],["LogNormal",[["$0","LogNormal",bM.j$29,0]]],["TruncatedNormal",[["$0","TruncatedNormal",bM.j$28,0]]]]))();};bM.j$32=function(){return bM._v$32?bM._v$32:bM._v$32=(cj.EncodeUnion(void 0,"$",[null,null,null,null]))();};bM.j$98=function(){return bM._v$98?bM._v$98:bM._v$98=(cj.EncodeUnion(void 0,"$",[[0,[["$0","Item",cj.Id(),0]]],[1,[["$0","Item",cj.Id(),0]]],[2,[[null,true,cj.Id()]]],[3,[]]]))();};bM.j$103=function(){return bM._v$103?bM._v$103:bM._v$103=(cj.EncodeRecord(void 0,[["div1",bM.j$97,0],["div2",bM.j$97,0]]))();};bM.j$102=function(){return bM._v$102?bM._v$102:bM._v$102=(cj.EncodeRecord(void 0,[["base_",bM.j$97,0],["exponent",bM.j$97,0]]))();};bM.j$101=function(){return bM._v$101?bM._v$101:bM._v$101=(cj.EncodeRecord(void 0,[["sub1",bM.j$97,0],["sub2",bM.j$97,0]]))();};bM.j$100=function(){return bM._v$100?bM._v$100:bM._v$100=(cj.EncodeRecord(void 0,[["div",bM.j$97,0],["modulo",bM.j$97,0]]))();};bM.j$99=function(){return bM._v$99?bM._v$99:bM._v$99=(cj.EncodeUnion(void 0,"$",[[0,[]],[1,[]],[2,[["$0","Item1",bM.j$97,0],["$1","Item2",bM.j$97,0]]],[3,[["$0","Item1",bM.j$97,0],["$1","Item2",bM.j$97,0]]],[4,[["$0","Item1",bM.j$97,0],["$1","Item2",bM.j$97,0]]],[5,[["$0","Item1",bM.j$97,0],["$1","Item2",bM.j$97,0]]],[6,[["$0","Item1",bM.j$97,0],["$1","Item2",bM.j$97,0]]],[7,[["$0","Item",bM.j$99,0]]],[8,[["$0","Item1",bM.j$99,0],["$1","Item2",bM.j$99,0]]],[9,[["$0","Item1",bM.j$99,0],["$1","Item2",bM.j$99,0]]]]))();};bL.j$30=function(){return bL._v$30?bL._v$30:bL._v$30=(cj.DecodeRecord(bT,[["min",cj.Id(),0],["max",cj.Id(),0]]))();};bL.j$29=function(){return bL._v$29?bL._v$29:bL._v$29=(cj.DecodeRecord(bS,[["mean",cj.Id(),0],["stdev",cj.Id(),0]]))();};bL.j$28=function(){return bL._v$28?bL._v$28:bL._v$28=(cj.DecodeRecord(bR,[["mu",cj.Id(),0],["sigma",cj.Id(),0]]))();};bL.j$27=function(){return bL._v$27?bL._v$27:bL._v$27=(cj.DecodeRecord(bQ,[["mean",cj.Id(),0],["stdev",cj.Id(),0],["min",cj.Id(),0],["max",cj.Id(),0]]))();};bM.j$31=function(){return bM._v$31?bM._v$31:bM._v$31=(cj.EncodeRecord(bT,[["min",cj.Id(),0],["max",cj.Id(),0]]))();};bM.j$30=function(){return bM._v$30?bM._v$30:bM._v$30=(cj.EncodeRecord(bS,[["mean",cj.Id(),0],["stdev",cj.Id(),0]]))();};bM.j$29=function(){return bM._v$29?bM._v$29:bM._v$29=(cj.EncodeRecord(bR,[["mu",cj.Id(),0],["sigma",cj.Id(),0]]))();};bM.j$28=function(){return bM._v$28?bM._v$28:bM._v$28=(cj.EncodeRecord(bQ,[["mean",cj.Id(),0],["stdev",cj.Id(),0],["min",cj.Id(),0],["max",cj.Id(),0]]))();};bO.to_string=function(fB){return bO.to_string_defaults(bO.get_defaults(),fB);};bO.get_defaults=function(){return bO.New(false,1E-06,1E-05);};bO.to_string_defaults=function(fB,fC){return db.emit_record(fB,A.ofArray([["stiff",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.stiff);}],["reltolerance",function(fD){return a.String(fD.reltolerance);}],["abstolerance",function(fD){return a.String(fD.abstolerance);}]]),fC);};bO.get_parse=function(){return bO.parse_defaults(bO.get_defaults());};bO.parse_defaults=function(fB){var fC;function fD(fJ,fK){return dz.op_DotGreaterGreater(D.pbool(),fC,fJ,fK);}function fE(fJ,fK){return bO.New(fJ,fK.abstolerance,fK.reltolerance);}function fF(fJ,fK){return dz.op_DotGreaterGreater(D.pfloat(),fC,fJ,fK);}function fG(fJ,fK){return bO.New(fK.stiff,fJ,fK.reltolerance);}function fH(fJ,fK){return dz.op_DotGreaterGreater(D.pfloat(),fC,fJ,fK);}function fI(fJ,fK){return bO.New(fK.stiff,fK.abstolerance,fJ);}fC=D.spaces();return D.record(fB,A.ofArray([["stiff",function(fJ){return dz.op_BarGreaterGreater(function(fK){return fD(fK[0],fK[1]);},function(fK){return function(fL){return fE(fK,fL);};},fJ[0],fJ[1]);}],["abstolerance",function(fJ){return dz.op_BarGreaterGreater(function(fK){return fF(fK[0],fK[1]);},function(fK){return function(fL){return fG(fK,fL);};},fJ[0],fJ[1]);}],["reltolerance",function(fJ){return dz.op_BarGreaterGreater(function(fK){return fH(fK[0],fK[1]);},function(fK){return function(fL){return fI(fK,fL);};},fJ[0],fJ[1]);}]]));};bO.New=function(fB,fC,fD){return{stiff:fB,abstolerance:fC,reltolerance:fD};};bP.to_string=function(fB){return fB=="Log"?"Log":"Real";};bP.get_parse=function(){var fB,fC,fD;function fE(fG){return"Real";}function fF(fG){return"Log";}fB=D.choice([(fC=D.kw("Real"),function(fG){return dz.op_BarGreaterGreater(fC,fE,fG[0],fG[1]);}),(fD=D.kw("Log"),function(fG){return dz.op_BarGreaterGreater(fD,fF,fG[0],fG[1]);})]);return function(fG){return fB([fG[0],fG[1]]);};};bQ=d.Truncated=fu.Class({},null,bQ);bQ.New=function(fB,fC,fD,fE){return new bQ({mean:fB,stdev:fC,min:fD,max:fE});};bR=d.LogNormal=fu.Class({mode:function(){return fv.exp(this.mu-this.sigma*this.sigma);},quantile:function(fB){return fv.exp(dn.erfinv(2*fB-1)*fv.sqrt(2)*this.sigma+this.mu);}},null,bR);bR.New=function(fB,fC){return new bR({mu:fB,sigma:fC});};bS=d.Normal=fu.Class({},null,bS);bS.New=function(fB,fC){return new bS({mean:fB,stdev:fC});};bT=d.Uniform=fu.Class({},null,bT);bT.New=function(fB,fC){return new bT({min:fB,max:fC});};bU=d.Distribution=fu.Class({},null,bU);bU.to_string=function(fB){return fB.$==1?(((fu.Curried3(function(fC,fD,fE){return fC("Normal("+_2.toSafe(fD)+","+_2.toSafe(fE)+")");}))(a.id))(a.String(fB.$0.mean)))(a.String(fB.$0.stdev)):fB.$==2?(((fu.Curried3(function(fC,fD,fE){return fC("LogNormal("+_2.toSafe(fD)+","+_2.toSafe(fE)+")");}))(a.id))(a.String(fB.$0.mu)))(a.String(fB.$0.sigma)):fB.$==3?(((((fu.Curried(function(fC,fD,fE,fF,fG){return fC("TruncatedNormal("+_2.toSafe(fD)+","+_2.toSafe(fE)+","+_2.toSafe(fF)+","+_2.toSafe(fG)+")");},5))(a.id))(a.String(fB.$0.mean)))(a.String(fB.$0.stdev)))(a.String(fB.$0.min)))(a.String(fB.$0.max)):(((fu.Curried3(function(fC,fD,fE){return fC("Uniform("+_2.toSafe(fD)+","+_2.toSafe(fE)+")");}))(a.id))(a.String(fB.$0.min)))(a.String(fB.$0.max));};bU.get_parse=function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5;function f6(f_,f$){return new bU({$:0,$0:bT.New(f_,f$)});}function f7(f_,f$){return new bU({$:1,$0:bS.New(f_,f$)});}function f8(f_,f$){return new bU({$:2,$0:bR.New(f_,f$)});}function f9(f_,f$){return new bU({$:3,$0:bQ.New(f_[0],f_[1],f$[0],f$[1])});}fB=D.choice([(fC=(fD=D.kw("Uniform"),(fE=(fF=(fG=(fH=D.skw(","),function(f_){return dz.op_GreaterGreaterDot(fH,D.pfloat(),f_[0],f_[1]);}),function(f_){return dz.op_DotGreaterGreaterDot(D.pfloat(),fG,f_[0],f_[1]);}),(D.bracket("(",")"))(fF)),function(f_){return dz.op_GreaterGreaterDot(fD,fE,f_[0],f_[1]);})),function(f_){return dz.op_BarGreaterGreater(fC,function(f$){return f6(f$[0],f$[1]);},f_[0],f_[1]);}),(fI=(fJ=D.kw("Normal"),(fK=(fL=(fM=(fN=D.skw(","),function(f_){return dz.op_GreaterGreaterDot(fN,D.pfloat(),f_[0],f_[1]);}),function(f_){return dz.op_DotGreaterGreaterDot(D.pfloat(),fM,f_[0],f_[1]);}),(D.bracket("(",")"))(fL)),function(f_){return dz.op_GreaterGreaterDot(fJ,fK,f_[0],f_[1]);})),function(f_){return dz.op_BarGreaterGreater(fI,function(f$){return f7(f$[0],f$[1]);},f_[0],f_[1]);}),(fO=(fP=D.kw("LogNormal"),(fQ=(fR=(fS=(fT=D.skw(","),function(f_){return dz.op_GreaterGreaterDot(fT,D.pfloat(),f_[0],f_[1]);}),function(f_){return dz.op_DotGreaterGreaterDot(D.pfloat(),fS,f_[0],f_[1]);}),(D.bracket("(",")"))(fR)),function(f_){return dz.op_GreaterGreaterDot(fP,fQ,f_[0],f_[1]);})),function(f_){return dz.op_BarGreaterGreater(fO,function(f$){return f8(f$[0],f$[1]);},f_[0],f_[1]);}),(fU=(fV=D.kw("TruncatedNormal"),(fW=(fX=(fY=(fZ=(f0=(f1=D.skw(","),function(f_){return dz.op_GreaterGreaterDot(f1,D.pfloat(),f_[0],f_[1]);}),function(f_){return dz.op_DotGreaterGreaterDot(D.pfloat(),f0,f_[0],f_[1]);}),(f2=D.skw(","),function(f_){return dz.op_DotGreaterGreater(fZ,f2,f_[0],f_[1]);})),(f3=(f4=(f5=D.skw(","),function(f_){return dz.op_GreaterGreaterDot(f5,D.pfloat(),f_[0],f_[1]);}),function(f_){return dz.op_DotGreaterGreaterDot(D.pfloat(),f4,f_[0],f_[1]);}),function(f_){return dz.op_DotGreaterGreaterDot(fY,f3,f_[0],f_[1]);})),(D.bracket("(",")"))(fX)),function(f_){return dz.op_GreaterGreaterDot(fV,fW,f_[0],f_[1]);})),function(f_){return dz.op_BarGreaterGreater(fU,function(f$){return f9(f$[0],f$[1]);},f_[0],f_[1]);})]);return function(f_){return fB([f_[0],f_[1]]);};};bV.to_string=function(fB){return fB=="Fixed"?"Fixed":fB=="Initial"?"Initial":fB=="Multiple"?"Multiple":"Random";};bV.get_parse=function(){var fB,fC,fD,fE,fF;function fG(fK){return"Random";}function fH(fK){return"Fixed";}function fI(fK){return"Initial";}function fJ(fK){return"Multiple";}fB=D.choice([(fC=D.kw("Random"),function(fK){return dz.op_BarGreaterGreater(fC,fG,fK[0],fK[1]);}),(fD=D.kw("Fixed"),function(fK){return dz.op_BarGreaterGreater(fD,fH,fK[0],fK[1]);}),(fE=D.kw("Initial"),function(fK){return dz.op_BarGreaterGreater(fE,fI,fK[0],fK[1]);}),(fF=D.kw("Multiple"),function(fK){return dz.op_BarGreaterGreater(fF,fJ,fK[0],fK[1]);})]);return function(fK){return fB([fK[0],fK[1]]);};};bW.is_fixed=function(fB){return bk.Equals(fB.variation,"Fixed");};bW.is_multiple=function(fB){return bk.Equals(fB.variation,"Multiple");};bW.vary=function(fB){return bW.New(fB.interval,fB.distribution,"Random");};bW.to_string=function(fB){return((((fu.Curried(function(fC,fD,fE,fF){return fC("{interval="+_2.toSafe(fD)+"; distribution="+_2.toSafe(fE)+"; variation="+_2.toSafe(fF)+"}");},4))(a.id))(bP.to_string(fB.interval)))(bU.to_string(fB.distribution)))(bV.to_string(fB.variation));};bW.get_parse=function(){var fB,fC,fD;function fE(fH,fI){return bW.New(fH,fI.distribution,fI.variation);}function fF(fH,fI){return bW.New(fI.interval,fH,fI.variation);}function fG(fH,fI){return bW.New(fI.interval,fI.distribution,fH);}return D.record(bW.get_empty(),A.ofArray([["interval",(fB=bP.get_parse(),function(fH){return dz.op_BarGreaterGreater(fB,function(fI){return function(fJ){return fE(fI,fJ);};},fH[0],fH[1]);})],["distribution",(fC=bU.get_parse(),function(fH){return dz.op_BarGreaterGreater(fC,function(fI){return function(fJ){return fF(fI,fJ);};},fH[0],fH[1]);})],["variation",(fD=bV.get_parse(),function(fH){return dz.op_BarGreaterGreater(fD,function(fI){return function(fJ){return fG(fI,fJ);};},fH[0],fH[1]);})]]));};bW.get_empty=function(){return bW.New("Log",new bU({$:0,$0:bT.New(0,0)}),"Random");};bW.New=function(fB,fC,fD){return{interval:fB,distribution:fC,variation:fD};};bX=d.Parameter=fu.Class({},null,bX);bX.variable=function(fB){var fC;fC=fB.prior;return fC!=null&&fC.$==1&&!bW.is_fixed(fC.$0);};bX.substitute=function(fB,fC){var fD;fD=K.TryFind(fC.name,fB);return fD!=null&&fD.$==1?bX.create$1(fC.name,fD.$0,fC.prior):fC;};bX.is_multiple=function(fB){var fC;fC=fB.prior;return fC!=null&&fC.$==1&&bW.is_multiple(fC.$0);};bX.create$1=function(fB,fC,fD){return bX.New(fB,fC,fD);};bX.getname=function(fB){return fB.name;};bX.to_string=function(fB){var fC,fD;fC=(fD=fB.prior,fD==null?"":(function(fE){return function(fF){return fE(", "+_2.toSafe(fF));};}(a.id))(bW.to_string(fD.$0)));return((((fu.Curried(function(fE,fF,fG,fH){return fE(_2.toSafe(fF)+" = "+_2.toSafe(fG)+_2.toSafe(fH));},4))(a.id))(fB.name))(a.String(fB.value)))(fC);};bX.to_filzbach=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT;fC=fB.prior;return fC==null?bC.New(fB.name,br.New(ck.Fixed,fB.value,fB.value),{$:1,$0:fB.value},null,false):(fD=fC.$0,(fE=bk.Equals(fD.variation,"Fixed")?ck.Fixed:fD.interval=="Log"?ck.Log:ck.Real,(fF=(fG=fD.distribution,fG.$==1?(fH=fG.$0.stdev,(fI=fG.$0.mean,(fJ=20,(fK=fI-fJ*fH,(fL=fI+fJ*fH,fE.$==1?br.New(fE,(fM=0,bk.Compare(fK,fM)===1?fK:fM),fL):fE.$==2?br.New(fE,fI,fI):br.New(fE,fK,fL)))))):fG.$==2?(fN=fG.$0,br.New(fE,fN.quantile(1E-06),fN.quantile(1-1E-06))):fG.$==3?(fO=fG.$0,br.New(fE,fO.min,fO.max)):br.New(fE,fG.$0.min,fG.$0.max)),(fP=(fQ=fD.distribution,fQ.$==1?(fR=fQ.$0,[{$:1,$0:bn.createNormal(fR.mean,fR.stdev)},fR.mean]):fQ.$==2?(fS=fQ.$0,[{$:1,$0:bn.createLogNormal(fS.mu,fS.sigma)},fS.mode()]):fQ.$==3?(fT=fQ.$0,[{$:1,$0:bn.createTruncatedNormal(fT.mean,fT.stdev,fT.min,fT.max)},fT.mean]):[null,fB.value]),bC.New(fB.name,fF,{$:1,$0:fP[1]},fP[0],true)))));};bX.get_parse=function(){var fB,fC,fD;function fE(fF,fG){var fH,fI,fJ,fK,fL;function fM(fN){return D.preturn(bX.create$1(fF,fG,{$:1,$0:fN}));}fH=(fI=(fJ=D.skw(","),(fK=bW.get_parse(),function(fN){return dz.op_GreaterGreaterDot(fJ,fK,fN[0],fN[1]);})),function(fN){return dz.op_GreaterGreaterEquals(fI,fM,fN[0],fN[1]);});fL=D.preturn(bX.create$1(fF,fG,null));return function(fN){return dz.op_LessBarGreater(fH,fL,fN[0],fN[1]);};}fB=(fC=(fD=D.skw("="),function(fF){return dz.op_GreaterGreaterDot(fD,D.pfloat(),fF[0],fF[1]);}),function(fF){return dz.op_DotGreaterGreaterDot(D.name(),fC,fF[0],fF[1]);});return function(fF){return dz.op_GreaterGreaterEquals(fB,function(fG){return fE(fG[0],fG[1]);},fF[0],fF[1]);};};bX.New=function(fB,fC,fD){return new bX({name:fB,value:fC,prior:fD});};bY.to_string=function(fB){return fB=="Proportional"?"proportional":"constant";};bY.get_parse=function(){var fB;fB=D.choice([D.op_GreaterGreaterPercent(D.kw("constant"),"Constant"),D.op_GreaterGreaterPercent(D.kw("proportional"),"Proportional")]);return function(fC){return fB([fC[0],fC[1]]);};};bZ.to_string=function(fB){return fB=="Random"?"Random":fB=="Multiple"?"Multiple":(function(fC){return function(fD){return fC("Fixed("+fD.toFixed(6)+")");};}(a.id))(fB.$0);};bZ.get_parse=function(){var fB,fC;fB=D.choice([D.op_BarGreaterGreater(D.op_GreaterGreaterDot(D.kw("Fixed"),(fC=D.pfloat(),(D.bracket("(",")"))(fC))),function(fD){return{$:0,$0:fD};}),D.op_GreaterGreaterPercent(D.kw("Random"),"Random"),D.op_GreaterGreaterPercent(D.kw("Multiple"),"Multiple")]);return function(fD){return fB([fD[0],fD[1]]);};};b0.get_defaults=function(){return b0.New("default",100,100,10,"Constant","Random",false,0,B.Empty,null,false,false,true,true);};b0.get_to_string=function(){var fB,fC;fB=b0.get_defaults();fC=A.ofArray([["name",function(fD){return fD.name;}],["burnin",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.burnin);}],["samples",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.samples);}],["thin",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.thin);}],["seed",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.seed);}],["seeds",function(fD){var fE;fE=dk.concat("; ",A.map(function(fF){return function(fG){return fF(a.String(fG));};}(a.id),fD.seeds));return(function(fF){return function(fG){return fF("[ "+_2.toSafe(fG)+" ]");};}(a.id))(fE);}],["lowerbound",function(fD){var fE;fE=fD.lowerbound;return fE==null?"":a.String(fE.$0);}],["noise_model",function(fD){return bY.to_string(fD.noise_model);}],["noise_parameter",function(fD){return bZ.to_string(fD.noise_parameter);}],["prune",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.prune);}],["timer",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.timer);}],["print_console",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.print_console);}],["print_summary",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.print_summary);}],["partial",function(fD){return(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fD.partial_evaluation);}]]);return function(fD){return db.emit_record(fB,fC,fD);};};b0.parse_defaults=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;function fQ(f5,f6,f7){return(D.op_BarGreaterGreater(f5,f6))(f7);}function fR(f5,f6){return b0.New(f5,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fS(f5,f6){return b0.New(f6.name,f5,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fT(f5,f6){return b0.New(f6.name,f6.burnin,f5,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fU(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f5,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fV(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f5,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fW(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f5,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fX(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f5,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fY(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f5,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function fZ(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,A.map(a.id,f5),f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function f0(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,{$:1,$0:f5},f6.timer,f6.partial_evaluation,f6.print_console,f6.print_summary);}function f1(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f5,f6.partial_evaluation,f6.print_console,f6.print_summary);}function f2(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f5,f6.print_summary);}function f3(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f6.partial_evaluation,f6.print_console,f5);}function f4(f5,f6){return b0.New(f6.name,f6.burnin,f6.samples,f6.thin,f6.noise_model,f6.noise_parameter,f6.prune,f6.seed,f6.seeds,f6.lowerbound,f6.timer,f5,f6.print_console,f6.print_summary);}return D.record(fB,A.ofArray([["name",(fC=D.name(),function(f5){return fQ(fC,function(f6){return function(f7){return fR(f6,f7);};},f5);})],["burnin",(fD=D.pint32(),function(f5){return fQ(fD,function(f6){return function(f7){return fS(f6,f7);};},f5);})],["samples",(fE=D.pint32(),function(f5){return fQ(fE,function(f6){return function(f7){return fT(f6,f7);};},f5);})],["thin",(fF=D.pint32(),function(f5){return fQ(fF,function(f6){return function(f7){return fU(f6,f7);};},f5);})],["noise_model",(fG=bY.get_parse(),function(f5){return fQ(fG,function(f6){return function(f7){return fV(f6,f7);};},f5);})],["noise_parameter",(fH=bZ.get_parse(),function(f5){return fQ(fH,function(f6){return function(f7){return fW(f6,f7);};},f5);})],["prune",(fI=D.pbool(),function(f5){return fQ(fI,function(f6){return function(f7){return fX(f6,f7);};},f5);})],["seed",(fJ=D.pint32(),function(f5){return fQ(fJ,function(f6){return function(f7){return fY(f6,f7);};},f5);})],["seeds",(fK=D.list_of(D.pint32()),function(f5){return fQ(fK,function(f6){return function(f7){return fZ(f6,f7);};},f5);})],["lowerbound",(fL=D.pfloat(),function(f5){return fQ(fL,function(f6){return function(f7){return f0(f6,f7);};},f5);})],["timer",(fM=D.pbool(),function(f5){return fQ(fM,function(f6){return function(f7){return f1(f6,f7);};},f5);})],["print_console",(fN=D.pbool(),function(f5){return fQ(fN,function(f6){return function(f7){return f2(f6,f7);};},f5);})],["print_summary",(fO=D.pbool(),function(f5){return fQ(fO,function(f6){return function(f7){return f3(f6,f7);};},f5);})],["partial",(fP=D.pbool(),function(f5){return fQ(fP,function(f6){return function(f7){return f4(f6,f7);};},f5);})]]));};b0.get_parse=function(){return b0.parse_defaults(b0.get_defaults());};b0.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO){return{name:fB,burnin:fC,samples:fD,thin:fE,noise_model:fF,noise_parameter:fG,prune:fH,seed:fI,seeds:fJ,lowerbound:fK,timer:fL,partial_evaluation:fM,print_console:fN,print_summary:fO};};b1.New=function(fB,fC,fD,fE){return{order:fB,initial_minimum:fC,log_evaluation:fD,plots:fE};};b2.get_defaults=function(){return b2.New("Multistability","Portfolio",null,null);};b2.get_parse=function(){return b2.parse_defaults(b2.get_defaults());};b2.parse_defaults=function(fB){var fC,fD,fE,fF,fG,fH;function fI(fO,fP){return b2.New("Multistability",fP.solver,fP.timeout,fP.seed);}function fJ(fO,fP){return b2.New("Turing",fP.solver,fP.timeout,fP.seed);}function fK(fO,fP){return b2.New(fP.mode,"NLSat",fP.timeout,fP.seed);}function fL(fO,fP){return b2.New(fP.mode,"Portfolio",fP.timeout,fP.seed);}function fM(fO,fP){return b2.New(fP.mode,fP.solver,{$:1,$0:fO},fP.seed);}function fN(fO,fP){return b2.New(fP.mode,fP.solver,fP.timeout,{$:1,$0:fO});}return D.record(fB,A.ofArray([["mode",(fC=D.choice([(fD=D.kw("multistability"),function(fO){return dz.op_BarGreaterGreater(fD,function(fP){return function(fQ){return fI(fP,fQ);};},fO[0],fO[1]);}),(fE=D.kw("turing"),function(fO){return dz.op_BarGreaterGreater(fE,function(fP){return function(fQ){return fJ(fP,fQ);};},fO[0],fO[1]);})]),function(fO){return fC([fO[0],fO[1]]);})],["solver",(fF=D.choice([(fG=D.kw("nlsat"),function(fO){return dz.op_BarGreaterGreater(fG,function(fP){return function(fQ){return fK(fP,fQ);};},fO[0],fO[1]);}),(fH=D.kw("portfolio"),function(fO){return dz.op_BarGreaterGreater(fH,function(fP){return function(fQ){return fL(fP,fQ);};},fO[0],fO[1]);})]),function(fO){return fF([fO[0],fO[1]]);})],["timeout",function(fO){return dz.op_BarGreaterGreater(D.pfloat(),function(fP){return function(fQ){return fM(fP,fQ);};},fO[0],fO[1]);}],["seed",function(fO){return dz.op_BarGreaterGreater(D.pint32(),function(fP){return function(fQ){return fN(fP,fQ);};},fO[0],fO[1]);}]]));};b2.New=function(fB,fC,fD,fE){return{mode:fB,solver:fC,timeout:fD,seed:fE};};b3.empty=function(fB){return b3.New(fB,B.Empty);};b3.New=function(fB,fC){return{file:fB,data:fC};};b4=d.Concentration=fu.Class({get_to_string:function(){return this.$0===-24?"yM":this.$0===-21?"zM":this.$0===-18?"aM":this.$0===-15?"fM":this.$0===-12?"pM":this.$0===-9?"nM":this.$0===-6?"uM":this.$0===-3?"mM":this.$0===0?"M":"M*10\\\\^"+a.String(this.$0);}},null,b4);b5=d.Time=fu.Class({get_to_string:function(){return this.$0===1E-09?"ns":this.$0===1E-06?"us":this.$0===0.001?"ms":this.$0===1?"s":this.$0===60?"min":this.$0===3600?"h":(function(fB){return function(fC){return fB(fC.toFixed(6)+"s");};}(a.id))(this.$0);}},null,b5);b6=d.Space=fu.Class({get_to_string:function(){return this.$0===-15?"fm":this.$0===-12?"pm":this.$0===-9?"nm":this.$0===-6?"um":this.$0===-3?"mm":this.$0===0?"m":"m*10\\\\^"+a.String(this.$0);}},null,b6);b7=d.Units=fu.Class({get_to_string:function(){return db.emit_record(b7.get_defaults(),A.ofArray([["concentration",function(fB){return fB.concentration.get_to_string();}],["time",function(fB){return fB.time.get_to_string();}],["space",function(fB){return fB.space.get_to_string();}]]),this);}},null,b7);b7.get_defaults=function(){return b7.New(new b4({$:0,$0:-9}),new b5({$:0,$0:1}),new b6({$:0,$0:-3}));};b7.get_parse=function(){var fB,fC,fD,fE,fF,fG;fB=(fC=D.choice([D.op_GreaterGreaterDot(D.kw("M"),D.preturn(new b4({$:0,$0:0}))),D.op_GreaterGreaterDot(D.kw("mM"),D.preturn(new b4({$:0,$0:-3}))),D.op_GreaterGreaterDot(D.kw("uM"),D.preturn(new b4({$:0,$0:-6}))),D.op_GreaterGreaterDot(D.kw("nM"),D.preturn(new b4({$:0,$0:-9}))),D.op_GreaterGreaterDot(D.kw("pM"),D.preturn(new b4({$:0,$0:-12}))),D.op_GreaterGreaterDot(D.kw("fM"),D.preturn(new b4({$:0,$0:-15}))),D.op_GreaterGreaterDot(D.kw("aM"),D.preturn(new b4({$:0,$0:-18}))),D.op_GreaterGreaterDot(D.kw("zM"),D.preturn(new b4({$:0,$0:-21}))),D.op_GreaterGreaterDot(D.kw("yM"),D.preturn(new b4({$:0,$0:-24})))]),function(fH){return fC([fH[0],fH[1]]);});fD=(fE=D.choice([D.op_GreaterGreaterDot(D.kw("ns"),D.preturn(new b5({$:0,$0:1E-09}))),D.op_GreaterGreaterDot(D.kw("us"),D.preturn(new b5({$:0,$0:1E-06}))),D.op_GreaterGreaterDot(D.kw("ms"),D.preturn(new b5({$:0,$0:0.001}))),D.op_GreaterGreaterDot(D.kw("s"),D.preturn(new b5({$:0,$0:1}))),D.op_GreaterGreaterDot(D.kw("min"),D.preturn(new b5({$:0,$0:60}))),D.op_GreaterGreaterDot(D.kw("h"),D.preturn(new b5({$:0,$0:3600})))]),function(fH){return fE([fH[0],fH[1]]);});fF=(fG=D.choice([D.op_GreaterGreaterDot(D.kw("m"),D.preturn(new b6({$:0,$0:0}))),D.op_GreaterGreaterDot(D.kw("mm"),D.preturn(new b6({$:0,$0:-3}))),D.op_GreaterGreaterDot(D.kw("um"),D.preturn(new b6({$:0,$0:-6}))),D.op_GreaterGreaterDot(D.kw("nm"),D.preturn(new b6({$:0,$0:-9}))),D.op_GreaterGreaterDot(D.kw("pm"),D.preturn(new b6({$:0,$0:-12}))),D.op_GreaterGreaterDot(D.kw("fm"),D.preturn(new b6({$:0,$0:-15})))]),function(fH){return fG([fH[0],fH[1]]);});return D.record(b7.get_defaults(),A.ofArray([["concentration",D.op_BarGreaterGreater(D.op_DotGreaterGreater(fB,D.spaces()),function(fH){return function(fI){return b7.New(fH,fI.time,fI.space);};})],["time",D.op_BarGreaterGreater(D.op_DotGreaterGreater(fD,D.spaces()),function(fH){return function(fI){return b7.New(fI.concentration,fH,fI.space);};})],["space",D.op_BarGreaterGreater(D.op_DotGreaterGreater(fF,D.spaces()),function(fH){return function(fI){return b7.New(fI.concentration,fI.time,fH);};})]]));};b7.New=function(fB,fC,fD){return new b7({concentration:fB,time:fC,space:fD});};b8=d.Assignment=fu.Class({partial_inline:function(fB){var fC;function fD(fE){return R.substitute(fC,fE);}fC=K.Map(function(fE,fF){return{$:1,$0:fF};},fB);return b8.New(this.variables,A.map(function(fE){return A.map(fD,fE);},this.values));},add_multiples:function(fB,fC){var fD;fD=A.unzip(A.map(function(fE){var fF;fB[0]=fB[0]+1;fF=A.map(function(fG){return fG+"_"+a.String(fB[0]);},fC);return[fF,A.append(fE,A.map(function(fG){return{$:0,$0:fG};},fF))];},this.values));return[fD[0],b8.create$5(A.append(this.variables,fC),fD[1])];},eval_label:function(fB){return A.zip(A.map(function(fC){return function(fD){return fC("["+_2.toSafe(fD)+"]");};}(a.id),this.get_to_string_separated()),this["eval"](fB));},get_string:function(){var fB,fC,fD,fE;fB=db.tuple_to_string(this.variables);fC=dk.concat("; ",A.map((fD=(fE=function(fF){return R.to_string(a.id,fF);},function(fF){return A.map(fE,fF);}),function(fF){return db.tuple_to_string(fD(fF));}),this.values));return(((fu.Curried3(function(fF,fG,fH){return fF(_2.toSafe(fG)+" = ["+_2.toSafe(fH)+"]");}))(a.id))(fB))(fC);},"eval":function(fB){var fC;fC=this;return A.map(function(fD){function fE(fF){return di.find(fB,fF);}return K.OfArray(U.ofSeq(A.zip(fC.variables,A.map(function(fF){return R["eval"](fE,fF);},fD))));},this.values);},get_to_string_separated:function(){var fB,fC;fB=this;return A.map(function(fD){return dk.concat("; ",A.map2(function(fE,fF){return(((fu.Curried3(function(fG,fH,fI){return fG(_2.toSafe(fH)+" = "+_2.toSafe(fI));}))(a.id))(fE))(fF);},fB.variables,fD));},A.map((fC=function(fD){return R.to_string(a.id,fD);},function(fD){return A.map(fC,fD);}),this.values));},get_mentions:function(){return A.append(this.variables,A.collect(R.mentions,A.concat(this.values)));}},null,b8);b8.create$4=function(){return b8.New(B.Empty,A.ofArray([B.Empty]));};b8.create$5=function(fB,fC){return b8.New(fB,fC);};b8.get_parse=function(){var fB,fC,fD,fE,fF;fB=D.tuple_of(D.name());fC=D.list_of(D.tuple_of(R.parse(D.name())));fD=(fE=(fF=D.skw("="),function(fG){return dz.op_DotGreaterGreater(fB,fF,fG[0],fG[1]);}),function(fG){return dz.op_DotGreaterGreaterDot(fE,fC,fG[0],fG[1]);});return function(fG){return dz.op_BarGreaterGreater(fD,function(fH){return b8.create$5(fH[0],fH[1]);},fG[0],fG[1]);};};b8.New=function(fB,fC){return new b8({variables:fB,values:fC});};b9=d.Sweep=fu.Class({inline_env:function(fB){return b9.New(this.name,A.map(function(fC){return fC.partial_inline(fB);},this.assignments));},get_merge:function(){return bc.fold(function(fB,fC){var fD;function fE(fF,fG){return A.map(function(fH){var fI;fI=K.OfArray(U.ofSeq(A.zip(fB.variables,fH)));return A.append(fH,A.map(function(fJ){return R.substitute(fI,fJ);},fG));},fF);}return b8.create$5(A.append(fB.variables,fC.variables),A.concat(A.map((fD=fB.values,function(fF){return fE(fD,fF);}),fC.values)));},b8.create$4(),this.assignments);},add_multiples:function(fB,fC){var fD;fD=this.get_merge().add_multiples(fB,fC);return[fD[0],b9.create$6(this.name,A.ofArray([fD[1]]))];},eval_label:function(fB){return this.get_merge().eval_label(fB);},simplify_assignments:function(){return b9.New(this.name,A.filter(function(fB){return fB.values.get_Length()>1;},this.assignments));},get_string:function(){return this.name+" = ["+dk.concat("; ",A.map(function(fB){return fB.get_string();},this.assignments))+"]";},get_variables:function(){return db.remove_duplicates(function(fB,fC){return fB===fC;},A.collect(function(fB){return fB.variables;},this.assignments));},"eval":function(fB){return(this.get_merge())["eval"](fB);},get_mentions:function(){return A.collect(function(fB){return A.distinct(fB.get_mentions());},this.assignments);}},null,b9);b9.list_to_string=function(fB){return(function(fC){return function(fD){return fC("[\\n  "+_2.toSafe(fD)+";\\n]");};}(a.id))(dk.concat(";\\n  ",A.map(function(fC){return fC.get_string();},fB)));};b9.create$7=function(){return b9.New("",B.Empty);};b9.create$6=function(fB,fC){return b9.New(fB,fC);};b9.get_parse=function(){var fB,fC,fD,fE;fB=(fC=(fD=D.skw("="),function(fF){return dz.op_DotGreaterGreater(D.name(),fD,fF[0],fF[1]);}),(fE=D.list_of(b8.get_parse()),function(fF){return dz.op_DotGreaterGreaterDot(fC,fE,fF[0],fF[1]);}));return function(fF){return dz.op_BarGreaterGreater(fB,function(fG){return b9.create$6(fG[0],fG[1]);},fF[0],fF[1]);};};b9.New=function(fB,fC){return new b9({name:fB,assignments:fC});};b_=d.Plot_settings=fu.Class({map:function(fB){return b_.New(this.x_label,this.y_label,this.title,this.label_font_size,this.tick_font_size,this.x_ticks,this.y_ticks,this.x_min,this.x_max,this.y_min,this.y_max,A.map(fB,this.v_boundaries),A.map(fB,this.h_boundaries));},update_empty_labels:function(fB,fC){var fD;fD=this.x_label===""?b_.New(fB,this.y_label,this.title,this.label_font_size,this.tick_font_size,this.x_ticks,this.y_ticks,this.x_min,this.x_max,this.y_min,this.y_max,this.v_boundaries,this.h_boundaries):this;return fD.y_label===""?b_.New(fD.x_label,fC,fD.title,fD.label_font_size,fD.tick_font_size,fD.x_ticks,fD.y_ticks,fD.x_min,fD.x_max,fD.y_min,fD.y_max,fD.v_boundaries,fD.h_boundaries):fD;}},null,b_);b_.get_defaults=function(){return b_.New("","","",16,16,B.Empty,B.Empty,null,null,null,null,B.Empty,B.Empty);};b_.parse=function(fB){return b_.parse_defaults(b_.get_defaults(),fB);};b_.parse_defaults=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fY,fZ){return b_.New(fY,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fM(fY,fZ){return b_.New(fZ.x_label,fY,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fN(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fY,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fO(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fY,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fP(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fY,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fQ(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fY,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fR(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fY,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fS(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,{$:1,$0:fY},fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fT(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,{$:1,$0:fY},fZ.y_min,fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fU(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,{$:1,$0:fY},fZ.y_max,fZ.v_boundaries,fZ.h_boundaries);}function fV(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,{$:1,$0:fY},fZ.v_boundaries,fZ.h_boundaries);}function fW(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fY,fZ.h_boundaries);}function fX(fY,fZ){return b_.New(fZ.x_label,fZ.y_label,fZ.title,fZ.label_font_size,fZ.tick_font_size,fZ.x_ticks,fZ.y_ticks,fZ.x_min,fZ.x_max,fZ.y_min,fZ.y_max,fZ.v_boundaries,fY);}fD=D.satisfy(function(fY){return fY!=="\\"";});return D.record(fB,A.ofArray([["x_label",(fE=D.between(D.pchar("\\""),D.pchar("\\""),D.manyChars(fD)),function(fY){return dz.op_BarGreaterGreater(fE,function(fZ){return function(f0){return fL(fZ,f0);};},fY[0],fY[1]);})],["y_label",(fF=D.between(D.pchar("\\""),D.pchar("\\""),D.manyChars(fD)),function(fY){return dz.op_BarGreaterGreater(fF,function(fZ){return function(f0){return fM(fZ,f0);};},fY[0],fY[1]);})],["title",(fG=D.between(D.pchar("\\""),D.pchar("\\""),D.manyChars(fD)),function(fY){return dz.op_BarGreaterGreater(fG,function(fZ){return function(f0){return fN(fZ,f0);};},fY[0],fY[1]);})],["label_font_size",function(fY){return dz.op_BarGreaterGreater(D.pint32(),function(fZ){return function(f0){return fO(fZ,f0);};},fY[0],fY[1]);}],["tick_font_size",function(fY){return dz.op_BarGreaterGreater(D.pint32(),function(fZ){return function(f0){return fP(fZ,f0);};},fY[0],fY[1]);}],["x_ticks",(fH=D.list_of(D.pfloat()),function(fY){return dz.op_BarGreaterGreater(fH,function(fZ){return function(f0){return fQ(fZ,f0);};},fY[0],fY[1]);})],["y_ticks",(fI=D.list_of(D.pfloat()),function(fY){return dz.op_BarGreaterGreater(fI,function(fZ){return function(f0){return fR(fZ,f0);};},fY[0],fY[1]);})],["x_min",function(fY){return dz.op_BarGreaterGreater(D.pfloat(),function(fZ){return function(f0){return fS(fZ,f0);};},fY[0],fY[1]);}],["x_max",function(fY){return dz.op_BarGreaterGreater(D.pfloat(),function(fZ){return function(f0){return fT(fZ,f0);};},fY[0],fY[1]);}],["y_min",function(fY){return dz.op_BarGreaterGreater(D.pfloat(),function(fZ){return function(f0){return fU(fZ,f0);};},fY[0],fY[1]);}],["y_max",function(fY){return dz.op_BarGreaterGreater(D.pfloat(),function(fZ){return function(f0){return fV(fZ,f0);};},fY[0],fY[1]);}],["v_boundaries",(fJ=D.list_of(fC),function(fY){return dz.op_BarGreaterGreater(fJ,function(fZ){return function(f0){return fW(fZ,f0);};},fY[0],fY[1]);})],["h_boundaries",(fK=D.list_of(fC),function(fY){return dz.op_BarGreaterGreater(fK,function(fZ){return function(f0){return fX(fZ,f0);};},fY[0],fY[1]);})]]));};b_.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN){return new b_({x_label:fB,y_label:fC,title:fD,label_font_size:fE,tick_font_size:fF,x_ticks:fG,y_ticks:fH,x_min:fI,x_max:fJ,y_min:fK,y_max:fL,v_boundaries:fM,h_boundaries:fN});};ca.New=function(fB,fC){return{element:fB,multiplicity:fC};};cb=d.Rate=fu.Class({map:function(fB,fC){return this.$==1?new cb({$:1,$0:fC(this.$0)}):new cb({$:0,$0:fB(this.$0)});},to_string_bare:function(fB,fC){return this.fold(fB,fC);},fold:function(fB,fC){return this.$==1?fC(this.$0):fB(this.$0);},to_string:function(fB,fC){return this.fold(function(fD){return"{"+fB(fD)+"}";},function(fD){return"["+fC(fD)+"]";});}},null,cb);cb.map2=function(fB,fC,fD){return fD.map(fB,fC);};cb.parse=function(fB,fC){var fD,fE,fF,fG;function fH(fJ){return new cb({$:0,$0:fJ});}function fI(fJ){return new cb({$:1,$0:fJ});}fD=(fE=(D.bracket("{","}"))(fB),function(fJ){return dz.op_BarGreaterGreater(fE,fH,fJ[0],fJ[1]);});fF=(fG=(D.bracket("[","]"))(fC),function(fJ){return dz.op_BarGreaterGreater(fG,fI,fJ[0],fJ[1]);});return function(fJ){return dz.op_LessBarGreater(fD,fF,fJ[0],fJ[1]);};};cc=d.Reaction=fu.Class({stochastic_to_deterministic:function(fB){return R.mul(fB,{$:1,$0:this.get_conversion_factor()});},getStoich:function(fB,fC){return fB?0:this.numInProducts(fC)-this.numInReactants(fC);},scale:function(fB,fC,fD){var fE,fF,fG;function fH(fI,fJ){return fJ.map(fB(fC,fI),fD);}return fC===1?this:(fE=b$.size(this.reactants)+b$.size(this.catalysts),(fF=b$.size(this.products)+b$.size(this.catalysts),(fG=fH(fE,this.rate),cc.create$4(this.catalysts,this.reactants,db.option_map2(function(fI){return fH(fF,fI);},this.reverse),fG,this.products))));},get_conversion_factor:function(){return b$.fold_left_m(function(fB,fC){return fB*db.fac(fC.multiplicity);},1,this.reactants);},numInProducts:function(fB){return b$.get_mult(bk.Equals,this.products,fB);},numInReactants:function(fB){return b$.get_mult(bk.Equals,this.reactants,fB);},normalise:function(){var fB,fC;fB=cc.create$4(b$.empty(),b$.union(bk.Equals,this.reactants,this.catalysts),null,this.rate,b$.union(bk.Equals,this.products,this.catalysts));return[fB,(fC=this.reverse,fC!=null&&fC.$==1?{$:1,$0:cc.create$4(b$.empty(),fB.products,null,fC.$0,fB.reactants)}:null)];},deterministic_to_stochastic:function(fB){return R.div(fB,{$:1,$0:this.get_conversion_factor()});},string:function(fB,fC,fD){var fE;function fF(fH){var fI;fI=fH.to_string(fC,fD);return fI==="{1.0}"?"":fI;}function fG(fH){return b$.to_string(fB," + ",fH);}return db.string_of_list(a.id," ",A.filter(function(fH){return fH!=="";},A.ofArray([b$.is_empty(this.catalysts)?"":fG(this.catalysts)+" ~",fG(this.reactants),(fE=this.reverse,fE!=null&&fE.$==1?"<->"+fF(this.rate)+fF(fE.$0):"->"+fF(this.rate)),fG(this.products)])));},get_allSpecies:function(){return b$.elements(b$.union(bk.Equals,b$.union(bk.Equals,this.reactants,this.products),this.catalysts));}},null,cc);cc.map=function(fB,fC,fD,fE){return cc.create$4(b$.map(fB,fE.catalysts),b$.map(fB,fE.reactants),db.option_map2(function(fF){return cb.map2(fC,fD,fF);},fE.reverse),cb.map2(fC,fD,fE.rate),b$.map(fB,fE.products));};cc.normalise_list=function(fB){return A.rev(bc.fold(function(fC,fD){var fE,fF,fG;fE=fD.normalise();fF=fE[0];fG=fE[1];return fG!=null&&fG.$==1?new B({$:1,$0:fG.$0,$1:new B({$:1,$0:fF,$1:fC})}):new B({$:1,$0:fF,$1:fC});},B.Empty,fB));};cc.get_sim_reactions_products=function(fB,fC,fD,fE,fF){function fG(fH){return cc.map(a.id,a.id,R.to_lambda,fH);}return A.rev(db.fold_left(function(fH,fI){var fJ,fK,fL,fM,fN,fO;fJ=cc.convert_simplify(fB,fC,fD,fE,fI);fK=fJ[0];fL=fJ[1];fM=b$.union(function(fP,fQ){return fP===fQ;},fK.products,fK.catalysts);return fL!=null&&fL.$==1?(fN=fL.$0,(fO=b$.union(function(fP,fQ){return fP===fQ;},fN.reactants,fN.catalysts),new B({$:1,$0:[fG(fN),fO,fN.rate],$1:new B({$:1,$0:[fG(fK),fM,fK.rate],$1:fH})}))):new B({$:1,$0:[fG(fK),fM,fK.rate],$1:fH});},B.Empty,fF));};cc.create$4=function(fB,fC,fD,fE,fF){return cc.New(fB,fC,fD,fE,fF);};cc.to_string=function(fB,fC,fD,fE){return fE.string(fB,fC,fD);};cc.convert_simplify=function(fB,fC,fD,fE,fF){var fG;function fH(fK,fL,fM){return fM*fv.pow(fK,1-fL);}function fI(fK){var fL;fL=fC.tryFind_index(fK);return fL==null?F.FailWith("Species "+fK.name+" not found in a rate expression"):fL.$0;}function fJ(fK){function fL(fM){return cY.map(fI,fM);}return function(fM){return R.map(fL,fM);};}fG=K.Map(function(fK,fL){return(fJ(fK))(fL);},fE);return cc.map(fI,function(fK){return R["eval"](function(fL){return di.find(fD,fL);},fK);},function(fK){function fL(fN){return co.map(fI,fN);}function fM(fN){return co.inline_keys(fD,fG,fN);}return R.simplify(R.expand(function(fN){return fM(fL(fN));},fK));},fF).scale(function(fK,fL){return function(fM){return fH(fK,fL,fM);};},fB,a.id).normalise();};cc.parse=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;function fQ(fS){return{$:1,$0:fS};}function fR(fS,fT){var fU,fV,fW,fX;function fY(fZ,f0){return D.preturn(fT!=null&&fT.$==1?cc.create$4(fS,fT.$0,fZ[1],fZ[0],f0):cc.create$3(fS,fZ[1],fZ[0],f0));}fU=(fV=(fW=D.choice([cc.parse_reversible(fC,fD,fE),cc.parse_irreversible(fC,fD,fE)]),function(fZ){return fW([fZ[0],fZ[1]]);}),(fX=b$.parse(fB),function(fZ){return dz.op_PlusGreaterGreaterPlus(fV,fX,fZ[0],fZ[1]);}));return function(fZ){return dz.op_GreaterGreaterEquals(fU,function(f0){return fY(f0[0],f0[1]);},fZ[0],fZ[1]);};}fF=D.pTry((fG=(fH=b$.parse(fB),(fI=(fJ=D.choice([(fK=(fL=D.kw("~"),(fM=b$.parse(fB),function(fS){return dz.op_GreaterGreaterDot(fL,fM,fS[0],fS[1]);})),function(fS){return dz.op_BarGreaterGreater(fK,fQ,fS[0],fS[1]);}),D.preturn(null)]),function(fS){return fJ([fS[0],fS[1]]);}),function(fS){return dz.op_PlusGreaterGreaterPlus(fH,fI,fS[0],fS[1]);})),(fN=(fO=D.lookAhead("<->"),(fP=D.lookAhead("->"),function(fS){return dz.op_LessBarGreater(fO,fP,fS[0],fS[1]);})),function(fS){return dz.op_PlusGreaterGreater(fG,fN,fS[0],fS[1]);})));return function(fS){return dz.op_GreaterGreaterEquals(fF,function(fT){return fR(fT[0],fT[1]);},fS[0],fS[1]);};};cc.create$3=function(fB,fC,fD,fE){return cc.create$4(b$.empty(),fB,fC,fD,fE);};cc.parse_reversible=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;function fQ(fS,fT){return[new cb({$:0,$0:fS}),new cb({$:0,$0:fT})];}function fR(fS,fT){return[fS,{$:1,$0:fT}];}fE=(fF=D.kw("<->"),(fG=(fH=D.pTry((fI=cb.parse(fB,fC),(fJ=cb.parse(fB,fC),function(fS){return dz.op_PlusGreaterGreaterPlus(fI,fJ,fS[0],fS[1]);}))),(fK=(fL=(fM=D.braces((fN=(fO=D.kw(","),function(fS){return dz.op_PlusGreaterGreater(fB,fO,fS[0],fS[1]);}),function(fS){return dz.op_PlusGreaterGreaterPlus(fN,fB,fS[0],fS[1]);})),(fP=D.preturn([fD,fD]),function(fS){return dz.op_LessBarGreater(fM,fP,fS[0],fS[1]);})),function(fS){return dz.op_BarGreaterGreater(fL,function(fT){return fQ(fT[0],fT[1]);},fS[0],fS[1]);}),function(fS){return dz.op_LessBarGreater(fH,fK,fS[0],fS[1]);})),function(fS){return dz.op_GreaterGreaterDot(fF,fG,fS[0],fS[1]);}));return function(fS){return dz.op_BarGreaterGreater(fE,function(fT){return fR(fT[0],fT[1]);},fS[0],fS[1]);};};cc.parse_irreversible=function(fB,fC,fD){var fE,fF,fG,fH,fI;function fJ(fK){return[fK,null];}fE=D.kw("->");fF=(fG=(fH=cb.parse(fB,fC),function(fK){return dz.op_BarGreaterGreater(fH,fJ,fK[0],fK[1]);}),(fI=D.preturn([new cb({$:0,$0:fD}),null]),function(fK){return dz.op_LessBarGreater(fG,fI,fK[0],fK[1]);}));return function(fK){return dz.op_GreaterGreaterDot(fE,fF,fK[0],fK[1]);};};cc.New=function(fB,fC,fD,fE,fF){return new cc({catalysts:fB,reactants:fC,reverse:fD,rate:fE,products:fF});};ce=cd.core=fu.Class({apply1d:function(fB,fC){return fv.abs(fB-0.5)<=this.width/2?[fB,fC+this.inner]:[fB,fC+this.outer];},apply2d:function(fB,fC){return cd.distance_from_xy(0.5,0.5,fB[0],fB[1])<=this.width/2?[fB,this.inner+fC]:[fB,this.outer+fC];},to_string:function(){return((((fu.Curried(function(fB,fC,fD,fE){return fB("centralcore = {inner="+dk.PadLeft(fC.toFixed(3),1)+"; outer="+dk.PadLeft(fD.toFixed(3),1)+"; width="+dk.PadLeft(fE.toFixed(3),1)+"}");},4))(a.id))(this.inner))(this.outer))(this.width);}},null,ce);ce.New=function(fB,fC,fD){return new ce({inner:fB,outer:fC,width:fD});};cf=cd.point=fu.Class({apply1d:function(fB,fC){return fv.abs(this.x-fB)<=this.width/2?[fB,fC+this.value]:[fB,fC];},apply2d:function(fB,fC){return cd.distance_from_xy(this.x,this.y,fB[0],fB[1])<=this.width/2?[fB,this.value+fC]:[fB,fC];},to_string:function(){return(((((fu.Curried(function(fB,fC,fD,fE,fF){return fB("{x="+dk.PadLeft(fC.toFixed(3),1)+"; y="+dk.PadLeft(fD.toFixed(3),1)+"; width="+dk.PadLeft(fE.toFixed(3),1)+"; value="+dk.PadLeft(fF.toFixed(3),1)+"}");},5))(a.id))(this.x))(this.y))(this.width))(this.value);}},null,cf);cf.New=function(fB,fC,fD,fE){return new cf({x:fB,y:fC,width:fD,value:fE});};cg=cd.rectangle=fu.Class({apply1d:function(fB,fC){return fB>=this.xmin&&fB<=this.xmax?[fB,fC+this.value]:[fB,fC];},apply2d:function(fB,fC){var fD,fE;fD=fB[1];fE=fB[0];return fE>=this.xmin&&fE<=this.xmax&&fD>=this.ymin&&fD<=this.ymax?[[fE,fD],this.value+fC]:[[fE,fD],fC];},to_string:function(){return((((((fu.Curried(function(fB,fC,fD,fE,fF,fG){return fB("{xmin="+dk.PadLeft(fC.toFixed(3),1)+"; xmax="+dk.PadLeft(fD.toFixed(3),1)+"; ymin = "+dk.PadLeft(fE.toFixed(3),1)+"; ymax = "+dk.PadLeft(fF.toFixed(3),1)+"; value="+dk.PadLeft(fG.toFixed(3),1)+"}");},6))(a.id))(this.xmin))(this.xmax))(this.ymin))(this.ymax))(this.value);}},null,cg);cg.New=function(fB,fC,fD,fE,fF){return new cg({xmin:fB,xmax:fC,ymin:fD,ymax:fE,value:fF});};ch.New=function(fB,fC,fD,fE){return{random:fB,core:fC,points:fD,rectangles:fE};};cj.EncodeArray=fu.Curried3(function(fB,fC,fD){return U.map(fB(),fD);});cj.DecodeRecord=function(fB,fC){return function(){return function(fD){var fE;function fF(fG,fH,fI){if(fI===0){if(fD.hasOwnProperty(fG))fE[fG]=(fH(null))(fD[fG]);else F.FailWith("Missing mandatory field: "+fG);}else if(fI===1)fE[fG]=fD.hasOwnProperty(fG)?{$:1,$0:(fH(null))(fD[fG])}:null;else if(fI===2){if(fD.hasOwnProperty(fG))fE[fG]=(fH(null))(fD[fG]);}else if(fI===3){if(fD[fG]===void 0)fE[fG]=(fH(null))(fD[fG]);}else F.FailWith("Invalid field option kind");}fE=fB===void 0?{}:new fB();U.iter(function(fG){return fF(fG[0],fG[1],fG[2]);},fC);return fE;};};};cj.DecodeStringMap=fu.Curried3(function(fB,fC,fD){var fE,fF,fG;fE=[new y.New([])];fF=fB();for(var fH in fD)if(function(fI){var fJ;fE[0]=(fJ=fF(fD[fI]),fE[0].Add(fI,fJ));return false;}(fH))break;return fE[0];});cj.DecodeList=fu.Curried3(function(fB,fC,fD){var fE;fE=fB();return A.init(U.length(fD),function(fF){return fE(U.get(fD,fF));});});cj.Id=fu.Curried3(function(fB,fC,fD){return fD;});cj.EncodeRecord=function(fB,fC){return function(){return function(fD){var fE;function fF(fG,fH,fI){var fJ;if(fI===0)fE[fG]=(fH(null))(fD[fG]);else if(fI===1){fJ=fD[fG];fJ==null?void 0:fE[fG]=(fH(null))(fJ.$0);}else if(fI===2){if(fD.hasOwnProperty(fG))fE[fG]=(fH(null))(fD[fG]);}else if(fI===3){if(fD[fG]===void 0)fE[fG]=(fH(null))(fD[fG]);}else F.FailWith("Invalid field option kind");}fE={};U.iter(function(fG){return fF(fG[0],fG[1],fG[2]);},fC);return fE;};};};cj.EncodeStringMap=fu.Curried3(function(fB,fC,fD){var fE,fF;fE={};fF=fB();K.Iterate(function(fG,fH){fE[fG]=fF(fH);},fD);return fE;});cj.EncodeList=fu.Curried3(function(fB,fC,fD){var fE,fF;fE=[];fF=fB();A.iter(function(fG){fE.push(fF(fG));},fD);return fE;});cj.EncodeStringDictionary=fu.Curried3(function(fB,fC,fD){var fE,fF,fG,fH;fE={};fF=fB();fG=da.Get(fD);try{while(fG.MoveNext()){fH=F.KeyValue(fG.Current());fE[fH[0]]=fF(fH[1]);}}finally{if(typeof fG=="object"&&"Dispose"in fG)fG.Dispose();}return fE;});cj.DecodeArray=function(fB){return cj.EncodeArray(fB);};cj.DecodeStringDictionary=fu.Curried3(function(fB,fC,fD){var fE,fF,fG;fE=new bd.New$5();fF=fB();for(var fH in fD)if(function(fI){fE.Add(fI,fF(fD[fI]));return false;}(fH))break;return fE;});cj.DecodeUnion=function(fB,fC,fD){return function(){return function(fE){var fF,fG,fJ,fK,fL;function fH(fM,fN){return fM===fG;}function fI(fM,fN,fO,fP){var fQ;if(fM===null){fQ=(fO(null))(fE);fN?delete fQ[fC]:void 0;fJ.$0=fQ;}else if(fP===0)fJ[fM]=(fO(null))(fE[fN]);else if(fP===1)fJ[fM]=fE.hasOwnProperty(fN)?{$:1,$0:(fO(null))(fE[fN])}:null;else F.FailWith("Invalid field option kind");}if(typeof fE==="object"&&fE!=null){fJ=fB===void 0?{}:new fB();if(bk.Equals(typeof fC,"string"))fF=(fG=fE[fC],U.findIndex(function(fM){return fH(fM[0],fM[1]);},fD));else{fK=[void 0];for(var fM in fC)if(function(fN){return fE.hasOwnProperty(fN)&&(fK[0]=fC[fN],true);}(fM))break;fF=fK[0];}fJ.$=fF;U.iter(function(fN){return fI(fN[0],fN[1],fN[2],fN[3]);},(U.get(fD,fF))[1]);return fJ;}else return fE;};};};cj.DecodeTuple=function(fB){return cj.EncodeTuple(fB);};cj.EncodeUnion=function(fB,fC,fD){return function(){return function(fE){var fF,fG;function fH(fI,fJ,fK,fL){var fM,fN,fO;if(fI===null){fM=(fK(null))(fE.$0);for(var fP in fM)if(function(fQ){fF[fQ]=fM[fQ];return false;}(fP))break;}else if(fL===0)fF[fJ]=(fK(null))(fE[fI]);else if(fL===1){fO=fE[fI];fO==null?void 0:fF[fJ]=(fK(null))(fO.$0);}else F.FailWith("Invalid field option kind");}return typeof fE==="object"&&fE!=null?(fF={},(fG=U.get(fD,fE.$),(bk.Equals(typeof fC,"string")?fF[fC]=fG[0]:void 0,U.iter(function(fI){return fH(fI[0],fI[1],fI[2],fI[3]);},fG[1]),fF))):fE;};};};cj.EncodeTuple=fu.Curried3(function(fB,fC,fD){return U.map2(function(fE,fF){return(fE(null))(fF);},fB,fD);});ck.Fixed={$:2};ck.Log={$:1};ck.Real={$:0};cl.New=function(fB,fC,fD,fE,fF){return{mean:fB,stdev:fC,lb:fD,ub:fE,denominator:fF};};cm.New=function(fB,fC){return{mu:fB,sigma:fC};};cn.New=function(fB,fC){return{mean:fB,stdev:fC};};co.Time={$:3};co.inline_rates_env=function(fB,fC){function fD(fE){var fF,fG;return fE.$==2?{$:0,$0:{$:0,$0:fE.$0}}:fE.$==3?{$:0,$0:cY.Time}:fE.$==1?(fF=fE.$0,(fG=K.TryFind(fF,fC),fG!=null&&fG.$==1?R.expand(fD,fG.$0):F.FailWith("Rate "+fF+" is undefined."))):{$:1,$0:di.find(fB,fE.$0)};}return K.Map(function(fE,fF){return(function(){function fG(fH){return R.expand(fD,fH);}return function(fH){return R.simplify(fG(fH));};}(fE))(fF);},fC);};co.inline_keys=function(fB,fC,fD){var fE,fF;return fD.$==2?{$:0,$0:{$:0,$0:fD.$0}}:fD.$==3?{$:0,$0:cY.Time}:fD.$==1?(fE=fD.$0,(fF=K.TryFind(fE,fC),fF!=null&&fF.$==1?fF.$0:F.FailWith("Rate "+fE+" is undefined."))):{$:1,$0:di.find(fB,fD.$0)};};co.to_string=function(fB,fC){return fC.$==1?"["+fC.$0+"]":fC.$==2?"["+fB(fC.$0)+"]":fC.$==3?"[time]":fC.$0;};co.scale=function(fB,fC){return fC.$==2?{$:3,$0:ct.New({$:0,$0:{$:2,$0:fC.$0}},{$:1,$0:fB})}:{$:0,$0:fC};};co.map=function(fB,fC){return fC.$==1?{$:1,$0:fC.$0}:fC.$==0?{$:0,$0:fC.$0}:fC.$==3?co.Time:{$:2,$0:fB(fC.$0)};};co.eval_function=function(fB,fC,fD){return R.to_lambda(R.simplify(R.expand(function(fE){return co.inline_keys(fB,fC,fE);},fD)));};co.eval_massaction=function(fB,fC){return R["eval"](function(fD){return di.find(fB,fD);},fC);};co.to_matlab=function(fB,fC,fD){return fD.$==1?fD.$0:fD.$==2?fB(fD.$0):fD.$==3?fC:fD.$0;};co.parse=function(fB){var fC,fD,fE,fF,fG;function fH(fK){return{$:2,$0:fK};}function fI(fK,fL){return dz.op_DotGreaterGreater(D.name(),D.spaces(),fK,fL);}function fJ(fK){return{$:0,$0:fK};}fC=D.choice([(fD=D.kw("[time]"),(fE=D.preturn(co.Time),function(fK){return dz.op_GreaterGreaterDot(fD,fE,fK[0],fK[1]);})),(fF=(fG=D.sqBrackets(fB),function(fK){return dz.op_DotGreaterGreater(fG,D.spaces(),fK[0],fK[1]);}),function(fK){return dz.op_BarGreaterGreater(fF,fH,fK[0],fK[1]);}),function(fK){return dz.op_BarGreaterGreater(function(fL){return fI(fL[0],fL[1]);},fJ,fK[0],fK[1]);}]);return function(fK){return fC([fK[0],fK[1]]);};};cp.BFalse={$:1};cp.BTrue={$:0};cq.New=function(fB,fC){return{div:fB,modulo:fC};};cr.New=function(fB,fC){return{sub1:fB,sub2:fC};};cs.New=function(fB,fC){return{base_:fB,exponent:fC};};ct.New=function(fB,fC){return{div1:fB,div2:fC};};cu.get_to_string=function(fB){return fB=="Stochastic"?"Stochastic":fB=="Deterministic"?"Deterministic":"Contextual";};cu.get_parse=function(){var fB,fC,fD,fE;function fF(fI){return"Contextual";}function fG(fI){return"Stochastic";}function fH(fI){return"Deterministic";}fB=D.choice([(fC=D.kw("Contextual"),function(fI){return dz.op_BarGreaterGreater(fC,fF,fI[0],fI[1]);}),(fD=D.kw("Stochastic"),function(fI){return dz.op_BarGreaterGreater(fD,fG,fI[0],fI[1]);}),(fE=D.kw("Deterministic"),function(fI){return dz.op_BarGreaterGreater(fE,fH,fI[0],fI[1]);})]);return function(fI){return fB([fI[0],fI[1]]);};};cv.interpolate_float=function(fB,fC,fD,fE,fF){return fE+(fF-fE)*(fB-fC)/(fD-fC);};cv.interpolate_reverse=function(fB,fC,fD){var fE;function fF(fG,fH,fI){return U.map2(function(fJ,fK){return((fB(fG,fH.time,fI.time))(fJ))(fK);},fH.values,fI.values);}return fC.$==1?(fE=fC.$0,function(fG,fH,fI,fJ){var fK,fL,fM,fN,fO,fP,fQ,fR;while(true)if(fJ.$==1){fK=fJ.$1;fL=fJ.$0;if(fL>fH.time){if(fI.$==1){fM=fI.$0;fN=fI.$1;if(fM.time<=fL){fO=new B({$:1,$0:fL,$1:fK});fH=fM;fI=fN;fJ=fO;}else{fP=fF(fL,fH,fM);fQ=new B({$:1,$0:cv.New(fL,fP),$1:fG});fG=fQ;fJ=fK;}}else return fG;}else{fR=new B({$:1,$0:fH,$1:fG});fG=fR;fJ=fK;}}else return fG;}(B.Empty,fE,fC.$1,function(fG,fH){var fI,fJ;while(true)if(fH.$==1){fI=fH.$0;fJ=fH.$1;if(fG.time<=fI)return fH;else fH=fJ;}else return B.Empty;}(fE,fD))):B.Empty;};cv.zero_order_hold=function(fB,fC,fD,fE,fF){return fE;};cv.create=function(fB,fC){return cv.New(fB,U.ofList(fC));};cv.New=function(fB,fC){return{time:fB,values:fC};};cw.interpolate=function(fB,fC,fD,fE,fF){return cw.New(fE.mean+(fF.mean-fE.mean)*(fB-fC)/(fD-fC),fE.stdev+(fF.stdev-fE.stdev)*(fB-fC)/(fD-fC));};cw.create=function(fB,fC){return cw.New(fB,fC);};cw.New=function(fB,fC){return{mean:fB,stdev:fC};};cy.New=function(fB,fC,fD,fE,fF){return{Node:fB,Left:fC,Right:fD,Height:fE,Count:fF};};cz=x.Pair=fu.Class({Equals:function(fB){return bk.Equals(this.Key,fB.Key);},GetHashCode:function(){return bk.Hash(this.Key);},CompareTo0:function(fB){return bk.Compare(this.Key,fB.Key);}},null,cz);cz.New=function(fB,fC){return new cz({Key:fB,Value:fC});};U.get=function(fB,fC){U.checkBounds(fB,fC);return fB[fC];};U.set=function(fB,fC,fD){U.checkBounds(fB,fC);fB[fC]=fD;};U.checkBounds=function(fB,fC){if(fC<0||fC>=fB.length)F.FailWith("Index was outside the bounds of the array.");};U.length=function(fB){return fB.dims===2?fB.length*fB.length:fB.length;};U.sub=function(fB,fC,fD){U.checkRange(fB,fC,fD);return fB.slice(fC,fC+fD);};U.checkRange=function(fB,fC,fD){if(fD<0||fC<0||fB.length<fC+fD)F.FailWith("Index was outside the bounds of the array.");};U.set2D=function(fB,fC,fD,fE){U.checkBounds2D(fB,fC,fD);fB[fC][fD]=fE;};U.zeroCreate2D=function(fB,fC){var fD;fD=U.init(fB,function(){return U.create(fC,null);});fD.dims=2;return fD;};U.checkBounds2D=function(fB,fC,fD){if(fC<0||fD<0||fC>=fB.length||fD>=(fB.length?fB[0].length:0))throw new fl.New();};U.get2D=function(fB,fC,fD){U.checkBounds2D(fB,fC,fD);return fB[fC][fD];};cA.$cctor=function(){var fB,fC;cA.$cctor=a.ignore;cA.defaultIGraph=J.New(null,new y.New([]),new y.New([]),false);cA.pid=D.op_DotGreaterGreater(D.name(),D.spaces());cA.plocation=D.op_GreaterGreaterEquals(E.pid(),function(fD){var fE;fE=D.choice([D.op_GreaterGreaterEquals(D.op_GreaterGreaterDot(D.pchar("."),E.pid()),function(fF){return D.preturn(new bH({$:1,$0:[fD,fF]}));}),D.preturn(new bH({$:0,$0:fD}))]);return function(fF){return fE([fF[0],fF[1]]);};});cA.pparameter=D.op_GreaterGreaterEquals(E.pid(),function(fD){var fE,fF;fE=D.choice([D.op_GreaterGreaterDot(D.kw("="),(fF=D.choice([D.op_GreaterGreaterDot(D.kw("Fixed"),D.preturn([fD,fD,"Fixed2"])),D.op_GreaterGreaterDot(D.kw("Normal"),D.preturn([fD,fD,"Normal"])),D.op_GreaterGreaterDot(D.kw("LogNormal"),D.preturn([fD,fD,"LogNormal"])),D.op_GreaterGreaterDot(D.kw("TruncatedNormal"),D.preturn([fD,fD,"TruncatedNormal"]))]),function(fG){return fF([fG[0],fG[1]]);})),D.preturn([fD,fD,"TruncatedNormal"])]);return function(fG){return fE([fG[0],fG[1]]);};});cA.parseTask=(fB=D.op_GreaterGreaterDot(D.pTry(D.op_GreaterGreaterDot(D.kw("directive"),D.kw("task"))),D.record(bG.New(null,1,1,1),A.ofArray([["task",D.op_BarGreaterGreater((fC=D.choice([D.op_GreaterGreaterDot(D.kw("infer"),D.preturn("Infer")),D.op_GreaterGreaterDot(D.kw("simulate"),D.preturn("Simulate")),D.op_GreaterGreaterDot(D.kw("parse"),D.preturn("Parse"))]),function(fD){return fC([fD[0],fD[1]]);}),function(fD){return function(fE){return bG.New({$:1,$0:fD},fE.copies,fE.copy_id,fE.nodes);};})],["copies",D.op_BarGreaterGreater(D.pint32(),function(fD){return function(fE){return bG.New(fE.task_type,fD,fE.copy_id,fE.nodes);};})],["copy_id",D.op_BarGreaterGreater(D.pint32(),function(fD){return function(fE){return bG.New(fE.task_type,fE.copies,fD,fE.nodes);};})],["nodes",D.op_BarGreaterGreater(D.pint32(),function(fD){return function(fE){return bG.New(fE.task_type,fE.copies,fE.copy_id,fD);};})]]))),D.op_GreaterGreaterDot(D.spaces(),D.opt(fB)));cA.parse=D.op_GreaterGreaterEquals(D.op_DotGreaterGreaterDot(E.parseTask(),L.get_parse()),function(fD){var fE,fF,fG;fE=fD[0];fF=fD[1];fG=D.choice([E.pinferenceGraph(fE,fF,K.OfArray(U.ofSeq(A.map(function(fH){return[fH.name,fH];},fF.systems)))),D.preturn(J.New(fE,K.OfArray(U.ofSeq(A.ofArray([[fF.top.name,fF]]))),new y.New([]),false))]);return function(fH){return fG([fH[0],fH[1]]);};});cA.from_string=function(fD){return D.from_string(E.parse(),fD);};};cx.OfSeq=function(fB){var fC;fC=U.ofSeq(bc.distinct(fB));U.sortInPlace(fC);return cx.Build(fC,0,fC.length-1);};cx.Enumerate=function(fB,fC){function fD(fE,fF){var fG;while(true)if(fE==null)return fF.$==1?{$:1,$0:[fF.$0[0],[fF.$0[1],fF.$1]]}:null;else if(fB){fG=fE;fE=fG.Right;fF=new B({$:1,$0:[fG.Node,fG.Left],$1:fF});}else{fG=fE;fE=fG.Left;fF=new B({$:1,$0:[fG.Node,fG.Right],$1:fF});}}return bc.unfold(function(fE){return fD(fE[0],fE[1]);},[fC,B.Empty]);};cx.TryFind=function(fB,fC){var fD;fD=(cx.Lookup(fB,fC))[0];return fD==null?null:{$:1,$0:fD.Node};};cx.Contains=function(fB,fC){return!((cx.Lookup(fB,fC))[0]==null);};cx.Add=function(fB,fC){return cx.Put(function(fD,fE){return fE;},fB,fC);};cx.Build=function(fB,fC,fD){var fE,fF,fG;return fD-fC+1<=0?null:(fE=(fC+fD)/2>>0,(fF=cx.Build(fB,fC,fE-1),(fG=cx.Build(fB,fE+1,fD),cx.Branch(U.get(fB,fE),fF,fG))));};cx.Lookup=function(fB,fC){var fD,fE,fF,fG;fD=[];fE=fC;fF=true;while(fF)if(fE==null)fF=false;else{fG=bk.Compare(fB,fE.Node);fG===0?fF=false:fG===1?(fD.unshift([true,fE.Node,fE.Left]),fE=fE.Right):(fD.unshift([false,fE.Node,fE.Right]),fE=fE.Left);}return[fE,fD];};cx.Put=function(fB,fC,fD){var fE,fF;fE=cx.Lookup(fC,fD);fF=fE[0];return fF==null?cx.Rebuild(fE[1],cx.Branch(fC,null,null)):cx.Rebuild(fE[1],cx.Branch(fB(fF.Node,fC),fF.Left,fF.Right));};cx.Branch=function(fB,fC,fD){var fE,fF;return cy.New(fB,fC,fD,1+(fE=fC==null?0:fC.Height,(fF=fD==null?0:fD.Height,bk.Compare(fE,fF)===1?fE:fF)),1+(fC==null?0:fC.Count)+(fD==null?0:fD.Count));};cx.Rebuild=function(fB,fC){var fD,fF,fG,fH,fI,fJ,fK,fL,fM,fN;function fE(fO){return fO==null?0:fO.Height;}fD=fC;for(fF=0,fG=U.length(fB)-1;fF<=fG;fF++){fD=(fH=U.get(fB,fF),fH[0]?(fI=fH[1],(fJ=fH[2],fE(fD)>fE(fJ)+1?fE(fD.Left)===fE(fD.Right)+1?(fK=fD.Left,cx.Branch(fK.Node,cx.Branch(fI,fJ,fK.Left),cx.Branch(fD.Node,fK.Right,fD.Right))):cx.Branch(fD.Node,cx.Branch(fI,fJ,fD.Left),fD.Right):cx.Branch(fI,fJ,fD))):(fL=fH[1],(fM=fH[2],fE(fD)>fE(fM)+1?fE(fD.Right)===fE(fD.Left)+1?(fN=fD.Right,cx.Branch(fN.Node,cx.Branch(fD.Node,fD.Left,fN.Left),cx.Branch(fL,fN.Right,fM))):cx.Branch(fD.Node,fD.Left,cx.Branch(fL,fD.Right,fM)):cx.Branch(fL,fD,fM))));}return fD;};cx.Remove=function(fB,fC){var fD,fE,fF,fG;fD=cx.Lookup(fB,fC);fE=fD[0];fF=fD[1];return fE==null?fC:fE.Right==null?cx.Rebuild(fF,fE.Left):fE.Left==null?cx.Rebuild(fF,fE.Right):cx.Rebuild(fF,(fG=U.ofSeq(bc.append(cx.Enumerate(false,fE.Left),cx.Enumerate(false,fE.Right))),cx.Build(fG,0,fG.length-1)));};cC.NewFromSeq=function(fB){var fC,fD,fE;fC={};fD=da.Get(fB);try{while(fD.MoveNext()){fE=fD.Current();fC[fE[0]]=fE[1];}}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}return fC;};cD.New=function(fB,fC){return{x:fB,y:fC};};cE.New=function(fB,fC){return{box_group:fB,box_dim:fC};};cF.New=function(fB,fC,fD,fE,fF,fG){return{name:fB,content:fC,anchors:fD,debug_anchors:fE,sub_groups:fF,offset:fG};};cH.create=function(fB,fC){return new cM.New(U.create(fB,fC));};cH.toArray=function(fB){return U.init(fB.get_Length(),function(fC){return cH.get(fB,fC);});};cH.get=function(fB,fC){return fB.get_Item(fC);};cI.simulate_callback=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK;function fL(fM,fN,fO,fP){return function(fQ){var fR,fS,fT,fU,fV;fR=fQ.time;fS=cI.EuclideanNorm(cL.toArray((fJ(fM))(fO)))<=0?(fC(cv.New(fM,(fD.grab_data(fM))(fO))),fC(cv.New(fR,(fD.grab_data(fR))(fO))),[fR,fO,fF.stepsdone+1]):fE.stiff?cI.runSolver(dC.New(dD.init(fM,fO,fJ,(fT=dD.defaults(),dF.New(fT.InitialStepSize,fE.abstolerance,fE.reltolerance,fT.MaxStep,fT.MinStep,fT.MaxScale,fT.MinScale,fT.NumberOfIterations,fT.Jacobian))),a.id,dD.advance,null,function(fW){return fW.t;},function(fW){return fW.x;}),fM,fN,fR,fO,fF.stepsdone,function(fW,fX){return(fD.grab_data(fW))(fX);},fH,fB,fC):cI.runSolver(dC.New(dG.init(fM,fO,fJ,(fU=dG.defaults(),dI.New(fU.InitialStepSize,fE.abstolerance,fE.reltolerance,fU.MaxStep,0.0001))),a.id,dG.advance,{$:1,$0:function(fW){return function(fX){return dG.add_interpolate(fW,fX);};}},function(fW){return fW.t;},function(fW){return fW.x;}),fM,fN,fR,fO,fF.stepsdone,function(fW,fX){return(fD.grab_data(fW))(fX);},fH,fB,fC);fV=fS[0];return[fV,fV+fH,cI.applyPertubation(fQ.target,fS[1],fG),fP];};}fE=fD.settings;fF=fD.simulator;fG=fF.populations;fH=fF.settings.get_print_interval();fI=A.filter(function(fM){var fN;return fM.time>=fF.currenttime&&(fN=fM.target,fN.$==0?U.exists(function(fO){return fO!==0;},fN.$0.get_get_pop_array()):true);},fF.events);fJ=fD.f;fK=bc.fold(function(fM,fN){return(function(fO){return fL(fO[0],fO[1],fO[2],fO[3]);}(fM))(fN);},[fF.currenttime,fF.nextprinttime,fD.concs,fF.stepsdone],fI);return cJ.New(fD.name,bf.New(fF.settings,fF.populations,fF.events,fK[0],fK[1],fK[3]),fD.grab_data,fD.interpolator,fD.settings,fD.f,fK[2]);};cI.create=function(fB,fC,fD,fE,fF,fG,fH){return cJ.New(fB,fC,fD,fE,fF,fH,fG);};cI.EuclideanNorm=function(fB){return fv.sqrt(bc.sumBy(function(fC){return fC*fC;},fB));};cI.runSolver=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK){var fL,fM,fN,fO,fP,fQ,fR,fS,fT;fL=true;fM=fC;fN=fD;fT=[fF];fP=fG;fQ=fB.init;fR=fB.init;fS=true;while(fS)(function(){var fU;fQ=fR;fR=fB.advance(fQ);return bc.fold(function(fV,fW){var fX,fY,fZ,f0,f1,f2,f3;return!fS?null:(fX=fB.get_x(fW),fY=fB.get_time(fW),a.isNaN(fX[0])?cV.ode_solver_error("Solver produced bad solution. Try altering tolerances."):void 0,fZ=_1.shouldStop(fE,fY,fP,fJ,null)?[fE,cI.Lerp(fE,fM,fT[0],fY,fX)]:[fY,fX],f0=fZ[0],fM===fE?(f1=0.99999999,fK(cv.New(f1*fE+(1-f1)*(fM-fI),fH(fM,fT[0])))):void 0,f2=_1.shouldPrint(fE,f0,fN,null,fL,fM)?(fK(cv.New(fM,fH(fM,fT[0]))),f3=f0+fI,bk.Compare(f3,fE)===-1?f3:fE):fN,fJ[0]||fM===fE?(fS=false,void(fM=f0)):(fL=false,fM=f0,fN=f2,fT[0]=fZ[1],void(fP=fP+1)));},null,(fU=fB.refine,fU==null?A.ofArray([fR]):A.append((fU.$0(fQ))(fR),A.ofArray([fR]))));}());return[fM,fT[0],fP];};cI.applyPertubation=function(fB,fC,fD){var fE;return fB=="OutputPoint"?fC:(fE=K.OfArray(U.ofSeq(A.map(function(fF){var fG;return[(fG=fD.tryFind_index(fF.species),fG==null?F.FailWith("Unknown species in event"):fG.$0),fF.value];},fB.$0.get_get_pop_info_list()))),cL.ofArray(U.mapi(function(fF,fG){var fH;fH=K.TryFind(fF,fE);return fH==null?fG:fG+fH.$0;},cL.toArray(fC))));};cI.Lerp=function(fB,fC,fD,fE,fF){return cL.scale(1/(fE-fC),cL.add(cL.scale(fE-fB,fD),cL.scale(fB-fC,fF)));};cJ.New=function(fB,fC,fD,fE,fF,fG,fH){return{name:fB,simulator:fC,grab_data:fD,interpolator:fE,settings:fF,f:fG,concs:fH};};cL.toArray=function(fB){return a.Array.prototype.slice.call(fB);};cL.ofArray=function(fB){return new a.Float64Array(fB);};cL.add=function(fB,fC){var fD,fE,fF,fG;cL.checkSize(fB,fC);fD=fB.length;fE=new a.Float64Array(fD);for(fF=0,fG=fD-1;fF<=fG;fF++)fE[fF]=fB[fF]+fC[fF];return fE;};cL.dot=function(fB,fC){var fD,fE,fF;cL.checkSize(fB,fC);fD=0;for(fE=0,fF=fB.length-1;fE<=fF;fE++)fD=fD+fB[fE]*fC[fE];return fD;};cL.map=function(fB,fC){var fD;fD=cL.copy(fC);cL.update(fB,fD);return fD;};cL.sum=function(fB){var fC,fD,fE;fC=0;for(fD=0,fE=fB.length-1;fD<=fE;fD++)fC=fC+fB[fD];return fC;};cL.map2=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ;cL.checkSize(fC,fD);fE=fC.length;fF=new a.Float64Array(fE);for(fG=0,fH=fE-1;fG<=fH;fG++){fF[fG]=(fI=fC[fG],(fJ=fD[fG],(fB(fI))(fJ)));}return fF;};cL.max=function(fB){var fC,fD,fE,fF;fC=0;for(fD=0,fE=fB.length-1;fD<=fE;fD++){fC=(fF=fB[fD],bk.Compare(fC,fF)===1?fC:fF);}return fC;};cL.scale=function(fB,fC){var fD,fE,fF;fD=cL.copy(fC);for(fE=0,fF=fD.length-1;fE<=fF;fE++)fD[fE]=fB*fD[fE];return fD;};cL.subtract=function(fB,fC){var fD,fE,fF,fG;cL.checkSize(fB,fC);fD=fB.length;fE=new a.Float64Array(fD);for(fF=0,fG=fD-1;fF<=fG;fF++)fE[fF]=fB[fF]-fC[fF];return fE;};cL.copy=function(fB){var fC;fC=new a.Float64Array(fB.length);fC.set(fB);return fC;};cL.mapi2=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ;cL.checkSize(fC,fD);fE=fC.length;fF=new a.Float64Array(fE);for(fG=0,fH=fE-1;fG<=fH;fG++){fF[fG]=(fI=fC[fG],(fJ=fD[fG],((fB(fG))(fI))(fJ)));}return fF;};cL.checkSize=function(fB,fC){if(fB.length!==fC.length)F.FailWith("Vector dimensions do not match");};cL.update=function(fB,fC){var fD,fE;for(fD=0,fE=fC.length-1;fD<=fE;fD++)fC[fD]=fB(fC[fD]);};cL.setScaled=function(fB,fC){var fD,fE,fF;fD=fC.length;for(fE=0,fF=fD-1;fE<=fF;fE++)fC[fE]=fB*fC[fE];};cL.setAddedScaled=function(fB,fC,fD){var fE,fF,fG;cL.checkSize(fB,fC);fE=fB.length;for(fF=0,fG=fE-1;fF<=fG;fF++)fB[fF]=fB[fF]+fD*fC[fF];};cM=d.VectorFS=fu.Class({set_Item:function(fB,fC){U.set(this.values,fB,fC);},ToArray:function(){return cH.toArray(this);},get_Length:function(){return U.length(this.values);},get_Item:function(fB){return U.get(this.values,fB);}},w,cM);cM.New=fu.Ctor(function(fB){w.New.call(this);this.values=fB;},cM);cN=d.Lambda=fu.Class({get_key:function(){return this.$0;},Equals:function(fB){return fB instanceof cN&&this===fB;},GetHashCode:function(){return bk.Hash(this);}},null,cN);cO.matrMultVec=function(fB,fC){var fD;fD=new a.Float64Array(cO.numRows(fB));cO.matrMultVecStore(fB,fC,fD);return cL.ofArray(fD);};cO.ofArray=function(fB){return c1.New(U.map(cL.ofArray,fB));};cO.matrMultMatr=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;fD=cO.numRows(fB);fE=cO.numCols(fB);fF=cO.numCols(fC);fE!==cO.numRows(fC)?F.FailWith("Matrix dimensions do not match"):null;fG=cO.zeros(fD,fF);for(fH=0,fI=fD-1;fH<=fI;fH++){fJ=fB.get_Item(fH);fK=fG.get_Item(fH);for(fL=0,fM=fF-1;fL<=fM;fL++){fN=0;for(fO=0,fP=fE-1;fO<=fP;fO++)fN=fN+fJ[fO]*(U.get(fC.MatrixData,fO))[fL];fK[fL]=fN;}}return fG;};cO.add=function(fB,fC){cO.sameSizeCheck(fB,fC);return c1.New(U.map2(cL.add,fB.MatrixData,fC.MatrixData));};cO.numRows=function(fB){return U.length(fB.MatrixData);};cO.matrMultVecStore=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK;for(fE=0,fF=cO.numRows(fB)-1;fE<=fF;fE++){fG=0;fI=fB.get_Item(fE);for(fJ=0,fK=cO.numCols(fB)-1;fJ<=fK;fJ++)fG=fG+fI[fJ]*fC[fJ];U.set(fD,fE,fG);}};cO.numCols=function(fB){return U.get(fB.MatrixData,0).length;};cO.zeros=function(fB,fC){return c1.New(U.init(fB,function(){return new a.Float64Array(fC);}));};cO.sameSizeCheck=function(fB,fC){var fD,fE;fD=cO.numRows(fB);fE=cO.numCols(fB);fD!==cO.numRows(fC)||fE!==cO.numCols(fC)?F.FailWith("Matrix dimensions do not match"):void 0;};cO.toArray=function(fB){return U.init(cO.numRows(fB),function(fC){return cL.toArray(cO.copyRow(fB,fC));});};cO.copyCol=function(fB,fC){var fD,fE,fF,fG;fD=cO.numRows(fB);fE=new a.Float64Array(fD);for(fF=0,fG=fD-1;fF<=fG;fF++)fE[fF]=(U.get(fB.MatrixData,fF))[fC];return fE;};cO.ofRows=function(fB){return c1.New(U.map(cL.copy,fB));};cO.matrMultScal=function(fB,fC){return cO.scalMultMatr(fC,fB);};cO.copyRow=function(fB,fC){return cL.copy(fB.get_Item(fC));};cO.copy=function(fB){return c1.New(U.map(cL.copy,fB.MatrixData));};cO.scalMultMatr=function(fB,fC){return c1.New(U.map(function(fD){return cL.scale(fB,fD);},fC.MatrixData));};cO.subtract=function(fB,fC){cO.sameSizeCheck(fB,fC);return c1.New(U.map2(cL.subtract,fB.MatrixData,fC.MatrixData));};cO.identity=function(fB,fC){var fD,fE,fF,fG,fH;fD=cO.zeros(fB,fC);for(fE=0,fF=(fG=fB-1,(fH=fC-1,bk.Compare(fG,fH)===-1?fG:fH));fE<=fF;fE++)(U.get(fD.MatrixData,fE))[fE]=1;return fD;};cO.vectorProduct=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;fD=fB.length;fE=fC.length;fF=cO.zeros(fD,fE);for(fG=0,fH=fD-1;fG<=fH;fG++){for(fI=0,fJ=fE-1;fI<=fJ;fI++){fK=fB[fG]*fC[fI];(U.get(fF.MatrixData,fG))[fI]=fK;}}return fF;};cP=d.Ode=fu.Class({to_oslo:function(){return this.to_oslo_abstract().evaluate();},to_sundials:function(){return this.to_sundials_abstract().evaluate();},to_lna:function(fB){var fC,fD,fE,fF,fG;fC=cP.get_matrices(this.initials,this.reactions);fD=fC[0];fE=dJ.create(this.name,this.settings,fC[1],fC[2],cP.get_rates(fD,this.reactions,!bk.Equals(this.settings.simulation.kinetics,"Deterministic")),fD,this.initials);fF=bF.to_env(this.settings.parameters);fG=U.map(function(fH){return R["eval"](function(fI){return di.find(fF,fI);},fH.value);},U.ofList(this.initials));return _4.initialise(fE.evaluate(),fE.matrix,fG,fB);},to_oslo_abstract:function(){var fB,fC;fB=cP.get_matrices(this.initials,this.reactions);fC=fB[0];return dJ.create(this.name,this.settings,fB[1],fB[2],cP.get_rates(fC,this.reactions,bk.Equals(this.settings.simulation.kinetics,"Stochastic")),fC,this.initials);},to_sundials_abstract:function(){return dL.create(K.OfArray(U.mapi(function(fB,fC){return[fC.species,fB];},U.ofSeq(bc.distinctBy(function(fB){return fB.species;},this.initials)))),this.reactions,this.initials,this.settings);},prune:function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;function fQ(fW){var fX;fX=R.simplify(R.substitute(fB,fW));return fX.$==1?fX.$0!==0:true;}function fR(fW,fX){return A.forAll(function(fY){return A.contains(fY,fW);},b$.elements(fX.reactants));}function fS(fW,fX){return function(fY){var fZ,f0,f1;fZ=A.partition(function(f2){return fR(fY,f2);},fX);f0=fZ[0];return f0.$==0?[fW,fY]:(f1=A.filter(function(f2){return!A.contains(f2,fY);},A.collect(function(f2){return b$.elements(f2.products);},f0)),(function(f2){return fS(f2[0],f2[1]);}([A.append(f0,fW),fZ[1]]))(A.distinct(A.append(f1,fY))));};}function fT(fW){return fW.$==1?{$:1,$0:fW.$0}:null;}function fU(fW){return fW[1];}function fV(fW){return Q.all_species(fH,fW);}fC=A.filter(function(fW){return fQ(fW.value);},this.initials);fD=A.map(function(fW){return fW.species;},fC);fE=(function(fW){return fS(fW[0],fW[1]);}([B.Empty,A.collect(function(fW){var fX;fX=fW.normalise();return fX[1]==null?A.ofArray([fX[0]]):A.ofArray([fX[0],fX[1].$0]);},this.reactions)]))(fD);fF=fE[1];fG=fE[0];fH=this.settings.all_used_rates((fI=function(fW){return A.choose(fT,fW);},function(fW){return fI(R.mentions(fW));}),fG);fJ=K.OfArray(U.ofSeq(A.map(function(fW){return[{$:2,$0:fW},{$:1,$0:0}];},A.ofSeq(dh.op_Subtraction(new dh.New$1(cx.OfSeq(A.collect(function(fW){return fV(fU(fW));},A.ofSeq(K.ToSeq(fH))))),new dh.New$1(cx.OfSeq(fF)))))));fK=K.Map(function(fW,fX){return R.substitute(fJ,fX);},fH);fL=K.OfArray(U.ofSeq(A.map(function(fW){return[{$:2,$0:fW},{$:1,$0:0}];},A.ofSeq(dh.op_Subtraction(new dh.New$1(cx.OfSeq(A.collect(function(fW){return Q.all_species(fH,fW);},this.settings.simulation.plots))),new dh.New$1(cx.OfSeq(fF)))))));fM=(fN=this.settings,O.New((fO=this.settings.simulation,P.New(fO.name,fO.initial,fO["final"],fO.points,A.map(function(fW){return R.substitute(fL,fW);},this.settings.simulation.plots),fO.plotcolours,fO.seed,fO.kinetics,fO.times,fO.prune,fO.multicore,fO.data,fO.sweeps)),fN.simulations,fN.stochastic,fN.deterministic,fN.spatial,fN.inference,fN.moment_closure,fN.synthesis,fN.data,fN.units,fN.simulator,fN.parameters,fN.sweeps,fK,fN.plot,fN.quiet));fP=A.map(function(fW){return fW.species;},fC);return cP.New(this.name,fM,fG,A.rev(db.fold_left(function(fW,fX){return A.exists(function(fY){return bk.Equals(fX,fY);},fP)?fW:new B({$:1,$0:V.create$4(false,{$:1,$0:0},fX,null,null),$1:fW});},A.rev(fC),fF)));},substitute:function(fB){return cP.New(this.name,this.settings.substitute(fB),this.reactions,this.initials);},simulate_instance:function(fB,fC){try{return bt.create(fC,fB(this.substitute(fC.environment)));}catch(fD){return F.FailWith(a.String(fD));}}},null,cP);cP.list_to_inference=function(fB,fC){var fD;function fE(fF,fG){var fH,fI;fH=fF?fG:cP.update_times(B.Empty,fG);fI=fB.simulator;return fI=="Oslo"?fH.to_oslo().simulate():fI=="Sundials"?cP.simulate_sundials(fH):(function(fJ){return function(fK){return fJ("Invalid simulator type for inference: "+bN.p(fK));};}(F.FailWith))(fB.simulator);}fD=cP.list_to_inference_method(fB,fC);return fB.inference.partial_evaluation?cP.list_inference_dependencies(fB,fD[0],fD[1],function(fF){return function(fG){return fE(fF,fG);};},fD[3],fD[4],fD[2],fD[5]):cP.list_inference_full(fB,fD[0],fD[1],function(fF){return function(fG){return fE(fF,fG);};},fD[3],fD[4],fD[2],fD[5]);};cP.create=function(fB,fC,fD,fE){return cP.New(fB,fE,fC,fD);};cP.get_matrices=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ;fD=U.ofList(A.distinctBy(function(fK){return fK.species;},fB));fE=K.OfArray(U.mapi(function(fK,fL){return[fL.species,fK];},fD));fF=A.length(fC);fG=fD.length;fH=U.init(fG,function(){return U.create(fF,0);});for(fI=0,fJ=fG-1;fI<=fJ;fI++)(function(fK){return A.iteri(function(fL,fM){return U.set(U.get(fH,fK),fL,fM.getStoich(U.get(fD,fK).constant,U.get(fD,fK).species));},fC);}(fI));return[fE,fH,U.ofList(A.map(function(fK){return b$.collectm(function(fL){return[fE.get_Item(fL.element),fL.multiplicity];},fK.reactants);},fC))];};cP.get_rates=function(fB,fC,fD){var fE,fF;function fG(fH){var fI;fI=K.TryFind(fH,fB);return fI==null?(function(fJ){return function(fK){return fJ("Missing species: "+_2.prettyPrint(fK)+" in rate");};}(F.FailWith))(fH.name):fI.$0;}fE=(fF=function(fH){return co.map(fG,fH);},function(fH){return R.map(fF,fH);});return U.ofList(A.map(function(fH){return fH.rate.map(fD?function(fI){return fH.deterministic_to_stochastic(fI);}:a.id,fE);},fC));};cP.to_matlab=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU;function fV(f1){dl.append(fQ,f1);}function fW(f1){return R["eval"](fD,f1);}function fX(f1){return"sol.(\'"+be.to_string(f1)+"\')";}function fY(f1){var f2,f3;f2=A.map(function(f4){return[f4,be.to_string(f4)];},A.rev(b$.elements(f1.reactants)));f3=f1.rate;return f3.$==1?R.to_string(function(f4){return co.to_matlab(be.to_string,fF,f4);},f3.$0):R.to_string(a.id,bc.fold(function(f4,f5){var f6;f6={$:1,$0:f1.numInReactants(f5[0])};return R.mul(f4,R.power$1(R.from_string(D.name(),f5[1]),f6));},f3.$0,f2));}function fZ(f1){return"d"+f1;}function f0(f1,f2,f3){var f4;f4=(db.fold_left(function(f5,f6){return(function(f7){var f8,f9;f8=f7[0];f9=f7[1];return function(f_){var f$,ga;f$=bc.nth(f1,f2);ga=f_[1].getStoich(f$.constant,f$.species);return ga===0?[f8,f9]:[f8+(ga>0?f9?" ":" + ":f9?" -":" - ")+(fv.abs(ga)===1?"":a.String(fv.abs(ga))+"*")+"r_"+a.String(f_[0]),false];};}(f5))(f6);},["",true],f3))[0];return f4===""?"0.0":f4;}fC=db.newline();fD=(fE=bF.to_env(fB.settings.parameters),function(f1){return di.find(fE,f1);});fF="t";fG="dxdt";fH="x__";fI="odes";fJ="tstart";fK="species";fL="sol";fM="i";fN="n";fO="tfinal";fP="plots";fQ=dl.empty();fR=!(fB.settings.simulation.plots.$==0);fV("function "+fL+" = "+"crn_export"+"()"+fC+fC);fV(fJ+" = "+a.String(fB.settings.simulation.initial)+"; % Initial time"+fC);fV(fO+" = "+a.String(fB.settings.simulation["final"])+"; % Final time"+fC);fV(fK+" = {"+db.string_of_list(function(f1){return"\'"+f1.species.name+"\'";},",",fB.initials)+"}; % The list of all species"+fC);fR?fV(fP+" = {"+db.string_of_list(function(f1){return"\'"+R.to_string(function(f2){return co.to_matlab(be.to_string,"time",f2);},f1)+"\'";},",",fB.settings.simulation.plots)+"};"+fC):void 0;fV(fN+" = length("+fK+");"+fC+fC);fV("% Write out the parameters");A.iter(function(f1){fV(fC+"p."+f1.name+" = "+a.String(f1.value)+";");},fB.settings.parameters);fV(fC+fC);fS=A.map(function(f1){return V["eval"](fW,f1);},fB.initials);fV("% Assign initial conditions"+fC);fV("x0 = zeros("+fN+",1);");A.iteri(function(f1,f2){return f2.value!==0?fV(fC+"x0("+a.String(f1+1)+") = "+a.String(f2.value)+";"+"\\u0009\\u0009"+"% "+f2.species.name):null;},fS);fV(fC+fC);fT=fB.settings.parameters.$==0?"":",p";fV("% Solve the ODEs"+fC);fV("["+fF+","+fH+"] = "+"ode15s"+"(@"+fI+",["+fJ+" "+fO+"],x0,[]"+fT+");"+fC+fC);fV("% Write out a solution structure to be returned by the function"+fC);fV("for "+fM+" = 1:"+fN+fC);fV("  "+fL+".("+fK+"{"+fM+"}) = "+fH+"(:,"+fM+");"+fC);fV("end"+fC+fC);fR?(fV("% Apply plot expressions"+fC),fV("plotsValues = zeros(length("+fH+"),"+a.String(A.length(fB.settings.simulation.plots))+");"),A.iteri(function(f1,f2){return fV(fC+"plotsValues(:,"+a.String(f1+1)+") = "+dk.Replace(dk.Replace(dk.Replace(R.to_string(function(f3){return co.to_matlab(fX,"time",f3);},f2),"*",".*"),"/","./"),"^",".^")+";");},fB.settings.simulation.plots),fV(fC+fC)):void 0;fV("% Produce a plot"+fC);fV("figure;"+fC);fU=fR?["plotsValues",fP]:[fH,fK];fV("plot("+fF+", "+fU[0]+")"+fC);fV("xlabel(\'Time\')"+fC);fV("ylabel(\'Concentration\')"+fC);fV("box off"+fC);fV("legend("+fU[1]+",\'box\',\'off\')");fV(fC+fC+"return"+fC+fC+"%%%"+fC+fC);fV("function "+fG+" = "+fI+"("+fF+","+fH+fT+")"+fC+fC);!(fB.settings.parameters.$==0)?(fV("% Write out the parameters"),A.iter(function(f1){fV(fC+f1.name+" = p."+f1.name+";");},fB.settings.parameters),fV(fC+fC)):void 0;fV("% Assign states");A.iteri(function(f1,f2){return fV(fC+f2.species.name+" = "+fH+"("+a.String(f1+1)+")"+";");},fS);fV(fC+fC);!fB.settings.rates.get_IsEmpty()?(fV("% Define rate expressions"),K.Iterate(function(f1,f2){return fV(fC+f1+" = "+R.to_string(function(f3){return co.to_matlab(be.to_string,fF,f3);},f2)+";");},fB.settings.rates),fV(fC+fC)):void 0;fV("% Define reaction propensities");A.iteri(function(f1,f2){return fV(fC+"r_"+a.String(f1)+" = "+fY(f2)+";");},fB.reactions);fV(fC+fC);fV("% Assign derivatives");A.iteri(function(f1,f2){return fV(fC+fZ(f2.species.name)+" = "+f0(f1,fS,A.indexed(fB.reactions))+";");},fB.initials);fV(fC+fC);fV(fG+" = ["+db.string_of_list(function(f1){return fZ(f1.species.name);},";",fB.initials)+"];"+fC+fC);fV("return");return a.String(fQ);};cP.update_times=function(fB,fC){return cP.New(fC.name,fC.settings.update_times(fB),fC.reactions,fC.initials);};cP.simulate_sundials=function(fB){var fC,fD;try{return fB.to_sundials().simulate();}catch(fE){if(fE instanceof cX){throw cV.ode_solver_error((fD=bF.to_string_inline(fB.settings.parameters),(((fu.Curried3(function(fF,fG,fH){return fF(_2.toSafe(fG)+"\\n\\nParameters: "+_2.toSafe(fH));}))(a.id))(fE.message))(fD)));}else throw fE;return fC;}};cP.list_to_inference_method=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU;function fV(fX,fY){return A.map(function(fZ){return cP.New(fX.name,fX.settings.update_simulation(fZ.settings),fX.reactions,fX.initials);},fY);}function fW(fX,fY){return fX.prune(db.update_map(fU,fY));}fD=fB.to_inference_runs(A.map(function(fX){return fX.settings;},fC));fE=fD[2];fF=fD[3];fG=fD[0];fH=bF.to_env((A.partition(bX.variable,fG))[1]);fI=A.map(function(fX){return A.map(function(fY){return fY.inline_env(fH);},fX);},fE);fJ=bF.remove(A.collect(ek.get_variables,fI),fG);fK=A.zip(fI,fF);fL=A.collect(function(fX){return A.map(function(fY){return fY.plots;},fX);},fF);fM=A.map(function(fX){var fY;return cP.New(fX.name,(fY=fX.settings,O.New(fY.simulation,fY.simulations,fY.stochastic,fY.deterministic,fY.spatial,fY.inference,fY.moment_closure,fY.synthesis,fY.data,fY.units,fY.simulator,fG,fY.sweeps,fY.rates,fY.plot,fY.quiet)),fX.reactions,fX.initials);},fC);fN=bF.to_env(fJ);fO=A.map2(function(fX,fY){return cP.generate_instances(fN,fX.name,fY[0],fY[1]);},fM,fK);fP=A.concat((((fu.Curried3(A.map2))(fV))(fM))(fO));fQ=A.concat(fO);fR=A.concat(fE);fS=fB.simulation.prune?(fT=A.collect(function(fX){return A.map(function(fY){return K.OfArray(U.ofSeq(A.zip(fX.get_merge().variables,fY)));},fX.get_merge().values);},fR),(fU=K.Map(function(fX,fY){return{$:1,$0:fY};},fH),(((fu.Curried3(A.map2))(fW))(fP))(fT))):fP;return[fL,A.concat(fD[1]),fJ,fS,fQ,fR];};cP.list_inference_dependencies=function(fB,fC,fD,fE,fF,fG,fH,fI){var fJ;fJ=A.indexed(ek.get_variable_dependencies(fI));return bu.create_with_dependencies(fB.inference,function(fK,fL,fM){var fN,fO,fP,fQ,fR;function fS(fT,fU){return A.contains(fT,fR);}fN=A.map2(function(fT,fU){return fT.update_environment(fU);},fG,A.map(function(fT){return fT[1];},ek["eval"](fL,fI)));fO=A.map(function(fT){return fT.substitute(fL);},fF);fP=A.indexed(A.zip(fN,fO));fQ=fM.$==0?[fN,fO]:(fR=fM.$0,A.unzip(A.map(function(fT){return fT[1];},A.filter(function(fT){return fS(fT[0],fT[1]);},fP))));return cP.list_simulate_instances(fB.simulation.multicore,fE(fK),fQ[0],fQ[1]);},fC,fD,fH,A.map(function(fK){var fL;function fM(fN,fO){return A.contains(fK.name,fO);}fL=A.filter(function(fN){return fM(fN[0],fN[1]);},fJ);return fL.$==0?d2.All:{$:1,$0:A.sort(A.map(function(fN){return fN[0];},fL))};},fH));};cP.list_inference_full=function(fB,fC,fD,fE,fF,fG,fH,fI){return bu.create(fB.inference,function(fJ,fK){var fL,fM;fL=A.map2(function(fN,fO){return fN.update_environment(fO);},fG,A.map(function(fN){return fN[1];},ek["eval"](fK,fI)));fM=A.map(function(fN){return fN.substitute(fK);},fF);return cP.list_simulate_instances(fB.simulation.multicore,fE(fJ),fL,fM);},fC,fD,fH);};cP.generate_instances=function(fB,fC,fD,fE){var fG,fH,fI,fJ;function fF(fK,fL,fM,fN){return function(fO){return C.create$5(fC,fK,fL,fM,fO,fN);};}fG=ek.eval_label(fB,fD);fH=A.length(fE);fI=A.length(fG);if(fH!==fI){fJ=A.head(fG);throw new cW.New(((((fu.Curried(function(fK,fL,fM,fN){return fK("Number of sweep items in "+_2.toSafe(fL)+" ("+a.String(fM)+") not compatible with number of data columns ("+a.String(fN)+")");},4))(a.id))(fJ[0]))(fI))(fH));}else return A.map2(function(fK,fL){return(function(fM){return fF(fM[0],fM[1],fM[2],fM[3]);}(fK))(fL);},fG,fE);};cP.list_simulate_instances=function(fB,fC,fD,fE){return fB?F.FailWith("Can\'t use Async in JavaScript (directive simulation {multicore=True})"):A.map2(function(fF,fG){return fG.simulate_instance(fC,fF);},fD,fE);};cP.New=function(fB,fC,fD,fE){return new cP({name:fB,settings:fC,reactions:fD,initials:fE});};cR=cQ.Random=fu.Class({NextDouble:function(){var fB;fB=this.rng[0].Microsoft_Research_Filzbach_Lib_IRng$NextDouble();this.rng[0]=fB[1];return fB[0];},Next$1:function(){var fB;fB=this.rng[0].Microsoft_Research_Filzbach_Lib_IRng$NextInt32();this.rng[0]=fB[1];return F.toInt(fB[0]);}},w,cR);cR.New$1=fu.Ctor(function(fB){w.New.call(this);this.rng=[new dK.New(fB)];},cR);cR.New=fu.Ctor(function(){var fB;cR.New$1.call(this,fv.abs(F.toInt((fB=fy.now(),fB*10000))));},cR);cS.count=function(fB){return fB.count;};cS.iter=function(fB,fC){var fD,fE;fD=da.Get(fC);try{while(fD.MoveNext()){fE=fD.Current();fB(fE.K,fE.V);}}finally{if(typeof fD=="object"&&"Dispose"in fD)fD.Dispose();}};cS.find=function(fB,fC){return fB.get_Item(fC);};cS.ofMap=function(fB){var fC;fC=cS.empty();K.Iterate(function(fD,fE){return cS.add(fC,fD,fE);},fB);return fC;};cS.empty=function(){return new bd.New$5();};cS.add=function(fB,fC,fD){fB.set_Item(fC,fD);};cS.tryFind=function(fB,fC){return fB.ContainsKey(fC)?{$:1,$0:fB.get_Item(fC)}:null;};cS.map_key=function(fB,fC){var fD;fD=cS.empty();cS.iter(function(fE,fF){return cS.add(fD,fB(fE),fF);},fC);return fD;};cS.copy=function(fB){var fC;fC=cS.empty();cS.iter(function(fD,fE){return cS.add(fC,fD,fE);},fB);return fC;};cS.fold=function(fB,fC,fD){var fE,fF,fG;fE=fD;fF=da.Get(fC);try{while(fF.MoveNext()){fG=fF.Current();fE=fB(fG.K,fG.V,fE);}}finally{if(typeof fF=="object"&&"Dispose"in fF)fF.Dispose();}return fE;};cS.map=function(fB,fC){var fD;fD=cS.empty();cS.iter(function(fE,fF){return cS.add(fD,fE,fB(fF));},fC);return fD;};cT=d.Event=fu.Class({},null,cT);cT.create=function(fB,fC){return cT.New(fC,{$:0,$0:fB});};cT.New=function(fB,fC){return new cT({time:fB,target:fC});};cU.New=function(fB,fC,fD){return{reaction:fB,propensity:fC,dependencies:fD};};b$.iterm=function(fB,fC){A.iter(fB,fC);};b$.elements=function(fB){return A.map(function(fC){return fC.element;},fB);};b$.union_all=function(fB,fC){return db.fold_left(function(fD,fE){return b$.union(fB,fD,fE);},b$.empty(),fC);};b$.to_mlist=a.id;b$.map=function(fB,fC){return A.map(function(fD){return ca.New(fB(fD.element),fD.multiplicity);},fC);};b$.is_empty=function(fB){return fB.$==0;};b$.union=function(fB,fC,fD){return db.fold_left(function(fE,fF){return b$.add(fB,fE,fF);},fC,fD);};b$.empty=function(){eu.$cctor();return eu.empty;};b$.collectm=function(fB,fC){return A.map(fB,fC);};b$.size=function(fB){return b$.fold_left_m(function(fC,fD){return fC+fD.multiplicity;},0,fB);};b$.to_map=function(fB){return K.OfArray(U.ofSeq(A.map(function(fC){return[fC.element,fC.multiplicity];},fB)));};b$.nonzero_elements=function(fB){return A.choose(function(fC){return fC.multiplicity===0?null:{$:1,$0:fC.element};},fB);};b$.difference=function(fB,fC,fD){return A.append(b$.mapm(function(fE){return ca.New(fE.element,fE.multiplicity-b$.get_mult(fB,fD,fE.element));},fC),b$.mapm(function(fE){return ca.New(fE.element,-fE.multiplicity);},b$.filter(function(fE){return b$.get_mult(fB,fC,fE)===0;},fD)));};b$.fold_left_m=function(fB,fC,fD){return db.fold_left(fB,fC,fD);};b$.get_mult=function(fB,fC,fD){var fE;fE=bc.tryFind(function(fF){return fB(fD,fF.element);},fC);return fE!=null&&fE.$==1?fE.$0.multiplicity:0;};b$.add=function(fB,fC,fD){function fE(fF,fG){var fH,fI;return fG.$==1?(fH=fG.$1,(fI=fG.$0,fB(fI.element,fF.element)?new B({$:1,$0:ca.New(fI.element,fI.multiplicity+fF.multiplicity),$1:fH}):new B({$:1,$0:fI,$1:fE(fF,fH)}))):A.ofArray([fF]);}return fE(fD,fC);};b$.mapm=function(fB,fC){return A.map(fB,fC);};b$.filter=function(fB,fC){return A.filter(function(fD){return b$.on_e(fB,fD);},fC);};b$.to_string=function(fB,fC,fD){return db.string_of_list(function(fE){return fE.multiplicity===0?"":fE.multiplicity===1?fB(fE.element):a.String(fE.multiplicity)+fB(fE.element);},fC,fD);};b$.on_e=function(fB,fC){return fB(fC.element);};b$.parse=function(fB){var fC,fD;fC=D.sepBy((fD=b$.counted(fB),function(fE){return b$.op_DotGreaterGreater(fD,D.spaces(),fE[0],fE[1]);}),D.skw("+"));return function(fE){return b$.op_BarGreaterGreater(fC,b$.from_mlist,fE[0],fE[1]);};};b$.op_BarGreaterGreater=function(fB,fC,fD,fE){return(D.op_BarGreaterGreater(fB,fC))([fD,fE]);};b$.from_mlist=function(fB){return db.fold_left(function(fC,fD){return b$.add(bk.Equals,fC,fD);},b$.empty(),fB);};b$.op_DotGreaterGreater=function(fB,fC,fD,fE){return(D.op_DotGreaterGreater(fB,fC))([fD,fE]);};b$.counted=function(fB){var fC,fD;function fE(fH){return ca.New(fH,1);}function fF(fH,fI){return b$.op_PlusGreaterGreaterPlus(D.pint32(),fB,fH,fI);}function fG(fH,fI){return ca.New(fI,fH);}fC=function(fH){return b$.op_BarGreaterGreater(fB,fE,fH[0],fH[1]);};fD=function(fH){return b$.op_BarGreaterGreater(function(fI){return fF(fI[0],fI[1]);},function(fI){return fG(fI[0],fI[1]);},fH[0],fH[1]);};return function(fH){return b$.op_LessBarGreater(fC,fD,fH[0],fH[1]);};};b$.op_LessBarGreater=function(fB,fC,fD,fE){return(D.op_LessBarGreater(fB,fC))([fD,fE]);};b$.op_PlusGreaterGreaterPlus=function(fB,fC,fD,fE){return(D.op_PlusGreaterGreaterPlus(fB,fC))([fD,fE]);};cW=cV.EngineException=fu.Class({},G,cW);cW.New=fu.Ctor(function(fB){this.message=fB;cG.setPrototypeOf(this,cW.prototype);},cW);cX=cV.SimulatorErrorException=fu.Class({},cW,cX);cX.New=fu.Ctor(function(fB){cW.New.call(this,"Simulator error: "+fB);},cX);cY.Time={$:1};cY.map=function(fB,fC){return fC.$==1?cY.Time:{$:0,$0:fB(fC.$0)};};cZ.New=function(fB,fC,fD,fE,fF,fG){return{id:fB,payload:fC,population:fD,isExplored:fE,isConstant:fF,deps:fG};};c0.New=function(fB,fC,fD,fE,fF){return{id:fB,payload:fC,reacts:fD,prods:fE,prop:fF};};c1=cK.Matrix=fu.Class({get_Item:function(fB){return U.get(this.MatrixData,fB);}},null,c1);c1.New=function(fB){return new c1({MatrixData:fB});};c2.array=function(fB,fC,fD){return fC==null?fD!=null&&fD.$==1?fB.slice(0,fD.$0+1):[]:fD==null?fB.slice(fC.$0):fB.slice(fC.$0,fD.$0+1);};c4.neumann_solve=function(fB,fC,fD,fE,fF){var fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;fG=fE.numspecies;fH=fE.nx;fI=fE.dt;fJ=(fE.xmax-fE.xmin)/(fE.nx-1);fK=U.map(function(fQ){return fQ*fI/(fJ*fJ);},fE.D);fL=U.init(fG,function(fQ){return U.concat([[0],U.create(fH-1,U.get(fK,fQ))]);});fM=U.init(fG,function(fQ){return U.concat([[2-U.get(fK,fQ)],U.create(fH-2,2-2*U.get(fK,fQ)),[2-U.get(fK,fQ)]]);});fN=U.init(fG,function(fQ){return U.concat([U.create(fH-1,U.get(fK,fQ)),[0]]);});fO=U.init(fG,function(fQ){var fR,fS,fT,fU,fV,fW,fX,fY;fR=U.get(fK,fQ);fS=-fR;fT=2+2*fR;fU=-fR;fV=fF===1?[U.create(fH,fS),U.concat([[2+fR],U.create(fH-2,fT),[2+fR]]),U.create(fH,fU)]:fF===2?[U.concat([[-fR*2/3],U.create(fH-1,fS)]),U.concat([[2+fR*2/3],U.create(fH-2,fT),[2+fR*2/3]]),U.concat([U.create(fH-1,fU),[-fR*2/3]])]:(function(fZ){return function(f0){return fZ("No order "+a.String(f0)+" approximation defined for zero-flux 1d solver");};}(F.FailWith))(fF);fW=fV[2];fX=fV[1];fY=fV[0];return function(fZ){return dM.TridiagonalAlgorithm(fY,fX,fW,fZ);};});fP=U.length(fE.plotlocs);return c4.solver(fB,fC,fD,fH,fG,fK,fO,fL,fM,fN,function(fQ){return U.init(fH,function(fR){return U.init(fP,function(fS){return U.get(U.get(fQ,U.get(fE.plotlocs,fS)),fR);});});},fE);};c4.periodic_solve=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fF=fE.numspecies;fG=fE.nx-1;fH=fE.dt;fI=(fE.xmax-fE.xmin)/(fE.nx-1);fJ=U.map(function(fP){return fP*fH/(fI*fI);},fE.D);fK=U.init(fF,function(fP){var fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0;fQ=U.get(fJ,fP);fR=-fQ;fS=2*(1+fQ);fT=-fQ;fU=U.create(fG,fR);fV=U.concat([[2*fS],U.create(fG-2,fS),[fS+fR*fT/fS]]);fW=U.create(fG,fT);fX=-fS;fY=U.concat([[fX],U.create(fG-2,0),[fT]]);fZ=U.concat([[1],U.create(fG-2,0),[fR/fX]]);f0=dM.TridiagonalAlgorithm(fU,fV,fW,fY);return function(f1){return dM.ApplySMInvertMatrix(fU,fV,fW,f1,fZ,f0);};});fL=U.init(fF,function(fP){return U.create(fG,U.get(fJ,fP));});fM=U.init(fF,function(fP){return U.create(fG,2*(1-U.get(fJ,fP)));});fN=U.init(fF,function(fP){return U.create(fG,U.get(fJ,fP));});fO=U.length(fE.plotlocs);return c4.solver(fB,fC,fD,fG,fF,fJ,fK,fL,fM,fN,function(fP){return U.init(fE.nx,function(fQ){return U.init(fO,function(fR){return fQ<fG?U.get(U.get(fP,U.get(fE.plotlocs,fR)),fQ):U.get(U.get(fP,U.get(fE.plotlocs,fR)),0);});});},fE);};c4.solver=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM){var fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW;fN=fB;fO=U.init(fF,function(){return U.create(fE,0);});fP=U.init(fF,function(){return U.create(fE,0);});fQ=U.create(fF,0);fR=U.create(fE,0);fS=fM.dt;for(fT=0,fU=fF-1;fT<=fU;fT++){for(fV=0,fW=fE-1;fV<=fW;fV++)U.set(U.get(fO,fT),fV,U.get(U.get(fC,fV),fT));}return bc.delay(function(){return bc.append([c5.New(fN,fL(fO))],bc.delay(function(){return bc.append(bc.enumWhile(function(){return fN<fM.tmax;},bc.delay(function(){return bc.append(bc.collect(function(){fN=fN+fS;return bc.append(bc.collect(function(fX){return bc.append(bc.collect(function(fY){U.set(fQ,fY,U.get(U.get(fO,fY),fX));return[];},F.range(0,fF-1)),bc.delay(function(){var fY;fY=fD(fN,fQ);return bc.collect(function(fZ){U.set(U.get(fP,fZ),fX,U.get(fY,fZ)*fS);return[];},F.range(0,fF-1));}));},F.range(0,fE-1)),bc.delay(function(){return bc.collect(function(fX){return U.get(fG,fX)>0?bc.append(bc.collect(function(fY){var fZ,f0;fZ=U.get(U.get(fO,fX),(fY-1+fE)%fE);f0=U.get(U.get(fO,fX),(fY+1)%fE);U.set(fR,fY,U.get(U.get(fI,fX),fY)*fZ+U.get(U.get(fJ,fX),fY)*U.get(U.get(fO,fX),fY)+U.get(U.get(fK,fX),fY)*f0+2*U.get(U.get(fP,fX),fY));return[];},F.range(0,fE-1)),bc.delay(function(){U.set(fO,fX,(U.get(fH,fX))(fR));return[];})):(U.set(fO,fX,U.map2(function(fY,fZ){return fY+fZ;},U.get(fO,fX),U.get(fP,fX))),[]);},F.range(0,fF-1));}));},F.range(0,fM.thin-1)),bc.delay(function(){return[c5.New(fN,fL(fO))];}));})),bc.delay(function(){return[];}));}));});};c5.New=function(fB,fC){return{t:fB,u:fC};};c7.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL){return{numspecies:fB,thin:fC,nx:fD,xmin:fE,xmax:fF,ymin:fG,ymax:fH,tmax:fI,dt:fJ,D:fK,plotlocs:fL};};c8.neumann_solve=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fF=fE.numspecies;fG=fE.nx;fH=fE.dt*0.5;fI=(fE.xmax-fE.xmin)/(fE.nx-1);fJ=U.map(function(fP){return fP*fH/(fI*fI);},fE.D);fK=U.init(fF,function(fP){return U.concat([[0],U.create(fG-1,U.get(fJ,fP))]);});fL=U.init(fF,function(fP){return U.concat([[1-U.get(fJ,fP)],U.create(fG-2,1-2*U.get(fJ,fP)),[1-U.get(fJ,fP)]]);});fM=U.init(fF,function(fP){return U.concat([U.create(fG-1,U.get(fJ,fP)),[0]]);});fN=U.init(fF,function(fP){var fQ,fR,fS,fT;fQ=U.get(fJ,fP);fR=U.create(fG,-fQ);fS=U.concat([[1+fQ],U.create(fG-2,1+2*fQ),[1+fQ]]);fT=U.create(fG,-fQ);return function(fU){return dM.TridiagonalAlgorithm(fR,fS,fT,fU);};});fO=U.length(fE.plotlocs);return c8.solver(fB,fC,fD,fG,fF,fJ,fN,fK,fL,fM,function(fP){return U.init(fG,function(fQ){return U.init(fG,function(fR){return U.init(fO,function(fS){return U.get(U.get(U.get(fP,U.get(fE.plotlocs,fS)),fQ),fR);});});});},fE);};c8.periodic_solve=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fF=fE.numspecies;fG=fE.nx;fH=fE.dt*0.5;fI=(fE.xmax-fE.xmin)/(fE.nx-1);fJ=U.map(function(fP){return fP*fH/(fI*fI);},fE.D);fK=U.init(fF,function(fP){return U.create(fG-1,U.get(fJ,fP));});fL=U.init(fF,function(fP){return U.create(fG-1,1-2*U.get(fJ,fP));});fM=U.init(fF,function(fP){return U.create(fG-1,U.get(fJ,fP));});fN=U.init(fF,function(fP){var fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0;fQ=U.get(fJ,fP);fR=-fQ;fS=1+2*fQ;fT=-fQ;fU=U.create(fG-1,fR);fV=U.concat([[2*fS],U.create(fG-3,fS),[fS+fR*fT/fS]]);fW=U.create(fG-1,fT);fX=-fS;fY=U.concat([[fX],U.create(fG-3,0),[fT]]);fZ=U.concat([[1],U.create(fG-3,0),[fR/fX]]);f0=dM.TridiagonalAlgorithm(fU,fV,fW,fY);return function(f1){return dM.ApplySMInvertMatrix(fU,fV,fW,f1,fZ,f0);};});fO=U.length(fE.plotlocs);return c8.solver(fB,fC,fD,fG-1,fF,fJ,fN,fK,fL,fM,function(fP){return U.init(fG,function(fQ){var fR;fR=fQ<fG-1?fQ:0;return U.init(fG,function(fS){var fT;fT=fS<fG-1?fS:0;return U.init(fO,function(fU){return U.get(U.get(U.get(fP,U.get(fE.plotlocs,fU)),fR),fT);});});});},fE);};c8.solver=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM){var fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0;fQ=fM.dt*0.5;fN=fB;fR=U.init(fF,function(){return U.init(fE,function(){return U.create(fE,0);});});fS=U.create(fF,0);fT=U.create(fF,null);for(fU=0,fV=fF-1;fU<=fV;fU++){fW=U.init(fE,function(){return U.create(fE,0);});for(fX=0,fY=fE-1;fX<=fY;fX++){for(fZ=0,f0=fE-1;fZ<=f0;fZ++)U.set(U.get(fW,fX),fZ,U.get(U.get(U.get(fC,fX),fZ),fU));}U.set(fT,fU,fW);}fP=U.init(fF,function(){return U.create(fE,0);});return bc.delay(function(){return bc.append([c9.New(fN,fL(fT))],bc.delay(function(){return bc.enumWhile(function(){return fN<fM.tmax;},bc.delay(function(){return bc.append(bc.collect(function(){fN=fN+fM.dt;return bc.append(bc.collect(function(f1){return bc.append(bc.collect(function(f2){return bc.append(bc.collect(function(f3){U.set(fS,f3,U.get(U.get(U.get(fT,f3),f2),f1));return[];},F.range(0,fF-1)),bc.delay(function(){var f3;f3=fD(fN,fS);return bc.collect(function(f4){var f5,f6;return U.get(fG,f4)>0?(f5=U.get(U.get(U.get(fT,f4),f2),(f1-1+fE)%fE),f6=U.get(U.get(U.get(fT,f4),f2),(f1+1)%fE),U.set(U.get(fP,f4),f2,U.get(U.get(fI,f4),f1)*f5+U.get(U.get(fJ,f4),f1)*U.get(fS,f4)+U.get(U.get(fK,f4),f1)*f6+fQ*U.get(f3,f4)),[]):(U.set(U.get(U.get(fR,f4),f2),f1,U.get(fS,f4)+fQ*U.get(f3,f4)),[]);},F.range(0,fF-1));}));},F.range(0,fE-1)),bc.delay(function(){return bc.collect(function(f2){var f3;return U.get(fG,f2)>0?(f3=(U.get(fH,f2))(U.get(fP,f2)),bc.collect(function(f4){U.set(U.get(U.get(fR,f2),f4),f1,U.get(f3,f4));return[];},F.range(0,fE-1))):[];},F.range(0,fF-1));}));},F.range(0,fE-1)),bc.delay(function(){return bc.collect(function(f1){return bc.append(bc.collect(function(f2){return bc.append(bc.collect(function(f3){U.set(fS,f3,U.get(U.get(U.get(fR,f3),f1),f2));return[];},F.range(0,fF-1)),bc.delay(function(){var f3;f3=fD(fN,fS);return bc.collect(function(f4){var f5,f6;return U.get(fG,f4)>0?(f5=U.get(U.get(U.get(fR,f4),(f1-1+fE)%fE),f2),f6=U.get(U.get(U.get(fR,f4),(f1+1)%fE),f2),U.set(U.get(fP,f4),f2,U.get(U.get(fI,f4),f1)*f5+U.get(U.get(fJ,f4),f1)*U.get(fS,f4)+U.get(U.get(fK,f4),f1)*f6+fQ*U.get(f3,f4)),[]):(U.set(U.get(U.get(fT,f4),f1),f2,U.get(fS,f4)+fQ*U.get(f3,f4)),[]);},F.range(0,fF-1));}));},F.range(0,fE-1)),bc.delay(function(){return bc.collect(function(f2){return U.get(fG,f2)>0?(U.set(U.get(fT,f2),f1,(U.get(fH,f2))(U.get(fP,f2))),[]):[];},F.range(0,fF-1));}));},F.range(0,fE-1));}));},F.range(0,fM.thin-1)),bc.delay(function(){return[c9.New(fN,fL(fT))];}));}));}));});};c9.New=function(fB,fC){return{t:fB,u:fC};};c_.online_meanvar=function(fB,fC,fD,fE){var fF;fF=fB+(fD-fB)/fE;return[fF,fC+((fD-fB)*(fD-fF)-fC)/fE];};c_.correlation_pearson=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fD=fB.length;fE=U.get(fB,0).length;fF=U.unzip(U.map(function(fP){var fQ;fQ=U.average(fP);return[fQ,fv.sqrt(U.sum(U.map(function(fR){return(fR-fQ)*(fR-fQ);},fP)))];},fB));fG=fF[0];fH=fF[1];fC=U.init(fD,function(){return U.create(fD,0);});for(fI=0,fJ=fD-1;fI<=fJ;fI++){U.set(U.get(fC,fI),fI,1);for(fK=fI+1,fL=fD-1;fK<=fL;fK++){fM=U.fold2(function(fP,fQ,fR){return fP+fQ*fR;},0,U.get(fB,fI),U.get(fB,fK));U.set(U.get(fC,fI),fK,(fM-fE*U.get(fG,fI)*U.get(fG,fK))/U.get(fH,fI)/U.get(fH,fK));}for(fN=0,fO=fI-1;fN<=fO;fN++)U.set(U.get(fC,fI),fN,U.get(U.get(fC,fN),fI));}return fC;};c_.log_of_normal_density=function(fB,fC,fD){var fE,fF;fE=fv.sqrt(2*3.14159265358979);fF=(fB-fC)/fD;return -0.5*fF*fF-fv.log(fD*fE);};c$.New=function(fB){return{map:fB};};da.Get=function(fB){return fB instanceof a.Array?da.ArrayEnumerator(fB):bk.Equals(typeof fB,"string")?da.StringEnumerator(fB):fB.GetEnumerator();};da.ArrayEnumerator=function(fB){return new dc.New(0,null,function(fC){var fD;fD=fC.s;return fD<U.length(fB)&&(fC.c=U.get(fB,fD),fC.s=fD+1,true);},void 0);};da.StringEnumerator=function(fB){return new dc.New(0,null,function(fC){var fD;fD=fC.s;return fD<fB.length&&(fC.c=fB[fD],fC.s=fD+1,true);},void 0);};da.Get0=function(fB){return fB instanceof a.Array?da.ArrayEnumerator(fB):bk.Equals(typeof fB,"string")?da.StringEnumerator(fB):"GetEnumerator0"in fB?fB.GetEnumerator0():fB.GetEnumerator();};db.fold_right=function(fB,fC,fD){return A.foldBack(fB,fC,fD);};db.trd3=function(fB,fC,fD){return fD;};db.snd3=function(fB,fC,fD){return fC;};db.fst3=a.id;db.fold_left=function(fB,fC,fD){return bc.fold(fB,fC,fD);};db.string_of_list=function(fB,fC,fD){var fE,fF,fG,fH;fE="";fF=fD;while(true)if(fF.$==1){if(fF.$1.$==0)return fE+fB(fF.$0);else{fG=fF.$0;fH=fF.$1;fE=fE+fB(fG)+fC;fF=fH;}}else return fE;};db.binom=function(fB,fC){return F.toInt(bc.fold(function(fD,fE){return fv.trunc(fD*(fB-fE+1)/fE);},1,A.ofSeq(F.range(1,fC))));};db.rev_map=function(fB,fC){var fD,fE,fF,fG;fD=B.Empty;fE=fC;while(true)if(fE.$==1){fF=fE.$1;fG=fE.$0;fD=new B({$:1,$0:fB(fG),$1:fD});fE=fF;}else return fD;};db.option_map2=function(fB,fC){return db.option_map(function(fD){return{$:1,$0:fB(fD)};},null,fC);};db.fac=function(fB){return db.fold_left(function(fC,fD){return fC*fD;},1,A.ofSeq(F.range(2,fB)));};db.disjoint=function(fB,fC,fD){return db.forall(function(fE){return!A.exists(function(fF){return fB(fE,fF);},fD);},fC);};db.union=function(fB,fC,fD){var fE,fF,fG,fH;fE=A.rev(fC);fF=db.remove_duplicates(fB,fD);while(true)if(fE.$==1){fG=fE.$1;fH=fE.$0;fE=fG;fF=db.maybecons(fB,fH,fF);}else return fF;};db.option_map=function(fB,fC,fD){return fD!=null&&fD.$==1?fB(fD.$0):fC;};db.emit_record=function(fB,fC,fD){var fE;function fF(fG,fH){return fH(fD)===fH(fB)?null:{$:1,$0:(((fu.Curried3(function(fI,fJ,fK){return fI(_2.toSafe(fJ)+"="+_2.toSafe(fK));}))(a.id))(fG))(fH(fD))};}fE=dk.concat("; ",A.choose(function(fG){return fF(fG[0],fG[1]);},fC));return(function(fG){return function(fH){return fG("{"+_2.toSafe(fH)+"}");};}(a.id))(fE);};db.newline=function(){e5.$cctor();return e5.newline;};db.update_map=function(fB,fC){return K.Fold(function(fD,fE,fF){return fD.Add(fE,fF);},K.Fold(function(fD,fE,fF){return fD.Add(fE,fF);},new y.New(B.Empty),fB),fC);};db.forall=function(fB,fC){return A.forAll(fB,fC);};db.remove_duplicates=function(fB,fC){return A.rev(function(fD,fE){var fF,fG;while(true)if(fD.$==1){fF=fD.$1;fG=fD.$0;if(A.exists(function(fH){return function(fI){return fB(fH,fI);};}(fG),fE))fD=fF;else{fD=fF;fE=new B({$:1,$0:fG,$1:fE});}}else return fE;}(fC,B.Empty));};db.maybecons=function(fB,fC,fD){return A.exists(function(fE){return fB(fC,fE);},fD)?fD:new B({$:1,$0:fC,$1:fD});};db.default_leak_rate_l=function(){e5.$cctor();return e5.default_leak_rate_l;};db.default_toehold_unbind_rate=function(){e5.$cctor();return e5.default_toehold_unbind_rate;};db.tuple_to_string=function(fB){return fB.$==1?fB.$1.$==0?fB.$0:"("+dk.concat(",",fB)+")":"";};dc=da.T=fu.Class({MoveNext:function(){return this.n(this);},Current:function(){return this.c;},Dispose:function(){if(this.d)this.d(this);}},w,dc);dc.New=fu.Ctor(function(fB,fC,fD,fE){w.New.call(this);this.s=fB;this.c=fC;this.n=fD;this.d=fE;},dc);dd.alreadyAdded=function(){return F.FailWith("An item with the same key has already been added.");};dd.notPresent=function(){return F.FailWith("The given key was not present in the dictionary.");};df=de.SparseMatrix=fu.Class({times$2:function(fB){var fC,fD,fE,fF,fG,fH;fC=U.create(this.rows,0);for(fD=0,fE=this.rows-1;fD<=fE;fD++)if(bk.Equals(U.get(this.indices,fD).length==0,false)){fF=0;for(fG=0,fH=U.get(this.count,fD)-1;fG<=fH;fG++)fF=fF+U.get(U.get(this.items,fD),fG)*U.get(fB,U.get(U.get(this.indices,fD),fG));U.set(fC,fD,fF);}return fC;},timesRight:function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK;fC=U.create(this.cols,0);for(fD=0,fE=this.rows-1;fD<=fE;fD++){fF=U.get(this.indices,fD);fG=U.get(fB,fD);fH=U.get(this.items,fD);for(fI=0,fJ=U.length(fF)-1;fI<=fJ;fI++){fK=U.get(fF,fI);U.set(fC,fK,U.get(fC,fK)+fG*U.get(fH,fI));}}return fC;},set_Item:function(fB,fC){U.set(this.indices,fB,fC.get_Indices());U.set(this.items,fB,fC.get_Items());U.set(this.count,fB,fC.get_Length());},minus:function(fB){var fC,fD,fE,fF;fC=new df.New(this.rows,this.cols);for(fD=0,fE=this.rows-1;fD<=fE;fD++){fF=this.get_Item(fD).minus(fB.get_Item(fD));fC.set_Items$1(fD,fF.get_Items());fC.set_Indices$1(fD,fF.get_Indices());fC.set_CountElem(fD,fF.get_Count());}return fC;},times$1:function(fB){var fC,fD,fE,fF,fG;fC=new df.New(this.rows,this.cols);for(fD=0,fE=this.rows-1;fD<=fE;fD++)if(bk.Equals(U.get(this.indices,fD).length==0,false)){fC.set_Indices$1(fD,U.create(U.get(this.count,fD),0));fC.set_Items$1(fD,U.create(U.get(this.count,fD),0));for(fF=0,fG=U.get(this.count,fD)-1;fF<=fG;fF++){fC.set_Indices(fD,fF,U.get(U.get(this.indices,fD),fF));fC.set_Items(fD,fF,fB*U.get(U.get(this.items,fD),fF));}fC.set_CountElem(fD,U.get(this.count,fD));}return fC;},get_Item:function(fB){return new es.New$1(U.get(this.items,fB),U.get(this.indices,fB),this.cols);},set_Items$1:function(fB,fC){U.set(this.items,fB,fC);},set_Indices$1:function(fB,fC){U.set(this.indices,fB,fC);},set_CountElem:function(fB,fC){U.set(this.count,fB,fC);},set_Indices:function(fB,fC,fD){U.set(U.get(this.indices,fB),fC,fD);},set_Items:function(fB,fC,fD){U.set(U.get(this.items,fB),fC,fD);},get_RowDimension:function(){return this.rows;},get_Items:function(fB,fC){return U.get(U.get(this.items,fB),fC);},ScaleRow:function(fB,fC,fD,fE){var fF,fG;for(fF=0,fG=U.get(this.count,fB)-1;fF<=fG;fF++)if(U.get(U.get(this.indices,fB),fF)>=fC&&U.get(U.get(this.indices,fB),fF)<=fD)U.set(U.get(this.items,fB),fF,U.get(U.get(this.items,fB),fF)*fE);},SwitchRows:function(fB,fC){var fD,fE,fF;fD=U.get(this.items,fB);fE=U.get(this.indices,fB);fF=U.get(this.count,fB);U.set(this.items,fB,U.get(this.items,fC));U.set(this.indices,fB,U.get(this.indices,fC));U.set(this.count,fB,U.get(this.count,fC));U.set(this.items,fC,fD);U.set(this.indices,fC,fE);U.set(this.count,fC,fF);},get_Item$1:function(fB,fC){var fD,fE,fF;return fB<0||fC<0||fB>=this.rows||fC>=this.cols?F.FailWith("Element index is out of range"):bk.Equals(U.get(this.indices,fB),null)?0:(fD=(fE=U.tryFindIndex(function(fG){return fG===fC;},c2.array(U.get(this.indices,fB),{$:1,$0:0},{$:1,$0:U.get(this.count,fB)-1})),fE==null?U.forall(function(fG){return fG<fC;},c2.array(U.get(this.indices,fB),{$:1,$0:0},{$:1,$0:U.get(this.count,fB)-1}))?~U.get(this.count,fB):(fF=U.tryFindIndex(function(fG){return fG>fC;},c2.array(U.get(this.indices,fB),{$:1,$0:0},{$:1,$0:U.get(this.count,fB)-1})),fF==null?-1:~fF.$0):fE.$0),fD<0?0:U.get(U.get(this.items,fB),fD));},set_Item$1:function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS;if(fB<0||fC<0||fB>=this.rows||fC>=this.cols)F.FailWith("Element index is out of range");else if(U.get(this.indices,fB).length==0||U.get(this.indices,fB).length<1){U.set(this.indices,fB,U.create(1,0));U.set(this.items,fB,U.create(1,0));U.set(U.get(this.indices,fB),0,fC);U.set(U.get(this.items,fB),0,fD);U.set(this.count,fB,1);}else{fG=(fE=U.tryFindIndex(function(fT){return fT===fC;},c2.array(U.get(this.indices,fB),{$:1,$0:0},{$:1,$0:U.get(this.count,fB)-1})),fE==null?U.forall(function(fT){return fT<fC;},c2.array(U.get(this.indices,fB),{$:1,$0:0},{$:1,$0:U.get(this.count,fB)-1}))?~U.get(this.count,fB):(fF=U.tryFindIndex(function(fT){return fT>fC;},c2.array(U.get(this.indices,fB),{$:1,$0:0},{$:1,$0:U.get(this.count,fB)-1})),fF==null?-1:~fF.$0):fE.$0);if(fG>=0)U.set(U.get(this.items,fB),fG,fD);else{fH=~fG;if(U.get(this.count,fB)>=U.length(U.get(this.items,fB))){fI=fv.min(16,this.cols-U.length(this.items));fJ=U.create(this.indices.length+fI,0);fK=U.create(this.items.length+fI,0);for(fL=0,fM=fH-1;fL<=fM;fL++)U.set(fJ,fL,U.get(U.get(this.indices,fB),fL));for(fN=0,fO=fH-1;fN<=fO;fN++)U.set(fK,fN,U.get(U.get(this.items,fB),fN));for(fP=0,fQ=U.get(this.count,fB)-fH-1;fP<=fQ;fP++){U.set(fJ,U.get(this.count,fB)-fP,U.get(U.get(this.indices,fB),U.get(this.count,fB)-fP-1));U.set(fK,U.get(this.count,fB)-fP,U.get(U.get(this.items,fB),U.get(this.count,fB)-fP-1));}U.set(this.items,fB,fK);U.set(this.indices,fB,fJ);}else{for(fR=0,fS=U.get(this.count,fB)-fH-1;fR<=fS;fR++){U.set(U.get(this.indices,fB),U.get(this.count,fB)-fR,U.get(U.get(this.indices,fB),U.get(this.count,fB)-fR-1));U.set(U.get(this.items,fB),U.get(this.count,fB)-fR,U.get(U.get(this.items,fB),U.get(this.count,fB)-fR-1));}}U.set(this.count,fB,U.get(this.count,fB)+1);U.set(U.get(this.indices,fB),fH,fC);U.set(U.get(this.items,fB),fH,fD);}}}},w,df);df.New$1=fu.Ctor(function(fB,fC,fD,fE,fF){w.New.call(this);this.rows=fB;this.cols=fC;this.items=fD;this.indices=fE;this.count=fF;},df);df.New=fu.Ctor(function(fB,fC){df.New$1.call(this,fB,fC,U.init(fB,function(){return[];}),U.init(fB,function(){return[];}),U.create(fB,0));},df);dg.Filter=function(fB,fC){var fD;return new dh.New$1((fD=U.ofSeq(bc.filter(fB,fC)),cx.Build(fD,0,fD.length-1)));};dh=x.FSharpSet=fu.Class({Add:function(fB){return new dh.New$1(cx.Add(fB,this.tree));},Equals:function(fB){return this.get_Count()===fB.get_Count()&&bc.forall2(bk.Equals,this,fB);},get_IsEmpty:function(){return this.tree==null;},GetEnumerator$1:function(){return da.Get(cx.Enumerate(false,this.tree));},get_Count:function(){var fB;fB=this.tree;return fB==null?0:fB.Count;},Contains:function(fB){return cx.Contains(fB,this.tree);},GetHashCode:function(){return -1741749453+bk.Hash(U.ofSeq(this));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();},CompareTo0:function(fB){return bc.compareWith(bk.Compare,this,fB);}},w,dh);dh.op_Subtraction=function(fB,fC){return dg.Filter(function(fD){return!fC.Contains(fD);},fB);};dh.New$1=fu.Ctor(function(fB){w.New.call(this);this.tree=fB;},dh);di.find=function(fB,fC){var fD;fD=K.TryFind(fC,fB);return fD!=null&&fD.$==1?fD.$0:(function(fE){return function(fF){return fE("The environment does not contain: "+_2.toSafe(fF));};}(F.FailWith))(fC);};di.to_string=function(fB){return"["+db.string_of_list(function(fC){var fD;return fC[0]+" = "+(fD=fC[1],a.String(fD));},"; ",A.ofSeq(K.ToSeq(fB)))+"]";};di.empty=function(){fd.$cctor();return fd.empty;};dj.GetFieldValues=function(fB){var fC,fD;fC=[];for(var fE in fB)fC.push(fB[fE]);return fC;};dj.GetFields=function(fB){var fC,fD;fC=[];for(var fE in fB)fC.push([fE,fB[fE]]);return fC;};dk.concat=function(fB,fC){return U.ofSeq(fC).join(fB);};dk.PadLeft=function(fB,fC){return dk.PadLeftWith(fB,fC," ");};dk.SplitStrings=function(fB,fC,fD){return dk.Split(fB,new a.RegExp(dk.concat("|",U.map(dk.RegexEscape,fC))),fD);};dk.SplitChars=function(fB,fC,fD){return dk.Split(fB,new a.RegExp("["+dk.RegexEscape(fC.join(""))+"]"),fD);};dk.map=function(fB,fC){return dk.collect(fB,dk.protect(fC));};dk.PadLeftWith=function(fB,fC,fD){return fC>fB.length?a.Array(fC-fB.length+1).join(fD)+fB:fB;};dk.ToCharArray=function(fB){return U.init(fB.length,function(fC){return fB[fC];});};dk.Substring=function(fB,fC,fD){return fB.substr(fC,fD);};dk.Split=function(fB,fC,fD){return fD===1?U.filter(function(fE){return fE!=="";},dk.SplitWith(fB,fC)):dk.SplitWith(fB,fC);};dk.RegexEscape=function(fB){return fB.replace(new a.RegExp("[-\\\\/\\\\\\\\^$*+?.()|[\\\\]{}]","g"),"\\\\$&");};dk.length=function(fB){return dk.protect(fB).length;};dk.StartsWith=function(fB,fC){return fB.substring(0,fC.length)==fC;};dk.Remove=function(fB,fC,fD){return fB.substring(0,fC)+fB.substring(fC+fD);};dk.Join=function(fB,fC){return fC.join(fB);};dk.collect=function(fB,fC){return U.init(fC.length,function(fD){return fB(fC[fD]);}).join("");};dk.protect=function(fB){return fB===null?"":fB;};dk.Replace=function(fB,fC,fD){function fE(fF){var fG,fH,fI;fG=fF.indexOf(fC);return fG!==-1?(fH=dk.ReplaceOnce(fF,fC,fD),(fI=fG+fD.length,dk.Substring(fH,0,fG+fD.length)+fE(fH.substring(fI)))):fF;}return fE(fB);};dk.SplitWith=function(fB,fC){return fB.split(fC);};dk.iter=function(fB,fC){bc.iter(fB,dk.protect(fC));};dk.ReplaceOnce=function(fB,fC,fD){return fB.replace(fC,fD);};dk.IsNullOrEmpty=function(fB){return fB==null||fB=="";};dl.init=function(fB){return new dS.New$1(fB);};dl.append=function(fB,fC){fB.Append(fC);};dl.value=function(fB){return a.String(fB);};dl.empty=function(){return new dS.New();};dm=bp.NamesMap=fu.Class({Item:function(fB){var fC,fD;fC=this;fD=U.length(this.names);return function(fE){while(true)if(U.get(fC.names,fE)===fB)return fE;else if(fE===fD-1)return -1;else fE=fE+1;}(0);},get_Keys:function(){return this.names;}},w,dm);dm.New=fu.Ctor(function(fB){w.New.call(this);this.names=fB;},dm);_do=dn.NormalGenerator=fu.Class({get_Sigma:function(){return this.stdev;},get_Mean:function(){return this.mean;},nextDouble:function(fB){var fC,fD,fE,fF,fG;fC=this.state.rnorm_phase?[this.state.rnorm_2*this.state.rnorm_f,(fD=this.state,dY.New(false,fD.rnorm_2,fD.rnorm_f)),fB]:(fE=function(fH,fI){var fJ,fK,fL,fM,fN,fO;while(true){fJ=fI.Microsoft_Research_Filzbach_Lib_IRng$NextDouble();fK=fJ[1].Microsoft_Research_Filzbach_Lib_IRng$NextDouble();fL=fK[1];fM=fJ[0]*2-1;fN=fK[0]*2-1;fO=fM*fM+fN*fN;if(fO<1)return[fO,fM,dY.New(fH.rnorm_phase,fN,fH.rnorm_f),fL];else{fH=dY.New(fH.rnorm_phase,fN,fH.rnorm_f);fI=fL;}}}(this.state,fB),(fF=fE[0],(fG=fv.sqrt(-2*fv.log(fF)/fF),[fE[1]*fG,dY.New(true,fE[2].rnorm_2,fG),fE[3]])));return[fC[0]*this.stdev+this.mean,new _do.New$1(fC[1],this.mean,this.stdev),fC[2]];}},w,_do);_do.New=fu.Ctor(function(fB,fC){_do.New$1.call(this,dY.New(false,0,0),fB,fC);},_do);_do.New$1=fu.Ctor(function(fB,fC,fD){w.New.call(this);this.state=fB;this.mean=fC;this.stdev=fD;},_do);bu.run_mcmc_seq=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN;fD=-1.79769313486232E+308;fE=B.Empty;fF=null;fG=fB.$==1?(fH=fB.$0,[d1.run_seq(fH.likefn,fH.parameters,fH.dependencies,fH.options),fH.parameters,fH.options,fH.numData,function(fO){return(fH.simfn(fO))(d2.All);}]):(fI=fB.$0,[bw.run_seq(fI.likefn,fI.parameters,fI.options),fI.parameters,fI.options,fI.numData,fI.simfn]);fJ=fG[0];fK=fG[4];fL=fG[1];fM=fG[2];fN=fG[3];return bc.delay(function(){var fO;fO=0;return bc.append(bc.collect(function(fP){var fQ,fR,fS,fT,fU,fV;fS=d3.stringOfSummary(fP,fM,fN);fF={$:1,$0:fP};fT=fP.$==1?fP.$0.mle:fP.$0.mle;try{fR=(fU=fT.logLikelihood>fD?(fK(false))(fT.values):fE,fD=fT.logLikelihood,fE=fU,fU);}catch(fW){if(fW instanceof cX)fV=fE;else throw fW;fR=fV;}fO=fO+1;return[bv.New(fO,fP,fR,fS)];},fJ),bc.delay(function(){var fP;return fF!=null&&fF.$==1&&(fF.$0.$==1&&(fP=fF.$0.$0,true))?(fC(bu.convert_sampling(fK(true),fE,fL,fM,fN,fP)),[]):(F.FailWith("inference did not return a sampling"),[]);}));});};bu.convert_sampling=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ,fK;fH=bu.getSummary(fE,fF,fG);fI=K.OfArray(U.ofSeq(A.choose(function(fL){return fL.isFixed()?{$:1,$0:[fL.name,fL.initValue.$0]}:null;},fD)));fJ=bu.analyse_chain(fG);fK=A.choose(function(fL){try{return{$:1,$0:fB(fL.values)};}catch(fM){return null;}},A.rev(fG.chain));return bA.New(fJ[2],fJ[0],fJ[3],fI,fJ[1],fC,fK.$===0?B.Empty:A.mapi(function(fL,fM){return bt.New(fM.instance,Z.qsummary(A.map(function(fN){return fN.get_Item(fL).table;},fK)));},A.head(fK)),fH);};bu.create_with_dependencies=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ,fK,fL,fM;function fN(fQ){return bc.findIndex(function(fR){return bk.Equals(fQ,fR);},fH);}function fO(fQ,fR,fS){return fC(fQ,bu.env_of_aa(fS,new y.New([])),fR);}function fP(fQ,fR){var fS,fT;fS=bu.penalties(fH.get_Length(),fB,fR);try{return fQ.$==0?A.mapi2(function(fU,fV,fW){return Z.likelihood(A.map(function(fX){return fS.get_Item(fX);},fI.get_Item(fU)),fV,fW);},A.map(bt.to_table,fO(true,fQ,fR)),fE):A.map2(function(fU,fV){return Z.likelihood(A.map(function(fW){return fS.get_Item(fW);},fI.get_Item(fV)),fU,fE.get_Item(fV));},A.map(bt.to_table,fO(true,fQ,fR)),fQ.$0);}catch(fU){if(fU instanceof cX)fT=(fM=fM+1,A.init(fE.get_Length(),function(){return -1.79769313486232E+308;}));else if(fU instanceof cW)fT=F.FailWith(fU.message);else throw fU;return fT;}}fH=A.distinct(A.concat(fD));fI=A.map(function(fQ){return A.map(fN,fQ);},fD);fJ=bu.generate_sigmas(fB.noise_parameter,fH);fK=(fL=fB.noise_parameter,fL=="Random"?A.ofArray([d2.All]):fL=="Multiple"?A.replicate(fJ.get_Length(),d2.All):B.Empty);fM=0;return{$:1,$0:dp.New(function(fQ){return function(fR){return fP(fQ,fR);};},fu.Curried3(fO),A.append(fJ,bu.fb_parameters(fF)),A.append(fK,fG),bu.options(fB),bu.num_datapoints(fE))};};bu.create=function(fB,fC,fD,fE,fF){var fG,fH,fI,fJ;function fK(fM){return bc.findIndex(function(fN){return bk.Equals(fM,fN);},fG);}function fL(fM,fN){return fC(fM,bu.env_of_aa(fN,new y.New([])));}fG=A.distinct(A.concat(fD));fH=A.map(function(fM){return A.map(fK,fM);},fD);fI=bu.generate_sigmas(fB.noise_parameter,fG);fJ=0;return{$:0,$0:dq.New(function(fM){var fN,fO;fN=bu.penalties(fG.get_Length(),fB,fM);try{return bc.sum(A.mapi2(function(fP,fQ,fR){return Z.likelihood(A.map(function(fS){return fN.get_Item(fS);},fH.get_Item(fP)),fQ,fR);},A.map(bt.to_table,fL(true,fM)),fE));}catch(fP){if(fP instanceof cX)fO=(fJ=fJ+1,-1.79769313486232E+308);else if(fP instanceof cW)fO=F.FailWith(fP.message);else throw fP;return fO;}},function(fM){return function(fN){return fL(fM,fN);};},A.append(fI,bu.fb_parameters(fF)),bu.options(fB),bu.num_datapoints(fE))};};bu.analyse_chain=function(fB){var fC,fD,fE;fC=A.map(dr.fromFilzbach,A.ofArray(d3.getSummary(fB)));fD=A.map(bu.evToMap,A.rev(fB.chain));fE=A.map(bu.evToMap,A.rev(fB.burnin));return[fD,bu.evToMap(fB.mle),fC,fE];};bu.getSummary=function(fB,fC,fD){var fE;fE=d3.informationCriteria(fD,fC);return ds.New(fB.seed,fB.burninLen,fB.sampleLen,fB.thinning,fD.mle.logLikelihood,fE.AIC,fE.BIC,fE.DIC,fC);};bu.generate_sigmas=function(fB,fC){var fD;return fB=="Random"?A.ofArray([bu.variable_sigma("sigma")]):fB=="Multiple"?A.init(fC.get_Length(),function(fE){return bu.variable_sigma((function(fF){return function(fG){return fF("sigma_"+a.String(fG));};}(a.id))(fE));}):(fD=fB.$0,A.ofArray([bC.New("sigma",br.New(ck.Fixed,fD,fD),{$:1,$0:fD},null,false)]));};bu.env_of_aa=function(fB,fC){return U.fold(function(fD,fE){return fD.Add(fE,fB.Item(fE));},fC,fB.get_Names());};bu.fb_parameters=function(fB){return A.map(bX.to_filzbach,fB);};bu.options=function(fB){return d4.New(fB.burnin,fB.samples,fB.thin,fB.seed,fB.print_console,fB.print_summary);};bu.num_datapoints=function(fB){return bc.sumBy(function(fC){return bc.sumBy(function(fD){return fD.values.get_Length();},fC.columns);},fB);};bu.penalties=function(fB,fC,fD){var fE,fF;return fC.noise_parameter=="Multiple"?A.init(fB,function(fG){var fH,fI;fH=fC.noise_model;fI=fD.Item((function(fJ){return function(fK){return fJ("sigma_"+a.String(fK));};}(a.id))(fG));return fu.Curried(bu.penalty,2,[fH,fI]);}):A.replicate(fB,(fE=fC.noise_model,(fF=fD.Item("sigma"),fu.Curried(bu.penalty,2,[fE,fF]))));};bu.evToMap=function(fB){return K.FoldBack(function(fC,fD,fE){return fE.Add(fC,fD);},K.OfArray([["Iteration",fB.iteration],["logLikelihood",fB.logLikelihood],["logPrior",fB.logPrior]]),fB.values.ToMap());};bu.variable_sigma=function(fB){return bC.New(fB,br.New(ck.Log,1E-06,1000000),null,null,true);};bu.penalty=function(fB,fC,fD,fE){if(a.isNaN(fE))return 0;else if(fB=="Proportional"){if(fD<=0){(function(fF){return fF("Cannot evaluate a proportional-error noise model for non-positive simulation values.");}(function(fF){fx.log(fF);}));throw cV.negative_simulation();}else return c_.log_of_normal_density(fE,fD,fv.sqrt(fD)*fC);}else return c_.log_of_normal_density(fE,fD,fC);};dp.New=function(fB,fC,fD,fE,fF,fG){return{likefn:fB,simfn:fC,parameters:fD,dependencies:fE,options:fF,numData:fG};};dq.New=function(fB,fC,fD,fE,fF){return{likefn:fB,simfn:fC,parameters:fD,options:fE,numData:fF};};dr=d.ParameterSummary=fu.Class({toNormalDist:function(){return new bU({$:1,$0:bS.New(this.mean,fv.sqrt(this.variance))});},toLogNormalDist:function(){var fB;fB=1+this.variance/this.mean/this.mean;return new bU({$:2,$0:bR.New(fv.log(this.mean/fv.sqrt(fB)),fv.log(fB))});},toTruncatedNormalDist:function(){return new bU({$:3,$0:bQ.New(this.mean,fv.sqrt(this.variance),this.lb,this.ub)});}},null,dr);dr.get_defaults=function(){return dr.New("",0,0,0,0,0,0,0,0,0,0,"Real");};dr.fromFilzbach=function(fB){return dr.New(fB.name,fB.mle,fB.summary.mean,fB.summary.variance,fB.qsummary.median,fB.range.lb,fB.range.ub,fB.qsummary.lb68,fB.qsummary.ub68,fB.qsummary.lb95,fB.qsummary.ub95,fB.range.pType.$==1?"Log":"Real");};dr.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM){return new dr({name:fB,mle:fC,mean:fD,variance:fE,median:fF,lb:fG,ub:fH,l68:fI,u68:fJ,l95:fK,u95:fL,ptype:fM});};ds=bu.McmcSummary=fu.Class({},null,ds);ds.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ){return new ds({seed:fB,burnin:fC,samples:fD,thin:fE,mle:fF,aic:fG,bic:fH,dic:fI,numData:fJ});};dt.New=function(fB,fC,fD,fE,fF,fG,fH){return{model:fB,comparisons:fC,correlations:fD,keys:fE,parameters:fF,marginals:fG,multiple_paras:fH};};du.New=function(fB,fC,fD,fE,fF){return{sim:fB,dat:fC,name:fD,xlabel:fE,ylabel:fF};};dv.New=function(fB,fC,fD,fE,fF,fG,fH){return{model:fB,comparisons:fC,posterior:fD,correlation:fE,traces:fF,psummary:fG,variations:fH};};dx.ofChart=function(fB){return d5.toString(d6.toHtmlStructure(fB));};dx.ofSubplots=function(fB){return d5.toString(d7.subplotsToHtmlStructure(fB));};dy=bu.Summary=fu.Class({},null,dy);dy.New=function(fB,fC){return new dy({mcmc:fB,parameters:fC});};bc.insufficient=function(){return F.FailWith("The input sequence has an insufficient number of elements.");};U.groupBy=function(fB,fC){var fD,fE,fF,fG,fH,fI;fD=new bd.New$5();fE=[];for(fF=0,fG=U.length(fC)-1;fF<=fG;fF++){fH=fC[fF];fI=fB(fH);fD.ContainsKey(fI)?fD.get_Item(fI).push(fH):(fE.push(fI),fD.Add(fI,[fH]));}U.mapInPlace(function(fJ){return[fJ,fD.get_Item(fJ)];},fE);return fE;};U.mapInPlace=function(fB,fC){var fD,fE;for(fD=0,fE=fC.length-1;fD<=fE;fD++)fC[fD]=fB(fC[fD]);};U.mapiInPlace=function(fB,fC){var fD,fE;for(fD=0,fE=fC.length-1;fD<=fE;fD++)fC[fD]=fB(fD,fC[fD]);return fC;};A.skip=function(fB,fC){var fD,fE,fF;fD=fC;for(fE=1,fF=fB;fE<=fF;fE++)if(fD.$==0)F.FailWith("Input list too short.");else fD=fD.$1;return fD;};bc.nonNegative=function(){return F.FailWith("The input must be non-negative.");};U.contains=function(fB,fC){var fD,fE,fF,fG;fD=true;fE=0;fG=U.length(fC);while(fD&&fE<fG)if(bk.Equals(fC[fE],fB))fD=false;else fE=fE+1;return!fD;};bc.tryHead=function(fB){var fC;fC=da.Get(fB);try{return fC.MoveNext()?{$:1,$0:fC.Current()}:null;}finally{if(typeof fC=="object"&&"Dispose"in fC)fC.Dispose();}};dz.op_BarGreaterGreater=function(fB,fC,fD,fE){return(D.op_BarGreaterGreater(fB,fC))([fD,fE]);};dz.op_GreaterGreaterEquals=function(fB,fC,fD,fE){return(D.op_GreaterGreaterEquals(fB,fC))([fD,fE]);};dz.op_DotGreaterGreater=function(fB,fC,fD,fE){return(D.op_DotGreaterGreater(fB,fC))([fD,fE]);};dz.op_GreaterGreaterDot=function(fB,fC,fD,fE){return(D.op_GreaterGreaterDot(fB,fC))([fD,fE]);};dz.op_LessBarGreater=function(fB,fC,fD,fE){return(D.op_LessBarGreater(fB,fC))([fD,fE]);};dz.op_DotGreaterGreaterDot=function(fB,fC,fD,fE){return(D.op_DotGreaterGreaterDot(fB,fC))([fD,fE]);};dz.op_PlusGreaterGreaterPlus=function(fB,fC,fD,fE){return(D.op_PlusGreaterGreaterPlus(fB,fC))([fD,fE]);};dz.op_PlusGreaterGreater=function(fB,fC,fD,fE){return(D.op_PlusGreaterGreater(fB,fC))([fD,fE]);};dz.op_GreaterGreaterPercent=function(fB,fC,fD,fE){return(D.op_GreaterGreaterPercent(fB,fC))([fD,fE]);};dA.$cctor=function(){var fB;dA.$cctor=a.ignore;function fC(fD){return fD.$==0?fD.$0.$==0?{$:0,$0:{$:2,$0:(be.get_from_string())(fD.$0.$0)}}:fD:fD;}dA.parse=R.parse(co.parse(be.get_parse()));dA.parse_plot=(fB=R.parse(co.parse(be.get_parse())),function(fD){return dz.op_BarGreaterGreater(fB,fC,fD[0],fD[1]);});};dB=S.anchor=fu.Class({toString:function(){return((((fu.Curried(function(fB,fC,fD,fE){return fB(_2.toSafe(fC)+":{"+fD.toFixed(6)+","+fE.toFixed(6)+"}");},4))(a.id))(this.anchor_id))(this.anchor_point.x))(this.anchor_point.y);}},null,dB);dB.New=function(fB,fC){return new dB({anchor_id:fB,anchor_point:fC});};dC.New=function(fB,fC,fD,fE,fF,fG){return{init:fB,current:fC,advance:fD,refine:fE,get_time:fF,get_x:fG};};dD.init=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;fH=fC.length;fI=(fD(fB))(fC);fJ=fE.InitialStepSize===0?(fF=cL.map(function(fQ){return 1/fE.RelativeTolerance*(fE.AbsoluteTolerance+fE.RelativeTolerance*fv.abs(fQ));},fC),(fG=cL.sum(cL.map2(function(fQ){return function(fR){return fQ*fQ/fR/fR;};},fI,fF)),fv.min(fv.sqrt(fE.RelativeTolerance/(1/(fF[0]*fF[0])+1/fH*fG)),fE.MaxStep))):fv.min(fE.InitialStepSize,fE.MaxStep);fK=5;fL=cO.zeros(fH,fK+1);for(fM=0,fN=fH-1;fM<=fN;fM++){fO=fC[fM];(U.get(fL.MatrixData,fM))[0]=fO;fP=fJ*fI[fM];(U.get(fL.MatrixData,fM))[1]=fP;}return dE.New(fB,fC,fD,fJ,fL,2,0,0,1,fK,0,new a.Float64Array(fH),false,fE);};dD.advance=function(fB){return dD.PredictorCorrector(dE.New(fB.t,fB.x,fB.f,fB.dt,fB.z,fB.q,fB.Dq,fB.delta,fB.r,fB.qmax,fB.nsuccess,new a.Float64Array(fB.x.length),false,fB.opts));};dD.defaults=function(){return dF.New(0,1E-06,0.001,1.79769313486232E+308,0,1.1,0.9,5,eo.Absent);};dD.PredictorCorrector=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL;fC=cO.copy(fB.z);fD=cO.copyCol(fC,0).length;fE=dD.NordsieckMatrix_init(fB.z);fF=dE.New(fB.t,cO.copyCol(fE,0),fB.f,fB.dt,fE,fB.q,fB.Dq,fB.delta,fB.r,fB.qmax,fB.nsuccess,new a.Float64Array(fD),false,fB.opts);fG=fB.opts.MinStep;fH=fB.opts.MaxScale;fI=fB.opts.MinScale;fJ=dD.Corrector(fF);return fJ.isIterationFailed?(fK=fJ.dt/2,fK<1E-12?F.FailWith("Cannot generate numerical solution"):dD.PredictorCorrector(dE.New(fJ.t,fJ.x,fJ.f,fK,dD.NordsieckMatrix_rescale(fC,0.5),fJ.q,fJ.Dq,fJ.delta,fJ.r,fJ.qmax,0,fJ.e,false,fJ.opts))):(fL=fv.min(1.1,fv.max(0.2,fJ.r)),fJ.delta>=1?(fJ.opts.MaxStep<1.79769313486232E+308?fL=fv.min(fL,fJ.opts.MaxStep/fJ.dt):void 0,fG>0?fL=fv.max(fL,fG/fJ.dt):void 0,fL=fv.min(fL,fH),fL=fv.max(fL,fI),dD.PredictorCorrector(dE.New(fJ.t,fJ.x,fJ.f,fJ.dt*fL,dD.NordsieckMatrix_rescale(fJ.z,fL),fJ.q,fJ.Dq,fJ.delta,fJ.r,fJ.qmax,fJ.nsuccess,fJ.e,false,fJ.opts))):(fJ.opts.MaxStep<1.79769313486232E+308?fL=fv.min(fL,fJ.opts.MaxStep/fJ.dt):void 0,fG>0?fL=fv.max(fL,fG/fJ.dt):void 0,fL=fv.min(fL,fH),fL=fv.max(fL,fI),dE.New(fJ.t+fJ.dt,fJ.x,fJ.f,fJ.dt*fL,dD.NordsieckMatrix_rescale(fJ.z,fL),fJ.q,fJ.Dq,fJ.delta,fJ.r,fJ.qmax,fJ.nsuccess,fJ.e,fJ.isIterationFailed,fJ.opts)));};dD.NordsieckMatrix_init=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM;fC=cO.numCols(fB);fD=cO.numRows(fB);fE=cO.copy(fB);for(fF=0,fG=fC-2;fF<=fG;fF++){for(fH=fF+1,fI=fC-1;fH<=fI;fH++){fJ=fC+fF-fH;for(fK=0,fL=fD-1;fK<=fL;fK++){fM=(U.get(fE.MatrixData,fK))[fJ]+(U.get(fE.MatrixData,fK))[fJ-1];(U.get(fE.MatrixData,fK))[fJ-1]=fM;}}}return fE;};dD.Corrector=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6,f7,f8,f9,f_,f$,ga,gb,gc,gd,ge,gf,gg,gh,gi,gj,gk,gl,gm,gn;function fT(go){return cO.subtract(cO.identity(fY,fY),cO.matrMultScal(go,f3*fX[f1-1]));}function fU(go){var gp,gq,gr,gs,gt,gu,gv,gw,gx,gy,gz,gA,gB,gC,gD,gE,gF,gG,gH,gI,gJ,gK,gL,gM,gN,gO,gP,gQ;gu=new a.Float64Array(fY);gv=(fZ(f4+f3))(go.x);for(gw=0,gx=fY-1;gw<=gx;gw++)gu[gw]=f3*gv[gw]-(f5.get_Item(gw))[1]-go.e[gw];gy=f7.$==1?ff.SolveCore(f7.$0,gu):f7.$==2?ff.SparseSolveCore(f7.$0,gu):F.FailWith("Failed to evaluate predictor matrix P");gz=new a.Float64Array(fY);for(gA=0,gB=fY-1;gA<=gB;gA++)gz[gA]=go.e[gA]+gy[gA];gC=new a.Float64Array(fY);for(gD=0,gE=fY-1;gD<=gE;gD++)gC[gD]=f0[gD]+fX[f1-1]*gz[gD];gF=cO.vectorProduct(gz,U.get(fW,f1-1));gG=cO.zeros(fY,f2+1);for(gH=0,gI=fY-1;gH<=gI;gH++){for(gJ=0,gK=f2;gJ<=gK;gJ++)if(gH<cO.numRows(gF)&&gJ<U.get(fW,f1-1).length){gL=(U.get(gF.MatrixData,gH))[gJ];(U.get(gG.MatrixData,gH))[gJ]=gL;}else(U.get(gG.MatrixData,gH))[gJ]=0;}gM=cO.add(f5,gG);gN=dD.ToleranceNorm(gz,f8,f9,go.x);gO=new a.Float64Array(fY);for(gP=0,gQ=fY-1;gP<=gQ;gP++)gO[gP]=(gz[gP]-fB.e[gP])*(1/(f1+2)*(U.get(fW,f1-1))[f1-1]);gq=dD.ToleranceNorm(gO,f8,f9,gC);gr=dD.ToleranceNorm(cO.copyCol(gM,f1-1),f8,f9,gC);gs=gN/(f6/(2*(f1+2)));gt=fe.New(gz,gN,gq,gr,gs,gC,gM,go.count+1);return gs>1&&gt.count<fV?fU(gt):gt;}fV=fB.opts.NumberOfIterations;fW=U.map(cL.ofArray,[[1,1],[2/3,1,1/3],[6/11,1,6/11,1/11],[24/50,1,35/50,10/50,1/50],[120/274,1,225/274,85/274,15/274,1/274],[720/1764,1,1624/1764,735/1764,175/1764,1/1764]]);fX=cL.ofArray([1,2/3,6/11,24/50,120/274,720/1764]);fY=fB.x.length;fZ=fB.f;f0=fB.x;f1=fB.q;f2=fB.qmax;f3=fB.dt;f4=fB.t;f5=cO.copy(fB.z);f6=1/(1/(f1+1)*dD.Factorial(f1)*(U.get(fW,f1-1))[f1]);fC=0;fD=0;fE=0;f7=(fG=fB.opts.Jacobian,fG.$==1?{$:1,$0:fT(fG.$0)}:fG.$==2?{$:2,$0:de.Identity(fY,fY).minus(fG.$0.times$1(f3*fX[f1-1]))}:{$:1,$0:fT(dD.NordsieckMatrix_Jacobian(f4+f3,f0,function(go,gp){return(fZ(go))(gp);}))});f8=fB.opts.AbsoluteTolerance;f9=fB.opts.RelativeTolerance;f_=fU(fe.New(fB.e,0,0,0,0,f0,f5,0));fI=f_.count<fV?fB.nsuccess+1:0;fJ=f_.delta;fK=false;fL=0;fM=f_.z;fN=f_.e;fO=f_.x;fP=f_.Dq;fQ=fB.q;fR=1;f$=fv.abs(f_.Dq);ga=fv.abs(f_.DqUp);gb=fv.abs(f_.DqDown);if(f_.count<fV){fK=false;fM=f_.z;for(gc=0,gd=fY-1;gc<=gd;gc++)fO[gc]=(f_.z.get_Item(gc))[0];fN=f_.e;}else{fK=true;fM=fB.z;for(ge=0,gf=fY-1;ge<=gf;ge++)fO[ge]=(fB.z.get_Item(ge))[0];fN=fB.e;}fD=0;if(fB.q<fB.qmax)fD=1/1.4/(fv.pow(ga,1/(f1+2))+1E-06);fC=1/1.2/(fv.pow(f$,1/(f1+1))+1E-06);fE=0;if(fB.q>1)fE=1/1.3/(fv.pow(gb,1/f1)+1E-06);fL=fI>=fB.q?0:fI;if(fC>=fD){if(fC<=fE&&fI>=fB.q&&fB.q>1){fQ=fB.q-1;fP=gb;for(gg=0,gh=fY-1;gg<=gh;gg++){for(gi=fQ+1,gj=f2;gi<=gj;gi++)(fM.get_Item(gg))[gi]=0;}fI=0;fR=fE;}else{fQ=fB.q;fP=f$;fR=fC;}}else if(fD>=fE){if(fD>=fC&&fI>=fB.q&&fB.q<fB.qmax){fQ=fB.q+1;fP=ga;fR=fD;fI=0;}else{fQ=fB.q;fP=f$;fR=fC;}}else if(fI>=fB.q&&fB.q>1){fQ=fB.q-1;fP=gb;for(gk=0,gl=fY-1;gk<=gl;gk++){for(gm=fQ+1,gn=f2;gm<=gn;gm++)(fM.get_Item(gk))[gm]=0;}fI=0;fR=fE;}else{fQ=fB.q;fP=f$;fR=fC;}fS=dE.New(fB.t,fO,fB.f,fB.dt,fM,fQ,fP,fJ,fR,fB.qmax,fL,fN,fK,fB.opts);return fS;};dD.NordsieckMatrix_rescale=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM;fD=1;fG=cO.numCols(fB);fH=cO.numRows(fB);fF=cO.copy(fB);for(fI=1,fJ=fG-1;fI<=fJ;fI++){fD=fD*fC;for(fK=0,fL=fH-1;fK<=fL;fK++){fM=(U.get(fF.MatrixData,fK))[fI]*fD;(U.get(fF.MatrixData,fK))[fI]=fM;}}return fF;};dD.NordsieckMatrix_Jacobian=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ;fE=fC.length;fF=cO.zeros(fE,fE);fG=U.create(fE,0);fH=new a.Float64Array(fE);for(fI=0,fJ=fE-1;fI<=fJ;fI++){U.set(fG,fI,fv.sqrt(1E-06*(fK=1E-05,(fL=fv.abs(fC[fI]),bk.Compare(fK,fL)===1?fK:fL))));fH[fI]=fC[fI];}fM=fD(fB,fC);fN=cO.zeros(fE,fE);for(fO=0,fP=fE-1;fO<=fP;fO++){fH[fO]=fH[fO]+U.get(fG,fO);fR=fD(fB,fH);for(fS=0,fT=fE-1;fS<=fT;fS++){fU=fR[fS];(U.get(fN.MatrixData,fO))[fS]=fU;}fH[fO]=fH[fO]-U.get(fG,fO);}for(fV=0,fW=fE-1;fV<=fW;fV++){fX=fF.get_Item(fV);for(fY=0,fZ=fE-1;fY<=fZ;fY++)fX[fY]=((U.get(fN.MatrixData,fY))[fV]-fM[fV])/U.get(fG,fY);}return fF;};dD.ToleranceNorm=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fH=fB.length;fI=fE.length;fF=0;fG=0;for(fJ=0,fK=fH-1;fJ<=fK;fJ++){fL=fv.abs(fB[fJ]);fF=fF>fL?fF:fL;}for(fM=0,fN=fI-1;fM<=fN;fM++){fO=fv.abs(fE[fM]);fG=fG>fO?fG:fO;}return fF/(fC+fD*fG);};dD.Factorial=function(fB){return fB<0?-1:fB===0?1:fB*dD.Factorial(fB-1);};dE.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO){return{t:fB,x:fC,f:fD,dt:fE,z:fF,q:fG,Dq:fH,delta:fI,r:fJ,qmax:fK,nsuccess:fL,e:fM,isIterationFailed:fN,opts:fO};};dF.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ){return{InitialStepSize:fB,AbsoluteTolerance:fC,RelativeTolerance:fD,MaxStep:fE,MinStep:fF,MaxScale:fG,MinScale:fH,NumberOfIterations:fI,Jacobian:fJ};};dG.init=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fF=7;fG=fC.length;fH=dH.New(fB,fC,fD,0,cO.zeros(fF,fG),1,0,fC,fE);return dH.New(fB,fC,fD,fE.InitialStepSize===0?(fI=cL.map(function(fP){return fE.AbsoluteTolerance+fE.RelativeTolerance*fv.abs(fP);},fC),(fJ=(fH.f(fB))(fC),(fK=cL.max(cL.map2(function(fP){return function(fQ){return fv.abs(fP/fQ);};},fC,fI)),(fL=cL.max(cL.map2(function(fP){return function(fQ){return fv.abs(fP/fQ);};},fJ,fI)),(fM=fv.min(fK,fL)<1E-05?1E-06:0.01*(fK/fL),(fN=cL.max(cL.map2(function(fP){return function(fQ){return fv.abs(fP/fQ);};},cL.subtract(fJ,(fH.f(fB+fM))(cL.add(fC,cL.scale(fM,fJ)))),cL.scale(fM,fI))),(fO=fv.max(fL,fN)<=1E-15?fv.max(1E-06,fM*0.001):fv.pow(0.01/fv.max(fL,fN),1/5),fO>100*fM?100*fM:fO))))))):fE.InitialStepSize,cO.zeros(fF,fG),1,0,fC,fE);};dG.advance=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fM){var fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6,f7,f8,f9,f_,f$,ga,gb,gc,gd,ge,gf,gg,gh,gi,gj,gk,gl,gm,gn,go,gp,gq,gr,gs,gt,gu,gv,gw,gx,gy,gz,gA,gB,gC,gD,gE,gF,gG,gH,gI,gJ,gK;gx=fM.dt;gy=dG.scaleTo(gx,(fN=cL.copy(fD),(fB.f(fC+gx*U.get(fH,0)))(fN)));gz=(fO=U.get(fE,0),dG.scaleTo(gx,(fP=(fQ=cL.copy(fD),dG.addTo(gy,U.get(fO,0),fQ)),(fB.f(fC+gx*U.get(fH,1)))(fP))));gA=(fR=U.get(fE,1),dG.scaleTo(gx,(fS=(fT=(fU=cL.copy(fD),dG.addTo(gy,U.get(fR,0),fU)),dG.addTo(gz,U.get(fR,1),fT)),(fB.f(fC+gx*U.get(fH,2)))(fS))));gB=(fV=U.get(fE,2),dG.scaleTo(gx,(fW=(fX=(fY=(fZ=cL.copy(fD),dG.addTo(gy,U.get(fV,0),fZ)),dG.addTo(gz,U.get(fV,1),fY)),dG.addTo(gA,U.get(fV,2),fX)),(fB.f(fC+gx*U.get(fH,3)))(fW))));gC=(f0=U.get(fE,3),dG.scaleTo(gx,(f1=(f2=(f3=(f4=(f5=cL.copy(fD),dG.addTo(gy,U.get(f0,0),f5)),dG.addTo(gz,U.get(f0,1),f4)),dG.addTo(gA,U.get(f0,2),f3)),dG.addTo(gB,U.get(f0,3),f2)),(fB.f(fC+gx*U.get(fH,4)))(f1))));gD=(f6=U.get(fE,4),dG.scaleTo(gx,(f7=(f8=(f9=(f_=(f$=(ga=cL.copy(fD),dG.addTo(gy,U.get(f6,0),ga)),dG.addTo(gz,U.get(f6,1),f$)),dG.addTo(gA,U.get(f6,2),f_)),dG.addTo(gB,U.get(f6,3),f9)),dG.addTo(gC,U.get(f6,4),f8)),(fB.f(fC+gx*U.get(fH,5)))(f7))));gE=(gb=U.get(fE,5),dG.scaleTo(gx,(gc=(gd=(ge=(gf=(gg=(gh=(gi=cL.copy(fD),dG.addTo(gy,U.get(gb,0),gi)),dG.addTo(gz,U.get(gb,1),gh)),dG.addTo(gA,U.get(gb,2),gg)),dG.addTo(gB,U.get(gb,3),gf)),dG.addTo(gC,U.get(gb,4),ge)),dG.addTo(gD,U.get(gb,5),gd)),(fB.f(fC+gx*U.get(fH,6)))(gc))));gF=cO.ofRows([gy,gz,gA,gB,gC,gD,gE]);gG=(gj=(gk=(gl=(gm=(gn=(go=(gp=cL.copy(fI),dG.addTo(gy,U.get(fG,0),gp)),dG.addTo(gz,U.get(fG,1),go)),dG.addTo(gA,U.get(fG,2),gn)),dG.addTo(gB,U.get(fG,3),gm)),dG.addTo(gC,U.get(fG,4),gl)),dG.addTo(gD,U.get(fG,5),gk)),dG.addTo(gE,U.get(fG,6),gj));gH=(gq=(gr=(gs=(gt=(gu=(gv=(gw=cL.copy(fI),dG.addTo(gy,U.get(fF,0),gw)),dG.addTo(gz,U.get(fF,1),gv)),dG.addTo(gA,U.get(fF,2),gu)),dG.addTo(gB,U.get(fF,3),gt)),dG.addTo(gC,U.get(fF,4),gs)),dG.addTo(gD,U.get(fF,5),gr)),dG.addTo(gE,U.get(fF,6),gq));gI=cL.max(cL.mapi2(fu.Curried3(function(gL,gM,gN){return fv.abs(1*(gM-gN))/fv.max(fB.opts.AbsoluteTolerance,fB.opts.RelativeTolerance*fv.max(fv.abs(fI[gL]),fv.abs(gN)));}),gG,gH));gJ=gI===0?gx:gx*fv.min(5,fv.max(0.2,0.8*fv.pow(1/gI,1/5)*fv.pow(fJ,0.08)));gK=fB.opts.MaxStep<1.79769313486232E+308?fv.min(gJ,fB.opts.MaxStep):gJ;if(a.isNaN(gK))throw new eq.New$2("Derivatives function returned NaN");else if(gK<1E-12)throw new eq.New$2("Cannot generate numerical solution");else return gI<=1?ep.New(gH,gK,fM.dt,gI,gF):fL(ep.New(gH,gK,fM.dt,gI,gF));}fC=fB.t;fD=fB.x;fE=[[1/5],[3/40,9/40],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];fF=[5179/57600,0,7571/16695,393/640,-92097/339200,187/2100,1/40];fG=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];fH=[0,1/5,3/10,4/5,8/9,1,1];fI=fB.x;fJ=fB.prevErr;fK=fL(ep.New(fB.x,fB.dt,fB.dt,0,fB.k));return dH.New(fB.t+fK.prevDt,fK.x,fB.f,fK.dt,fK.k,fK.e,fB.t,fB.x,fB.opts);};dG.add_interpolate=function(fB,fC){var fD,fE,fG,fH,fI,fJ,fK,fL,fM;function fF(fN){var fO,fP,fQ;return fN>=fG-1?B.Empty:new B({$:1,$0:(fO=U.get(fK,fN),(fP=fE.get_Item(fN),(fQ=fN===0?fB.x:fE.get_Item(fN-1),dH.New(fO,fP,fB.f,fB.dt,fB.k,fB.prevErr,fN===0?fB.t:U.get(fK,fN-1),fQ,fB.opts)))),$1:fF(fN+1)});}fG=4;fH=new a.Float64Array(fG-1);for(fI=0,fJ=fG-2;fI<=fJ;fI++)fH[fI]=(fI+1)/fG;fK=U.create(fG,0);for(fL=0,fM=fG-2;fL<=fM;fL++)U.set(fK,fL,fB.t+(fC.t-fB.t)*fH[fL]);fE=dG.interp(fH,fB.x,fC.k);return fF(0);};dG.defaults=function(){return dI.New(0,1E-06,0.001,1.79769313486232E+308,1E-12);};dG.scaleTo=function(fB,fC){cL.setScaled(fB,fC);return fC;};dG.addTo=function(fB,fC,fD){cL.setAddedScaled(fD,fB,fC);return fD;};dG.interp=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ;bk.Equals(fD,null)?F.FailWith("interpolation array k is empty."):null;fG=fC.length;fH=cO.numRows(fD);fI=fB.length;fJ=cO.zeros(fI,fG);for(fK=0,fL=fI-1;fK<=fL;fK++)fJ.get_Item(fK).set(fC);fM=cO.zeros(4,fI);for(fN=0,fO=fI-1;fN<=fO;fN++){(fM.get_Item(0))[fN]=fB[fN];for(fP=1,fQ=3;fP<=fQ;fP++)(fM.get_Item(fP))[fN]=fB[fN]*(fM.get_Item(fP-1))[fN];}fR=cO.ofArray([[1,-183/64,37/12,-145/128],[0,0,0,0],[0,1500/371,-1000/159,1000/371],[0,-125/32,125/12,-375/64],[0,9477/3392,-729/106,25515/6784],[0,-11/7,11/3,-55/28],[0,3/2,-4,5/2]]);fE=cO.zeros(fG,4);fF=cO.zeros(fG,fI);for(fS=0,fT=fI-1;fS<=fT;fS++){for(fU=0,fV=fG-1;fU<=fV;fU++){(fF.get_Item(fU))[fS]=0;for(fW=0,fX=3;fW<=fX;fW++){(fE.get_Item(fU))[fW]=0;for(fY=0,fZ=fH-1;fY<=fZ;fY++)(fE.get_Item(fU))[fW]=(fE.get_Item(fU))[fW]+(fD.get_Item(fY))[fU]*(fR.get_Item(fY))[fW];(fF.get_Item(fU))[fS]=(fF.get_Item(fU))[fS]+(fE.get_Item(fU))[fW]*(fM.get_Item(fW))[fS];}(fJ.get_Item(fS))[fU]=(fJ.get_Item(fS))[fU]+(fF.get_Item(fU))[fS];}}return fJ;};dH.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ){return{t:fB,x:fC,f:fD,dt:fE,k:fF,prevErr:fG,prevT:fH,prevX:fI,opts:fJ};};dI.New=function(fB,fC,fD,fE,fF){return{InitialStepSize:fB,AbsoluteTolerance:fC,RelativeTolerance:fD,MaxStep:fE,MinStep:fF};};dJ=d.OsloAbstract=fu.Class({evaluate:function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ;function fK(fQ){var fR;fR=fD.tryFind_index(fQ);return fR==null?(function(fS){return function(fT){return fS("Attempting to look up non-existent species "+_2.toSafe(fT));};}(F.FailWith))(fQ.name):fR.$0;}function fL(fQ){function fR(fS){return co.map(fK,fS);}return function(fS){return R.map(fR,fS);};}function fM(fQ){return co.eval_massaction(fB,fQ);}function fN(fQ){return co.eval_function(fB,fG,fQ);}function fO(fQ){return co.map(fK,fQ);}function fP(fQ){return co.inline_keys(fB,fG,fQ);}fB=bF.to_env(this.settings.parameters);fC=V.to_initialpops_events(fB,this.settings.simulation.initial,this.initials);fD=fC[0];fE=fD.get_get_pop_array();fF=bf.create(fD,fC[1],this.settings.simulation,1);fG=co.inline_rates_env(fB,K.Map(function(fQ,fR){return(fL(fQ))(fR);},this.settings.rates));fH=U.map(function(fQ){return cb.map2(fM,fN,fQ);},this.rates);return X.New(this.name,fF,U.ofList(A.map((fI=(fJ=function(fQ){return fP(fO(fQ));},function(fQ){return R.expand(fJ,fQ);}),function(fQ){return R.simplify(fI(fQ));}),fF.settings.plots)),this.settings.deterministic,cO.ofArray(this.matrix),this.powers,fH,cL.ofArray(fE));}},null,dJ);dJ.create=function(fB,fC,fD,fE,fF,fG,fH){return dJ.New(fB,fC,fD,fE,fF,fG,fH);};dJ.New=function(fB,fC,fD,fE,fF,fG,fH){return new dJ({name:fB,settings:fC,matrix:fD,powers:fE,rates:fF,species:fG,initials:fH});};dK=dn.LCGRng=fu.Class({Microsoft_Research_Filzbach_Lib_IRng$NextDouble:function(){var fB;fB=this.Microsoft_Research_Filzbach_Lib_IRng$NextInt32();return[fB[0]*dn["lcg.d"](),fB[1]];},Microsoft_Research_Filzbach_Lib_IRng$NextInt32:function(){var fB;fB=(dn["lcg.a"]()*this.seed%dn["lcd.m"]()+dn["lcg.c"]())%dn["lcd.m"]();return[fB,new dK.New(fB)];}},w,dK);dK.New=fu.Ctor(function(fB){w.New.call(this);this.seed=fB;},dK);dn.fst3=a.id;dn["lcg.d"]=function(){fn.$cctor();return fn["lcg.d"];};dn["lcg.a"]=function(){fn.$cctor();return fn["lcg.a"];};dn["lcd.m"]=function(){fn.$cctor();return fn["lcd.m"];};dn["lcg.c"]=function(){fn.$cctor();return fn["lcg.c"];};dn.logOfNormPDF=function(fB,fC,fD){var fE,fF;fE=fv.sqrt(6.28318530717959);fF=(fB-fD)/fC;return -0.5*fF*fF-fv.log(fE*fC);};dn.improbable=function(){fn.$cctor();return fn.improbable;};dn.normCDF=function(fB,fC,fD){return 0.5*(1+dn.erf((fD-fB)/fC/fv.sqrt(2)));};dn.erfinv=function(fB){var fC,fD,fE,fF;fC=-fv.log((1-fB)*(1+fB));fD=fC<5?[A.ofArray([2.81022636E-08,3.43273939E-07,-3.5233877E-06,-4.39150654E-06,0.00021858087,-0.00125372503,-0.00417768164,0.246640727,1.50140941]),fC-2.5]:(fE=fv.sqrt(fC)-3,[A.ofArray([-0.000200214257,0.000100950558,0.00134934322,-0.00367342844,0.00573950773,-0.0076224613,0.00943887047,1.00167406,2.83297682]),fE]);fF=fD[1];return A.reduce(function(fG,fH){return fG*fF+fH;},fD[0])*fB;};dn.erf=function(fB){var fC;function fD(fE,fF){return function(fG){return[fE+fG*fF,fF*fC];};}fC=1/(1+0.5*fv.abs(fB));return fB<0?fC*fv.exp((U.fold(function(fE,fF){return(function(fG){return fD(fG[0],fG[1]);}(fE))(fF);},[-fB*fB,1],[-1.26551223,1.00002368,0.37409196,0.09678418,-0.18628806,0.27886807,-1.13520398,1.48851587,-0.82215223,0.17087277]))[0])-1:1-fC*fv.exp((U.fold(function(fE,fF){return(function(fG){return fD(fG[0],fG[1]);}(fE))(fF);},[-fB*fB,1],[-1.26551223,1.00002368,0.37409196,0.09678418,-0.18628806,0.27886807,-1.13520398,1.48851587,-0.82215223,0.17087277]))[0]);};dL=d.SundialsAbstract=fu.Class({evaluate:function(){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK;function fL(fO){var fP;fP=fE.tryFind_index(fO);return fP==null?(function(fQ){return function(fR){return fQ("Species "+_2.toSafe(fR)+" not found in model");};}(F.FailWith))(fO.name):fP.$0;}function fM(fO){return co.inline_keys(fB,fC,fO);}function fN(fO){return R.map(fI,fO);}fB=bF.to_env(this.settings.parameters);fC=co.inline_rates_env(fB,this.settings.rates);fD=V.to_initialpops_events(fB,this.settings.simulation.initial,this.initials);fE=fD[0];fF=bf.create(fE,fD[1],this.settings.simulation,1);fG=fE.get_get_pop_array();fH=A.map(function(fO){return db.fst3(fO[0],fO[1],fO[2]);},cc.get_sim_reactions_products(1,fE,fB,fC,this.reactions));fI=function(fO){return cY.map(fL,fO);};return _0.New(fF,U.ofList(A.map((fJ=(fK=function(fO){return R.expand(fM,fO);},function(fO){return R.simplify(fK(fO));}),function(fO){return fN(fJ(fO));}),fF.settings.plots)),fH,this.settings.deterministic,fG);}},null,dL);dL.create=function(fB,fC,fD,fE){return dL.New(fB,fE,fC,fD);};dL.New=function(fB,fC,fD,fE){return new dL({species:fB,settings:fC,reactions:fD,initials:fE});};dM.TridiagonalAlgorithm=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fF=U.length(fE);fG=U.create(fF,0);fH=fE.slice();fI=U.create(fF,0);U.set(fG,0,U.get(fD,0)/U.get(fC,0));U.set(fH,0,U.get(fH,0)/U.get(fC,0));for(fJ=1,fK=fF-2;fJ<=fK;fJ++){fL=U.get(fC,fJ)-U.get(fB,fJ)*U.get(fG,fJ-1);U.set(fG,fJ,U.get(fD,fJ)/fL);U.set(fH,fJ,(U.get(fH,fJ)-U.get(fB,fJ)*U.get(fH,fJ-1))/fL);}U.set(fH,fF-1,(U.get(fH,fF-1)-U.get(fB,fF-1)*U.get(fH,fF-2))/(U.get(fC,fF-1)-U.get(fB,fF-1)*U.get(fG,fF-2)));U.set(fI,fF-1,U.get(fH,fF-1));fM=F.step(fF-2,-1,0);fN=da.Get(fM);try{while(fN.MoveNext()){fO=fN.Current();U.set(fI,fO,U.get(fH,fO)-U.get(fG,fO)*U.get(fI,fO+1));}}finally{if(typeof fN=="object"&&"Dispose"in fN)fN.Dispose();}return fI;};dM.ApplySMInvertMatrix=function(fB,fC,fD,fE,fF,fG){var fH,fI;fH=dM.TridiagonalAlgorithm(fB,fC,fD,fE);fI=dM.DotProduct(fF,fH)/(1+dM.DotProduct(fF,fG));return U.map2(function(fJ,fK){return fJ-fI*fK;},fH,fG);};dM.DotProduct=function(fB,fC){return U.fold2(function(fD,fE,fF){return fD+fE*fF;},0,fB,fC);};dN.$cctor=function(){dN.$cctor=a.ignore;dN.empty=new y.New([]);dN.filter=function(fB){return function(fC){return K.Filter(function(fD,fE){return(fB(fD))(fE);},fC);};};};dO.$cctor=function(){var fB,fC,fD,fE,fF;dO.$cctor=a.ignore;function fG(fH){return true;}dO.start_pos=[0,0];dO.add_row=function(fH){return D.add_rows(1,fH);};dO.lineSeparators=["\\r\\n","\\n"];dO.CommentSingle="//";dO.CommentStart="(*";dO.CommentEnd="*)";dO.newline=function(fH){var fI,fJ,fK;fI=fH[0];fJ=fH[1];fK=fJ[0];return dk.StartsWith(fI,"\\n")?{$:1,$0:"\\n",$1:[fI.substring(1),[fK+1,0]]}:dk.StartsWith(fI,"\\r\\n")?{$:1,$0:"\\n",$1:[fI.substring(2),[fK+1,0]]}:dk.StartsWith(fI,"\\r")?{$:1,$0:"\\n",$1:[fI.substring(1),[fK+1,0]]}:D.mk_failEmpty([fK,fJ[1]],"linebreak");};dO.eof=function(fH){return fH[0]===""?{$:0,$0:null,$1:["",fH[1]]}:D.mk_failEmpty(fH[1],"end of input");};dO.digits=D.op_LessQmarkGreater(D.manySatisfy(D.isDigit),"an integer");dO.digits1=D.op_LessQmarkGreater(D.many1Satisfy(D.isDigit),"an integer");dO.skipNewline=D.op_BarGreaterGreater(D.newline(),a.ignore);dO.keyword=D.skipString;dO.linebreak=D.op_BarGreaterGreater(D.newline(),a.ignore);dO.sign=D.op_BarGreaterGreater(D.opt(D.pstring("-")),function(fH){return fH==null?"":"-";});dO.forced_sign=D.op_LessBarGreater(D.pstring("-"),D.pstring("+"));dO.opt_sign=D.op_BarGreaterGreater(D.opt(D.op_LessBarGreater(D.pstring("-"),D.pstring("+"))),function(fH){return fH==null?"":fH.$0;});dO.pint32=D.guarded(function(fH){return F.toInt(a.Number(fH));},D.pTry(D.op_DotGreaterGreaterDot(D.sign(),D.digits1())));dO.pfloat=D.op_LessQmarkGreater(D.guarded(a.Number,D.pTry(D.op_DotGreaterGreaterDot(D.op_DotGreaterGreaterDot(D.op_DotGreaterGreaterDot(D.sign(),D.digits1()),D.opt(D.op_GreaterGreaterDot(D.pstring("."),D.digits1()))),D.opt(D.op_DotGreaterGreaterDot(D.op_GreaterGreaterDot(D.op_LessBarGreater(D.pstring("e"),D.pstring("E")),D.opt_sign()),D.digits1()))))),"a float");dO.anyChar=function(fH){var fI,fJ,fK,fL;fI=fH[0];fJ=fH[1];fK=fJ[0];fL=[fK,fJ[1]];return fI.length>0&&D.isLetter(fI[0])?dk.StartsWith(fI,"\\n")?{$:1,$0:"\\n",$1:[fI.substring(1),[fK+1,0]]}:dk.StartsWith(fI,"\\r\\n")?{$:1,$0:"\\n",$1:[fI.substring(2),[fK+1,0]]}:dk.StartsWith(fI,"\\r")?{$:1,$0:"\\n",$1:[fI.substring(1),[fK+1,0]]}:{$:1,$0:fI[0],$1:[fI.substring(1),D.add_cols(1,fL)]}:D.mk_failEmpty(fL,"a letter");};dO.whiteSpace=D.op_LessQmarkGreater(D.op_LessBarGreater(D.linebreak(),function(fH){return D.skipChar(D.isWhiteSpace,fH[0],fH[1]);}),"a white space");dO.anyChar_INTERNAL=D.op_LessQmarkGreater(function(fH){return D.skipChar(fG,fH[0],fH[1]);},"any char");dO.eol=D.op_LessBarGreater((fB=D.choice(U.map(D.keyword(),D.lineSeparators())),function(fH){return fB([fH[0],fH[1]]);}),D.eof());dO.commentLine=D.op_BarGreaterGreater(D.op_GreaterGreaterGreaterGreater((D.keyword())(D.CommentSingle()),(fC=D.op_LessBarGreater(D.linebreak(),D.eof()),function(fH){return D.manyUntil(D.anyChar_INTERNAL(),fC,fH[0],fH[1]);})),a.ignore);dO.spaces=function(fH){var fI;fI=(D.many(D.op_LessBarGreater(D.op_LessBarGreater(D.commentLine(),D.commentMultiline()),D.whiteSpace())))(fH);return fI.$==1?{$:0,$0:"",$1:fI.$1}:fI.$==2?{$:0,$0:"",$1:fH}:fI.$==3?{$:3,$0:fI.$0,$1:fI.$1}:{$:0,$0:"",$1:fI.$1};};dO.spaces1=function(fH){var fI;fI=(D.many1(D.op_LessBarGreater(D.op_LessBarGreater(D.commentLine(),D.commentMultiline()),D.whiteSpace())))(fH);return fI.$==1?{$:0,$0:"",$1:fI.$1}:fI.$==2?{$:0,$0:"",$1:fH}:fI.$==3?{$:3,$0:fI.$0,$1:fI.$1}:{$:0,$0:"",$1:fI.$1};};dO.name=D.op_LessQmarkGreater(D.op_BarGreaterGreater(D.op_DotGreaterGreaterDot(D.many1Satisfy(D.isLetter),D.manySatisfy(function(fH){return D.isLetter(fH)||D.isDigit(fH)||fH==="_"||fH==="\'";})),function(fH){return fH[0]+fH[1];}),"an identifier");dO.pcolour=(fD=D.manySatisfy(function(fH){return D.isLetter(fH)||D.isDigit(fH);}),D.op_DotGreaterGreater(D.op_GreaterGreaterDot(D.pstring("\\""),(fE=D.choice([D.op_GreaterGreaterEquals(D.op_GreaterGreaterDot(D.kw("#"),D.many1Satisfy(function(fH){return"a"<=fH&&fH<="f"||"A"<=fH&&fH<="F"||D.isDigit(fH);})),function(fH){return D.preturn("#"+fH);}),fD]),function(fH){return fE([fH[0],fH[1]]);})),D.kw("\\"")));dO.pbool=(fF=D.choice([D.op_GreaterGreaterPercent(D.kw("true"),true),D.op_GreaterGreaterPercent(D.kw("True"),true),D.op_GreaterGreaterPercent(D.kw("false"),false),D.op_GreaterGreaterPercent(D.kw("False"),false)]),function(fH){return fF([fH[0],fH[1]]);});dO.parse=new et.New();};dP=x.ValueCollection=fu.Class({GetEnumerator$1:function(){return da.Get(bc.map(function(fB){return fB.V;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},w,dP);dP.New=fu.Ctor(function(fB){w.New.call(this);this.d=fB;},dP);dQ.fromSeq=function(fB){var fC;fC=U.ofSeq(bc.delay(function(){return bc.collect(function(fD){return[cz.New(fD[0],fD[1])];},bc.distinctBy(function(fD){return fD[0];},fB));}));U.sortInPlace(fC);return cx.Build(fC,0,fC.length-1);};dS=dR.StringBuilder=fu.Class({Append:function(fB){this._str=this._str+fB;return this;}},w,dS);dS.New$1=fu.Ctor(function(fB){w.New.call(this);this._str="";this._str=fB;},dS);dS.New=fu.Ctor(function(){dS.New$1.call(this,"");},dS);dT.$cctor=function(){dT.$cctor=a.ignore;dT.newline="\\r\\n";dT.tab="\\u0009";dT.quotemark="\\"";dT.space=" ";dT.empty="";dT.equals="=";dT.indent_string=bl.space()+bl.space();dT.preamble=bl.xmltag(A.ofArray([["version",{$:1,$0:"1.0"}],["encoding",{$:1,$0:"UTF-8"}]]))+bl.newline()+bl.tagopen(0,"sbml",A.ofArray([["xmlns",{$:1,$0:"http://www.sbml.org/sbml/level2/version4"}],["level",{$:1,$0:"2"}],["version",{$:1,$0:"4"}]]))+bl.newline();dT.postamble=bl.tagclose(0,"sbml");dT.openAngle="&lt;";dT.closeAngle=">";dT.empty_model=dU.New(null,null,B.Empty,B.Empty,B.Empty,B.Empty,B.Empty,B.Empty);};dU.New=function(fB,fC,fD,fE,fF,fG,fH,fI){return{id:fB,name:fC,listOfUnitDefinitions:fD,listOfCompartments:fE,listOfSpecies:fF,listOfParameters:fG,listOfInitialAssignments:fH,listOfReactions:fI};};dV.Mole={$:19};dV.Litre={$:15};dV.Dimensionless={$:4};dV.Second={$:24};dW.Times={$:4};dW.Plus={$:3};dX.Divide={$:1};dX.Power={$:2};dX.Subtract={$:3};dX.Mod={$:5};dY.New=function(fB,fC,fD){return{rnorm_phase:fB,rnorm_2:fC,rnorm_f:fD};};dZ.IsLetterOrDigit=function(fB){return dZ.IsLetter(fB)||dZ.IsDigit(fB);};dZ.IsLetter=function(fB){return fB>="A"&&fB<="Z"||fB>="a"&&fB<="z";};dZ.IsDigit=function(fB){return fB>="0"&&fB<="9";};dZ.IsWhiteSpace=function(fB){return fB.match(new a.RegExp("\\\\s"))!==null;};d0.$cctor=function(){d0.$cctor=a.ignore;d0.activate_idd_script="\\r\\nvar objects = document.getElementsByClassName(\\"cliplot div.fsharp-idd\\");\\r\\nfor(var i = 0; i < objects.length; i++)\\r\\n  InteractiveDataDisplay.asPlot(objects.item(i));\\r\\nobjects = document.getElementsByClassName(\\"cliplot div.idd-subplots\\");\\r\\nfor(var i = 0; i < objects.length; i++)\\r\\n  InteractiveDataDisplay.asSubPlots(objects.item(i));\\r\\n";d0.prepare_idd_script=(function(fB){return function(fC){return fB("\\r\\n<script type=\\"text/javascript\\">\\r\\n    window.addEventListener(\\"load\\", function(){"+_2.toSafe(fC)+"});\\r\\n<\/script>");};}(a.id))(bz.activate_idd_script());d0.cdn_scripts="\\r\\n<link rel=\\"stylesheet\\" type=\\"text/css\\" href=\\"https://cdn.jsdelivr.net/npm/interactive-data-display@1.5.30/dist/idd.css\\" integrity=\\"sha384-c0Bubh+0uCjFanb6BoVtGLQAYmnD27PrMKjIlFp3QZ/ZjpWHo+q86s7zmX1bKAmU\\" crossorigin=\\"anonymous\\"/>\\r\\n<script src=\\"https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js\\" integrity=\\"sha384-bPV3mA2eo3edoq56VzcPBmG1N1QVUfjYMxVIJPPzyFJyFZ8GFfN7Npt06Zr23qts\\" crossorigin=\\"anonymous\\"><\/script>\\r\\n<script src=\\"https://code.jquery.com/jquery-2.1.4.min.js\\" integrity=\\"sha384-R4/ztc4ZlRqWjqIuvf6RX5yb/v90qNGx6fS48N0tRxiGkqveZETq72KgDVJCp2TC\\" crossorigin=\\"anonymous\\"><\/script>\\r\\n<script src=\\"https://cdnjs.cloudflare.com/ajax/libs/rxjs/3.1.2/rx.lite.min.js\\" integrity=\\"sha384-YYQgxpPVmcgxIB80jXrurb3n9UJCb8MOA+2Om6wfF3Fji0Khse2mz3Pz87kt2wba\\" crossorigin=\\"anonymous\\"><\/script>\\r\\n<script src=\\"https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js\\" integrity=\\"sha384-jx+EoRqSnwNqHsZoMJl/OMDriDdzqdPXunQMsJOq6eUISEJxQkBgcR88EFkA2iHw\\" crossorigin=\\"anonymous\\"><\/script>\\r\\n<script src=\\"https://cdn.jsdelivr.net/npm/interactive-data-display@1.5.30/dist/idd.js\\" integrity=\\"sha384-Ys962FVdDdKVR+cU47Lb85HIpxUsV8oK/s7lb43z8kD7481L26ecJ4Q3yqUdgRBJ\\" crossorigin=\\"anonymous\\"><\/script>\\r\\n";d0.footer_scripts_idd="\\r\\n<script>\\r\\nfunction openTab(evt, group, tabName) {\\r\\n    var i, tabcontent, tablinks;\\r\\n    tabcontent = document.getElementsByClassName(\\"tabcontent cliplot \\"+group);\\r\\n    for (i = 0; i < tabcontent.length; i++) {\\r\\n        tabcontent[i].style.display = \\"none\\";\\r\\n    }\\r\\n    tablinks = document.getElementsByClassName(\\"tablinks cliplot \\"+group);\\r\\n    for (i = 0; i < tablinks.length; i++) {\\r\\n        tablinks[i].className = tablinks[i].className.replace(\\" active\\", \\"\\");\\r\\n    }\\r\\n    document.getElementById(group+tabName).style.display = \\"block\\";\\r\\n    evt.currentTarget.className += \\" active\\";\\r\\n    var objects = document.querySelectorAll(\\"#\\"+group+tabName+\\" div.fsharp-idd\\");\\r\\n    for(var i = 0; i < objects.length; i++)\\r\\n        InteractiveDataDisplay.asPlot(objects.item(i)).requestUpdateLayout();\\r\\n    objects = document.querySelectorAll(\\"#\\"+group+tabName+\\" div.idd-subplots\\");\\r\\n    for(var i = 0; i < objects.length; i++)\\r\\n        InteractiveDataDisplay.asSubPlots(objects.item(i));\\r\\n}\\r\\nfunction openComparison(evt, group, compName) {\\r\\n    var i, compcontent, complinks;\\r\\n    compcontent = document.getElementsByClassName(\\"compcontent cliplot \\"+group);\\r\\n    for (i = 0; i < compcontent.length; i++) {\\r\\n        compcontent[i].style.display = \\"none\\";\\r\\n    }\\r\\n    complinks = document.getElementsByClassName(\\"complinks cliplot \\"+group);\\r\\n    for (i = 0; i < complinks.length; i++) {\\r\\n        complinks[i].className = complinks[i].className.replace(\\" active\\", \\"\\");\\r\\n    }\\r\\n    document.getElementById(group+compName).style.display = \\"block\\";\\r\\n    evt.currentTarget.className += \\"active\\";\\r\\n    var objects = document.querySelectorAll(\\"#\\"+group+compName+\\" div.fsharp-idd\\");\\r\\n    for(var i = 0; i < objects.length; i++)\\r\\n        InteractiveDataDisplay.asPlot(objects.item(i)).requestUpdateLayout();\\r\\n    objects = document.querySelectorAll(\\"#\\"+group+compName+\\" div.idd-subplots\\");\\r\\n    for(var i = 0; i < objects.length; i++)\\r\\n        InteractiveDataDisplay.asSubPlots(objects.item(i));\\r\\n}\\r\\nwindow.addEventListener(\\"load\\", function() { document.getElementById(\\"cliplot_defaultOpen\\").click(); });\\r\\n<\/script>";d0.page_header_scripts=((((fu.Curried(function(fB,fC,fD,fE){return fB(_2.toSafe(fC)+" "+_2.toSafe(fD)+" "+_2.toSafe(fE));},4))(a.id))(bz.cdn_scripts()))(bz.prepare_idd_script()))(bz.footer_scripts_idd());d0.unified_scripts=(((fu.Curried3(function(fB,fC,fD){return fB("<script>"+_2.toSafe(fC)+"<\/script> "+_2.toSafe(fD));}))(a.id))(bz.activate_idd_script()))(bz.footer_scripts_idd());d0.local_styles="<style>\\r\\n    .cliplot {font-family: \\"Lato\\", sans-serif;}\\r\\n    \\r\\n    ul.tab.cliplot {\\r\\n\\u0009\\u0009list-style-type: none;\\r\\n\\u0009\\u0009margin: 0;\\r\\n\\u0009\\u0009padding: 0;\\r\\n\\u0009\\u0009overflow: hidden;\\r\\n\\u0009\\u0009border: 2px solid #ccc;\\r\\n\\u0009\\u0009background-color: #f1f1f1;\\r\\n\\u0009}\\r\\n\\r\\n\\u0009/* Float the list items side by side */\\r\\n\\u0009ul.tab.cliplot li {float: left;}\\r\\n\\r\\n\\u0009/* Style the links inside the list items */\\r\\n\\u0009ul.tab.cliplot li a {\\r\\n\\u0009\\u0009display: inline-block;\\r\\n\\u0009\\u0009color: black;\\r\\n\\u0009\\u0009text-align: center;\\r\\n\\u0009\\u0009padding: 14px 16px;\\r\\n\\u0009\\u0009text-decoration: none;\\r\\n\\u0009\\u0009transition: 0.3s;\\r\\n\\u0009\\u0009font-size: 17px;\\r\\n\\u0009}\\r\\n\\r\\n\\u0009/* Change background color of links on hover */\\r\\n\\u0009ul.tab.cliplot li a:hover {\\r\\n\\u0009\\u0009background-color: #ddd;\\r\\n\\u0009}\\r\\n\\r\\n\\u0009/* Create an active/current tablink class */\\r\\n\\u0009ul.tab.cliplot li a:focus, .active.cliplot {\\r\\n\\u0009\\u0009background-color: #ccc;\\r\\n\\u0009}\\r\\n\\r\\n\\u0009/* Style the tab content */\\r\\n\\u0009.tabcontent.cliplot {\\r\\n\\u0009\\u0009display: none;\\r\\n\\u0009\\u0009padding: 12px 12px;\\r\\n\\u0009\\u0009border: 2px solid #ccc;\\r\\n\\u0009\\u0009border-top: none;\\r\\n\\u0009}\\r\\n\\r\\n\\u0009/* Style the table cells*/\\r\\n\\u0009th.cliplot, td.cliplot { \\r\\n\\u0009\\u0009padding: 3px;\\r\\n\\u0009\\u0009min-width: 50px;\\r\\n\\u0009}\\u0009\\r\\n\\u0009th.cliplot {\\r\\n\\u0009\\u0009border-top: 2px solid #000;\\r\\n\\u0009\\u0009border-bottom: 1px solid #000;\\r\\n\\u0009}\\r\\n\\u0009table.cliplot#pTable {\\r\\n\\u0009\\u0009border-collapse: collapse;\\r\\n\\u0009\\u0009border-bottom: 2px solid #000;\\r\\n\\u0009}</style>";};d1.run_seq=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL;function fM(fN,fO,fP){var fQ,fR,fS;fQ=fN.$==1?(fR=d1.sampleStep(fB,fG,fE,fO,fP,fN.$0),[{$:1,$0:fR[0]},fR[1]]):fO>=fE.burninLen?[{$:1,$0:bw.samplingInit(fN.$0)},fP]:(fS=d1.burninStep(fB,fG,fE,fO,fP,fN.$0),[{$:0,$0:fS[0]},fS[1]]);return[fQ[0],fO+1,fQ[1]];}fF=d1.paramsInit(fD,bw.paramsCheck(fC));fG=fF[1];fH=fF[0];fI=fB(d2.All);fJ=bw.paramsInit(fH,new dK.New(fE.seed));fK=fJ[0];fL=fI(fK);return bc.map(function(fN){return dn.fst3(fN[0],fN[1],fN[2]);},bw.step_to_seq(function(fN){return fM(fN[0],fN[1],fN[2]);},[{$:0,$0:bw.burninInit(function(fN){return bc.sum(fI(fN));},fH,fK,fF[2],fJ[1])},1,fL],fE.burninLen+fE.sampleLen));};d1.paramsInit=function(fB,fC){var fD,fE,fF,fG;function fH(fJ,fK){return fJ.isFixed();}function fI(fJ,fK){return new e6.New(fJ.name,fJ.range);}fD=A.partition(function(fJ){return fH(fJ[0],fJ[1]);},A.zip(fC,fB));fE=fD[1];fF=bq.ofSeq(A.map(function(fJ){return fI(fJ[0],fJ[1]);},fE));fG=A.map(function(fJ){return fJ[1];},fE);return[A.map(function(fJ){return fJ[0];},A.append(fE,fD[0])),fG,fF];};d1.sampleStep=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ,fK,fL,fM,fN;fH=d1.evaluateAcceptance(fB,fC,fE,fF,fG.space,fG.priors,fG.state,fG.innovationGens,fG.indexes,fG.randGen);fI=fH[0];fJ=fI.$==0?(fK=fI.$0,[fK,fK.logLikelihood>fG.mle.logLikelihood?fK:fG.mle,fH[2],fG.accepted+1]):[(fL=fG.state,bo.New(fL.values,fL.logLikelihood,fL.logPrior,fE)),fG.mle,fF,fG.accepted];fM=fJ[0];fN=bx.New(fG.space,fM,fG.thinningSkippedCount,fG.chain,fG.burnin,fH[1],fH[3],fJ[1],fG.priors,fG.indexes,fJ[3]);return[fN.thinningSkippedCount===fD.thinning-1?bx.New(fN.space,fN.state,0,new B({$:1,$0:fM,$1:fN.chain}),fN.burnin,fN.randGen,fN.innovationGens,fN.mle,fN.priors,fN.indexes,fN.accepted):bx.New(fN.space,fN.state,fN.thinningSkippedCount+1,fN.chain,fN.burnin,fN.randGen,fN.innovationGens,fN.mle,fN.priors,fN.indexes,fN.accepted),fJ[2],fH[5]];};d1.burninStep=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR;function fS(fU,fV){return fV?bs.New(fU.accepted+1,fU.altered+1):fU;}function fT(fU,fV){return fV?bs.New(fU.accepted,fU.altered+1):fU;}fH=d1.evaluateAcceptance(fB,fC,fE,fF,fG.space,fG.priors,fG.state,fG.innovationGens,fG.indexes,fG.randGen);fI=fH[4];fJ=fH[0];fK=fJ.$==0?(fL=fJ.$0,[fL,fL.logLikelihood>fG.mle.logLikelihood?fL:fG.mle,fH[2],(((fu.Curried3(U.map2))(fS))(fG.stats))(fI)]):[(fM=fG.state,bo.New(fM.values,fM.logLikelihood,fM.logPrior,fE)),fG.mle,fF,(((fu.Curried3(U.map2))(fT))(fG.stats))(fI)];fN=fK[0];fO=fK[3];fP=U.choose(a.id,U.mapi(function(fU,fV){return fV.altered===20?{$:1,$0:fU}:null;},fO));fQ=bw.correctInnovationGens(fP,fG.space,fG.stats,fG.innovationGens);fR=by.New(fG.space,fN,fG.thinningSkippedCount,fG.chain,U.mapi(function(fU,fV){return U.contains(fU,fP)?bs.New(0,0):fV;},fO),fH[1],fQ,fK[1],fG.priors,fG.indexes);return[fR.thinningSkippedCount===fD.thinning-1?by.New(fR.space,fR.state,0,new B({$:1,$0:fN,$1:fR.chain}),fR.stats,fR.randGen,fR.innovationGens,fR.mle,fR.priors,fR.indexes):by.New(fR.space,fR.state,fR.thinningSkippedCount+1,fR.chain,fR.stats,fR.randGen,fR.innovationGens,fR.mle,fR.priors,fR.indexes),fK[2],fH[5]];};d1.evaluateAcceptance=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK){var fL,fM,fN,fO,fP,fQ,fR,fS;fL=bw.proposeValues(fF,fH,fK,fI);fM=fL[3];fN=fL[0];fO=fL[2];fP=fL[1];fQ=bw.isStateOutOfRange(fP,fN,fF,fJ);return fQ?[fg.Rejected,fM,fE,fO,fP,fQ]:(fR=d1.partial_logLikelihoods(fP,fC,fB,fE,fN),(fS=bw.acceptProposedValues(fD,bc.sum(fR),bw.lglkPriors(fN,fG),fN,fH,fM),[fS[0],fS[1],fR,fO,fP,fQ]));};d1.partial_logLikelihoods=function(fB,fC,fD,fE,fF){var fG,fH,fI;fG=A.map(function(fJ){return fJ[1];},A.filter(function(fJ){return fJ[0];},A.zip(A.ofArray(fB),fC)));return A.contains(d2.All,fG)?(fD(d2.All))(fF):(fH=A.sort(A.distinct(bc.fold(function(fJ,fK){return fK.$==0?F.FailWith("Can\'t be possible"):A.append(fK.$0,fJ);},B.Empty,fG))),(fI=(fD({$:1,$0:fH}))(fF),A.mapi(function(fJ,fK){var fL;fL=bc.tryFindIndex(function(fM){return fM===fJ;},fH);return fL==null?fK:fI.get_Item(fL.$0);},fE)));};d2.All={$:0};bw.run_seq=function(fB,fC,fD){var fE,fF,fG;function fH(fI,fJ){var fK,fL,fM;return[fI.$==1?{$:1,$0:(fK=bw.sampleStep(fB,fD,fJ,fI.$0),dn.fst3(fK[0],fK[1],fK[2]))}:fJ>=fD.burninLen?{$:1,$0:(fL=bw.sampleStep(fB,fD,fJ,bw.samplingInit(fI.$0)),dn.fst3(fL[0],fL[1],fL[2]))}:{$:0,$0:(fM=bw.burninStep(fB,fD,fJ,fI.$0),dn.fst3(fM[0],fM[1],fM[2]))},fJ+1];}fE=bw.paramsSetup(bw.paramsCheck(fC));fF=fE[0];fG=bw.paramsInit(fF,new dK.New(fD.seed));return bc.map(function(fI){return fI[0];},bw.step_to_seq(function(fI){return fH(fI[0],fI[1]);},[{$:0,$0:bw.burninInit(fB,fF,fG[0],fE[1],fG[1])},0],fD.burninLen+fD.sampleLen));};bw.paramsCheck=function(fB){A.iter(function(fC){var fD,fE;fD=fC.initValue;fD==null?void 0:(fE=fD.$0,fE>fC.range.ub||fE<fC.range.lb?((((fu.Curried(function(fF,fG,fH,fI){return fF("The initial value of parameter "+_2.toSafe(fG)+" is outside the specified bounds ("+fH.toFixed(6)+","+fI.toFixed(6)+")");},4))(F.FailWith))(fC.name))(fC.range.lb))(fC.range.ub):void 0);},fB);A.exists(function(fC){return fC.isFixed()&&fC.initValue==null;},fB)?F.FailWith("All fixed parameters must have initial value"):void 0;A.exists(function(fC){return fC.range.lb>fC.range.ub;},fB)?F.FailWith("One of the parameter definitions contains upper bound lower than lower bound"):void 0;A.exists(function(fC){return!fC.isReal()&&fC.range.lb<0;},fB)?F.FailWith("One of the log-scale parameter definitions contains negative lower bound"):void 0;return A.map(function(fC){var fD;return fC.range.pType.$===1&&fC.range.lb===0?bC.New(fC.name,(fD=fC.range,br.New(fD.pType,4.94065645841247E-324,fD.ub)),fC.initValue,fC.prior,fC.summary):fC;},fB);};bw.paramsInit=function(fB,fC){var fD,fE;function fF(fG,fH,fI){var fJ;return fG==null?(fJ=fI.Microsoft_Research_Filzbach_Lib_IRng$NextDouble(),[fH.lb+fJ[0]*(fH.ub-fH.lb),fJ[1]]):[fG.$0,fI];}fD=U.ofList(A.skip(1,A.scan(function(fG,fH){var fI;fI=fF(fH.initValue,fH.range,fG[1]);return[new e6.New(fH.name,fI[0]),fI[1]];},[new e6.New("dummy",0),fC],fB)));fE=U.map(function(fG){return fG[0];},fD);U.length(fD)!==fB.get_Length()?F.FailWith("unexpected scan behaviour"):void 0;return[bq.ofArray(fE),(U.get(fD,U.length(fD)-1))[1]];};bw.step_to_seq=function(fB,fC,fD){function fE(fF,fG){var fH;return fG<=0?null:(fH=fB(fF),{$:1,$0:[fH,[fH,fG-1]]});}return bc.unfold(function(fF){return fE(fF[0],fF[1]);},[fC,fD]);};bw.burninInit=function(fB,fC,fD,fE,fF){var fG,fH,fI;function fJ(fK){var fL;fL=fK.pType;return fL.$==1?0.5*(fv.log(fK.ub)-fv.log(fK.lb)):fL.$==2?F.FailWith("Must not be called. Innovation generator is not needed for fixed parameter"):0.5*(fK.ub-fK.lb);}fG=K.OfArray(U.ofSeq(U.mapi(function(fK,fL){return[fK,new _do.New(0,fJ(fL))];},fE.get__dataArray())));fH=U.ofList(A.map(function(fK){return fK.prior;},fC));fI=bo.New(fD,fB(fD),bw.lglkPriors(fD,fH),0);return by.New(fE,fI,0,B.Empty,U.map(function(){return bs.New(0,0);},fE.get__dataArray()),fF,fG,fI,fH,U.init(fG.get_Count(),a.id));};bw.samplingInit=function(fB){return bx.New(fB.space,fB.state,0,B.Empty,fB.chain,fB.randGen,fB.innovationGens,fB.mle,fB.priors,fB.indexes,0);};bw.paramsSetup=function(fB){var fC,fD,fE;fC=A.partition(function(fF){return fF.isFixed();},fB);fD=fC[1];fE=bq.ofSeq(A.map(function(fF){return new e6.New(fF.name,fF.range);},fD));return[A.append(fD,fC[0]),fE];};bw.sampleStep=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN;fF=bw.evaluateAcceptance(fB,fD,fE.space,fE.priors,fE.state,fE.innovationGens,fE.indexes,fE.randGen);fG=fF[4];fH=fF[0];fI=fH.$==0?(fJ=fH.$0,[fJ,fJ.logLikelihood>fE.mle.logLikelihood?fJ:fE.mle,fE.accepted+1]):[(fK=fE.state,bo.New(fK.values,fK.logLikelihood,fK.logPrior,fD)),fE.mle,fE.accepted];fL=fI[0];fM=fI[1];fN=bx.New(fE.space,fL,fE.thinningSkippedCount,fE.chain,fE.burnin,fF[1],fF[2],fM,fE.priors,fE.indexes,fI[2]);return fN.thinningSkippedCount===fC.thinning-1?[bx.New(fN.space,fN.state,0,new B({$:1,$0:fL,$1:fN.chain}),fN.burnin,fN.randGen,fN.innovationGens,fN.mle,fN.priors,fN.indexes,fN.accepted),fM.logLikelihood,fG]:[bx.New(fN.space,fN.state,fN.thinningSkippedCount+1,fN.chain,fN.burnin,fN.randGen,fN.innovationGens,fN.mle,fN.priors,fN.indexes,fN.accepted),fM.logLikelihood,fG];};bw.burninStep=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR;function fS(fU,fV){return fV?bs.New(fU.accepted+1,fU.altered+1):fU;}function fT(fU,fV){return fV?bs.New(fU.accepted,fU.altered+1):fU;}fF=bw.evaluateAcceptance(fB,fD,fE.space,fE.priors,fE.state,fE.innovationGens,fE.indexes,fE.randGen);fG=fF[4];fH=fF[3];fI=fF[0];fJ=fI.$==0?(fK=fI.$0,[fK,fK.logLikelihood>fE.mle.logLikelihood?fK:fE.mle,(((fu.Curried3(U.map2))(fS))(fE.stats))(fH)]):[(fL=fE.state,bo.New(fL.values,fL.logLikelihood,fL.logPrior,fD)),fE.mle,(((fu.Curried3(U.map2))(fT))(fE.stats))(fH)];fM=fJ[0];fN=fJ[1];fO=fJ[2];fP=U.choose(a.id,U.mapi(function(fU,fV){return fV.altered===20?{$:1,$0:fU}:null;},fO));fQ=bw.correctInnovationGens(fP,fE.space,fE.stats,fE.innovationGens);fR=by.New(fE.space,fM,fE.thinningSkippedCount,fE.chain,U.mapi(function(fU,fV){return U.exists(function(fW){return fU===fW;},fP)?bs.New(0,0):fV;},fO),fF[1],fQ,fN,fE.priors,fE.indexes);return fR.thinningSkippedCount===fC.thinning-1?[by.New(fR.space,fR.state,0,new B({$:1,$0:fM,$1:fR.chain}),fR.stats,fR.randGen,fR.innovationGens,fR.mle,fR.priors,fR.indexes),fN.logLikelihood,fG]:[by.New(fR.space,fR.state,fR.thinningSkippedCount+1,fR.chain,fR.stats,fR.randGen,fR.innovationGens,fR.mle,fR.priors,fR.indexes),fN.logLikelihood,fG];};bw.lglkPriors=function(fB,fC){var fD;function fE(fF,fG){var fH,fI,fJ;return fF==null?0:fF.$0.$==1?(fH=fF.$0.$0,dn.logOfNormPDF(fH.mu,fH.sigma,fv.log(fG))-fv.log(fG)):fF.$0.$==2?(fI=fF.$0.$0,dn.logOfNormPDF(fI.mean,fI.stdev,fG)-fv.log(fI.denominator)):(fJ=fF.$0.$0,dn.logOfNormPDF(fJ.mean,fJ.stdev,fG));}return U.sum((fD=fB.ToArray(),(((fu.Curried3(U.map2))(fE))(fC))(fD)));};bw.correctInnovationGens=function(fB,fC,fD,fE){function fF(fG,fH,fI){var fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS;fJ=(fK=fI<5?fG.get_Sigma()*0.8:fI>5?fG.get_Sigma()*1.2:fG.get_Sigma(),(fL=fH.pType,fL.$==1?(fM=(fN=10,bk.Compare(fK,fN)===-1?fK:fN),(fO=0.01,bk.Compare(fM,fO)===1?fM:fO)):fL.$==2?F.FailWith("Update of fixed value"):(fP=fH.ub-fH.lb,(fQ=0.001*fP,(fR=(fS=0.5*fP,bk.Compare(fK,fS)===-1?fK:fS),bk.Compare(fR,fQ)===1?fR:fQ)))));return new _do.New(fG.get_Mean(),fJ);}return K.Map(function(fG,fH){return U.exists(function(fI){return fG===fI;},fB)?fF(fH,fC.Item$1(fG),U.get(fD,fG).accepted):fH;},fE);};bw.evaluateAcceptance=function(fB,fC,fD,fE,fF,fG,fH,fI){var fJ,fK,fL,fM,fN,fO,fP;fJ=bw.proposeValues(fD,fF,fI,fG);fK=fJ[3];fL=fJ[0];fM=fJ[2];fN=fJ[1];fO=bw.isStateOutOfRange(fN,fL,fD,fH);return fO?[fg.Rejected,fK,fM,fN,fO]:(fP=bw.acceptProposedValues(fC,fB(fL),bw.lglkPriors(fL,fE),fL,fF,fK),[fP[0],fP[1],fM,fN,fO]);};bw.proposeValues=function(fB,fC,fD,fE){var fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY;function fZ(f1,f2,f3,f4){var f5,f6;f5=f3.nextDouble(f4);f6=f5[0];return[f1.$==1?f2*fv.exp(f6):f1.$==2?F.FailWith("Proposing to update fixed value"):f2+f6,f5[1],f5[2]];}function f0(f1){var f2,f3,f4;f2=function(f5,f6,f7){var f8,f9,f_;while(true){f8=f6.Microsoft_Research_Filzbach_Lib_IRng$NextDouble();f9=f8[1];f_=f8[0];if(f7===1)return[new B({$:1,$0:f_,$1:f5}),f9];else{f5=new B({$:1,$0:f_,$1:f5});f6=f9;f7=f7-1;}}}(B.Empty,f1,fH);f3=f2[1];f4=U.ofList(f2[0]);return U.exists(function(f5){return f5<fT;},f4)?[U.map(function(f5){return f5<fT;},f4),f3]:f0(f3);}fF=fC.values;fG=fC.values.get__dataArray();fH=U.length(fB.get__dataArray());return fH===0?[fF,[],fE,fD]:(fI=U.sub(fG,fH,U.length(fG)-fH),(fJ=(fK=fD.Microsoft_Research_Filzbach_Lib_IRng$NextDouble(),(fL=fK[1].Microsoft_Research_Filzbach_Lib_IRng$NextDouble(),(fM=fL[1],(fN=fL[0],fK[0]<0.67?(fO=U.create(fH,null),(fP=fM.Microsoft_Research_Filzbach_Lib_IRng$NextDouble(),(fQ=fP[1].Microsoft_Research_Filzbach_Lib_IRng$NextDouble(),(fR=F.toInt(fv.floor(fN*fH)),(fR>0&&fP[0]<0.5?U.set(fO,fR-1,true):void 0,U.set(fO,fR,true),fR<fH-1&&fQ[0]<0.5?U.set(fO,fR+1,true):void 0,[fO,fQ[1]]))))):(fS=3/fH,(fT=(fU=fS*fv.exp(4*(fN-0.5)),fU<0.1*fS?0.1*fS:fU>0.99?0.99:fU),f0(fM))))))),(fV=fJ[0],(fW=U.ofSeq(bc.skip(1,bc.scan(function(f1,f2){var f3,f4,f5,f6;f3=f1[1];f4=f1[3];f5=f1[2];f6=f2?fZ(fB.Item$1(f4).pType,fF.Item$1(f4),f5.get_Item(f4),f3):[U.get(fG,f4),f5.get_Item(f4),f3];return[f6[0],f6[2],f5.Add(f4,f6[1]),f4+1];},[0,fJ[1],fE,0],fV))),(fX=U.map(a.fst,fW).concat(fI),(fY=U.get(fW,U.length(fW)-1),[fF.CopyWithNewValues(fX),fV,fY[2],fY[1]]))))));};bw.isStateOutOfRange=function(fB,fC,fD,fE){function fF(fG){var fH,fI;fH=fC.Item$1(fG);fI=fD.Item$1(fG);return fH<fI.lb||fH>fI.ub;}return U.exists2(function(fG,fH){return fG&&fF(fH);},fB,fE);};bw.acceptProposedValues=function(fB,fC,fD,fE,fF,fG){var fH,fI,fJ,fK,fL;fH=(fI=fD+fC,(fJ=fF.logLikelihood+fF.logPrior,(fK=fG.Microsoft_Research_Filzbach_Lib_IRng$NextDouble(),(fL=fK[1],fI>fJ?[true,fL]:[fI-fJ>fv.log(fK[0]),fL]))));return[fH[0]?{$:0,$0:bo.New(fE,fC,fD,fB)}:fg.Rejected,fH[1]];};d3.stringOfSummary=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK;fE="\\u0009";fF="\\r\\n";return fB.$==1?(fG=fB.$0,(fH=d3.getSummary(fG),(fI=fG.mle.values,(fJ=d3.informationCriteria(fG,fD),dk.concat(fF,U.concat([["Params"+fE+a.String(fH.length),"Free_params"+fE+a.String(U.filter(function(fL){return fL.range.pType.$!==2;},fH).length),"Burnin"+fE+a.String(fC.burninLen),"Samples"+fE+a.String(fC.sampleLen),"Max loglikelihood"+fE+a.String(fG.mle.logLikelihood),"AIC"+fE+a.String(fJ.AIC),"BIC"+fE+a.String(fJ.BIC),"DIC"+fE+a.String(fJ.DIC)],[" ",dk.concat(fE,["Name","Type","Lower Bound","Upper Bound","MLE","Posterior mean","Posterior variance","Posterior l95","Posterior l68","Posterior median","Posterior u68","Posterior u95"])],U.map(function(fL){return dk.concat(fE,new B({$:1,$0:fL.name,$1:new B({$:1,$0:d3.stringOfRange(fL.range.pType),$1:A.map(a.String,A.ofArray([fL.range.lb,fL.range.ub,fI.Item(fL.name),fL.summary.mean,fL.summary.variance,fL.qsummary.lb95,fL.qsummary.lb68,fL.qsummary.median,fL.qsummary.ub68,fL.qsummary.ub95]))})}));},fH)])))))):(fK=fB.$0,dk.concat(fF,U.concat([["Phase: Burn-In"],["Params"+fE+a.String(fK.space.get_Names().length),"Free_params"+fE+a.String(U.filter(function(fL){return fL.pType.$!==2;},fK.space.ToArray()).length),"Burnin"+fE+a.String(fC.burninLen),"Samples"+fE+a.String(fC.sampleLen),"Max loglikelihood"+fE+a.String(fK.mle.logLikelihood)]])));};d3.getSummary=function(fB){var fC;fC=d3.extractBayesTable(fB);return U.length(fC.get_ColumnNames())<=1?[]:U.ofSeq(bc.delay(function(){return bc.map(function(fD){return d3.getParameterSummary(fC,fB,fD);},bc.skip(1,fC.get_ColumnNames()));}));};d3.informationCriteria=function(fB,fC){var fD,fE,fF;fD=fB.mle.logLikelihood;fE=U.length(fB.space.get__dataArray());return eI.New(-2*fD+2*fE,-2*fD+fv.log(fC)*fE,(fF=d3.extractBayesTable(fB),fF.get_ColumnCount()===0?a.NaN:-1*(-2*fD)+2*U.average(U.map(function(fG){return -2*fG;},fF.GetColumn("logLikelihood")))));};d3.stringOfRange=function(fB){return fB.$==1?"log":fB.$==2?"fixed":"real";};d3.extractBayesTable=function(fB){var fC,fD;fC=U.ofSeq(bc.map(function(fE){return[fE.logLikelihood].concat(fE.values.get__dataArray());},fB.chain));return U.length(fC)===0?new e7.New([],new dm.New([])):(fD=new dm.New(U.ofSeq(bc.delay(function(){return bc.append(["logLikelihood"],bc.delay(function(){return fB.space.get__namesMap().get_Keys();}));}))),new e7.New(U.init(U.length(fB.space.get__namesMap().get_Keys())+1,function(fE){return U.init(U.length(fC),function(fF){return U.get(U.get(fC,fF),fE);});}),fD));};d3.getParameterSummary=function(fB,fC,fD){var fE,fF;fE=fB.GetColumn(fD);fF=fC.space.get__namesMap().Item(fD);return eF.New(fD,fC.mle.values.Item(fD),d3.summary(fE),d3.qsummary(fE),fC.space.Item$1(fF));};d3.qsummary=function(fB){var fC,fD;function fE(fF){var fG,fH;fG=fF*(fD+1/3)-2/3;return fG<=0?U.get(fC,0):fG>=fD-1?U.get(fC,fD-1):(fH=fv.floor(fG),U.get(fC,F.toInt(fH))*(1-fG+fH)+U.get(fC,F.toInt(fH)+1)*(fG-fH));}fC=U.ofSeq(bc.filter(function(fF){return!(a.isNaN(fF)||fv.abs(fF)===a.Infinity);},fB));U.sortInPlace(fC);fD=U.length(fC);return fD<1?eH.New(a.NaN,a.NaN,a.NaN,a.NaN,a.NaN,a.NaN,a.NaN):eH.New(U.get(fC,0),fE(0.025),fE(0.16),fE(0.5),fE(0.84),fE(0.975),U.get(fC,fD-1));};d3.summary=function(fB){var fC;fC=bc.fold(function(fD,fE){var fF,fG,fH,fI,fJ;return a.isNaN(fE)||fv.abs(fE)===a.Infinity?fD:(fF=fE-fD.mean,(fG=fD.count+1,(fH=fD.mean+fF/fG,eG.New(fG,(fI=fD.min,bk.Compare(fE,fI)===-1?fE:fI),(fJ=fD.max,bk.Compare(fE,fJ)===1?fE:fJ),fH,fD.variance+fF*(fE-fH)))));},eG.New(0,Infinity,-Infinity,0,0),fB);return fC.count<2?fC:eG.New(fC.count,fC.min,fC.max,fC.mean,fC.variance/(fC.count-1));};d4.New=function(fB,fC,fD,fE,fF,fG){return{burninLen:fB,sampleLen:fC,thinning:fD,seed:fE,print_console:fF,print_summary:fG};};d5.toString=function(fB){var fC,fD,fE;return fB.$==1?(fC=fB.$0,(fD=A.length(fC.Attributes)===0?"":" "+dk.Join(" ",U.ofSeq(bc.map(function(fF){return(((fu.Curried3(function(fG,fH,fI){return fG(_2.toSafe(fH)+"=\\""+_2.toSafe(fI)+"\\"");}))(a.id))(fF.Key.$0))(fF.Value.$0);},fC.Attributes))),(fE=dk.Join("\\n",U.ofSeq(bc.map(d5.toString,bc.rev(fC.Children)))),(((fu.Curried3(function(fF,fG,fH){return fF("<div"+_2.toSafe(fG)+">"+_2.toSafe(fH)+"</div>");}))(a.id))(fD))(fE)))):fB.$==2?(function(fF){return function(fG){return fF("<table class=\'idd-subplots-table\'>"+_2.toSafe(fG)+"</table>");};}(a.id))(dk.Join("\\n",U.ofSeq(bc.map(function(fF){return(function(fG){return function(fH){return fG("<tr>"+_2.toSafe(fH)+"</tr>");};}(a.id))(dk.Join("",U.ofSeq(bc.map(function(fG){return(function(fH){return function(fI){return fH("<td>"+_2.toSafe(fI)+"</td>");};}(a.id))(d5.toString(fG.$0));},bc.rev(fF.$0)))));},bc.rev(fB.$0.$0))))):fB.$==3?"":fB.$0.$0;};d5.createDiv=function(){return eJ.New(B.Empty,B.Empty);};d5.addDiv=function(fB,fC){return eJ.New(fC.Attributes,new B({$:1,$0:{$:1,$0:fB},$1:fC.Children}));};d5.addText=function(fB,fC){return eJ.New(fC.Attributes,new B({$:1,$0:{$:0,$0:d5.guardText(fB)},$1:fC.Children}));};d5.addAttribute=function(fB,fC,fD){return eJ.New(new B({$:1,$0:eK.New(d5.guardAttrName(fB),d5.guardAttrValue(fC)),$1:fD.Attributes}),fD.Children);};d5.addTable=function(fB,fC){return eJ.New(fC.Attributes,new B({$:1,$0:{$:2,$0:fB},$1:fC.Children}));};d5.guardText=function(fB){return{$:0,$0:dk.Replace(dk.Replace(fB,">","&gt;"),"<","&lt;")};};d5.guardAttrName=function(fB){var fC;fC=["-"];if(U.exists(function(fD){return!(dZ.IsLetterOrDigit(fD)||U.contains(fD,fC));},dk.ToCharArray(fB)))throw new eq.New$2((((fu.Curried3(function(fD,fE,fF){return fD("the string must contain only letters, digits or "+_2.printArray(_2.prettyPrint,fE)+", but "+_2.toSafe(fF)+" was passed");}))(a.id))(fC))(fB));else null;return{$:0,$0:fB};};d5.guardAttrValue=function(fB){return{$:0,$0:dk.Replace(dk.Replace(fB,"\\\\","\\\\\\\\"),"\\"","\\\\\\"")};};d6.toHtmlStructure=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT;fC=d5.createDiv();fD=d6.addVisibleRegionInfo(fB.VisibleRegion,K.OfArray(U.ofSeq(A.ofArray([["class","fsharp-idd"],["data-idd-plot","figure"],["style",(((fu.Curried3(function(fU,fV,fW){return fU("width: "+a.String(fV)+"px; height: "+a.String(fW)+"px;");}))(a.id))(fB.Width))(fB.Height)]]))),new y.New([]));fE=d6.axisToHtmlStructure(fB.Yaxis,eL.Left);fF=fE==null?[fC,null]:[d5.addDiv(fE.$0[0],fC),{$:1,$0:fE.$0[1]}];fG=fF[0];fH=fB.Ylabel!==null?d5.addDiv(d6.vertAxisLabelToHtmlStructue(fB.Ylabel,eL.Left),fG):fG;fI=d6.axisToHtmlStructure(fB.Xaxis,eL.Bottom);fJ=fI==null?[fH,null]:[d5.addDiv(fI.$0[0],fH),{$:1,$0:fI.$0[1]}];fK=fJ[0];fL=fB.Xlabel!==null?d5.addDiv(d6.horAxisLabelToHtmlStructure(fB.Xlabel,eL.Bottom),fK):fK;fM=!fB.IsTooltipPlotCoordsEnabled?fD[1].Add("isLegendVisible",d6.getEffectiveLegendvisibility(fB.IsLegendEnabled,fB.Plots)?"true":"false").Add("suppress-tooltip-coords","true"):fD[1].Add("isLegendVisible",d6.getEffectiveLegendvisibility(fB.IsLegendEnabled,fB.Plots)?"true":"false");fN=fD[0].Add("data-idd-navigation-enabled",fB.IsNavigationEnabled?"true":"false");fO=d6.gridLinesToHtmlStructure(fB.GridLines,fJ[1],fF[1],fB.Title!==null?(fP=d5.addText(fB.Title,d5.createDiv()),d5.addDiv(d6.addAttributes((new y.New([])).Add("class","idd-title").Add("data-idd-placement","top"),fP),fL)):fL);fQ=(fR=fB.TooltipDelay,fR==null?fM:fM.Add("tooltipDelay",(function(fU){return function(fV){return fU(fV.toFixed(6));};}(a.id))(fR.$0)));fS=bc.fold(function(fU,fV){return d5.addDiv(fV,fU);},fO,bc.map(d6.plotToDiv,fB.Plots));fT=d6.createStyleAttributes(fQ);return{$:1,$0:d6.addAttributes(fN.Add(fT[0],fT[1]),fS)};};d6.addVisibleRegionInfo=function(fB,fC,fD){return fB.$==1?[fC.Add("data-idd-visible-region",(((((fu.Curried(function(fE,fF,fG,fH,fI){return fE(fF.toFixed(6)+" "+fG.toFixed(6)+" "+fH.toFixed(6)+" "+fI.toFixed(6));},5))(a.id))(fB.$0))(fB.$2))(fB.$1))(fB.$3)),fD]:[fC,fD.Add("padding",(function(fE){return function(fF){return fE(a.String(fF));};}(a.id))(fB.$0))];};d6.axisToHtmlStructure=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL;return fB.$==1?(fD=fv.floor((new fy()).valueOf()*fv.random()).toString(),{$:1,$0:[fB.$0?d5.addAttribute("data-idd-scientific-notation","true",d5.addAttribute("style","position: relative;",(fE=d5.addAttribute("data-idd-axis","numeric",d5.addAttribute("id",fD,d5.createDiv())),d5.addAttribute("data-idd-placement",d6.placementToStr(fC),fE)))):d5.addAttribute("style","position: relative;",(fE=d5.addAttribute("data-idd-axis","numeric",d5.addAttribute("id",fD,d5.createDiv())),d5.addAttribute("data-idd-placement",d6.placementToStr(fC),fE))),fD]}):fB.$==2?(fF=fB.$0,(fG=fv.floor((new fy()).valueOf()*fv.random()).toString(),(fH=(fI=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",fF.Angle===0?"":"rotate: true; rotateAngle: "+(function(fM){return function(fN){return fM(fN.toFixed(6)+";");};}(a.id))(fF.Angle),d5.addAttribute("style","position: relative;",(fJ=d5.addAttribute("data-idd-axis","labels",d5.addAttribute("id",fG,d5.createDiv())),d5.addAttribute("data-idd-placement",d6.placementToStr(fC),fJ))))),d5.addText((fK=U.ofSeq(fF.Ticks),(fL=U.ofSeq(fF.Labels).map(a.btoa).join(","),(((fu.Curried3(function(fM,fN,fO){return fM("ticks float64.1D "+_2.toSafe(fN)+"\\nlabels string.1D "+_2.toSafe(fO));}))(a.id))(a.btoa((new a.Uint8Array(fz.from(fK).buffer)).reduce(function(fM,fN){return fM+fA.fromCharCode(fN);},""))))(fL))),fI)),{$:1,$0:[fF.ForceLabelsVisibility?d5.addAttribute("data-idd-force-labels-visibility","true",fF.Angle===0?fH:d5.addAttribute("data-idd-style","rotate: true; rotateAngle: "+(function(fM){return function(fN){return fM(fN.toFixed(6)+";");};}(a.id))(fF.Angle),fH)):fF.Angle===0?fH:d5.addAttribute("data-idd-style","rotate: true; rotateAngle: "+(function(fM){return function(fN){return fM(fN.toFixed(6)+";");};}(a.id))(fF.Angle),fH),fG]}))):null;};d6.vertAxisLabelToHtmlStructue=function(fB,fC){var fD,fE;fD=fC.$==3||(fC.$==0?false:fC.$!=1)?d6.placementToStr(fC):F.FailWith("wrong placement");return d5.addDiv(d5.addText(fB,d5.addAttribute("class","idd-verticalTitle-inner",d5.createDiv())),d5.addAttribute("data-idd-placement",fD,d5.addAttribute("class","idd-verticalTitle",d5.createDiv())));};d6.horAxisLabelToHtmlStructure=function(fB,fC){var fD;return d5.addText(fB,d5.addAttribute("data-idd-placement",fC.$==3||(fC.$==0?false:fC.$!=1)?F.FailWith("wrong placement"):d6.placementToStr(fC),d5.addAttribute("class","idd-horizontalTitle",d5.createDiv())));};d6.createStyleAttributes=function(fB){return["data-idd-style",K.Fold(function(fC,fD,fE){return fC+fD+": "+fE+"; ";},"",fB)];};d6.addAttributes=function(fB,fC){return K.Fold(function(fD,fE,fF){return d5.addAttribute(fE,fF,fD);},fC,fB);};d6.plotToDiv=function(fB){return fB.$==1?d6.markersToDiv(fB.$0):fB.$==2?d6.barchartToDiv(fB.$0):fB.$==3?d6.histogramToDiv(fB.$0):fB.$==4?d6.heatmapToDiv(fB.$0):d6.polylineToDiv(fB.$0);};d6.gridLinesToHtmlStructure=function(fB,fC,fD,fE){var fF,fG,fH;return fB.$==0?fE:(fF=fB.$0,d5.addDiv(fD==null?fC==null?(fG=A.ofArray([(function(fI){return function(fJ){return fI("thickness: "+fJ.toFixed(1)+"px");};}(a.id))(fB.$1)]),d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(fF.$==0?fG:(fH=fF.$0,new B({$:1,$0:((((fu.Curried(function(fI,fJ,fK,fL){return fI("stroke: rgb("+fA(fJ)+","+fA(fK)+","+fA(fL)+")");},4))(a.id))(fH.R))(fH.G))(fH.B),$1:fG})))),d5.addAttribute("data-idd-placement","center",d5.addAttribute("data-idd-plot","grid",d5.createDiv())))):d5.addAttribute("data-idd-xaxis",fC.$0,(fG=A.ofArray([(function(fI){return function(fJ){return fI("thickness: "+fJ.toFixed(1)+"px");};}(a.id))(fB.$1)]),d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(fF.$==0?fG:(fH=fF.$0,new B({$:1,$0:((((fu.Curried(function(fI,fJ,fK,fL){return fI("stroke: rgb("+fA(fJ)+","+fA(fK)+","+fA(fL)+")");},4))(a.id))(fH.R))(fH.G))(fH.B),$1:fG})))),d5.addAttribute("data-idd-placement","center",d5.addAttribute("data-idd-plot","grid",d5.createDiv()))))):d5.addAttribute("data-idd-yaxis",fD.$0,fC==null?(fG=A.ofArray([(function(fI){return function(fJ){return fI("thickness: "+fJ.toFixed(1)+"px");};}(a.id))(fB.$1)]),d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(fF.$==0?fG:(fH=fF.$0,new B({$:1,$0:((((fu.Curried(function(fI,fJ,fK,fL){return fI("stroke: rgb("+fA(fJ)+","+fA(fK)+","+fA(fL)+")");},4))(a.id))(fH.R))(fH.G))(fH.B),$1:fG})))),d5.addAttribute("data-idd-placement","center",d5.addAttribute("data-idd-plot","grid",d5.createDiv())))):d5.addAttribute("data-idd-xaxis",fC.$0,(fG=A.ofArray([(function(fI){return function(fJ){return fI("thickness: "+fJ.toFixed(1)+"px");};}(a.id))(fB.$1)]),d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(fF.$==0?fG:(fH=fF.$0,new B({$:1,$0:((((fu.Curried(function(fI,fJ,fK,fL){return fI("stroke: rgb("+fA(fJ)+","+fA(fK)+","+fA(fL)+")");},4))(a.id))(fH.R))(fH.G))(fH.B),$1:fG})))),d5.addAttribute("data-idd-placement","center",d5.addAttribute("data-idd-plot","grid",d5.createDiv())))))),fE));};d6.getEffectiveLegendvisibility=function(fB,fC){return fB.$==2?false:fB.$==1?A.exists(function(fD){return fD.$==1?fD.$0.Name!==null:fD.$==2?fD.$0.Name!==null:fD.$==3?fD.$0.Name!==null:fD.$==4?fD.$0.Name!==null:fD.$0.Name!==null;},fC):true;};d6.placementToStr=function(fB){return fB.$==0?"bottom":fB.$==2?"left":fB.$==3?"right":"top";};d6.markersToDiv=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK;fC=A.ofArray([(function(fL){return function(fM){return fL("size: "+fM.toFixed(1));};}(a.id))(fB.Size)]);fD=(fE=fB.FillColour,fE.$==0?fC:(fF=fE.$0,new B({$:1,$0:((((fu.Curried(function(fL,fM,fN,fO){return fL("color: rgb("+fA(fM)+","+fA(fN)+","+fA(fO)+")");},4))(a.id))(fF.R))(fF.G))(fF.B),$1:fC})));fG=(fH=fB.BorderColour,fH.$==0?fD:(fI=fH.$0,new B({$:1,$0:((((fu.Curried(function(fL,fM,fN,fO){return fL("border: rgb("+fA(fM)+","+fA(fN)+","+fA(fO)+")");},4))(a.id))(fI.R))(fI.G))(fI.B),$1:fD})));return dk.IsNullOrEmpty(fB.Name)?(fJ=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(new B({$:1,$0:(function(fL){return function(fM){return fL("shape: "+_2.toSafe(fM));};}(a.id))((fK=fB.Shape,fK.$==1?"circle":fK.$==3?"cross":fK.$==2?"diamond":fK.$==4?"triangle":"box")),$1:fG}))),d5.addAttribute("data-idd-plot","markers",d5.createDiv()))),d5.addText(d6.getXYDataDom(fB.X,fB.Y),fJ)):d5.addAttribute("data-idd-name",fB.Name,(fJ=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(new B({$:1,$0:(function(fL){return function(fM){return fL("shape: "+_2.toSafe(fM));};}(a.id))((fK=fB.Shape,fK.$==1?"circle":fK.$==3?"cross":fK.$==2?"diamond":fK.$==4?"triangle":"box")),$1:fG}))),d5.addAttribute("data-idd-plot","markers",d5.createDiv()))),d5.addText(d6.getXYDataDom(fB.X,fB.Y),fJ)));};d6.barchartToDiv=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN;fC=A.ofArray([(function(fO){return function(fP){return fO("barWidth: "+fP.toFixed(6));};}(a.id))(fB.BarWidth)]);fD=(fE=fB.FillColour,fE.$==0?fC:(fF=fE.$0,new B({$:1,$0:((((fu.Curried(function(fO,fP,fQ,fR){return fO("color: rgb("+fA(fP)+","+fA(fQ)+","+fA(fR)+")");},4))(a.id))(fF.R))(fF.G))(fF.B),$1:fC})));fG=(fH=fB.BorderColour,fH.$==0?fD:(fI=fH.$0,new B({$:1,$0:((((fu.Curried(function(fO,fP,fQ,fR){return fO("border: rgb("+fA(fP)+","+fA(fQ)+","+fA(fR)+")");},4))(a.id))(fI.R))(fI.G))(fI.B),$1:fD})));fJ=(fK=fB.Shadow,fK.$==0?fG:(fL=fK.$0,fL.$==0?new B({$:1,$0:"shadow: grey",$1:fG}):(fM=fL.$0,new B({$:1,$0:((((fu.Curried(function(fO,fP,fQ,fR){return fO("shadow: rgb("+fA(fP)+","+fA(fQ)+","+fA(fR)+")");},4))(a.id))(fM.R))(fM.G))(fM.B),$1:fG}))));return dk.IsNullOrEmpty(fB.Name)?(fN=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(new B({$:1,$0:function(fO){return fO("shape: bars");}(a.id),$1:fJ}))),d5.addAttribute("data-idd-plot","markers",d5.createDiv()))),d5.addText(d6.getXYDataDom(fB.BarCenters,fB.BarHeights),fN)):d5.addAttribute("data-idd-name",fB.Name,(fN=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(new B({$:1,$0:function(fO){return fO("shape: bars");}(a.id),$1:fJ}))),d5.addAttribute("data-idd-plot","markers",d5.createDiv()))),d5.addText(d6.getXYDataDom(fB.BarCenters,fB.BarHeights),fN)));};d6.histogramToDiv=function(fB){var fC;return d6.barchartToDiv((fC=fi.buildHistogram(fB.Samples,fB.BinCount),e$.New(fB.Name,U.ofList(fC.BinCentres),U.ofSeq(bc.map(a.id,fC.BinCounters)),fC.BinWidth,fB.Colour,fB.Colour,fk.WithoutShadow)));};d6.heatmapToDiv=function(fB){var fC,fD,fE,fF,fG,fH,fI;fC=A.ofArray([(function(fJ){return function(fK){return fJ("opacity: "+fK.toFixed(6));};}(a.id))(fB.Opacity)]);return dk.IsNullOrEmpty(fB.Name)?(fD=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq((fE=fB.Palette,fE.$==1?fC:new B({$:1,$0:(function(fJ){return function(fK){return fJ("colorPalette: "+_2.toSafe(fK));};}(a.id))(fE.$0),$1:fC})))),d5.addAttribute("data-idd-plot","heatmap",d5.createDiv()))),d5.addText((fF=fB.Data,(fG=fF.length,(fH=fF.length?fF[0].length:0,(fI=U.ofSeq(bc.delay(function(){return bc.collect(function(fJ){return bc.map(function(fK){return U.get2D(fF,fJ,fK);},F.range(0,fH-1));},F.range(0,fG-1));})),(((((fu.Curried(function(fJ,fK,fL,fM,fN){return fJ("x float64.1D "+_2.toSafe(fK)+"\\ny float64.1D "+_2.toSafe(fL)+"\\nvalues float64.2D "+fA(fM)+" "+_2.toSafe(fN));},5))(a.id))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fB.X)).buffer)).reduce(function(fJ,fK){return fJ+fA.fromCharCode(fK);},""))))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fB.Y)).buffer)).reduce(function(fJ,fK){return fJ+fA.fromCharCode(fK);},""))))(fH))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fI)).buffer)).reduce(function(fJ,fK){return fJ+fA.fromCharCode(fK);},""))))))),fD)):d5.addAttribute("data-idd-name",fB.Name,(fD=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq((fE=fB.Palette,fE.$==1?fC:new B({$:1,$0:(function(fJ){return function(fK){return fJ("colorPalette: "+_2.toSafe(fK));};}(a.id))(fE.$0),$1:fC})))),d5.addAttribute("data-idd-plot","heatmap",d5.createDiv()))),d5.addText((fF=fB.Data,(fG=fF.length,(fH=fF.length?fF[0].length:0,(fI=U.ofSeq(bc.delay(function(){return bc.collect(function(fJ){return bc.map(function(fK){return U.get2D(fF,fJ,fK);},F.range(0,fH-1));},F.range(0,fG-1));})),(((((fu.Curried(function(fJ,fK,fL,fM,fN){return fJ("x float64.1D "+_2.toSafe(fK)+"\\ny float64.1D "+_2.toSafe(fL)+"\\nvalues float64.2D "+fA(fM)+" "+_2.toSafe(fN));},5))(a.id))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fB.X)).buffer)).reduce(function(fJ,fK){return fJ+fA.fromCharCode(fK);},""))))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fB.Y)).buffer)).reduce(function(fJ,fK){return fJ+fA.fromCharCode(fK);},""))))(fH))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fI)).buffer)).reduce(function(fJ,fK){return fJ+fA.fromCharCode(fK);},""))))))),fD)));};d6.polylineToDiv=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ;fC=A.ofArray([(function(fK){return function(fL){return fK("thickness: "+fL.toFixed(1));};}(a.id))(fB.Thickness)]);fD=(fE=fB.Colour,fE.$==0?fC:(fF=fE.$0,new B({$:1,$0:((((fu.Curried(function(fK,fL,fM,fN){return fK("stroke: rgb("+fA(fL)+","+fA(fM)+","+fA(fN)+")");},4))(a.id))(fF.R))(fF.G))(fF.B),$1:fC})));fG=new B({$:1,$0:(function(fK){return function(fL){return fK("lineJoin: "+_2.toSafe(fL));};}(a.id))((fH=fB.LineJoin,fH.$==0?"bevel":fH.$==1?"round":"miter")),$1:fD});return dk.IsNullOrEmpty(fB.Name)?(fI=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(new B({$:1,$0:(function(fK){return function(fL){return fK("lineCap: "+_2.toSafe(fL));};}(a.id))((fJ=fB.LineCap,fJ.$==1?"round":fJ.$==2?"square":"butt")),$1:fG}))),d5.addAttribute("data-idd-plot","polyline",d5.createDiv()))),d5.addText(d6.getXYDataDom(fB.X,fB.Y),fI)):d5.addAttribute("data-idd-name",fB.Name,(fI=d5.addAttribute("data-idd-datasource","InteractiveDataDisplay.readBase64",d5.addAttribute("data-idd-style",dk.Join("; ",U.ofSeq(new B({$:1,$0:(function(fK){return function(fL){return fK("lineCap: "+_2.toSafe(fL));};}(a.id))((fJ=fB.LineCap,fJ.$==1?"round":fJ.$==2?"square":"butt")),$1:fG}))),d5.addAttribute("data-idd-plot","polyline",d5.createDiv()))),d5.addText(d6.getXYDataDom(fB.X,fB.Y),fI)));};d6.getXYDataDom=function(fB,fC){return(((fu.Curried3(function(fD,fE,fF){return fD("x float64.1D "+_2.toSafe(fE)+"\\ny float64.1D "+_2.toSafe(fF));}))(a.id))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fB)).buffer)).reduce(function(fD,fE){return fD+fA.fromCharCode(fE);},""))))(a.btoa((new a.Uint8Array(fz.from(U.ofSeq(fC)).buffer)).reduce(function(fD,fE){return fD+fA.fromCharCode(fE);},"")));};d7.setTitle=function(fB,fC){return eM.New(fB===null?null:{$:1,$0:fB},fC.Charts,fC.PlotWidth,fC.PlotHeight,fC.RowsCount,fC.ColumnsCount,fC.ExternalLegendSource,fC.Margin,fC.CommonVisibility,fC.SyncHorizontalAxes,fC.SyncVerticalAxes);};d7.createSubplots=function(fB,fC,fD){var fE,fF;fE=F.range(0,fC-1);fF=bc.concat(bc.map(function(fG){return bc.map(function(fH){return[fG,fH];},fE);},F.range(0,fB-1)));return eM.New(null,bc.fold(function(fG,fH){return fG.Add(fH,fD(fH[0],fH[1]));},new y.New([]),fF),300,200,fB,fC,null,{$:1,$0:20},true,null,null);};d7.setSubplotSize=function(fB,fC,fD){return eM.New(fD.Title,fD.Charts,fB,fC,fD.RowsCount,fD.ColumnsCount,fD.ExternalLegendSource,fD.Margin,fD.CommonVisibility,fD.SyncHorizontalAxes,fD.SyncVerticalAxes);};d7.subplotsToHtmlStructure=function(fB){var fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO;fC=d7.slotGridToHtmlStructure(fB.PlotWidth,fB.PlotHeight,d7.subplotsToSlotGrid(fB));fD=d5.addAttribute("class","idd-subplots",d5.createDiv());fE=(fF=fB.Title,fF==null?fD:d5.addDiv(d5.addAttribute("class","idd-subplots-title",d5.addText(fF.$0,d5.createDiv())),fD));fG=d5.addAttribute("class","idd-subplots-legendholder",d5.createDiv());fH=(fI=d5.addTable(fC,(fJ=fB.ExternalLegendSource,fJ==null?fG:d5.addAttribute("data-idd-ext-legend",((((fu.Curried(function(fP,fQ,fR,fS){return fP(_2.toSafe(fQ)+" "+fA(fR)+" "+fA(fS));},4))(a.id))(d6.placementToStr(fJ.$0[2])))(fJ.$0[0]))(fJ.$0[1]),fG))),d5.addAttribute("data-idd-common-visibility",(function(fP){return function(fQ){return fP(fA(fQ));};}(a.id))(fB.CommonVisibility),fI));fK=(fL=fB.Margin,fL==null?fH:d5.addAttribute("data-idd-style",(function(fP){return function(fQ){return fP("subplots-margin: "+fA(fQ)+"px; ");};}(a.id))(fL.$0),fH));fM=(fN=fB.SyncHorizontalAxes,fN==null?fK:d5.addAttribute("data-idd-horizontal-binding",(function(fP){return function(fQ){return fP(fA(fQ));};}(a.id))(fN.$0),fK));return{$:1,$0:d5.addDiv((fO=fB.SyncVerticalAxes,fO==null?fM:d5.addAttribute("data-idd-vertical-binding",(function(fP){return function(fQ){return fP(fA(fQ));};}(a.id))(fO.$0),fM)),fE)};};d7.slotGridToHtmlStructure=function(fB,fC,fD){var fE,fF;fE=fD.length;fF=fD.length?fD[0].length:0;return{$:0,$0:A.ofSeq(bc.rev(bc.map(function(fG){return{$:0,$0:A.ofSeq(bc.rev(bc.map(function(fH){return{$:0,$0:d7.slotToHtmlStructure(fB,fC,U.get2D(fD,fG,fH))};},F.range(0,fF-1))))};},F.range(0,fE-1))))};};d7.subplotsToSlotGrid=function(fB){var fC,fD,fE,fF,fG,fH;fC=fB.RowsCount;fD=fB.ColumnsCount;fE=(fF=fD*3,(fG=fh.Empty,(fH=U.init(fC*3,function(){return U.create(fF,fG);}),(fH.dims=2,fH))));bc.iter(function(fI){bc.iter(function(fJ){var fK,fL;fK=fB.Charts.get_Item([fI,fJ]);fK==null?void 0:(fL=fK.$0,U.set2D(fE,fI*3+1,fJ*3+1,{$:0,$0:d7.chartToBareChart(fL)}),fL.Title!==null?U.set2D(fE,fI*3,fJ*3+1,{$:2,$0:fL.Title}):void 0,U.set2D(fE,fI*3+1,fJ*3,{$:1,$0:fL.Yaxis,$1:eL.Left,$2:fL.Ylabel}),U.set2D(fE,fI*3+2,fJ*3+1,{$:1,$0:fL.Xaxis,$1:eL.Bottom,$2:fL.Xlabel}));},F.range(0,fD-1));},F.range(0,fC-1));return fE;};d7.slotToHtmlStructure=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN;function fO(fQ){var fR,fS,fT;return fE!==null?d5.addDiv(fF.$==3||(fF.$==1?false:fF.$!=0)?(fS=d6.vertAxisLabelToHtmlStructue(fE,fF),d5.addAttribute("style",(function(fU){return function(fV){return fU("height: "+fA(fV)+"px; position: relative;");};}(a.id))(fC),fS)):(fT=d6.horAxisLabelToHtmlStructure(fE,fF),d5.addAttribute("style",(function(fU){return function(fV){return fU("width: "+fA(fV)+"px;");};}(a.id))(fB),fT)),fQ):fQ;}function fP(fQ){var fR,fS,fT;fR=d6.axisToHtmlStructure(fG,fF);return fR==null?fQ:(fS=fR.$0[0],d5.addDiv(fF.$==3?d5.addAttribute("class","idd-subplots-slot-right",fF.$==3||(fF.$==1?false:fF.$!=0)?d5.addAttribute("style",(function(fU){return function(fV){return fU("height: "+fA(fV)+"px;");};}(a.id))(fC),fS):d5.addAttribute("style",(function(fU){return function(fV){return fU("width: "+fA(fV)+"px;");};}(a.id))(fB),fS)):fF.$==1?d5.addAttribute("class","idd-subplots-slot-top",fF.$==3||(fF.$==1?false:fF.$!=0)?d5.addAttribute("style",(function(fU){return function(fV){return fU("height: "+fA(fV)+"px;");};}(a.id))(fC),fS):d5.addAttribute("style",(function(fU){return function(fV){return fU("width: "+fA(fV)+"px;");};}(a.id))(fB),fS)):fF.$==0?d5.addAttribute("class","idd-subplots-slot-bottom",fF.$==3||(fF.$==1?false:fF.$!=0)?d5.addAttribute("style",(function(fU){return function(fV){return fU("height: "+fA(fV)+"px;");};}(a.id))(fC),fS):d5.addAttribute("style",(function(fU){return function(fV){return fU("width: "+fA(fV)+"px;");};}(a.id))(fB),fS)):d5.addAttribute("class","idd-subplots-slot-left",fF.$==3||(fF.$==1?false:fF.$!=0)?d5.addAttribute("style",(function(fU){return function(fV){return fU("height: "+fA(fV)+"px;");};}(a.id))(fC),fS):d5.addAttribute("style",(function(fU){return function(fV){return fU("width: "+fA(fV)+"px;");};}(a.id))(fB),fS)),fQ));}return fD.$==1?(fE=fD.$2,(fF=fD.$1,(fG=fD.$0,(fH=d5.createDiv(),{$:1,$0:fF.$==2?d5.addAttribute("class","idd-subplots-margin-left",fP(fO(d5.addAttribute("style",(function(fQ){return function(fR){return fQ("height: "+fA(fR)+"px; display: flex; justify-content: flex-end;");};}(a.id))(fC),fH)))):fF.$==0?d5.addAttribute("class","idd-subplots-margin-bottom",fO(fP(d5.addAttribute("style",(function(fQ){return function(fR){return fQ("width: "+fA(fR)+"px; display: flex; flex-direction: column; justify-content: flex-start; margin-left: auto; margin-right: auto;");};}(a.id))(fB),fH)))):F.FailWith("Not supported exception")})))):fD.$==0?(fI=fD.$0,(fJ=d6.addVisibleRegionInfo(fI.VisibleRegion,(new y.New([])).Add("data-idd-plot","plot").Add("class","idd-subplot").Add("style",(((fu.Curried3(function(fQ,fR,fS){return fQ("height: "+fA(fR)+"px; width: "+fA(fS)+"px;");}))(a.id))(fC))(fB)),new y.New([])),(fK=bc.fold(function(fQ,fR){return d5.addDiv(d6.plotToDiv(fR),fQ);},d6.gridLinesToHtmlStructure(fI.GridLines,null,null,d5.addDiv(d5.addAttribute("data-idd-plot","subplots-trap",d5.createDiv()),d5.createDiv())),fI.Plots),(fL=fJ[1].Add("isLegendVisible",d6.getEffectiveLegendvisibility(fI.IsLegendEnabled,fI.Plots)?"true":"false"),(fM=fJ[0].Add("data-idd-navigation-enabled",fI.IsNavigationEnabled?"true":"false"),(fN=d6.createStyleAttributes(fL),{$:1,$0:d6.addAttributes(fM.Add(fN[0],fN[1]),fK)})))))):fD.$==2?{$:1,$0:d5.addAttribute("class","idd-subplot-title",d5.addText(fD.$0,d5.createDiv()))}:e8.Empty;};d7.chartToBareChart=function(fB){return fp.New(fB.GridLines,fB.Plots,fB.IsLegendEnabled,fB.IsNavigationEnabled,fB.IsTooltipPlotCoordsEnabled,fB.VisibleRegion);};d8.Empty=function(){eN.$cctor();return eN.Empty;};d8.addPolyline=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fC.Xlabel,fC.Xaxis,fC.Ylabel,fC.Yaxis,fC.GridLines,new B({$:1,$0:{$:0,$0:fB},$1:fC.Plots}),fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.addMarkers=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fC.Xlabel,fC.Xaxis,fC.Ylabel,fC.Yaxis,fC.GridLines,new B({$:1,$0:{$:1,$0:fB},$1:fC.Plots}),fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.setXlabel=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fB,fC.Xaxis,fC.Ylabel,fC.Yaxis,fC.GridLines,fC.Plots,fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.setYlabel=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fC.Xlabel,fC.Xaxis,fB,fC.Yaxis,fC.GridLines,fC.Plots,fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.setTitle=function(fB,fC){return d_.New(fC.Width,fC.Height,fB,fC.Xlabel,fC.Xaxis,fC.Ylabel,fC.Yaxis,fC.GridLines,fC.Plots,fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.setVisibleRegion=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fC.Xlabel,fC.Xaxis,fC.Ylabel,fC.Yaxis,fC.GridLines,fC.Plots,fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fB,fC.TooltipDelay);};d8.addHeatmap=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fC.Xlabel,fC.Xaxis,fC.Ylabel,fC.Yaxis,fC.GridLines,new B({$:1,$0:{$:4,$0:fB},$1:fC.Plots}),fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.createLabelledAxis=function(fB,fC){return{$:2,$0:eP.New(fB,fC,0,false)};};d8.createTiltedLabelledAxis=function(fB,fC,fD){return{$:2,$0:eP.New(fB,fC,fD,false)};};d8.setXaxis=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fC.Xlabel,fB,fC.Ylabel,fC.Yaxis,fC.GridLines,fC.Plots,fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.setLabelsVisibility=function(fB,fC){var fD;return fC.$==2?(fD=fC.$0,{$:2,$0:eP.New(fD.Ticks,fD.Labels,fD.Angle,fB)}):F.FailWith("Force labels visibility can be set only on a labelled axis");};d8.addHistogram=function(fB,fC){return d_.New(fC.Width,fC.Height,fC.Title,fC.Xlabel,fC.Xaxis,fC.Ylabel,fC.Yaxis,fC.GridLines,new B({$:1,$0:{$:3,$0:fB},$1:fC.Plots}),fC.IsLegendEnabled,fC.IsNavigationEnabled,fC.IsTooltipPlotCoordsEnabled,fC.VisibleRegion,fC.TooltipDelay);};d8.DefaultGridLines=function(){eN.$cctor();return eN.DefaultGridLines;};d9.Grey=function(){eO.$cctor();return eO.Grey;};d9.Black=function(){eO.$cctor();return eO.Black;};d9.parse=function(fB){var fC,fD,fE,fF,fG,fH,fI;function fJ(fK){var fL,fM;try{return{$:1,$0:a.parseInt(fK,16)&255};}catch(fN){if(fN instanceof eq||(fN instanceof fa||fN instanceof fb))fL=null;else throw fN;return fL;}}return(fD=fB.length===7&&fB[0]==="#"?(fE=fJ(dk.Substring(fB,1,2)),(fF=fJ(dk.Substring(fB,3,2)),(fG=fJ(dk.Substring(fB,5,2)),fE!=null&&fE.$==1&&(fF!=null&&fF.$==1&&(fG!=null&&fG.$==1&&(fH=[fG.$0,fF.$0,fE.$0],true)))?{$:1,$0:{$:1,$0:e9.New(fH[2],fH[1],fH[0])}}:null))):null,fD!=null&&fD.$==1?(fC=fD.$0,true):(fI=K.TryFind(fB,d9.namesToColours()),fI!=null&&fI.$==1&&(fC=fI.$0,true)))?{$:1,$0:fC}:null;};d9.Gray=function(){eO.$cctor();return eO.Gray;};d9.DarkGrey=function(){eO.$cctor();return eO.DarkGrey;};d9.namesToColours=function(){eO.$cctor();return eO.namesToColours;};d9.createColour=function(fB,fC,fD){return{$:1,$0:e9.New(fB,fC,fD)};};d_.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO){return{Width:fB,Height:fC,Title:fD,Xlabel:fE,Xaxis:fF,Ylabel:fG,Yaxis:fH,GridLines:fI,Plots:fJ,IsLegendEnabled:fK,IsNavigationEnabled:fL,IsTooltipPlotCoordsEnabled:fM,VisibleRegion:fN,TooltipDelay:fO};};d$.Visible={$:0};d$.Automatic={$:1};eb.createHeatmap=function(fB,fC,fD){return eQ.New(null,fB,fC,fD,eR.Default,1);};eb.setPalette=function(fB,fC){return eQ.New(fC.Name,fC.X,fC.Y,fC.Data,fB,fC.Opacity);};eb.setName=function(fB,fC){return eQ.New(fB,fC.X,fC.Y,fC.Data,fC.Palette,fC.Opacity);};ec.init=function(fB,fC,fD){var fE,fF,fG,fH,fI;fE=U.zeroCreate2D(fB,fC);for(fF=0,fG=fB-1;fF<=fG;fF++){for(fH=0,fI=fC-1;fH<=fI;fH++)U.set2D(fE,fF,fH,fD(fF,fH));}return fE;};ed.createMarkers=function(fB,fC){return eS.New(null,fB,fC,10,eT.Default,eT.Default,ee.Box);};ed.setShape=function(fB,fC){return eS.New(fC.Name,fC.X,fC.Y,fC.Size,fC.FillColour,fC.BorderColour,fB);};ed.setFillColour=function(fB,fC){return eS.New(fC.Name,fC.X,fC.Y,fC.Size,fB,fC.BorderColour,fC.Shape);};ed.setSize=function(fB,fC){return eS.New(fC.Name,fC.X,fC.Y,fB,fC.FillColour,fC.BorderColour,fC.Shape);};ee.Circle={$:1};ee.Box={$:0};ef.createPolyline=function(fB,fC){return eU.New(null,fB,fC,eT.Default,1,eV.Butt,eW.Miter);};ef.setThickness=function(fB,fC){return eU.New(fC.Name,fC.X,fC.Y,fC.Colour,fB,fC.LineCap,fC.LineJoin);};ef.setStrokeColour=function(fB,fC){return eU.New(fC.Name,fC.X,fC.Y,fB,fC.Thickness,fC.LineCap,fC.LineJoin);};eg.createHistogram=function(fB){return eX.New(null,fB,eT.Default,30);};eg.setBinCount=function(fB,fC){return eX.New(fC.Name,fC.Samples,fC.Colour,fB);};eh.empty=function(){return eh.New([],new bd.New$5());};eh.add=function(fB,fC){var fD;fD=U.length(fB.to_species);fB.to_species.push(fC);fB.from_species.Add(fC,fD);return fD;};eh.index=function(fB,fC){return fB.from_species.ContainsKey(fC)?fB.from_species.get_Item(fC):eh.add(fB,fC);};eh.New=function(fB,fC){return{to_species:fB,from_species:fC};};ei.New=function(fB,fC,fD){return{init:fB,react_st:fC,index:fD};};ej.kwList=function(){eZ.$cctor();return eZ.kwList;};ek.add_multiples=function(fB,fC,fD){return A.unzip(A.map(function(fE){return fE.add_multiples(fB,fC);},fD));};ek.eval_label=function(fB,fC){return fC.$===0?A.ofArray([["","",di.empty(),""]]):A.collect(function(fD){var fE;fE=fD.simplify_assignments().eval_label(fB);return A.map2(function(fF,fG){return(function(fH){var fI,fJ;fI=fH[0];fJ=fH[1];return function(fK){return[fD.name,fI,fJ,fK[0]];};}(fF))(fG);},fD.eval_label(fB),fE);},fC);};ek.get_variables=function(fB){return db.remove_duplicates(function(fC,fD){return fC===fD;},A.collect(function(fC){return fC.get_variables();},fB));};ek.get_variable_dependencies=function(fB){return A.collect(function(fC){return A.map(function(fD){return A.choose(function(fE){return fE.$==0?{$:1,$0:fE.$0}:null;},fD);},fC.values);},A.map(function(fC){return fC.get_merge();},fB));};ek["eval"]=function(fB,fC){return fC.$===0?A.ofArray([["",di.empty()]]):A.collect(function(fD){return A.map(function(fE){return[fD.name,fE];},fD["eval"](fB));},fC);};el.New=function(fB,fC,fD){return{path_class:fB,commands:fC,path_label:fD};};em.New=function(fB,fC,fD,fE,fF){return{label_text:fB,label_anchor:fC,label_class:fD,letter_width:fE,label_dir:fF};};en.$cctor=function(){var fB;en.$cctor=a.ignore;function fC(fD){return" transform=\\"translate("+fD+")\\"";}en.pi=3.14159265359;en.origo=cD.New(0,0);en.pointradius=1.25;en.default_letter_width=8;en.fontsize=15;en.text_height=S.fontsize()+2;en.half_text_height=S.text_height()/2;en.translate_anchor_by=function(fD){function fE(fF){return S.translate_point_by(fD,fF);}return function(fF){return S.transform_anchor_by(fE,fF);};};en.translate_path_command_by=function(fD){function fE(fF){return S.translate_point_by(fD,fF);}return function(fF){return S.transform_path_command_by(fE,fF);};};en.translate_label_by=function(fD){function fE(fF){return S.translate_point_by(fD,fF);}return function(fF){return S.transform_label_by(fE,fF);};};en.translate_path_by=function(fD){function fE(fF){return S.translate_point_by(fD,fF);}return function(fF){return S.transform_path_by(fE,fF);};};en.translate_to_string=(fB=function(fD){return fC(S.point_to_string(fD));},function(fD){return S.on_option(fB,"",fD);});en.translate_group_by=function(fD){function fE(fF){return S.translate_point_by(fD,fF);}return function(fF){return S.transform_group_by(fE,fF);};};};cV.ode_solver_error=function(fB){throw new cX.New("ODE error: "+fB);};cV.negative_simulation=function(){throw new cX.New("Cannot evaluate a proportional-error noise model for non-positive simulation values.");};eo.Absent={$:0};ep.New=function(fB,fC,fD,fE,fF){return{x:fB,dt:fC,prevDt:fD,e:fE,k:fF};};eq=v.ArgumentException=fu.Class({},G,eq);eq.New$2=fu.Ctor(function(fB){this.message=fB;cG.setPrototypeOf(this,eq.prototype);},eq);es=er.SparseVector=fu.Class({get_Indices:function(){return this.indices;},get_Items:function(){return this.items;},get_Length:function(){return this.n;},minus:function(fB){function fC(fD,fE){return fD-fE;}return this.binary(function(fD){return function(fE){return fC(fD,fE);};},fB);},get_Count:function(){return this.count;},set_Item:function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP;if(fB<0||fB>=this.n)F.FailWith("index is out of range");else{fF=(fD=U.tryFindIndex(function(fQ){return fQ===fB;},c2.array(this.indices,{$:1,$0:0},{$:1,$0:this.count-1})),fD==null?U.forall(function(fQ){return fQ<fB;},c2.array(this.indices,{$:1,$0:0},{$:1,$0:this.count-1}))?~this.count:(fE=U.tryFindIndex(function(fQ){return fQ>fB;},c2.array(this.indices,{$:1,$0:0},{$:1,$0:this.count-1})),fE==null?-1:~fE.$0):fD.$0);if(fF>=0)U.set(this.items,fF,fC);else{fG=~fF;if(this.count>=U.length(this.items)){fH=fv.min(16,this.n-U.length(this.items));fI=U.create(this.indices.length+fH,0);fJ=U.create(this.items.length+fH,0);for(fK=0,fL=this.indices.length-1;fK<=fL;fK++)U.set(fI,fK,U.get(this.indices,fK));for(fM=0,fN=this.items.length-1;fM<=fN;fM++)U.set(fJ,fM,U.get(this.items,fM));this.items=fJ;this.indices=fI;for(fO=0,fP=this.count-fG-1;fO<=fP;fO++){U.set(this.indices,this.count-fO,U.get(this.indices,this.count-fO-1));U.set(this.items,this.count-fO,U.get(this.items,this.count-fO-1));}this.count=this.count+1;U.set(this.indices,fG,fB);U.set(this.items,fG,fC);}else void 0;}}},binary:function(fB,fC){var fD,fE,fF;function fG(fH,fI,fJ){var fK;fK=U.unzip(U.ofList(A.rev(fJ)));return new es.New$1(fK[1].concat(c2.array(fH.get_Items(),{$:1,$0:fI},{$:1,$0:fH.get_Count()-1})),fK[0].concat(c2.array(fH.get_Indices(),{$:1,$0:fI},{$:1,$0:fH.get_Count()-1})),fH.get_Length());}fD=this;!(this.get_Length()===fC.get_Length())?F.FailWith("Minus requires two vectors of the same length"):void 0;fE=this.get_Count();fF=fC.get_Count();return fE===0?new es.New$1(U.map(fB(0),fC.get_Items()),fC.get_Indices(),fC.get_Length()):fF===0?this:function(fH,fI,fJ){var fK,fL,fM,fN,fO,fP;while(true){fK=U.get(fD.get_Indices(),fH);fL=U.get(fC.get_Indices(),fI);fM=fK-fL;if(fM<0){fN=new B({$:1,$0:[fK,(fB(U.get(fD.get_Items(),fK)))(0)],$1:fJ});if(fH<fD.get_Count()-1){fH=fH+1;fJ=fN;}else return fG(fC,fI,fN);}else if(fM>0){fO=new B({$:1,$0:[fL,(fB(0))(U.get(fC.get_Items(),fL))],$1:fJ});if(fI<fC.get_Count()-1){fI=fI+1;fJ=fO;}else return fG(fD,fH,fO);}else if(fM===0){fP=new B({$:1,$0:[fK,(fB(U.get(fD.get_Items(),fH)))(U.get(fC.get_Items(),fI))],$1:fJ});if(fH<fD.get_Count()-1&&fI<fC.get_Count()-1){fH=fH+1;fI=fI+1;fJ=fP;}else return fH<fD.get_Count()-1?fG(fD,fH+1,fP):fG(fC,fI+1,fP);}else throw new fr.New("..\\\\Oslo.FSharp\\\\SparseVector.fs",97,16);}}(0,0,B.Empty);}},w,es);es.New$1=fu.Ctor(function(fB,fC,fD){w.New.call(this);this.n=fD;this.items=bk.Equals(fB,null)?F.FailWith("argument is null"):fB;this.indices=bk.Equals(fC,null)?F.FailWith("argument is null"):fC;this.count=U.sumBy(function(fE){return fE*fE;},this.items)===0?0:this.items.length;},es);bc.enumWhile=function(fB,fC){return{GetEnumerator:function(){return new dc.New(null,null,function(fD){var fE;while(true){fE=fD.s;if(bk.Equals(fE,null)){if(fB()){fD.s=da.Get(fC);fD=fD;}else return false;}else if(fE.MoveNext()){fD.c=fE.Current();return true;}else{fE.Dispose();fD.s=null;fD=fD;}}},function(fD){var fE;fE=fD.s;!bk.Equals(fE,null)?fE.Dispose():void 0;});}};};bc.enumUsing=function(fB,fC){return{GetEnumerator:function(){var fD,fE;try{fD=da.Get(fC(fB));}catch(fF){fE=fB;fE.Dispose();throw fF;}return new dc.New(null,null,function(fG){return fD.MoveNext()&&(fG.c=fD.Current(),true);},function(){var fG;fD.Dispose();fG=fB;fG.Dispose();});}};};cd.distance_from_xy=function(fB,fC,fD,fE){return fv.sqrt(fv.pow(fD-fB,2)+fv.pow(fE-fC,2));};cd.defaults=function(){e3.$cctor();return e3.defaults;};cd.to_string=function(fB){var fC;return"{ "+dk.concat("; ",A.filter(function(fD){return fD!=="";},A.ofArray([fB.random!==cd.defaults().random?(function(fD){return function(fE){return fD("random = "+dk.PadLeft(fE.toFixed(3),1));};}(a.id))(fB.random):"",(fC=fB.core,fC!=null&&fC.$==1?fC.$0.to_string():""),!bk.Equals(fB.points,cd.defaults().points)?"points = ["+dk.concat("; ",A.map(function(fD){return fD.to_string();},fB.points))+"]":"",!bk.Equals(fB.rectangles,cd.defaults().rectangles)?"rectangles = ["+dk.concat("; ",A.map(function(fD){return fD.to_string();},fB.rectangles))+"]":""])))+" }";};cd.default_rectangle=function(){e3.$cctor();return e3.default_rectangle;};cd.default_point=function(){e3.$cctor();return e3.default_point;};cd.default_core=function(){e3.$cctor();return e3.default_core;};cd.parser=function(){e3.$cctor();return e3.parser;};et=D.ParserBuilder=fu.Class({},w,et);et.New=fu.Ctor(function(){w.New.call(this);},et);eu.$cctor=function(){eu.$cctor=a.ignore;eu.empty=B.Empty;};ev.New=function(fB,fC,fD){return{id:fB,name:fC,listOfUnits:fD};};ew.New=function(fB,fC,fD,fE,fF,fG,fH,fI){return{id:fB,name:fC,compartmentType:fD,spatialDimensions:fE,size:fF,units:fG,outside:fH,constant:fI};};ex.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL){return{id:fB,name:fC,speciesType:fD,compartment:fE,initialAmount:fF,initialConcentration:fG,substanceUnits:fH,hasOnlySubstanceUnits:fI,boundaryCondition:fJ,charge:fK,constant:fL};};ey.New=function(fB,fC,fD,fE,fF){return{id:fB,name:fC,value:fD,units:fE,constant:fF};};ez.New=function(fB,fC){return{symbol:fB,math:fC};};eA.New=function(fB,fC,fD,fE,fF,fG,fH){return{id:fB,name:fC,reversible:fD,fast:fE,listOfReactants:fF,listOfProducts:fG,kineticLaw:fH};};eB.New=function(fB,fC,fD,fE,fF){return{kind:fB,exponent:fC,scale:fD,multiplier:fE,offset:fF};};eC.New=function(fB,fC,fD,fE){return{id:fB,name:fC,species:fD,stoichiometry:fE};};eD.New=function(fB,fC){return{math:fB,listOfParameters:fC};};eE.Abs={$:2};eE.Ceiling={$:32};eE.Floor={$:5};eF.New=function(fB,fC,fD,fE,fF){return{name:fB,mle:fC,summary:fD,qsummary:fE,range:fF};};eG.New=function(fB,fC,fD,fE,fF){return{count:fB,min:fC,max:fD,mean:fE,variance:fF};};eH.New=function(fB,fC,fD,fE,fF,fG,fH){return{min:fB,lb95:fC,lb68:fD,median:fE,ub68:fF,ub95:fG,max:fH};};eI.New=function(fB,fC,fD){return{AIC:fB,BIC:fC,DIC:fD};};eJ.New=function(fB,fC){return{Attributes:fB,Children:fC};};eK.New=function(fB,fC){return{Key:fB,Value:fC};};eL.Left={$:2};eL.Bottom={$:0};eM.New=function(fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL){return{Title:fB,Charts:fC,PlotWidth:fD,PlotHeight:fE,RowsCount:fF,ColumnsCount:fG,ExternalLegendSource:fH,Margin:fI,CommonVisibility:fJ,SyncHorizontalAxes:fK,SyncVerticalAxes:fL};};eN.$cctor=function(){eN.$cctor=a.ignore;eN.DefaultGridLines={$:1,$0:d9.DarkGrey(),$1:1};eN.Empty=d_.New(800,600,null,null,{$:1,$0:true},null,{$:1,$0:true},d8.DefaultGridLines(),B.Empty,d$.Automatic,true,true,{$:0,$0:20},null);};eO.$cctor=function(){eO.$cctor=a.ignore;eO.namesToColours=(new y.New([])).Add("AliceBlue",d9.createColour(240&255,248&255,255&255)).Add("AntiqueWhite",d9.createColour(250&255,235&255,215&255)).Add("Aqua",d9.createColour(0&255,255&255,255&255)).Add("Aquamarine",d9.createColour(127&255,255&255,212&255)).Add("Azure",d9.createColour(240&255,255&255,255&255)).Add("Beige",d9.createColour(245&255,245&255,220&255)).Add("Bisque",d9.createColour(255&255,228&255,196&255)).Add("Black",d9.createColour(0&255,0&255,0&255)).Add("BlanchedAlmond",d9.createColour(255&255,235&255,205&255)).Add("Blue",d9.createColour(0&255,0&255,255&255)).Add("BlueViolet",d9.createColour(138&255,43&255,226&255)).Add("Brown",d9.createColour(165&255,42&255,42&255)).Add("BurlyWood",d9.createColour(222&255,184&255,135&255)).Add("CadetBlue",d9.createColour(95&255,158&255,160&255)).Add("Chartreuse",d9.createColour(127&255,255&255,0&255)).Add("Chocolate",d9.createColour(210&255,105&255,30&255)).Add("Coral",d9.createColour(255&255,127&255,80&255)).Add("CornflowerBlue",d9.createColour(100&255,149&255,237&255)).Add("Cornsilk",d9.createColour(255&255,248&255,220&255)).Add("Crimson",d9.createColour(220&255,20&255,60&255)).Add("Cyan",d9.createColour(0&255,255&255,255&255)).Add("DarkBlue",d9.createColour(0&255,0&255,139&255)).Add("DarkCyan",d9.createColour(0&255,139&255,139&255)).Add("DarkGoldenRod",d9.createColour(184&255,134&255,11&255)).Add("DarkGray",d9.createColour(169&255,169&255,169&255)).Add("DarkGrey",d9.createColour(169&255,169&255,169&255)).Add("DarkGreen",d9.createColour(0&255,100&255,0&255)).Add("DarkKhaki",d9.createColour(189&255,183&255,107&255)).Add("DarkMagenta",d9.createColour(139&255,0&255,139&255)).Add("DarkOliveGreen",d9.createColour(85&255,107&255,47&255)).Add("DarkOrange",d9.createColour(255&255,140&255,0&255)).Add("DarkOrchid",d9.createColour(153&255,50&255,204&255)).Add("DarkRed",d9.createColour(139&255,0&255,0&255)).Add("DarkSalmon",d9.createColour(233&255,150&255,122&255)).Add("DarkSeaGreen",d9.createColour(143&255,188&255,143&255)).Add("DarkSlateBlue",d9.createColour(72&255,61&255,139&255)).Add("DarkSlateGray",d9.createColour(47&255,79&255,79&255)).Add("DarkSlateGrey",d9.createColour(47&255,79&255,79&255)).Add("DarkTurquoise",d9.createColour(0&255,206&255,209&255)).Add("DarkViolet",d9.createColour(148&255,0&255,211&255)).Add("DeepPink",d9.createColour(255&255,20&255,147&255)).Add("DeepSkyBlue",d9.createColour(0&255,191&255,255&255)).Add("DimGray",d9.createColour(105&255,105&255,105&255)).Add("DimGrey",d9.createColour(105&255,105&255,105&255)).Add("DodgerBlue",d9.createColour(30&255,144&255,255&255)).Add("FireBrick",d9.createColour(178&255,34&255,34&255)).Add("FloralWhite",d9.createColour(255&255,250&255,240&255)).Add("ForestGreen",d9.createColour(34&255,139&255,34&255)).Add("Fuchsia",d9.createColour(255&255,0&255,255&255)).Add("Gainsboro",d9.createColour(220&255,220&255,220&255)).Add("GhostWhite",d9.createColour(248&255,248&255,255&255)).Add("Gold",d9.createColour(255&255,215&255,0&255)).Add("GoldenRod",d9.createColour(218&255,165&255,32&255)).Add("Gray",d9.createColour(128&255,128&255,128&255)).Add("Grey",d9.createColour(128&255,128&255,128&255)).Add("Green",d9.createColour(0&255,128&255,0&255)).Add("GreenYellow",d9.createColour(173&255,255&255,47&255)).Add("HoneyDew",d9.createColour(240&255,255&255,240&255)).Add("HotPink",d9.createColour(255&255,105&255,180&255)).Add("IndianRed",d9.createColour(205&255,92&255,92&255)).Add("Indigo",d9.createColour(75&255,0&255,130&255)).Add("Ivory",d9.createColour(255&255,255&255,240&255)).Add("Khaki",d9.createColour(240&255,230&255,140&255)).Add("Lavender",d9.createColour(230&255,230&255,250&255)).Add("LavenderBlush",d9.createColour(255&255,240&255,245&255)).Add("LawnGreen",d9.createColour(124&255,252&255,0&255)).Add("LemonChiffon",d9.createColour(255&255,250&255,205&255)).Add("LightBlue",d9.createColour(173&255,216&255,230&255)).Add("LightCoral",d9.createColour(240&255,128&255,128&255)).Add("LightCyan",d9.createColour(224&255,255&255,255&255)).Add("LightGoldenRodYellow",d9.createColour(250&255,250&255,210&255)).Add("LightGray",d9.createColour(211&255,211&255,211&255)).Add("LightGrey",d9.createColour(211&255,211&255,211&255)).Add("LightGreen",d9.createColour(144&255,238&255,144&255)).Add("LightPink",d9.createColour(255&255,182&255,193&255)).Add("LightSalmon",d9.createColour(255&255,160&255,122&255)).Add("LightSeaGreen",d9.createColour(32&255,178&255,170&255)).Add("LightSkyBlue",d9.createColour(135&255,206&255,250&255)).Add("LightSlateGray",d9.createColour(119&255,136&255,153&255)).Add("LightSlateGrey",d9.createColour(119&255,136&255,153&255)).Add("LightSteelBlue",d9.createColour(176&255,196&255,222&255)).Add("LightYellow",d9.createColour(255&255,255&255,224&255)).Add("Lime",d9.createColour(0&255,255&255,0&255)).Add("LimeGreen",d9.createColour(50&255,205&255,50&255)).Add("Linen",d9.createColour(250&255,240&255,230&255)).Add("Magenta",d9.createColour(255&255,0&255,255&255)).Add("Maroon",d9.createColour(128&255,0&255,0&255)).Add("MediumAquaMarine",d9.createColour(102&255,205&255,170&255)).Add("MediumBlue",d9.createColour(0&255,0&255,205&255)).Add("MediumOrchid",d9.createColour(186&255,85&255,211&255)).Add("MediumPurple",d9.createColour(147&255,112&255,219&255)).Add("MediumSeaGreen",d9.createColour(60&255,179&255,113&255)).Add("MediumSlateBlue",d9.createColour(123&255,104&255,238&255)).Add("MediumSpringGreen",d9.createColour(0&255,250&255,154&255)).Add("MediumTurquoise",d9.createColour(72&255,209&255,204&255)).Add("MediumVioletRed",d9.createColour(199&255,21&255,133&255)).Add("MidnightBlue",d9.createColour(25&255,25&255,112&255)).Add("MintCream",d9.createColour(245&255,255&255,250&255)).Add("MistyRose",d9.createColour(255&255,228&255,225&255)).Add("Moccasin",d9.createColour(255&255,228&255,181&255)).Add("NavajoWhite",d9.createColour(255&255,222&255,173&255)).Add("Navy",d9.createColour(0&255,0&255,128&255)).Add("OldLace",d9.createColour(253&255,245&255,230&255)).Add("Olive",d9.createColour(128&255,128&255,0&255)).Add("OliveDrab",d9.createColour(107&255,142&255,35&255)).Add("Orange",d9.createColour(255&255,165&255,0&255)).Add("OrangeRed",d9.createColour(255&255,69&255,0&255)).Add("Orchid",d9.createColour(218&255,112&255,214&255)).Add("PaleGoldenRod",d9.createColour(238&255,232&255,170&255)).Add("PaleGreen",d9.createColour(152&255,251&255,152&255)).Add("PaleTurquoise",d9.createColour(175&255,238&255,238&255)).Add("PaleVioletRed",d9.createColour(219&255,112&255,147&255)).Add("PapayaWhip",d9.createColour(255&255,239&255,213&255)).Add("PeachPuff",d9.createColour(255&255,218&255,185&255)).Add("Peru",d9.createColour(205&255,133&255,63&255)).Add("Pink",d9.createColour(255&255,192&255,203&255)).Add("Plum",d9.createColour(221&255,160&255,221&255)).Add("PowderBlue",d9.createColour(176&255,224&255,230&255)).Add("Purple",d9.createColour(128&255,0&255,128&255)).Add("RebeccaPurple",d9.createColour(102&255,51&255,153&255)).Add("Red",d9.createColour(255&255,0&255,0&255)).Add("RosyBrown",d9.createColour(188&255,143&255,143&255)).Add("RoyalBlue",d9.createColour(65&255,105&255,225&255)).Add("SaddleBrown",d9.createColour(139&255,69&255,19&255)).Add("Salmon",d9.createColour(250&255,128&255,114&255)).Add("SandyBrown",d9.createColour(244&255,164&255,96&255)).Add("SeaGreen",d9.createColour(46&255,139&255,87&255)).Add("SeaShell",d9.createColour(255&255,245&255,238&255)).Add("Sienna",d9.createColour(160&255,82&255,45&255)).Add("Silver",d9.createColour(192&255,192&255,192&255)).Add("SkyBlue",d9.createColour(135&255,206&255,235&255)).Add("SlateBlue",d9.createColour(106&255,90&255,205&255)).Add("SlateGray",d9.createColour(112&255,128&255,144&255)).Add("SlateGrey",d9.createColour(112&255,128&255,144&255)).Add("Snow",d9.createColour(255&255,250&255,250&255)).Add("SpringGreen",d9.createColour(0&255,255&255,127&255)).Add("SteelBlue",d9.createColour(70&255,130&255,180&255)).Add("Tan",d9.createColour(210&255,180&255,140&255)).Add("Teal",d9.createColour(0&255,128&255,128&255)).Add("Thistle",d9.createColour(216&255,191&255,216&255)).Add("Tomato",d9.createColour(255&255,99&255,71&255)).Add("Turquoise",d9.createColour(64&255,224&255,208&255)).Add("Violet",d9.createColour(238&255,130&255,238&255)).Add("Wheat",d9.createColour(245&255,222&255,179&255)).Add("White",d9.createColour(255&255,255&255,255&255)).Add("WhiteSmoke",d9.createColour(245&255,245&255,245&255)).Add("Yellow",d9.createColour(255&255,255&255,0&255)).Add("YellowGreen",d9.createColour(154&255,205&255,50&255));eO.AliceBlue=d9.namesToColours().get_Item("AliceBlue");eO.AntiqueWhite=d9.namesToColours().get_Item("AntiqueWhite");eO.Aqua=d9.namesToColours().get_Item("Aqua");eO.Aquamarine=d9.namesToColours().get_Item("Aquamarine");eO.Azure=d9.namesToColours().get_Item("Azure");eO.Beige=d9.namesToColours().get_Item("Beige");eO.Bisque=d9.namesToColours().get_Item("Bisque");eO.Black=d9.namesToColours().get_Item("Black");eO.BlanchedAlmond=d9.namesToColours().get_Item("BlanchedAlmond");eO.Blue=d9.namesToColours().get_Item("Blue");eO.BlueViolet=d9.namesToColours().get_Item("BlueViolet");eO.Brown=d9.namesToColours().get_Item("Brown");eO.BurlyWood=d9.namesToColours().get_Item("BurlyWood");eO.CadetBlue=d9.namesToColours().get_Item("CadetBlue");eO.Chartreuse=d9.namesToColours().get_Item("Chartreuse");eO.Chocolate=d9.namesToColours().get_Item("Chocolate");eO.Coral=d9.namesToColours().get_Item("Coral");eO.CornflowerBlue=d9.namesToColours().get_Item("CornflowerBlue");eO.Cornsilk=d9.namesToColours().get_Item("Cornsilk");eO.Crimson=d9.namesToColours().get_Item("Crimson");eO.Cyan=d9.namesToColours().get_Item("Cyan");eO.DarkBlue=d9.namesToColours().get_Item("DarkBlue");eO.DarkCyan=d9.namesToColours().get_Item("DarkCyan");eO.DarkGoldenRod=d9.namesToColours().get_Item("DarkGoldenRod");eO.DarkGray=d9.namesToColours().get_Item("DarkGray");eO.DarkGrey=d9.namesToColours().get_Item("DarkGrey");eO.DarkGreen=d9.namesToColours().get_Item("DarkGreen");eO.DarkKhaki=d9.namesToColours().get_Item("DarkKhaki");eO.DarkMagenta=d9.namesToColours().get_Item("DarkMagenta");eO.DarkOliveGreen=d9.namesToColours().get_Item("DarkOliveGreen");eO.DarkOrange=d9.namesToColours().get_Item("DarkOrange");eO.DarkOrchid=d9.namesToColours().get_Item("DarkOrchid");eO.DarkRed=d9.namesToColours().get_Item("DarkRed");eO.DarkSalmon=d9.namesToColours().get_Item("DarkSalmon");eO.DarkSeaGreen=d9.namesToColours().get_Item("DarkSeaGreen");eO.DarkSlateBlue=d9.namesToColours().get_Item("DarkSlateBlue");eO.DarkSlateGray=d9.namesToColours().get_Item("DarkSlateGray");eO.DarkSlateGrey=d9.namesToColours().get_Item("DarkSlateGrey");eO.DarkTurquoise=d9.namesToColours().get_Item("DarkTurquoise");eO.DarkViolet=d9.namesToColours().get_Item("DarkViolet");eO.DeepPink=d9.namesToColours().get_Item("DeepPink");eO.DeepSkyBlue=d9.namesToColours().get_Item("DeepSkyBlue");eO.DimGray=d9.namesToColours().get_Item("DimGray");eO.DimGrey=d9.namesToColours().get_Item("DimGrey");eO.DodgerBlue=d9.namesToColours().get_Item("DodgerBlue");eO.FireBrick=d9.namesToColours().get_Item("FireBrick");eO.FloralWhite=d9.namesToColours().get_Item("FloralWhite");eO.ForestGreen=d9.namesToColours().get_Item("ForestGreen");eO.Fuchsia=d9.namesToColours().get_Item("Fuchsia");eO.Gainsboro=d9.namesToColours().get_Item("Gainsboro");eO.GhostWhite=d9.namesToColours().get_Item("GhostWhite");eO.Gold=d9.namesToColours().get_Item("Gold");eO.GoldenRod=d9.namesToColours().get_Item("GoldenRod");eO.Gray=d9.namesToColours().get_Item("Gray");eO.Grey=d9.namesToColours().get_Item("Grey");eO.Green=d9.namesToColours().get_Item("Green");eO.GreenYellow=d9.namesToColours().get_Item("GreenYellow");eO.HoneyDew=d9.namesToColours().get_Item("HoneyDew");eO.HotPink=d9.namesToColours().get_Item("HotPink");eO.IndianRed=d9.namesToColours().get_Item("IndianRed");eO.Indigo=d9.namesToColours().get_Item("Indigo");eO.Ivory=d9.namesToColours().get_Item("Ivory");eO.Khaki=d9.namesToColours().get_Item("Khaki");eO.Lavender=d9.namesToColours().get_Item("Lavender");eO.LavenderBlush=d9.namesToColours().get_Item("LavenderBlush");eO.LawnGreen=d9.namesToColours().get_Item("LawnGreen");eO.LemonChiffon=d9.namesToColours().get_Item("LemonChiffon");eO.LightBlue=d9.namesToColours().get_Item("LightBlue");eO.LightCoral=d9.namesToColours().get_Item("LightCoral");eO.LightCyan=d9.namesToColours().get_Item("LightCyan");eO.LightGoldenRodYellow=d9.namesToColours().get_Item("LightGoldenRodYellow");eO.LightGray=d9.namesToColours().get_Item("LightGray");eO.LightGrey=d9.namesToColours().get_Item("LightGrey");eO.LightGreen=d9.namesToColours().get_Item("LightGreen");eO.LightPink=d9.namesToColours().get_Item("LightPink");eO.LightSalmon=d9.namesToColours().get_Item("LightSalmon");eO.LightSeaGreen=d9.namesToColours().get_Item("LightSeaGreen");eO.LightSkyBlue=d9.namesToColours().get_Item("LightSkyBlue");eO.LightSlateGray=d9.namesToColours().get_Item("LightSlateGray");eO.LightSlateGrey=d9.namesToColours().get_Item("LightSlateGrey");eO.LightSteelBlue=d9.namesToColours().get_Item("LightSteelBlue");eO.LightYellow=d9.namesToColours().get_Item("LightYellow");eO.Lime=d9.namesToColours().get_Item("Lime");eO.LimeGreen=d9.namesToColours().get_Item("LimeGreen");eO.Linen=d9.namesToColours().get_Item("Linen");eO.Magenta=d9.namesToColours().get_Item("Magenta");eO.Maroon=d9.namesToColours().get_Item("Maroon");eO.MediumAquaMarine=d9.namesToColours().get_Item("MediumAquaMarine");eO.MediumBlue=d9.namesToColours().get_Item("MediumBlue");eO.MediumOrchid=d9.namesToColours().get_Item("MediumOrchid");eO.MediumPurple=d9.namesToColours().get_Item("MediumPurple");eO.MediumSeaGreen=d9.namesToColours().get_Item("MediumSeaGreen");eO.MediumSlateBlue=d9.namesToColours().get_Item("MediumSlateBlue");eO.MediumSpringGreen=d9.namesToColours().get_Item("MediumSpringGreen");eO.MediumTurquoise=d9.namesToColours().get_Item("MediumTurquoise");eO.MediumVioletRed=d9.namesToColours().get_Item("MediumVioletRed");eO.MidnightBlue=d9.namesToColours().get_Item("MidnightBlue");eO.MintCream=d9.namesToColours().get_Item("MintCream");eO.MistyRose=d9.namesToColours().get_Item("MistyRose");eO.Moccasin=d9.namesToColours().get_Item("Moccasin");eO.NavajoWhite=d9.namesToColours().get_Item("NavajoWhite");eO.Navy=d9.namesToColours().get_Item("Navy");eO.OldLace=d9.namesToColours().get_Item("OldLace");eO.Olive=d9.namesToColours().get_Item("Olive");eO.OliveDrab=d9.namesToColours().get_Item("OliveDrab");eO.Orange=d9.namesToColours().get_Item("Orange");eO.OrangeRed=d9.namesToColours().get_Item("OrangeRed");eO.Orchid=d9.namesToColours().get_Item("Orchid");eO.PaleGoldenRod=d9.namesToColours().get_Item("PaleGoldenRod");eO.PaleGreen=d9.namesToColours().get_Item("PaleGreen");eO.PaleTurquoise=d9.namesToColours().get_Item("PaleTurquoise");eO.PaleVioletRed=d9.namesToColours().get_Item("PaleVioletRed");eO.PapayaWhip=d9.namesToColours().get_Item("PapayaWhip");eO.PeachPuff=d9.namesToColours().get_Item("PeachPuff");eO.Peru=d9.namesToColours().get_Item("Peru");eO.Pink=d9.namesToColours().get_Item("Pink");eO.Plum=d9.namesToColours().get_Item("Plum");eO.PowderBlue=d9.namesToColours().get_Item("PowderBlue");eO.Purple=d9.namesToColours().get_Item("Purple");eO.RebeccaPurple=d9.namesToColours().get_Item("RebeccaPurple");eO.Red=d9.namesToColours().get_Item("Red");eO.RosyBrown=d9.namesToColours().get_Item("RosyBrown");eO.RoyalBlue=d9.namesToColours().get_Item("RoyalBlue");eO.SaddleBrown=d9.namesToColours().get_Item("SaddleBrown");eO.Salmon=d9.namesToColours().get_Item("Salmon");eO.SandyBrown=d9.namesToColours().get_Item("SandyBrown");eO.SeaGreen=d9.namesToColours().get_Item("SeaGreen");eO.SeaShell=d9.namesToColours().get_Item("SeaShell");eO.Sienna=d9.namesToColours().get_Item("Sienna");eO.Silver=d9.namesToColours().get_Item("Silver");eO.SkyBlue=d9.namesToColours().get_Item("SkyBlue");eO.SlateBlue=d9.namesToColours().get_Item("SlateBlue");eO.SlateGray=d9.namesToColours().get_Item("SlateGray");eO.SlateGrey=d9.namesToColours().get_Item("SlateGrey");eO.Snow=d9.namesToColours().get_Item("Snow");eO.SpringGreen=d9.namesToColours().get_Item("SpringGreen");eO.SteelBlue=d9.namesToColours().get_Item("SteelBlue");eO.Tan=d9.namesToColours().get_Item("Tan");eO.Teal=d9.namesToColours().get_Item("Teal");eO.Thistle=d9.namesToColours().get_Item("Thistle");eO.Tomato=d9.namesToColours().get_Item("Tomato");eO.Turquoise=d9.namesToColours().get_Item("Turquoise");eO.Violet=d9.namesToColours().get_Item("Violet");eO.Wheat=d9.namesToColours().get_Item("Wheat");eO.White=d9.namesToColours().get_Item("White");eO.WhiteSmoke=d9.namesToColours().get_Item("WhiteSmoke");eO.Yellow=d9.namesToColours().get_Item("Yellow");eO.YellowGreen=d9.namesToColours().get_Item("YellowGreen");};eP.New=function(fB,fC,fD,fE){return{Ticks:fB,Labels:fC,Angle:fD,ForceLabelsVisibility:fE};};eQ.New=function(fB,fC,fD,fE,fF,fG){return{Name:fB,X:fC,Y:fD,Data:fE,Palette:fF,Opacity:fG};};eR.Default={$:1};eS.New=function(fB,fC,fD,fE,fF,fG,fH){return{Name:fB,X:fC,Y:fD,Size:fE,FillColour:fF,BorderColour:fG,Shape:fH};};eT.Default={$:0};eU.New=function(fB,fC,fD,fE,fF,fG,fH){return{Name:fB,X:fC,Y:fD,Colour:fE,Thickness:fF,LineCap:fG,LineJoin:fH};};eV.Butt={$:0};eW.Miter={$:2};eX.New=function(fB,fC,fD,fE){return{Name:fB,Samples:fC,Colour:fD,BinCount:fE};};eY.parse=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6,f7,f8,f9,f_;function f$(gd){return{$:1,$0:gd};}function ga(gd){return{$:0,$0:gd};}function gb(gd,ge){return{$:2,$0:gd,$1:ge};}function gc(gd,ge){return dz.op_LessBarGreater(fO,fM,gd,ge);}fD=R.zero();fE=R.one();fF=(fG=D.name_kw(ej.kwList()),function(gd){return dz.op_DotGreaterGreater(fG,D.spaces(),gd[0],gd[1]);});fH=R.parse(fF);fI=R.parse(co.parse(fB));fJ=D.kw(",");fK=(fL=V.parse(fB,fH,fD),function(gd){return dz.op_BarGreaterGreater(fL,f$,gd[0],gd[1]);});fM=(fN=cc.parse(fB,fH,fI,fE),function(gd){return dz.op_BarGreaterGreater(fN,ga,gd[0],gd[1]);});fO=(fP=(fQ=(fR=D.pTry((fS=D.kw("("),function(gd){return dz.op_DotGreaterGreater(fF,fS,gd[0],gd[1]);})),(fT=D.sepBy(fH,fJ),function(gd){return dz.op_DotGreaterGreaterDot(fR,fT,gd[0],gd[1]);})),(fU=D.kw(")"),function(gd){return dz.op_DotGreaterGreater(fQ,fU,gd[0],gd[1]);})),function(gd){return dz.op_BarGreaterGreater(fP,function(ge){return gb(ge[0],ge[1]);},gd[0],gd[1]);});fV=function(gd){return dz.op_LessBarGreater(function(ge){return gc(ge[0],ge[1]);},fK,gd[0],gd[1]);};fW=D.kw("|");fX=(fY=(fZ=D.many((f0=(f1=(f2=(f3=D.kw("module"),function(gd){return dz.op_GreaterGreaterDot(f3,D.name(),gd[0],gd[1]);}),(f4=D.paren(D.sepBy(D.name(),fJ)),function(gd){return dz.op_DotGreaterGreaterDot(f2,f4,gd[0],gd[1]);})),(f5=D.kw("="),function(gd){return dz.op_DotGreaterGreater(f1,f5,gd[0],gd[1]);})),(f6=D.braces((f7=D.opt(fW),(f8=D.sepBy(fV,fW),function(gd){return dz.op_GreaterGreaterDot(f7,f8,gd[0],gd[1]);}))),function(gd){return dz.op_DotGreaterGreaterDot(f0,f6,gd[0],gd[1]);}))),function(gd){return dz.op_GreaterGreaterDot(D.spaces(),fZ,gd[0],gd[1]);}),(f9=D.opt(fW),function(gd){return dz.op_DotGreaterGreater(fY,f9,gd[0],gd[1]);}));f_=D.sepBy(fV,fW);return function(gd){return dz.op_DotGreaterGreaterDot(fX,f_,gd[0],gd[1]);};};eY.convert_instructions=function(fB,fC){var fD;function fE(fF,fG){return function(fH){var fI,fJ,fK,fL,fM,fN,fO;function fP(fZ,f0){return fZ[0]===fI&&fJ.get_Length()===fZ[1].get_Length();}function fQ(fZ,f0){return fZ[0]===fI;}function fR(fZ){var f0;function f1(f3){return f3[0];}function f2(f3){return fZ===f3;}f0=bc.tryFind(function(f3){return f2(f1(f3));},fO);return f0==null?null:{$:1,$0:f0.$0[1]};}function fS(fZ,f0){var f1,f2;f1=fR(f0);return f1==null?f0:(f2=f1.$0,f2.$==0?f2.$0:F.FailWith(((((fu.Curried(function(f3,f4,f5,f6){return f3("Module invokation failed: cannot substitute expression \\""+_2.toSafe(f4)+"\\" for \\""+_2.toSafe(f5)+"\\" in module \\""+_2.toSafe(f6)+"\\"");},4))(a.id))(R.to_string(a.id,f2)))(f0))(fZ)));}function fT(fZ,f0){return be.New(fS(fZ,f0.name));}function fU(fZ){var f0;f0=fR(fZ);return f0!=null&&f0.$==1?f0.$0:{$:0,$0:fZ};}function fV(fZ,f0){function f1(f2){var f3,f4;return f2.$==0?(f3=f2.$0,(f4=fR(f3),f4!=null&&f4.$==1?R.map(function(f5){return{$:0,$0:f5};},f4.$0):{$:0,$0:{$:0,$0:f3}})):f2.$==1?{$:0,$0:{$:1,$0:fS(fZ,f2.$0)}}:f2.$==2?{$:0,$0:{$:2,$0:fT(fZ,f2.$0)}}:{$:0,$0:co.Time};}return f0.map(function(f2){return R.expand(fU,f2);},function(f2){return R.expand(f1,f2);});}function fW(fZ,f0){var f1;return cc.create$4(b$.map(function(f2){return fT(fZ,f2);},f0.catalysts),b$.map(function(f2){return fT(fZ,f2);},f0.reactants),(f1=f0.reverse,f1!=null&&f1.$==1?{$:1,$0:fV(fZ,f1.$0)}:null),fV(fZ,f0.rate),b$.map(function(f2){return fT(fZ,f2);},f0.products));}function fX(fZ,f0){var f1,f2;f1=fT(fZ,f0.species);return V.create$4(f0.constant,R.expand(fU,f0.value),f1,(f2=f0.time,f2==null?null:{$:1,$0:R.expand(fU,f2.$0)}),f0.spatial);}function fY(fZ,f0){var f1,f2;f1=f0[0];f2=f0[1];return function(f3){var f4;return f3.$==1?[f1,new B({$:1,$0:fX(fZ,f3.$0),$1:f2})]:f3.$==2?(f4=A.map(function(f5){return R.expand(fU,f5);},f3.$1),(function(f5){return fE(f5[0],f5[1]);}([f1,f2]))({$:2,$0:f3.$0,$1:f4})):[new B({$:1,$0:fW(fZ,f3.$0),$1:f1}),f2];};}return fH.$==1?[fF,new B({$:1,$0:fH.$0,$1:fG})]:fH.$==2?(fI=fH.$0,(fJ=fH.$1,(fK=(fL=bc.tryFind(function(fZ){return fP(fZ[0],fZ[1]);},fB),fL==null?(fM=(((fu.Curried3(function(fZ,f0,f1){return fZ(_2.toSafe(f0)+"("+_2.toSafe(f1)+")");}))(a.id))(fI))(dk.concat(", ",A.map(function(fZ){return R.to_string(a.id,fZ);},fJ))),F.FailWith((fN=bc.tryFind(function(fZ){return fQ(fZ[0],fZ[1]);},fB),fN!=null&&fN.$==1?(((fu.Curried3(function(fZ,f0,f1){return fZ("No module definition with "+fA(f0)+" arguments found for invokation \\""+_2.toSafe(f1)+"\\"");}))(a.id))(fJ.get_Length()))(fM):(function(fZ){return function(f0){return fZ("No module definition found for module invocation \\""+_2.toSafe(f0)+"\\"");};}(a.id))(fM)))):[fL.$0[0][1],fL.$0[1]]),(fO=A.zip(fK[0],fJ),bc.fold(function(fZ,f0){return(function(f1){return fY(fI,f1);}(fZ))(f0);},[fF,fG],fK[1]))))):[new B({$:1,$0:fH.$0,$1:fF}),fG];};}fD=bc.fold(function(fF,fG){return(function(fH){return fE(fH[0],fH[1]);}(fF))(fG);},[B.Empty,B.Empty],fC);return[A.rev(fD[0]),A.rev(fD[1])];};eZ.$cctor=function(){eZ.$cctor=a.ignore;eZ.kwList=A.ofArray(["module","system","inference","directive","with"]);};e0.parse_list=function(fB,fC){var fD,fE;return D.sepBy((fD=D.kw("directive"),(fE=e0.parse(fB,fC),function(fF){return dz.op_GreaterGreaterDot(fD,fE,fF[0],fF[1]);})),D.spaces());};e0.parse=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0,f1,f2,f3,f4,f5,f6,f7,f8,f9,f_,f$,ga,gb,gc,gd,ge,gf,gg,gh,gi,gj,gk,gl,gm,gn;function go(gE){return bc.fold(function(gF,gG){var gH;gH=gG[0];if(gF.ContainsKey(gH))throw new cW.New((function(gI){return function(gJ){return gI("Failed trying to parse duplicate rate expression "+_2.toSafe(gJ));};}(a.id))(gH));else return gF.Add(gH,gG[1]);},new y.New([]),gE);}function gp(gE){return{$:4,$0:gE};}function gq(gE){return{$:3,$0:gE};}function gr(gE){return{$:1,$0:gE};}function gs(gE){return{$:0,$0:gE};}function gt(gE){return{$:2,$0:gE};}function gu(gE){return{$:6,$0:gE};}function gv(gE){return{$:8,$0:gE};}function gw(gE){return{$:9,$0:gE};}function gx(gE){return{$:5,$0:gE};}function gy(gE){return{$:10,$0:gE};}function gz(gE){return{$:7,$0:gE};}function gA(gE){return{$:11,$0:gE};}function gB(gE){return{$:13,$0:gE};}function gC(gE){return{$:14,$0:gE};}function gD(gE){return{$:12,$0:gE};}fD=(fE=D.list_of((fF=(fG=D.skw("="),function(gE){return dz.op_GreaterGreaterDot(fG,fB,gE[0],gE[1]);}),function(gE){return dz.op_DotGreaterGreaterDot(D.name(),fF,gE[0],gE[1]);})),(fH=function(gE){return D.preturn(go(gE));},function(gE){return dz.op_GreaterGreaterEquals(fE,fH,gE[0],gE[1]);}));fI=D.choice([(fJ=(fK=D.kw("deterministic"),(fL=bO.get_parse(),function(gE){return dz.op_GreaterGreaterDot(fK,fL,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(fJ,gp,gE[0],gE[1]);}),(fM=(fN=D.kw("stochastic"),(fO=_7.get_parse(),function(gE){return dz.op_GreaterGreaterDot(fN,fO,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(fM,gq,gE[0],gE[1]);}),(fP=(fQ=D.kw("simulations"),(fR=D.list_of(P.parse_named(fC)),function(gE){return dz.op_GreaterGreaterDot(fQ,fR,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(fP,gr,gE[0],gE[1]);}),(fS=(fT=D.kw("simulation"),(fU=P.parse(fC),function(gE){return dz.op_GreaterGreaterDot(fT,fU,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(fS,gs,gE[0],gE[1]);}),(fV=(fW=D.kw("simulator"),(fX=_1.get_parse(),function(gE){return dz.op_GreaterGreaterDot(fW,fX,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(fV,gt,gE[0],gE[1]);}),(fY=(fZ=D.kw("parameters"),(f0=D.list_of(bX.get_parse()),function(gE){return dz.op_GreaterGreaterDot(fZ,f0,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(fY,gu,gE[0],gE[1]);}),(f1=(f2=D.kw("sweeps"),(f3=D.list_of(b9.get_parse()),function(gE){return dz.op_GreaterGreaterDot(f2,f3,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(f1,gv,gE[0],gE[1]);}),(f4=(f5=D.kw("data"),(f6=D.list_of(D.name()),function(gE){return dz.op_GreaterGreaterDot(f5,f6,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(f4,gw,gE[0],gE[1]);}),(f7=(f8=D.kw("inference"),(f9=b0.get_parse(),function(gE){return dz.op_GreaterGreaterDot(f8,f9,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(f7,gx,gE[0],gE[1]);}),(f_=(f$=D.kw("spatial"),(ga=(_6.get_parse())(fC),function(gE){return dz.op_GreaterGreaterDot(f$,ga,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(f_,gy,gE[0],gE[1]);}),(gb=(gc=D.kw("rates"),function(gE){return dz.op_GreaterGreaterDot(gc,fD,gE[0],gE[1]);}),function(gE){return dz.op_BarGreaterGreater(gb,gz,gE[0],gE[1]);}),(gd=(ge=D.kw("plot_settings"),(gf=b_.parse(fC),function(gE){return dz.op_GreaterGreaterDot(ge,gf,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(gd,gA,gE[0],gE[1]);}),(gg=(gh=D.kw("moments"),function(gE){return dz.op_GreaterGreaterDot(gh,bD.parse(),gE[0],gE[1]);}),function(gE){return dz.op_BarGreaterGreater(gg,gB,gE[0],gE[1]);}),(gi=(gj=D.kw("synthesis"),(gk=b2.get_parse(),function(gE){return dz.op_GreaterGreaterDot(gj,gk,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(gi,gC,gE[0],gE[1]);}),(gl=(gm=D.kw("units"),(gn=b7.get_parse(),function(gE){return dz.op_GreaterGreaterDot(gm,gn,gE[0],gE[1]);})),function(gE){return dz.op_BarGreaterGreater(gl,gD,gE[0],gE[1]);})]);return function(gE){return fI([gE[0],gE[1]]);};};e1=x.HashSet=fu.Class({Add:function(fB){return this.add(fB);},add:function(fB){var fC,fD;fC=this.hash(fB);fD=this.data[fC];return fD==null?(this.data[fC]=[fB],this.count=this.count+1,true):this.arrContains(fB,fD)?false:(fD.push(fB),this.count=this.count+1,true);},arrContains:function(fB,fC){var fD,fE,fF,fG;fD=true;fE=0;fG=fC.length;while(fD&&fE<fG)if(this.equals.apply(null,[fC[fE],fB]))fD=false;else fE=fE+1;return!fD;},GetEnumerator:function(){return da.Get(fq.concat(this.data));},GetEnumerator0:function(){return da.Get(fq.concat(this.data));}},w,e1);e1.New$3=fu.Ctor(function(){e1.New$4.call(this,[],bk.Equals,bk.Hash);},e1);e1.New$4=fu.Ctor(function(fB,fC,fD){var fE;w.New.call(this);this.equals=fC;this.hash=fD;this.data=[];this.count=0;fE=da.Get(fB);try{while(fE.MoveNext())this.add(fE.Current());}finally{if(typeof fE=="object"&&"Dispose"in fE)fE.Dispose();}},e1);e2.ClosePath={$:3};e3.$cctor=function(){var fB,fC,fD,fE,fF,fG,fH;e3.$cctor=a.ignore;function fI(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fJ(ga,gb){return ce.New(ga,gb.outer,gb.width);}function fK(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fL(ga,gb){return ce.New(gb.inner,ga,gb.width);}function fM(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fN(ga,gb){return ce.New(gb.inner,gb.outer,ga);}function fO(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fP(ga,gb){return cf.New(ga,gb.y,gb.width,gb.value);}function fQ(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fR(ga,gb){return cf.New(gb.x,ga,gb.width,gb.value);}function fS(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fT(ga,gb){return cf.New(gb.x,gb.y,ga,gb.value);}function fU(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fV(ga,gb){return cf.New(gb.x,gb.y,gb.width,ga);}function fW(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fX(ga,gb){return cg.New(ga,gb.xmax,gb.ymin,gb.ymax,gb.value);}function fY(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function fZ(ga,gb){return cg.New(gb.xmin,ga,gb.ymin,gb.ymax,gb.value);}function f0(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function f1(ga,gb){return cg.New(gb.xmin,gb.xmax,ga,gb.ymax,gb.value);}function f2(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function f3(ga,gb){return cg.New(gb.xmin,gb.xmax,gb.ymin,ga,gb.value);}function f4(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function f5(ga,gb){return cg.New(gb.xmin,gb.xmax,gb.ymin,gb.ymax,ga);}function f6(ga,gb){return dz.op_DotGreaterGreater(D.pfloat(),D.spaces(),ga,gb);}function f7(ga,gb){return ch.New(ga,gb.core,gb.points,gb.rectangles);}function f8(ga,gb){return dz.op_DotGreaterGreater(fB,D.spaces(),ga,gb);}function f9(ga,gb){return ch.New(gb.random,{$:1,$0:ga},gb.points,gb.rectangles);}function f_(ga,gb){return ch.New(gb.random,gb.core,ga,gb.rectangles);}function f$(ga,gb){return ch.New(gb.random,gb.core,gb.points,ga);}e3.default_core=ce.New(0,0,0);e3.default_point=cf.New(0,0,0,0);e3.default_rectangle=cg.New(0,1,0,1,0);e3.defaults=ch.New(0,null,B.Empty,B.Empty);e3.CONSTANT="constant";e3.INIT="init";e3.SPATIAL="spatial";e3.parser=(fB=D.record(cd.default_core(),A.ofArray([["inner",function(ga){return dz.op_BarGreaterGreater(function(gb){return fI(gb[0],gb[1]);},function(gb){return function(gc){return fJ(gb,gc);};},ga[0],ga[1]);}],["outer",function(ga){return dz.op_BarGreaterGreater(function(gb){return fK(gb[0],gb[1]);},function(gb){return function(gc){return fL(gb,gc);};},ga[0],ga[1]);}],["width",function(ga){return dz.op_BarGreaterGreater(function(gb){return fM(gb[0],gb[1]);},function(gb){return function(gc){return fN(gb,gc);};},ga[0],ga[1]);}]])),(fC=D.record(cd.default_point(),A.ofArray([["x",function(ga){return dz.op_BarGreaterGreater(function(gb){return fO(gb[0],gb[1]);},function(gb){return function(gc){return fP(gb,gc);};},ga[0],ga[1]);}],["y",function(ga){return dz.op_BarGreaterGreater(function(gb){return fQ(gb[0],gb[1]);},function(gb){return function(gc){return fR(gb,gc);};},ga[0],ga[1]);}],["width",function(ga){return dz.op_BarGreaterGreater(function(gb){return fS(gb[0],gb[1]);},function(gb){return function(gc){return fT(gb,gc);};},ga[0],ga[1]);}],["value",function(ga){return dz.op_BarGreaterGreater(function(gb){return fU(gb[0],gb[1]);},function(gb){return function(gc){return fV(gb,gc);};},ga[0],ga[1]);}]])),(fD=D.record(cd.default_rectangle(),A.ofArray([["xmin",function(ga){return dz.op_BarGreaterGreater(function(gb){return fW(gb[0],gb[1]);},function(gb){return function(gc){return fX(gb,gc);};},ga[0],ga[1]);}],["xmax",function(ga){return dz.op_BarGreaterGreater(function(gb){return fY(gb[0],gb[1]);},function(gb){return function(gc){return fZ(gb,gc);};},ga[0],ga[1]);}],["ymin",function(ga){return dz.op_BarGreaterGreater(function(gb){return f0(gb[0],gb[1]);},function(gb){return function(gc){return f1(gb,gc);};},ga[0],ga[1]);}],["ymax",function(ga){return dz.op_BarGreaterGreater(function(gb){return f2(gb[0],gb[1]);},function(gb){return function(gc){return f3(gb,gc);};},ga[0],ga[1]);}],["value",function(ga){return dz.op_BarGreaterGreater(function(gb){return f4(gb[0],gb[1]);},function(gb){return function(gc){return f5(gb,gc);};},ga[0],ga[1]);}]])),D.record(cd.defaults(),A.ofArray([["random",function(ga){return dz.op_BarGreaterGreater(function(gb){return f6(gb[0],gb[1]);},function(gb){return function(gc){return f7(gb,gc);};},ga[0],ga[1]);}],["centralcore",function(ga){return dz.op_BarGreaterGreater(function(gb){return f8(gb[0],gb[1]);},function(gb){return function(gc){return f9(gb,gc);};},ga[0],ga[1]);}],["points",(fE=(fF=D.list_of(fC),function(ga){return dz.op_DotGreaterGreater(fF,D.spaces(),ga[0],ga[1]);}),function(ga){return dz.op_BarGreaterGreater(fE,function(gb){return function(gc){return f_(gb,gc);};},ga[0],ga[1]);})],["rectangles",(fG=(fH=D.list_of(fD),function(ga){return dz.op_DotGreaterGreater(fH,D.spaces(),ga[0],ga[1]);}),function(ga){return dz.op_BarGreaterGreater(fG,function(gb){return function(gc){return f$(gb,gc);};},ga[0],ga[1]);})]])))));};e4=bl.NotId=fu.Class({},G,e4);e4.New=function(fB){return new e4({Data0:fB});};e5.$cctor=function(){e5.$cctor=a.ignore;e5.commit_number="0";e5.default_matching_degree=1;e5.default_toehold_bind_rate=0.0003;e5.default_toehold_unbind_rate=0.1126;e5.default_leak_rate_l=1E-09;e5.default_leak_rate_w=db.default_leak_rate_l()/100;e5.default_tau_rate=db.default_toehold_unbind_rate();e5.default_toehold_length=6;e5.default_specificity_length=20;e5.default_elementary_migration_rate=1/0.000125;e5.default_tolerance=1E-06;e5.array_of_list=U.ofList;e5.newline="\\r\\n";};e6=bp.NamedObject=fu.Class({get_Name:function(){return this.name;},get_Data:function(){return this.data;}},w,e6);e6.New=fu.Ctor(function(fB,fC){w.New.call(this);this.name=fB;this.data=fC;},e6);e7=bp.BayesTable=fu.Class({get_ColumnNames:function(){return this.columnNames.get_Keys();},get_ColumnCount:function(){return U.length(this.data);},GetColumn:function(fB){return U.get(this.data,this.columnNames.Item(fB));}},w,e7);e7.New=fu.Ctor(function(fB,fC){w.New.call(this);this.data=fB;this.columnNames=fC;},e7);e8.Empty={$:3};e9.New=function(fB,fC,fD){return{R:fB,G:fC,B:fD};};e$.New=function(fB,fC,fD,fE,fF,fG,fH){return{Name:fB,BarCenters:fC,BarHeights:fD,BarWidth:fE,FillColour:fF,BorderColour:fG,Shadow:fH};};fa=v.FormatException=fu.Class({},G,fa);fb=v.OverflowException=fu.Class({},G,fb);fc.$cctor=function(){var fB;fc.$cctor=a.ignore;fc.defaults=b1.New(3,1E-16,false,B.Empty);fc.pmonomial=bD.op_BarGreaterGreater(bD.op_GreaterGreaterDot(D.spaces(),D.angleBrackets(D.sepBy1(bD.op_DotGreaterGreaterDot(bD.op_BarGreaterGreater(bD.op_DotGreaterGreater(D.name(),D.spaces()),be.create),(fB=D.choice([bD.op_BarGreaterGreater(bD.op_DotGreaterGreater(bD.op_GreaterGreaterDot(D.kw("^"),D.pint32()),D.spaces()),F.toInt),D.preturn(1)]),function(fC){return fB([fC[0],fC[1]]);})),D.kw("*")))),bD.canonicalMonomial);fc.pplot=R.parse(bD.pmonomial());fc.parse=bD.parse_defaults(bD.defaults());};fd.$cctor=function(){fd.$cctor=a.ignore;fd.empty=new y.New([]);};de.Identity=function(fB,fC){var fD,fE,fF,fG;fD=fv.min(fB,fC);fE=new df.New(fB,fC);for(fF=0,fG=fD-1;fF<=fG;fF++)fE.get_Item(fF).set_Item(fF,1);return fE;};fe.New=function(fB,fC,fD,fE,fF,fG,fH,fI){return{e:fB,Dq:fC,DqUp:fD,DqDown:fE,delta:fF,x:fG,z:fH,count:fI};};ff.SolveCore=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN;fD=cO.numRows(fB);fE=cO.copy(fB);fF=cL.copy(fC);fo.solveCore(fE,fF);fG=new fz(fD);for(fH=0,fI=fD-1;fH<=fI;fH++){fJ=fF[fH];fL=fE.get_Item(fH);for(fM=fD-fH,fN=fD-1;fM<=fN;fM++)fJ=fJ-fG[fM]*fL[fM];fG[fD-fH-1]=fJ;}return fG;};ff.SparseSolveCore=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM,fN,fO,fP,fQ,fR,fS,fT,fU,fV,fW,fX,fY,fZ,f0;fG=fB.get_RowDimension();fD=U.ofSeq(bc.delay(function(){return bc.map(function(f1){return fC[f1];},F.range(0,fG-1));}));fE=U.ofSeq(bc.delay(function(){return bc.map(a.id,F.range(0,fG-1));}));fF=U.create(fG,0);for(fH=0,fI=fG-1;fH<=fI;fH++){fJ=0;fK=fB.get_Items(fJ,fH);fL=0;for(fO=0,fP=fG-fH-1;fO<=fP;fO++){fL=fB.get_Items(fO,fH);fv.abs(fL)>fv.abs(fK)?(fJ=fO,fK=fL):void 0;}fv.abs(fK)<1E-12?F.FailWith("Cannot apply Gauss method"):void 0;fB.ScaleRow(fJ,fH+1,fG-1,1/fK);U.set(fD,fJ,U.get(fD,fJ)/fK);fB.set_Items(fJ,fH,1);fJ!==fG-fH-1?(fB.SwitchRows(fJ,fG-fH-1),fM=U.get(fD,fG-fH-1),U.set(fD,fG-fH-1,U.get(fD,fJ)),U.set(fD,fJ,fM),fN=U.get(fE,fG-fH-1),U.set(fE,fG-fH-1,U.get(fE,fJ)),U.set(fE,fJ,fN)):void 0;for(fQ=0,fR=fG-fH-2;fQ<=fR;fQ++){fL=fB.get_Item$1(fQ,fH);if(fL!==0){for(fS=fH+1,fT=fG-1;fS<=fT;fS++)fB.set_Item$1(fQ,fS,fL-fB.get_Item$1(fG-fH-1,fS));U.set(fD,fQ,U.get(fD,fQ)-fL*U.get(fD,fG-fH-1));fB.set_Item$1(fQ,fH,0);}else void 0;}}for(fU=0,fV=fG-1;fU<=fV;fU++){fW=U.get(fD,fU);fY=fB.get_Item(fU);for(fZ=0,f0=fY.get_Count()-1;fZ<=f0;fZ++)if(U.get(fY.get_Indices(),fZ)>=fG-fU)fW=fW-U.get(fF,U.get(fY.get_Indices(),fZ))*U.get(fB.get_Item(fU).get_Items(),fZ);U.set(fF,fG-fU-1,fW);}return cL.ofArray(fF);};fg.Rejected={$:1};fh.Empty={$:3};fi.buildHistogram=function(fB,fC){var fD,fE,fF,fG,fH,fI;fD=1E-06;fE=bc.min(fB)-fD;fF=(bc.max(fB)+fD-fE)/fC;fG=A.init(fC,function(fJ){return fE+fF*0.5+fJ*fF;});fH=U.init(fC,function(fJ){return fE+fJ*fF;});fI=U.create(fC,0);bc.iter(function(fJ){U.set(fI,fJ,U.get(fI,fJ)+1);},bc.map(function(fJ){return fJ<0?~fJ-1:fJ;},bc.map(function(fJ){return U.binarySearch(fH,function(fK){return bk.Compare(fJ,fK);},0,U.length(fH));},fB)));return fj.New(fG,A.ofArray(fI),fF);};fj.New=function(fB,fC,fD){return{BinCentres:fB,BinCounters:fC,BinWidth:fD};};fk.WithoutShadow={$:0};fl=v.IndexOutOfRangeException=fu.Class({},G,fl);fl.New=fu.Ctor(function(){fl.New$1.call(this,"Index was outside the bounds of the array.");},fl);fl.New$1=fu.Ctor(function(fB){this.message=fB;cG.setPrototypeOf(this,fl.prototype);},fl);fm.$cctor=function(){fm.$cctor=a.ignore;fm.zero={$:1,$0:0};fm.one={$:1,$0:1};};fn.$cctor=function(){fn.$cctor=a.ignore;fn.improbable=4.94065645841247E-324;fn.log_improbable=fv.log(dn.improbable());fn["lcg.a"]=1664525;fn["lcg.c"]=1013904223;fn["lcd.m"]=fv.pow(2,32);fn["lcg.d"]=1/dn["lcd.m"]();};fo.solveCore=function(fB,fC){var fD,fE,fF,fG,fH,fI,fJ,fK;fD=0;for(fE=0,fF=cO.numRows(fB)-1;fE<=fF;fE++){fI=cO.numRows(fB)-fE-1;fD=0;for(fJ=0,fK=fI;fJ<=fK;fJ++)if(fv.abs((fB.get_Item(fJ))[fE])>fv.abs((fB.get_Item(fD))[fE]))fD=fJ;fv.abs((fB.get_Item(fD))[fE])<1E-12?F.FailWith("Cannot apply Gauss method"):void 0;fG=fB.get_Item(fD);fH=fG[fE];fo.divideFrom(fG,fH,fE+1);fC[fD]=fC[fD]/fH;fG[fE]=1;fD!==fI?(fo.flipRows(fB,fD,fI),fo.flipValues(fC,fD,fI)):void 0;fo.processOtherRows(fB,fC,fE);}};fo.divideFrom=function(fB,fC,fD){var fE,fF;for(fE=fD,fF=fB.length-1;fE<=fF;fE++)fB[fE]=fB[fE]/fC;};fo.flipRows=function(fB,fC,fD){var fE,fF,fG,fH,fI;fE=fB.get_Item(fC);fF=fB.get_Item(fD);for(fG=0,fH=fE.length-1;fG<=fH;fG++){fI=fE[fG];fE[fG]=fF[fG];fF[fG]=fI;}};fo.flipValues=function(fB,fC,fD){var fE;fE=fB[fC];fB[fC]=fB[fD];fB[fD]=fE;};fo.processOtherRows=function(fB,fC,fD){var fE,fF,fG,fH,fI,fJ,fK,fL;fE=fB.MatrixData;fF=fE.length-fD-1|0;fG=+fC[fF];fH=fE[fF];fI=0;for(;fI<fF;fI++){fJ=fE[fI];fK=+fJ[fD];if(fK!==0){fL=fD|0+1;for(;fL<fJ.length;fL++)fJ[fL]=+fJ[fL]-fK*+fH[fL];fC[fI]=+fC[fI]-fK*fG;fJ[fD]=0;}}};bn.createNormal=function(fB,fC){return fC>0?{$:0,$0:cn.New(fB,fC)}:F.FailWith("Cannot create Normal distribution with non-positive sigma. Value supplied: "+fA(fC));};bn.createLogNormal=function(fB,fC){return fC>0?{$:1,$0:cm.New(fB,fC)}:F.FailWith("Cannot create LogNormal distribution with non-positive sigma. Value supplied: "+fA(fC));};bn.createTruncatedNormal=function(fB,fC,fD,fE){return{$:2,$0:cl.New(fB,fC,fD,fE,dn.normCDF(fB,fC,fE)-dn.normCDF(fB,fC,fD))};};fp.New=function(fB,fC,fD,fE,fF,fG){return{GridLines:fB,Plots:fC,IsLegendEnabled:fD,IsNavigationEnabled:fE,IsTooltipPlotCoordsEnabled:fF,VisibleRegion:fG};};U.binarySearch=function(fB,fC,fD,fE){var fF,fG,fH,fI;fF=fD;fG=fE-1;if(fD<0)throw new fs.New("index","Non-negative number required.");else null;if(fE>U.length(fB))throw new eq.New$2("Offset and length were out of bounds for the array or count is greater than the number of elements from index to the end of the source collection.");else null;if(fE<fD)throw new fs.New("length","Non-negative number required.");else null;while(true)if(fF>fG)return~fF;else{fH=(fF+fG)/2>>0;fI=fC(U.get(fB,fH));if(fF===fG)return fI===0?fF:fI>0?~(fF+1):~fF;else if(fI<=0)fG=fH;else fF=fH+1;}};fq.concat=function(fB){var fC,fD;fC=[];for(var fE in fB)fC.push.apply(fC,fB[fE]);return fC;};fr=v.MatchFailureException=fu.Class({},G,fr);fr.New=fu.Ctor(function(fB,fC,fD){this.message=fB+" at "+fA(fC)+":"+fA(fD);cG.setPrototypeOf(this,fr.prototype);},fr);fs=v.ArgumentOutOfRangeException=fu.Class({},G,fs);fs.New=fu.Ctor(function(fB,fC){this.message=fC+"\\nParameter name: "+fB;cG.setPrototypeOf(this,fs.prototype);},fs);}());\r\n\r\n\r\nif (typeof IntelliFactory !==\'undefined\') {\r\n  IntelliFactory.Runtime.ScriptBasePath = \'/Content/\';\r\n  IntelliFactory.Runtime.Start();\r\n}\r\n'},function(f,t,e){"use strict";e.r(t),e.d(t,"config",(function(){return N})),e.d(t,"user_parse_code",(function(){return s})),e.d(t,"user_get_exports",(function(){return c})),e.d(t,"user_get_export",(function(){return l})),e.d(t,"user_infer_gui",(function(){return d})),e.d(t,"user_get_sim_runs",(function(){return p})),e.d(t,"user_state_space",(function(){return E})),e.d(t,"user_state_space_jit",(function(){return h})),e.d(t,"expression_to_string",(function(){return G})),e.d(t,"mcplot_to_string",(function(){return v})),e.d(t,"completeInitialization",(function(){return M})),e.d(t,"sendFinished",(function(){return S})),e.d(t,"sendIG",(function(){return L})),e.d(t,"sendExport",(function(){return H})),e.d(t,"generateAndSendExports",(function(){return U})),e.d(t,"handleGenerateExports",(function(){return k})),e.d(t,"handleException",(function(){return W})),e.d(t,"processMessage",(function(){return q}));var n=e(1),r=e.n(n),i=e(2),o=e.n(i),a=function(){function f(f){this.Module=f,this.extractionCache={},this.writeCache={},this.sizeOfFloat64=8,this.fnSundialsSolverWasm=this.Module.cwrap("fnSundialsSolver","number",["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"]),this.fnSundialsCMESolverWasm=this.Module.cwrap("fnSundialsCMESolver","number",["number","number","number","number","number","number","number","number","number","number","number","number","number"])}return f.prototype.allocEmHeap=function(f){return this.Module._malloc(f)},f.prototype.allocFloat64EmHeapAndCopyTo=function(f){var t=new Float64Array(f),e=t.length*t.BYTES_PER_ELEMENT,n=this.Module._malloc(e),r=new Uint8Array(this.Module.HEAPU8.buffer,n,e);return r.set(new Uint8Array(t.buffer)),r.byteOffset},f.prototype.allocInt32EmHeapAndCopyTo=function(f){var t=new Int32Array(f),e=t.length*t.BYTES_PER_ELEMENT,n=this.Module._malloc(e),r=new Uint8Array(this.Module.HEAPU8.buffer,n,e);return r.set(new Uint8Array(t.buffer)),r.byteOffset},f.prototype.freeEmHeap=function(f){this.Module._free(f)},f.prototype.extractFloat64ArrayFromEmMemory=function(f,t){var e=f+"_"+t;return this.extractionCache[e]||(this.extractionCache[e]=new Float64Array(this.Module.HEAPU8.buffer,f,t)),this.extractionCache[e]},f.prototype.writeNumArrayToEmMemory=function(f,t){var e=t.length,n=f+"_"+e;this.writeCache[n]||(this.writeCache[n]=new Float64Array(this.Module.HEAPU8.buffer,f,e)),this.writeCache[n].set(t)},f.prototype.fnSundialsSolver=function(f){var t=this,e=f.sundialsOutput,n=this.Module.addFunction((function(f,n,r){var i=t.extractFloat64ArrayFromEmMemory(n,r);e(f,i)}),"ddii"),r=f.functionalRates,i=this.Module.addFunction((function(f,e,n,i){var o=t.extractFloat64ArrayFromEmMemory(n,i),a=r(f,o);t.writeNumArrayToEmMemory(e,a)}),"vdiii"),o=this.allocInt32EmHeapAndCopyTo(f.stoichM),a=this.allocInt32EmHeapAndCopyTo(f.powersM),u=this.allocFloat64EmHeapAndCopyTo(f.ratesM),s=this.allocInt32EmHeapAndCopyTo(f.stoichF),c=this.allocFloat64EmHeapAndCopyTo(f.concs),l=this.allocFloat64EmHeapAndCopyTo(f.t),d=this.allocEmHeap(f.rNM*this.sizeOfFloat64),p=this.allocEmHeap(f.rNF*this.sizeOfFloat64),m=this.fnSundialsSolverWasm(f.sN,f.rNM,o,a,u,f.rNF,s,i,c,l,f.tN,n,f.stiff,f.abstol,f.reltol,d,p),_=this.extractFloat64ArrayFromEmMemory(c,f.concs.length);return f.conc=_,this.Module.removeFunction(i),this.Module.removeFunction(n),this.freeEmHeap(p),this.freeEmHeap(d),this.freeEmHeap(l),this.freeEmHeap(c),this.freeEmHeap(s),this.freeEmHeap(u),this.freeEmHeap(a),this.freeEmHeap(o),m},f.prototype.fnSundialsCMESolver=function(f){var t=this,e=f.sundialsOutput,n=this.Module.addFunction((function(f,n,r){var i=t.extractFloat64ArrayFromEmMemory(n,r);e(f,i)}),"ddii"),r=(this.allocInt32EmHeapAndCopyTo(f.stoichM),this.allocFloat64EmHeapAndCopyTo(f.propensities)),i=this.allocInt32EmHeapAndCopyTo(f.sources),o=this.allocInt32EmHeapAndCopyTo(f.targets),a=this.allocFloat64EmHeapAndCopyTo(f.diagonals),u=this.allocFloat64EmHeapAndCopyTo(f.prob_mass),s=this.allocFloat64EmHeapAndCopyTo(f.timesToReturnParam),c=this.fnSundialsCMESolverWasm(f.stateN,f.transN,r,i,o,a,u,s,f.numTimesToReturnParam,n,f.stiff,f.abstol,f.reltol),l=this.extractFloat64ArrayFromEmMemory(u,f.prob_mass.length);return f.prob_mass=l,this.freeEmHeap(s),this.freeEmHeap(u),this.freeEmHeap(a),this.freeEmHeap(o),this.freeEmHeap(i),this.freeEmHeap(r),this.Module.removeFunction(n),c},f}(),u=e(3);eval.call(null,u);var s,c,l,d,p,m,_,C,g,$,D,B,b,E,h,G,v,F,y,I,w={contents:!1},N={loader:function(){var f=e(6);f=f.replace(/('|")use strict('|");?/,""),eval.call(null,f)},isJITfunc:null,getJITfunc:null,processMessage:q};r()({locateFile:function(f){return"SundialsSolver.wasm"==f?o.a:f}}).then((function(f){var t=new a(f);M(N,t)})),void 0===I&&(I={now:function(){return 0}});var A=[];function M(f,t){!function(f,t){var e=self;e.window=self,e.window.WS_EM_GLUE=t,f(),delete e.window}(f.loader,t),function(f,t){"undefined"==typeof Microsoft&&console.log("Worker initialization failed: Microsoft namespace not defined. Bad F# bundle import?");s=Microsoft.Research.CRNEngine.JSONAPI.user_parse_code,c=Microsoft.Research.CRNEngine.JSONAPI.user_get_exports,l=Microsoft.Research.CRNEngine.JSONAPI.user_get_export,d=Microsoft.Research.CRNEngine.JSONAPI.user_infer_gui,p=Microsoft.Research.CRNEngine.JSONAPI.user_get_sim_runs,m=Microsoft.Research.CRNEngine.JSONAPI.simulateFloat,_=Microsoft.Research.CRNEngine.JSONAPI.simulateFloatJIT,C=Microsoft.Research.CRNEngine.JSONAPI.simulateMeanStdev,g=Microsoft.Research.CRNEngine.JSONAPI.simulateMeanStdevProbabilities,$=Microsoft.Research.CRNEngine.JSONAPI.simulateSpatial1D,D=Microsoft.Research.CRNEngine.JSONAPI.simulateSpatial2D,B=Microsoft.Research.CRNEngine.JSONAPI.simulateMeanStdevTable,b=Microsoft.Research.CRNEngine.JSONAPI.getProbabilityMap,E=Microsoft.Research.CRNEngine.JSONAPI.user_state_space,h=Microsoft.Research.CRNEngine.JSONAPI.user_state_space_jit,G=Microsoft.Research.CRNEngine.JSONAPI.expression_to_string,v=Microsoft.Research.CRNEngine.JSONAPI.mcplot_to_string,y=null==f?function(f){return!1}:f,F=t}(f.isJITfunc,f.getJITfunc);var e=A;A=null;for(var n=0,r=e;n<r.length;n++){V(r[n])}}function S(){self.postMessage({mtype:"finished"},void 0)}function L(f){var t={mtype:"model",model:f};return self.postMessage(t,void 0),f}function H(f){var t={mtype:"export",export:f};self.postMessage(t,void 0)}function U(f,t,e){for(var n=0,r=c(f,t,e);n<r.length;n++){H(r[n])}}function R(f){return function(t){var e={mtype:"simresult",row:{instance:f,time:t.time,values:t.values}};self.postMessage(e,void 0)}}function O(f){return function(t){var e={mtype:"simtable",table:{instance:f,time:t.times,values:t.columns.map((function(f){return f.values}))}};self.postMessage(e,void 0)}}function x(f){return function(t){var e={mtype:"newplottable",plottable:{instance:f,plottable:t}};self.postMessage(e,void 0)}}function j(f){return function(f){var t={mtype:"statespace",statespace:f};self.postMessage(t,void 0)}}function J(f){var t={mtype:"parameterdefinitions",nodeId:f.nodeId,parameters:f.parameters};self.postMessage(t,void 0)}function T(f){var t={mtype:"summary",nodeId:f.nodeId,summary:f.summary};self.postMessage(t,void 0);var e={mtype:"inferenceprogress",nodeId:f.nodeId,progress:f.iteration};self.postMessage(e,void 0);var n=void 0,r=-1/0;if(null!=f.state.BurninPhase){var i=f.state.BurninPhase;n=i.mle,r=i.mle.lglk}else{var o=f.state.SamplingPhase;n=o.mle,r=o.mle.lglk;var a=o.chain[0];if(a&&0==o.thinningSkippedCount){var u={mtype:"inferencechainupdate",nodeId:f.nodeId,update:a};self.postMessage(u,void 0)}}if(f.lkincreased){var s={mtype:"parameterresult",nodeId:f.nodeId,values:n};self.postMessage(s,void 0)}if(null!=f.mlesims){var c=f.mlesims;console.log("MLE lglk increased to "+r+". sending "+c.length+" simulations");for(var l=0;l<c.length;l++){var d={result:c[l],sim_id:l},p={mtype:"inferenceresult",nodeId:f.nodeId,result:d};self.postMessage(p,void 0)}}}function k(f,t){for(var e=0,n=c(!1,f,t);e<n.length;e++){H(n[e])}}function P(f,t){if(null!=f.task&&"Parse"==f.task.task_type)throw"this model is designed for parsing only";!function(f,t){L(f);var e=f.nodes[t],n={mtype:"node",node:e};self.postMessage(n,void 0);var r=p(f,e.top.name),i={mtype:"simtype",simtype:r.value_type};self.postMessage(i,void 0);var o=r.instances.map((function(f,t){return{id:t,crnName:e.top.name,instance:f}})),a={mtype:"instancedefinitions",nodeId:t,definitions:o};self.postMessage(a,void 0);for(var u=0;u<o.length;u++){var s=o[u],c=s.instance,l=R(s.id),d=O(s.id),b=I.now();switch(r.value_type){case"Float":if(y(e)){var E=x(s.id),h=F(e,c);_(e,h,l,E,H,L,w)}else m(f,e.top.name,c,l,H,w);break;case"MeanStdev":C(f,e.top.name,c,l,H,w);break;case"MeanStdevProbabilities":var G=j(s.id),v=g(f,e.top.name,c,G,l,H,w),N={mtype:"probabilities",probabilities:{instance:s.instance,probabilities:v}};self.postMessage(N,void 0);break;case"Spatial1D":$(f,e.top.name,c,l,H,w);break;case"Spatial2D":D(f,e.top.name,c,l,H,w);break;case"MeanStdevTable":B(f,e.top.name,c,d,H,w)}var A=I.now();console.log("Simulation took "+(A-b)+" milliseconds")}}(f,t)}function K(f,t){var e=p(f,t),n={mtype:"simtype",simtype:e.value_type};self.postMessage(n,void 0);var r={mtype:"instancedefinitions",nodeId:t,definitions:e.instances.map((function(f,t){return{id:t,instance:f}}))};self.postMessage(r,void 0)}function W(f){var t="function"==typeof f.get_Message?f.get_Message():null==f.message?""+f:f.message;if(null!=f.errors){var e={mtype:"error",error:{message:t,positions:f.errors}};self.postMessage(e,void 0)}else{e={mtype:"error",error:{message:t}};self.postMessage(e,void 0)}}function q(f){var t,e,n,r,i,o,a,u,c=f.data;console.log("worker request: "+c.mtype);try{switch(c.mtype){case"parsecode":null==(u=c.code)&&(u=""),L(s(u));break;case"generateexports":k(c.model,c.nodeId);break;case"generateexport":i=c.model,o=c.nodeId,a=c.id,H(l(i,o,a));break;case"simulategui":P(c.model,c.nodeId);break;case"simulatesingle":!function(f,t,e){var n=p(f,t),r=e.instance,i=R(e.id),o=O(e.id),a=I.now();switch(n.value_type){case"Float":var u=f.nodes[t];if(y(u)){var s=x(e.id),c=F(u,r);_(u,c,i,s,H,L,w)}else m(f,t,r,i,H,w);break;case"MeanStdev":C(f,t,r,i,H,w);break;case"MeanStdevProbabilities":var l=j(e.id),d=g(f,t,r,l,i,H,w),b={mtype:"probabilities",probabilities:{instance:e.instance,probabilities:d}};self.postMessage(b,void 0);break;case"Spatial1D":$(f,t,r,i,H,w);break;case"Spatial2D":D(f,t,r,i,H,w);break;case"MeanStdevTable":B(f,t,r,o,H,w)}var E=I.now();console.log("Simulation took "+(E-a)+" milliseconds")}(c.model,c.nodeId,c.definition);break;case"infergui":!function(f){if(null!=f.task&&"Parse"==f.task.task_type)throw"this model is designed for parsing only";for(var t in f.nodes)K(f,t);d(f,H,J,T,w)}(c.model);break;case"getsimrunsgui":!function(f,t){if(null!=f.task&&"Parse"==f.task.task_type)throw"this model is designed for parsing only";var e={mtype:"node",node:f.nodes[t]};self.postMessage(e,void 0),K(f,t)}(c.model,c.nodeId);break;case"statespace":!function(f,t){if(null!=f.task&&"Parse"==f.task.task_type)throw"this model is designed for parsing only";var e=null;for(var n in f.nodes){e=f.nodes[n];break}if(t){var r=p(f,e.top.name).instances[0],i=F(e,r),o=h(i);j()(o)}else{o=E(f);j()(o)}}(c.model,c.jit);break;case"getprobabilitymap":t=c.probabilities,e=c.species,n=c.lowerBound,r={mtype:"probabilitymap",map:b(t,e,n)},self.postMessage(r,void 0);break;case"getcloudcapabilities":self.postMessage({mtype:"pools",account:"",pools:[]},void 0);break;case"synthesis":self.postMessage({mtype:"error",error:{message:"Synthesis not available for run-in-browser"}},void 0)}S()}catch(f){W(f)}}function V(f){null==A?N.processMessage(f):A.push(f)}self.addEventListener("message",V)}]);
//# sourceMappingURL=CRNEngine.worker.10305745e7d2382adbfb.js.map